<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent flexRow">
    <div style="flex:1 1 50%" id="list" class="flexColumn"></div>
    <div style="flex:1 1 calc(50% - 3em)" class="flexColumn">
        <div id="mst"></div>
        <input type="file" id="fileSelector" multiple="multiple" style="flex: unset !important; margin-top : 20px;"/>
        <div id='upListTab' class="flexColumn" style="height:unset">
            <form name="uploadForm" id="uploadForm" enctype="multipart/form-data" method="post" style="display: none;"></form>
            <div id='upList'></div> 
            <div id='imgPreview' style="height:unset"></div>
        </div>
        <div id="map" class="flexColumn"></div>
    </div>
</div>
<!-- HTML autogen end ---------------------------------------------- -->

<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "fo_mst";
    var pgmid = "manageBrand"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"pgmid":"manageBrand","pgm_nm":"■ 브랜드 정보관리","pgm_tp":"UX","proc_mst_id":"","proc_mst_nm":"","remark":"등록된 회사 코드를 선택해서 등록된 브랜드의 정보를 조회","ver":4,"pgm_stat":"Y","reg_usid":"mjw","reg_dt":"2022-01-25 17:17:18","upd_usid":"mjw","upd_dt":"2022-01-25 17:17:18","app_pgmid":"fo_mst","pgm_grp_nm":"상품정보","sort_seq":11,"shortcut":"W1","crud":"","app_pgm_nm":"마스터정보"};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-search","reg_dt":"2022-01-25 17:17:18","reg_usid":"","func_nm":"조회","upd_usid":"","upd_dt":"2022-01-25 17:17:18","func_tp":"DB_R","remark":"회사 코드를 선택한 후, 브랜드를 조회하거나 입력할 수 있습니다.","pgmid":"manageBrand","sort_seq":"1","funcid":"search","content":"등록된 회사를 선택해서 브랜드를 조회하거나 대표 브랜드를 조회한다.","crud":"R","id":"0"},{"func_icon":"fas fa-save","reg_dt":"2022-01-25 17:17:18","reg_usid":"","func_nm":"저장","upd_usid":"","upd_dt":"2022-01-25 17:17:18","func_tp":"DB_W","remark":"한번 등록된 코드는 변경할 수 없습니다.","pgmid":"manageBrand","sort_seq":"2","funcid":"save","content":"추가/수정된 브랜드 코드를 저장한다.","crud":"R","id":"1"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["pageCond"]={"sort_seq":"1","data_id":"pageCond","data_nm":"조회조건","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"comcd","colnm":"회사 코드","dtype":"text","etype":"sel","attr":"hidden","len":null,"defval":"gUserinfo.orgcd","refcd":"COMCD","option":"sel:comcd::nm","valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null,"id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"br_lv","colnm":"브랜드레벨","dtype":"text","etype":"sel","attr":null,"defval":"NOR","w":"10","h":null,"refcd":"BR_LV","option":"sel:br_lv::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"brcd","colnm":"코드(like)","dtype":"text","etype":"txt","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null,"id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"br_nm","colnm":"명(like)","dtype":"text","etype":"txt","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null,"id":"3"}]};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"2","data_id":"list","data_nm":"브랜드코드목록","data_icon":null,"component_pgmid":"agGrid","component_option":{"func":[{"funcid":"addRow","func_nm":"줄추가","func_icon":"fas fa-plus"},{"funcid":"delRow","func_nm":"줄삭제","func_icon":"fas fa-minus"}]},"inout_tp":"INOUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"sort_seq","colnm":"정렬순서","dtype":"num","etype":"txt","attr":null,"defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"rep_brcd","colnm":"대표브랜드","dtype":"text","etype":"sel","attr":null,"defval":null,"w":"8","h":null,"refcd":"REP_BRCD","option":"sel:rep_brcd::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"brcd","colnm":"브랜드코드","dtype":"text","etype":"txt","attr":"pk","defval":null,"w":"7","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"br_nm","colnm":"브랜드명","dtype":"text","etype":"txt","attr":"keycol ","defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"map_list","colnm":"매핑코드","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"20","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"20","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"cd_stat","colnm":"코드상태","dtype":"text","etype":"cbx","attr":null,"defval":"Y","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":"손익센터","colid":"profit_cntr_cd","colnm":"코드","dtype":"text","etype":"txt","attr":"pop","defval":null,"w":"5","h":null,"refcd":"CNTRCD","option":"sel:profit_cntr_cd:profit_cntr_nm:cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":"손익센터","colid":"profit_cntr_nm","colnm":"명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":10,"section":null,"section_icon":null,"colgrp":null,"colid":"fileid","colnm":"이미지파일ID","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"}]};
me.dataDef["_pgm_data"]["mst"]={"sort_seq":"3","data_id":"mst","data_nm":"브랜드코드구분","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":"INOUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"brcd","colnm":"브랜드코드","dtype":"text","etype":"txt","attr":"pk","len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null,"id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"br_nm","colnm":"브랜드명","dtype":"text","etype":"txt","attr":"keycol ","len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null,"id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"rep_brcd","colnm":"대표브랜드","dtype":"text","etype":"sel","attr":null,"len":null,"defval":null,"refcd":"REP_BRCD","option":"sel","valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null,"id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":"손익센터","colid":"profit_cntr_cd","colnm":"코드","dtype":"text","etype":"txt","attr":"pop","defval":null,"w":"5","h":null,"refcd":"CNTRCD","option":"sel:profit_cntr_cd:profit_cntr_nm:cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":"손익센터","colid":"profit_cntr_nm","colnm":"명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"sort_seq","colnm":"정렬순서","dtype":"num","etype":"txt","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null,"id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고","dtype":"text","etype":"txt","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"20","h":null,"id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"cd_stat","colnm":"코드상태","dtype":"text","etype":"cbx","attr":null,"len":null,"defval":"Y","refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null,"id":"7"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_usid","colnm":"등록사용자ID","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":10,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_dt","colnm":"등록일자","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":11,"section":null,"section_icon":null,"colgrp":null,"colid":"upd_usid","colnm":"변경사용자ID","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"},{"sort_seq":12,"section":null,"section_icon":null,"colgrp":null,"colid":"upd_dt","colnm":"변경일자","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"11"},{"sort_seq":13,"section":null,"section_icon":null,"colgrp":null,"colid":"fileid","colnm":"이미지파일ID","dtype":"text","etype":"none","attr":"hidden ","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"12"}]};
me.dataDef["_pgm_data"]["map"]={"sort_seq":"4","data_id":"map","data_nm":"공급사 코드매칭","data_icon":null,"component_pgmid":"agGrid","component_option":{"func":[{"funcid":"addRow","func_nm":"줄추가","func_icon":"fas fa-plus"},{"funcid":"delRow","func_nm":"줄삭제","func_icon":"fas fa-minus"},{"funcid":"saveDet","func_nm":"매칭정보저장","func_icon":"fas fa-save"}]},"inout_tp":"INOUT","content":[{"sort_seq":"1","section":null,"section_icon":null,"colgrp":"공급사","colid":"suprcd","colnm":"공급사코드","dtype":"text","etype":"txt","attr":"pk pop","defval":null,"w":"10","h":null,"refcd":"supr","option":"sel:suprcd:supr_nm:cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":"2","section":null,"section_icon":null,"colgrp":"공급사","colid":"supr_nm","colnm":"공급사명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":"3","section":null,"section_icon":null,"colgrp":null,"colid":"match_cd","colnm":"매칭코드","dtype":"text","etype":"txt","attr":"pk upper","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":"4","section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"20","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"}]};
me.dataDef["_pgm_data"]["upList"]={"sort_seq":"5","data_id":"upList","data_nm":"업로드 목록","data_icon":null,"component_pgmid":"FreeForm","component_option":{"func":[{"funcid":"del","func_nm":"이미지 삭제","func_icon":"fas fa-minus"}]},"inout_tp":"OUT","content":[]};
me.dataDef["_pgm_data"]["imgPreview"]={"sort_seq":"6","data_id":"imgPreview","data_nm":"이미지미리보기","data_icon":null,"component_pgmid":"FreeForm","component_option":{"func":[{"funcid":"fit","func_nm":"Fit","func_icon":"fas fa-expand"},{"funcid":"+","func_nm":"확대","func_icon":"fas fa-plus"},{"funcid":"-","func_nm":"축소","func_icon":"fas fa-minus"},{"funcid":"100","func_nm":"원본크기","func_icon":" "}]},"inout_tp":"imgPreview","content":null};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */
/* 사용자초기화 */
me.fnInitExtra=function() {
        me.pageObj["pageCond"].setVal("comcd",gUserinfo.orgcd);
         function _auth(auth) {
            if(isNull(auth)) { 
                gfnAlert("시스템 사용권한 점검","화면에 대한 권한이 없습니다!");
                $("*[pageidx='"+me.pageid+"']").remove();
                delete gfn[me.pageid]; 
                me.page.remove(); 
            } else {
                if(isNull(auth.save_yn) || auth.save_yn != "Y") {
                    /* 각 화면에 맞게 적용*/ 
                    me.pageObj._pageFunc.setDisp("save",false);
                    me.pageObj.list._componentFunc.setDisp("addRow",false);
                    me.pageObj.list._componentFunc.setDisp("delRow",false);
                    me.pageObj.map._componentFunc.setDisp("addRow",false);
                    me.pageObj.map._componentFunc.setDisp("delRow",false);
                    me.pageObj.map._componentFunc.setDisp("saveDet",false); 
                }
            } 
        }
        if(subset(gds.comcd,"grpcd","pgm_auth").length==0) {
            gfnGetData("pgm_auth",function(rtn){
                _auth(subset(rtn,"pgmid",pgmid)[0]);
            }); 
        } else {
            _auth(subset(subset(gds.comcd,"grpcd","pgm_auth"),"pgmid",pgmid)[0]) ;
        }
        me.page.find(".imgupload").on("click", me.setThumbnail);
    }
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //코드 목록
        else if(component==me.pageObj["list"]) {
            
            if(evt == "focus") {
                if(row >= 0) {
                    var rowData = me.pageObj.list.getRowData(row);
                    rowData.currow = row; //선택된 rowdi를 넘겨줌
                    me.pageObj.mst.importData(rowData); 
                    if(!isNull(rowData.brcd)) {
                        //console.log(rowData);
                        me.fnimgSearch(rowData.brcd);
                        me.fnSearchMap(rowData.brcd);
                    }
                }
            }
            else if(evt == "componentFunc") {
                if(row == "addRow") {
                    me.pageObj.list.addRow();
                    
                } else if(row == "delRow") {
                    var rows = me.pageObj.list.selectedRows();
                    if(rows.length < 0) {
                        gfnAlert("줄 삭제 확인", "선택된 줄이 없습니다.");
                    } else {
                        //confirm후 즉시 삭제
                        me.fnDelete(rows);
                    }
                }
            }
            //if(evt=="dblclick" && col=="colid") {...}
        }
        //코드 폼
        else if(component == me.pageObj["mst"]) {
            //목록이 눌렸을 때 mst 폼으로 보내줌
            if(evt == "change") {
                var rowData = me.pageObj.mst.exportData()[0];
                var rowid = me.pageObj.mst.getVal("currow");
                if(!isNull(rowid)) {
                    me.pageObj.list.setRowData(rowid, rowData);
                }
                //목록이 눌렸을 때 해당 코드의 공급사 코드매칭 조회
            }
        }
        else if(component == me.pageObj["upList"]) {
            if(evt == "componentFunc") {
                if(row == "del") {
                    me.fnImgDelete();
                }
            }
        }
        //공급사 매칭 목록
        else if(component == me.pageObj["map"]) {
            if(evt == "componentFunc") {
                 if(row == "addRow") {
                    component.addRow();
                    
                } else if(row == "delRow") {
                    var rows = component.selectedRows();
                    
                    if(rows.length < 0) {
                        gfnAlert("줄 삭제 확인", "선택된 줄이 없습니다.");
                    } else {
                        component.delRow(rows);
                    }

                } else if(row == "saveDet") {
                    me.fnSaveMap();
                }
            }
        }
        //이미지 뷰어 버튼 참조
        else if(component==me.pageObj["imgPreview"]) {
            //if(evt=="change" && col=="colid") {...}
            if($('button[funcid="fit"]').on("click",function() {
                $("#"+pageid+" #imgPreview img").css("width","100%");
                $("#"+pageid+" #imgPreview img").css("height","85%");
            }));
            if($('button[funcid="+"]').on("click",function() {
                var w = $("#"+pageid+" #imgPreview .imgArea img").outerWidth();
                var h = $("#"+pageid+" #imgPreview .imgArea img").outerHeight();
                $("#"+pageid+" #imgPreview img").css("width",(w*1.1)+"px");
                $("#"+pageid+" #imgPreview img").css("height",(h*1.1)+"px");
                fnCenter();   
            }));
            if($('button[funcid="-"]').on("click",function() {
                var w = $("#"+pageid+" #imgPreview .imgArea img").outerWidth();
                var h = $("#"+pageid+" #imgPreview .imgArea img").outerHeight();
                $("#"+pageid+" #imgPreview img").css("width",(w/1.1)+"px"); 
                $("#"+pageid+" #imgPreview img").css("height",(h/1.1)+"px"); 
                fnCenter();   
            })); 
            if($('button[funcid="100"]').on("click",function() {
                $("#"+pageid+" #imgPreview .imgArea img").css("width","unset");
                $("#"+pageid+" #imgPreview .imgArea img").css("height","unset");
                fnCenter();   
            }));  
            var fnCenter = function() {
                var outerContent =$("#"+pageid+" #imgPreview .imgArea");
                var innerContent =$("#"+pageid+" #imgPreview img"); 
                outerContent.scrollLeft( (innerContent.width() - outerContent.width()) / 2);       
            }
        }
    }
    
    //delete:삭제
    me.fnDelete=function(rows) {
        function _fnDelete() {
            var list = [];
            var rows2 = [];
            for(var i=0; i < rows.length; i++) {
                if(me.pageObj.list.getVal(rows[i],"crud")=="C"||isNull(me.pageObj.list.getVal(rows[i],"crud"))) me.pageObj.list.delRow(rows[i]);
                else {  
                    list.push(me.pageObj.list.getRowData(rows[i]));
                    rows2.push(rows[i]);
                }
            }
            var args = me.pageObj["pageCond"].exportData()[0]; 
            args.list = list;
            var invar = JSON.stringify(args);
            gfnTx(appid+"."+pgmid,"delete",{INVAR:invar},function(OUTVAR){
                if(OUTVAR.rtnCd=="OK") {
                    for(var i=0; i < rows2.length; i++) {
                        var row = me.pageObj.list.grid.gridOptions.api.getRowNode(rows2[i]);
                        me.pageObj.list.grid.gridOptions.api.applyTransaction({remove:[row.data]});
                    }
                    me.pageObj.list.redraw();
                } else {
                    gfnAlert("삭제오류",OUTVAR.rtnMsg);
                }
            });
        }
        gfnConfirm("삭제확인","선택한 줄을 삭제하시겠습니까?",function(rtn) {
            if(rtn) _fnDelete();
        })
    }
    //search:조회 
    me.fnSearch=function() {
        if( !me.pageObj["pageCond"].chkValid() ) return;
        var args = me.pageObj["pageCond"].exportData()[0];
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.rtnCd=="OK") {
                me.pageObj["list"].importData(OUTVAR.list);
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }
    
    me.fnimgSearch=function(brcd){
        $("#upList .componentBody").html("");
        $("#imgPreview .componentBody").html("");
        var args = {brcd : brcd};

        var invar = JSON.stringify(args);
        
        gfnTx(appid + "." + pgmid, "imgSearch", {INVAR : invar}, function(OUTVAR) {
            if(OUTVAR.rtnCd == "OK") {
                console.log(OUTVAR.list);
                var list = OUTVAR.list[0];
                var orgn_nm = list.orgn_nm;
                $("#upList .componentBody").html("");
                const thumb = $(`<span class='orgn_nm'><b class="fnm">`+ orgn_nm + `</b></span>`);
                me.pageObj.upList.componentBody.append(thumb);
                $("#imgPreview .componentBody").html("");
                $("#imgPreview .componentBody").append(`<img src='`+ list.file_url + `'/>`);
            } else {
                gfnAlert("조회오류", OUTVAR.rtnMsg);
            }
        })
    }
    me.fnImgDelete=function(){
        var brcd = me.pageObj["mst"].getVal("brcd");
        console.log(brcd);
        var args = {brcd : brcd};

        var invar = JSON.stringify(args);
        
        gfnTx(appid + "." + pgmid, "imgDelete", {INVAR : invar}, function(OUTVAR) {
            console.log(OUTVAR);
            if(OUTVAR.rtnCd == "OK") {
                gfnAlert("삭제완료", "이미지 삭제 완료");
                $("#imgPreview .componentBody").html("");
                me.pageObj.upList.componentBody.html("");
            } else {
                gfnAlert("조회오류", OUTVAR.rtnMsg);
            }
        })
    }

    //save:저장 
    me.fnSave=function() {
        if( !me.pageObj["pageCond"].chkValid() ) return;
        var args = me.pageObj["pageCond"].exportData()[0];
        var list = me.pageObj.list.exportData("CRU");
        args.list = list;
        var invar = JSON.stringify(args);
        console.log(invar);
        uploadFile();
         gfnTx(appid+"."+pgmid, "save", {INVAR:invar}, function(OUTVAR){
             console.log(OUTVAR);
             if(OUTVAR.rtnCd=="OK") {
                 gfnAlert("저장성공","입력하신 코드가 저장되었습니다.");
                 me.fnSearch();
             } else {
                 gfnAlert("조회오류",OUTVAR.rtnMsg);
             }
         });
    }

    //refresh:코드갱신 
    me.fnRefresh = function() { 
        gfnTx("aweportal.frameset","retrieveInit",{}, function(OUTVAR){ 
            if(OUTVAR.rtnCd=="OK") {
                gds.comcd         = OUTVAR.comcd;   //공통코드 
                //조회조건 refresh
                me.pageObj["pageCond"] = new gfnComponent( me.pageid, "pageCond", me.dataDef["_pgm_data"]["pageCond"], me.fnEH, me); 
                gfnAlert("공통코드 리프레시","코드를 다시 가져왔습니다.");
            }
		});
    }
    
    //search:공급사 목록 조회
    me.fnSearchMap = function(brcd) {
        if( !me.pageObj["pageCond"].chkValid() ) return;  
        if( isNull(me.pageObj["mst"].getVal("brcd")) ) return;
    
        var args = {brcd : brcd};

        var invar = JSON.stringify(args);
        
        gfnTx(appid + "." + pgmid, "searchMap", {INVAR : invar}, function(OUTVAR) {
            if(OUTVAR.rtnCd == "OK") {
                me.pageObj["map"].importData(OUTVAR.map);
                
            } else {
                gfnAlert("조회오류", OUTVAR.rtnMsg);
            }
        })
    }
    
    //save:공급사 매칭 정보 저장
    me.fnSaveMap = function() {
        if( !me.pageObj["pageCond"].chkValid() ) return;
        var args   = me.pageObj.mst.exportData()[0]; 
        var map    = me.pageObj.map.exportData(); 
        args.map   = map;
        args.grpcd = "BRCD";

        var invar = JSON.stringify(args);
        
        gfnTx(appid + "." + pgmid, "saveMap", {INVAR : invar}, function(OUTVAR) {
            //console.log(OUTVAR);
            if(OUTVAR.rtnCd == "OK") {
                gfnAlert("저장성공", "입력하신 코드가 저장되었습니다.");
                me.fnSearchMap(args.brcd); 
            } else {
                gfnAlert("조회오류", OUTVAR.rtnMsg);
            }
        })
    }

$("#fileSelector").bind('change', function() {
    selectFile(this.files);
});
    // 파일 리스트 번호
var fileIndex = 0;
// 등록할 전체 파일 사이즈
var totalFileSize = 0;
// 파일 리스트
var fileList = new Array();
// 파일 사이즈 리스트
var fileSizeList = new Array();
// 등록 가능한 파일 사이즈 MB
var uploadSize = 10;
// 등록 가능한 총 파일 사이즈 MB
var maxUploadSize = 10;	

// 파일 선택시
function selectFile(fileObject) {
    var files = null; 
    if (fileObject != null) {
        // 파일 Drag 이용하여 등록시 
        files = fileObject;  
    } else {
        // 직접 파일 등록시
        files = $('#multipaartFileList_' + fileIndex)[0].files;
    } 
    console.log(files);
    if (files != null) { // 다중파일 등록   

        for (var i = 0; i < files.length; i++) { 
            var fileName = files[i].name; // 파일 이름
            var fileNameArr = fileName.split("\."); // 확장자 
            var ext = fileNameArr[fileNameArr.length - 1]; 
            var fileSize = files[i].size; // 파일 사이즈(단위 :byte) 
            if (fileSize <= 0) {
                console.log("0kb file return");
                return;
            } 
            var fileSizeKb = fileSize / 1024; // 파일 사이즈(단위 :kb)
            var fileSizeMb = fileSizeKb / 1024;    // 파일 사이즈(단위 :Mb)

            var fileSizeStr = "";
            if ((1024*1024) <= fileSize) {    // 파일 용량이 1메가 이상인 경우 
                fileSizeStr = fileSizeMb.toFixed(2) + " Mb";
            } else if ((1024) <= fileSize) { 
                fileSizeStr = parseInt(fileSizeKb) + " kb";
            } else { 
                fileSizeStr = parseInt(fileSize) + " byte";
            } 
            if ($.inArray(ext, [ 'pdf', 'jpg', 'jpeg', 'gif', 'png' , 'PNG' , 'JPG']) <= 0) {
                // 확장자 체크
                gfnAlert("등록 실패", "등록이 불가능한 파일 입니다.("+fileName+")");
                break; 
            }
            if (fileSizeMb > uploadSize) {
                // 파일 사이즈 체크
                gfnAlert("업로드 파일확인","용량 초과\n업로드 가능 용량 : " + uploadSize + " MB");
                break;
            } else { 
                totalFileSize += fileSizeMb; // 전체 파일 사이즈 
                fileList[fileIndex] = files[i]; // 파일 배열에 넣기  
                fileSizeList[fileIndex] = fileSizeMb; // 파일 사이즈 배열에 넣기 
                addFileList(fileIndex, fileName, fileSizeStr); // 업로드 파일 목록 생성
                fileIndex++;                      // 파일 번호 증가
            } 
        } /* End of for */
    } else {
        gfnAlert("ERROR", "ERROR");
    }
}

// 업로드 파일 목록 생성
function addFileList(fIndex, fileName, fileSizeStr) {
    var fileNameArr = fileName.split("\."); // 확장자 
    var ext = fileNameArr[fileNameArr.length - 1];
    var file = $("#fileSelector").get(0).files[fIndex];
    console.log(file);
    if(file) {
        // FileReader 인스턴스 생성
        const reader = new FileReader();
        // 이미지가 로드가 된 경우
        reader.onload = e => {
            const thumb = $(`<li class='`+fileNameArr[0] + fIndex + `'><b class="fnm">`+ fileName + `</b></li>`);
            me.pageObj.upList.componentBody.append(thumb);
            thumb.attr("src", e.target.result );
            var oE = $(e.target);
            var oTR = oE.exactObj("img[src]");
            var imgSrc = oTR.attr("src");
            $("#imgPreview .componentBody").html("");
            $("#imgPreview .componentBody").append(`<img src='`+ e.target.result + `'/>`);
        }
        // reader가 이미지 읽도록 하기
        reader.readAsDataURL(file);
    }
}

// 목록에서 업로드 파일 삭제
function deleteFile(fIndex) { 
    // 전체 파일 사이즈 수정
    totalFileSize -= fileSizeList[fIndex];
    // 파일 배열에서 삭제
    delete fileList[fIndex];
    // 파일 사이즈 배열 삭제
    delete fileSizeList[fIndex];
}
var fileIdList = [];

function uploadFile() {
    console.log("업로드파일 들어옴");
    // 등록할 파일 리스트
    var uploadFileList = Object.keys(fileList);
    console.log(uploadFileList);
    console.log(fileList);
    // 파일이 있는지 체크
    if (uploadFileList.length == 0) {
        // 파일등록 경고창
        gfnAlert("파일 미등록", "업로드할 파일이 없습니다.");
        return;
    }

    // 용량을 10MB를 넘을 경우 업로드 불가
    if (totalFileSize > maxUploadSize) {
        // 파일 사이즈 초과 경고창
        gfnAlert("총 용량 초과", "총 업로드 가능 용량 : " + maxUploadSize + " MB");
        return;
    }

    var curIdx = 0;
    var maxIdx = uploadFileList.length;

    function submitFile(idx) {
        var file = fileList[uploadFileList[idx]];
        var fileNameArr = file.name.split("\.")[0];
        if(fileNameArr.includes("_")) {
            fileNameArr = fileNameArr.split("\_")[0];
        } else if(fileNameArr.includes("(")) {
            fileNameArr = fileNameArr.split("\(")[0];
        } else if(fileNameArr.includes("-")) {
            fileNameArr = fileNameArr.split("\-")[0];
        }
        var arg = {filenm : fileNameArr};
        var invar = JSON.stringify(arg);
        var frm = $("#"+pageid+" #uploadForm");
        var formData = new FormData(frm[0]);
        var fileSize = file.size;
        var oName = file.name;
        var userid = gUserinfo.userid;
        var brcd = me.pageObj["mst"].getVal("brcd");
        var args = {"file_tp": "BR_IMG", "ref_file_tp" : "TM_BRAND", "ref_id": brcd, "fileSize" : fileSize};
        var invar = JSON.stringify(args);
        formData.append("file",file);
        formData.append("INVAR",invar);
        $.ajax({
            url : "awegtx.jsp?pgm=aweportal.popupUpload",
            data : formData,
            type : 'POST',
            enctype : 'multipart/form-data',
            processData : false,
            contentType : false,
            dataType : 'json',
            cache : false,
            timeout: 60000,
            success : function(OUTVAR) {
                if(OUTVAR.rtnCd == "OK") {
                    gParamFile["fileupload"](OUTVAR.fileno);
                    fileIdList.push({fileid: OUTVAR.fileid});
                    $("." + file.name.split("\.")[0] + idx ).remove();
                    $("#imgPreview .componentBody").html("");
                    console.log(OUTVAR.fileid);
                    var mst = me.pageObj["mst"].exportData()[0];
                    var list = me.pageObj["list"].exportData();
                    console.log(mst);
                    console.log(list);
                    for(i=0;i<list.length;i++){
                        if(list[i].brcd == mst.brcd){
                            mst.fileid = OUTVAR.fileid;
                            list[i].fileid = OUTVAR.fileid;
                            console.log(OUTVAR.fileid);
                            console.log(list[i].fileid)
                        }
                    }
                } else {
                    gfnAlert("파일업로드 오류",OUTVAR.rtnCd);
                }
            },
            complete: function(jqXHR, rst) {
                console.dir(jqXHR);
                console.dir(rst);
                $("#fileSelector").show();
                $("#upList .componentTop").show();
            }
        });
    }
    gParamFile["fileupload"] = function(fileno) {
        curIdx++;
        if(curIdx < maxIdx) {
            submitFile(curIdx);
        } else if (curIdx==maxIdx) {
            //변수초기화
            fileIndex = 0;
            totalFileSize = 0;
            fileList = new Array();
            fileSizeList = new Array();
        }
    }
    submitFile(curIdx); //첫번째 파일 업로드 트리거
    $("#fileSelector").val("");
} 

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>