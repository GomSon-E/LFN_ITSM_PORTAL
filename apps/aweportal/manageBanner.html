<style>[pgmid='manageBanner'].framepage .userClass { 
width:100%; 
}
.bannerListDivFoot button, #mnBanner .bbsBtn button, #mnBanner .bannerComDiv button {
    display:inline-block;
    color:white;
    font-weight: bold;
    cursor:pointer;
    background-color:#3e3e3a;
    border: none;
    border-radius:0.25rem;
    padding:.125rem 0.5rem; 
    height:1.75rem;
    vertical-align:bottom;
    font-size:0.75rem;    
    white-space: nowrap;
    text-overflow: ellipsis;
}
.bannerListDivFoot button {
    height: auto !important;
}
.bannerListDivFoot button:hover, #mnBanner .bbsBtn button:hover, #mnBanner .bannerComDiv button:hover, .bannerListDivFoot button:focus, #mnBanner .bbsBtn button:focus, #mnBanner .bannerComDiv button:focus {
    color:#000;
    font-weight: bold;
    cursor:pointer;
    background-color:#eaeaea;
    border: none;
}
#mnBanner textarea, #mnBanner input, #toggle input {
    font-family: "Noto Sans KR", sans-serif;
}
.flexColunm > * {
    flex: 0 0 auto;
}
.flexColunm > *:last-child {
    flex: 1 1 auto;
    height: unset !important;
}
#toggle .bannerListDiv {
    margin-bottom: 15px;
}
#toggle .BannerTable {
    width: 97.5%; 
    margin: 0 auto;
    margin-top : 20px;
    padding-top: 2%;
    padding-bottom: 5%;
    font-size: 1.2em;
    border: 1px solid #EFEFEF;
    border-collapse: collapse;
}
#toggle .BannerTable > thead > tr > th { 
    background-color: rgba(138, 131, 131, 0.925); 
    color: #ffffff; 
}
#toggle .BannerTable > thead > tr > th { 
    text-align: center; 
    height: 27px;
}
#toggle .BannerTable > thead > tr > th:nth-child(1){
    width: 10%;
}
#toggle .BannerTable > thead > tr > th:nth-child(2){
    width: 60%
}
#toggle .BannerTable > thead > tr > th:nth-child(3){
    width: 20%;
}
#toggle .BannerTable > thead > tr > th:nth-child(4){
    width: 10%;
}
#toggle .BannerTable > tbody > tr{
    cursor: pointer;
}
#toggle .BannerTable > tbody > tr:nth-child(odd){
    background-color: #EFEFEF;
}
#toggle .BannerTable > tbody > tr .title {
    text-align: left;    
}
#toggle .BannerTable > tbody > tr .title:hover {
    text-decoration: underline;
}
#toggle .BannerTable > tbody > tr > td {
    height: 35px;
    text-align: center; 
}
#toggle .bannerListDivFoot > * {
    margin-right: 5px;
}
#toggle .bannerListDivFoot{
    position: relative;
    left: 30%;
    margin-top: 60px;
    display: flex;
}
#toggle .bannerListDivFoot .bannerSearchCond{
    height: 24px;
    vertical-align: middle;
}
#toggle .bannerListDivFoot input{
    line-height: 16px;
    vertical-align: middle;
    min-width: 350px;
}
#mnBanner .titleDiv {
    border: 1px solid rgb(231, 228, 228);
    border-inline: none;
    margin-top: 10px;
    margin-bottom: 30px;
    padding-top: 10px;
    padding-bottom: 10px;
}
#mnBanner .bannerDiv, #mnBanner .bannerComDiv{
    border : 1px solid rgb(197, 194, 194); 
    padding: 50px;
    margin : 30px;
}
#mnBanner .notice {
    font-size: 1.2em;
    font-weight: bold;
}
#mnBanner .contentForm {
    margin-bottom: 20px;
}
#mnBanner .boardTitle {
    width: 99%;
    margin-bottom : 20px; 
    margin-top : 20px; 
    display: none;
}
#mnBanner .boardTitle2 {
    width: 90%;
    overflow: hidden;
    height: 30px;
    margin-bottom : 20px; 
    margin-top : 10px;
    border: none;
    font-weight: bold;
    font-size: 1.8em;
}
#mnBanner .boardRegInfo {
    margin-bottom : 10px; 
    border: none;
    font-size: 1.2em;
}
#dropZone {
    margin-top: 5px;
    min-height: 80px;
    border : 1px solid rgb(204, 204, 204); 
}
#dropZone #fileDragDesc {
    margin: 10px;
}
#dropZone #fileDragDesc .fileList:hover {
    text-decoration: underline;
    cursor : pointer;
}
#dropZone > tr > td {
    margin-right : 5px;
}
#mnBanner .bbsBtn {
    margin-bottom: 10px;
    min-height: 25px;
    padding-top: 20px;
    border-top: 1px solid rgb(204, 204, 204);
}
#mnBanner .bbsBtn button {
    margin-right: 10px;
}
#mnBanner .toList {
    float: right;
    margin-right: 0px !important;
}
#mnBanner .insertBannerComDiv, #mnBanner .BannerCommListDiv {
    margin-top : 20px;
    margin-bottom : 20px;
}
#myBannerCommArea {
    width: 99.5%;
    height: 70px;
    margin-bottom : 20px;
    resize: none;
    padding: 5px;
}
#mnBanner .BannerCommListDiv .bbsComm {
    font-size: 1.1em;
    padding: 10px 5px 10px 5px;
    margin-bottom : 2px;
    border : 1px solid rgb(231, 228, 228);
    border-inline: none;
}
#mnBanner .BannerCommListDiv textarea {
    width : 99.5%; 
    height : 60px;
    padding: 5px; 
    margin-bottom : 10px; resize : none;
}
#mnBanner .BannerCommListDiv .bbsComm span{
    margin-right : 20px;
}
#mnBanner .BannerCommListDiv button {
    margin-right: 10px;
}
#mnBanner .comments{
    margin-top:10px; 
    margin-bottom:10px;
}
.off-screen {
    display: none;
}
#nav {
    margin-top: 30px;
    text-align: center;
}
#nav a {
    display: inline-block;
    padding: 3px 5px;
    margin-right: 10px;
    font-family:Tahoma;
    background: #ccc;
    color: #000;
    text-decoration: none;
}
#nav a.active {
    background: #333;
    color: #fff;
}
#bannertextarea {
    min-height: 350px;
    font-size: 1.5em;
}</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div id="toggle" class="flexColumn">
    <div class="pageTop"></div>
    <div class="pageCond">
        <div class="section">
            <div class="condCol 3col">
                <h2>배너</h2>
            </div>      
        </div>    
    </div>
    <div class="bannerListDiv">
        <table class="BannerTable">
            <thead>
            <tr>
                <th>작성자</th>
                <th>제목</th>
                <th>작성일자</th>
                <th>조회수</th>
            </tr>    
            </thead>
            <tbody class="BannerTbody">
            </tbody>
        </table>
        <div class="bannerListDivFoot">
            <select class="bannerSearchCond">
                <option value="ti">제목</option>
                <option value="co">내용</option>
                <option value="tico">제목+내용</option>
                <option value="all">전체글</option>
            </select>
            <input type="text" class="searchKeyword"> 
            <button class="searchBtn"><i class="fa fa-search"></i></button>
            <button type="button" class="toRegisterBBS">새글 작성</button>
        </div>
    </div>
</div>
<div id="mnBanner" style="display: none;">
    <div class="bannerDiv">
        <form class="contentForm">
            <span class="notice">배너</span>
            <input type="text" class="boardTitle" placeholder="제목">
            <div class="titleDiv">
                <div class="boardTitle2">
                </div>
                <div class="boardRegInfo" style="display: inline-block;">
                </div>
            </div>
            <textarea id="mytextarea" class="boardContent" name="mytextarea3" placeholder="내용을 입력하세요"></textarea>
            <div id="bannertextarea" class="boardContent" style="display: none;"></div>
            <br>
            <div class="uploadedFile">
                <i class="fas fa-file-alt"></i><span>&nbsp;&nbsp;업로드된 파일</span>
                <div id="dropZone">
                    <div id="fileDragDesc"> 업로드된 파일이 없습니다. </div>
                </div>
            </div>
        </form>
        <div class="bbsBtn">
            <button class="fileUploadBtn" style="display : none;">파일선택</button>
            <button type="button" class="updateBtn">수정</button>
            <button type="button" class="updateBtn2" style="display: none;">수정하기</button>
            <button type="button" class="deleteBtn">삭제</button>
            <button type="button" class="toList">목록으로</button>
        </div>
    </div>
    <div class="bannerComDiv">
        <div class="insertBannerComDiv">
            <h2>댓글</h2>
            <form>
                <textarea type="text" id="myBannerCommArea" placeholder="댓글을 입력하세요"></textarea>
                <br>
                <button type="button" class="insertBannerCommBtn" >댓글 작성</button>
            </form>
        </div>
        <div class="BannerCommListDiv">
        </div>
    </div>
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "aweportal";
    var pgmid = "manageBanner"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"pgmid":"manageBanner","pgm_nm":"배너 관리","pgm_tp":"UX","proc_mst_id":"","proc_mst_nm":"","remark":"배너를 관리한다.","ver":0,"pgm_stat":"Y","reg_usid":"admin","reg_dt":"2021-11-12 18:10:21","upd_usid":"admin","upd_dt":"2021-11-12 18:10:21","app_pgmid":"aweportal","pgm_grp_nm":"포털관리자","sort_seq":null,"shortcut":"","crud":"","app_pgm_nm":"포털"};
me.dataDef["_pgm_func"]=[];
me.dataDef["_pgm_data"] = {};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */
var file_tp = "BBS_ATTCH";
var ref_file_tp = "T_DOC";

gfnTx("aweportal.manageBBS", "selectAllBanner", {}, function(OUTVAR){
    for (let i = 0; i < OUTVAR.list.length; i++) {
        const el = OUTVAR.list[i];
        var BannerList = {
            docid: el.docid,
            title: el.title,
            content: el.content,
            reg_usid: el.reg_usid,
            dt: el.reg_dt,
            read_cnt: el.read_cnt,
            grpid : el.doc_fieldid,
            reg_nm: el.nm,
        };
        me.dataSet["BannerList"].push(BannerList);
    }
    me.fnDrawBannerList();
})
$("#toggle .searchBtn").on("click", function() {
    me.dataSet["BannerList"] = [];
    var disp = $("#"+pageid+" .bannerSearchCond").val();
    var term = $("#"+pageid+" .searchKeyword").val();
    var args = {disp: disp, term: term};
    var invar = JSON.stringify(args);
    if(disp == "all") {
        gfnTx("aweportal.manageBBS", "selectAllDoc", {}, function(OUTVAR){
            for (let i = 0; i < OUTVAR.list.length; i++) {
                const el = OUTVAR.list[i];
                var BannerList = {
                    docid: el.docid,
                    title: el.title,
                    content: el.content,
                    reg_usid: el.reg_usid,
                    dt: el.reg_dt,
                    read_cnt: el.read_cnt,
                    grpid : el.doc_fieldid,
                    reg_nm: el.nm,
                };
                me.dataSet["BannerList"].push(BannerList);
                me.fnDrawBannerList();
            }
        })
        return;
    } else if(isNull(term) || term == undefined) {
        gfnAlert("검색 실패", "검색어를 입력해 주세요.");
        return;
    }
    gfnTx("aweportal.manageBBS", "searchDoc", {INVAR : invar}, function(OUTVAR){
        if(OUTVAR.list.length == 0) {
            gfnAlert("검색 실패", "검색 결과가 존재하지 않습니다.");
            $("#"+pageid+" .searchKeyword").val("");
            return;
        }
        else {
            for (let i = 0; i < OUTVAR.list.length; i++) {
                const el = OUTVAR.list[i];
                var BannerList = {
                    docid: el.docid,
                    title: el.title,
                    content: el.content,
                    reg_usid: el.reg_usid,
                    dt: el.reg_dt,
                    read_cnt: el.read_cnt,
                    grpid : el.doc_fieldid,
                    reg_nm: el.nm,
                };
                me.dataSet["BannerList"].push(BannerList);
                me.fnDrawBannerList();
            }
        }    
    })
    $("#"+pageid+" .searchKeyword").val("");
});

if(gUserinfo.userid != "admin") {
    $("#"+pageid+" .toRegisterBBS").hide();
    $("#"+pageid+" .toRegisterBBS").prop("disabled", true);
}

$("#"+pageid+" #mytextarea").attr("id",pageid+"mytextarea");
    var plugins = [
    "advlist", "autolink", "lists", "link", "image", "charmap", "print", "preview", "anchor",
    "searchreplace", "visualblocks", "code", "fullscreen", "insertdatetime", "media", "table",
    "paste", "code", "help", "wordcount", "save"
];
var edit_toolbar = 'formatselect fontselect fontsizeselect |'
            + ' forecolor backcolor |'
            + ' bold italic underline strikethrough |'
            + ' alignjustify alignleft aligncenter alignright |'
            + ' bullist numlist |'
            + ' table tabledelete |'
            + ' link image';
var selector = '#'+pageid+'mytextarea';
tinymce.init({
    selector: selector,
    branding: false,
    forced_root_block: false,
    language: "ko_KR",
    plugins: plugins,
    toolbar: edit_toolbar,
    height: 450,
    statusbar: false,
    resize: false,
    deprecation_warnings: false,
    content_style: "body {margin : 10px}",
    paste_data_images: true
});
// 날짜 형식 메소드
function dateFormat(date) {
    let month = date.getMonth() + 1;
    let day = date.getDate();
    let hour = date.getHours();
    let minute = date.getMinutes();
    let second = date.getSeconds();

    month = month >= 10 ? month : '0' + month;
    day = day >= 10 ? day : '0' + day;
    hour = hour >= 10 ? hour : '0' + hour;
    minute = minute >= 10 ? minute : '0' + minute;
    second = second >= 10 ? second : '0' + second;

    return date.getFullYear() + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;
}
/* 사용자초기화 */
me.fnInitExtra=function() {
    me.dataSet["BannerList"] = [];
    me.dataSet["FileList"] = [];
    me.dataSet["CommList"] = [];
}
/* 이벤트핸들러 */
me.fnEH=function(component, evt, row, col, val) { 
    //화면기능버튼이 눌리면 
    if (component==me.pageObj["_pageFunc"]){ 
        if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
    }
    //사용자 컴포넌트/컨트롤
    else if(component.userComponent=="myCompoId") {
        //if(evt=="dblclick" && col=="colid") {...}
    }
}
// 게시글 목록 조회 메소드
me.fnDrawBannerList= function() {
    page.find(".BannerTable .BannerTbody").html("");
    $.each(me.dataSet["BannerList"],function(idx,el) {
        if(el.title.length > 50) {
            el.title = el.title.substr(0, 49) + "..."; 
        }
        var bbsList = $(`<tr class="bbs" docid='${el.docid}'>`);
        bbsList.append(`<td class="reg_nm">${el.reg_nm}</td> `);
        bbsList.append(`<td class="title"><b>${el.title}</b></td> `);
        bbsList.append(`<td class="dt">${el.dt}</td>`);
        bbsList.append(`<td class="read_cnt">${el.read_cnt}</td>`);
        bbsList.append(`</tr>`);
        page.find(".BannerTable .BannerTbody").append(bbsList);
        bbsList.on("click",function(e){
            var oE = $(e.target);
            var oTR = oE.exactObj("tr[docid]");
            if(oTR.length != 1) return;
            me.fnShowDetail(oTR.attr("docid"));
        });
    });
    if(me.dataSet["BannerList"].length%15 != 0) {
        var len = 15 - (me.dataSet["BannerList"].length%15);
        for (let index = 0; index < len; index++) {
            var emptyList = $(`<tr class="bbs" style="cursor : auto;">`);
            emptyList.append(`<td class="reg_nm"></td> `);
            emptyList.append(`<td class="title"></td> `);
            emptyList.append(`<td class="dt"></td>`);
            emptyList.append(`<td class="read_cnt"></td>`);
            emptyList.append(`</tr>`);
            page.find(".BannerTable .BannerTbody").append(emptyList);
        }
    }

    /********* pagination 시작 ***********/
    var rowPerPage = 15;
    $('#nav').remove();
    var $BannerTable = $("#"+pageid+" .BannerTable");
    $BannerTable.after('<div id="nav">');
    var $tr = $($BannerTable).find('tbody tr');
    var rowTotals = $tr.length;
    var pageTotal = Math.ceil(rowTotals/ rowPerPage);
    var i = 0;
    $('<a href="#" class="toFirstList" style="background-color:white; color:white; pointer-events:none;"></a>').attr('rel', 0).html('<<').appendTo('#nav');
    for (; i < pageTotal; i++) {
        $('<a href="#"></a>')
            .attr('rel', i)
            .attr('class', "idx"+i)
            .html(i + 1)
            .appendTo('#nav');
    }
    $('<a href="#" class="toLastList"></a>').attr('rel', pageTotal-1).html('>>').appendTo('#nav');
    $("#nav .idx0").addClass('active');
    if(pageTotal == 1) {
        $("#nav").css("display", "none");
    }

    $tr.addClass('off-screen')
        .slice(0, rowPerPage)
        .removeClass('off-screen');

    var $pagingLink = $('#nav a');
    $pagingLink.on('click', function (e) {
        var oE = $(e.target);
        var oTR = oE.exactObj("a[rel]");
        var pageIdx = oTR.attr("rel");
        if(pageIdx == (pageTotal-1)) {
            $(".toLastList").css("background-color", "white");
            $(".toLastList").css("color", "white");
            $(".toLastList").css("cursor", "auto");
            $(".toLastList").css("pointer-events", "none");
        } else {
            $(".toLastList").css("background-color", "#ccc");
            $(".toLastList").css("color", "black");
            $(".toLastList").css("cursor", "pointer");
            $(".toLastList").css("pointer-events", "auto");
        }

        if(pageIdx == 0) {
            $(".toFirstList").css("background-color", "white");
            $(".toFirstList").css("color", "white");
            $(".toFirstList").css("cursor", "auto");
            $(".toFirstList").css("pointer-events", "none");
        } else {
            $(".toFirstList").css("background-color", "#ccc");
            $(".toFirstList").css("color", "black");
            $(".toFirstList").css("cursor", "pointer");
            $(".toFirstList").css("pointer-events", "auto");
        }

        e.preventDefault();
        var $this = $(this);
        if ($this.hasClass('active')) {
            return;
        }
        $pagingLink.removeClass('active');
        $this.addClass('active');

        if ($this.hasClass('toLastList')) {
            $(".toLastList").css("background-color", "white");
            $(".toLastList").css("color", "white");
            $(".idx" + (pageTotal-1)).addClass('active');
        }
        if ($this.hasClass('toFirstList')) {
            $(".toFirstList").css("background-color", "white");
            $(".toFirstList").css("color", "white");
            $(".idx0").addClass('active');
        }

        var currPage = $this.attr('rel');
        var startItem = currPage * rowPerPage;
        var endItem = startItem + rowPerPage;
        $tr.css('opacity', '0.0')
            .addClass('off-screen')
            .slice(startItem, endItem)
            .removeClass('off-screen')
            .animate({opacity: 1}, 300);

    });
    $pagingLink.filter(':first').addClass('active');
    /********* pagination 끝 ***********/
}
// 게시글 상세정보 조회 메소드
me.fnShowDetail= function(docid) {
    me.dataSet["FileList"] = [];
    $("#fileDragDesc").html("");
    $("#"+pageid+" .tox-tinymce").hide();
    var title = $("#"+pageid+ " .boardTitle").val();
    var content = tinymce.activeEditor.getContent();
    var commnets = $("#"+pageid+ " #myBannerCommArea").val();
    var userid = gUserinfo.userid;
    var arg = {docid : docid};
    var invar = JSON.stringify(arg);
    gfnTx("aweportal.manageBBS", "selectOneDoc", {INVAR : invar}, function(OUTVAR) {
        var title = OUTVAR.list[0].title;
        if(title.length > 50) {
            title = title.substr(0, 49) + "...";
        }
        var content = OUTVAR.list[0].content;
        var reg_usid = OUTVAR.list[0].reg_usid;
        var reg_nm = OUTVAR.list[0].nm;
        var reg_dt = OUTVAR.list[0].reg_dt;
        var expire_dt = OUTVAR.list[0].expire_dt;
        page.find("#toggle").hide();
        page.find("#mnBanner").show();
        page.find("#mnBanner .boardTitle").val(title);
        page.find("#mnBanner .boardTitle2").html(title);
        page.find("#mnBanner .boardRegInfo").html("<i class='fas fa-user-circle ' style='color :rgb(197, 194, 194)'></i> <b>" + reg_nm + "</b>&nbsp;&nbsp;&nbsp;<i class='fas fa-clock' style='color :rgb(197, 194, 194)'></i> <b> 노출 기간</b>  " + reg_dt + " ~ " + expire_dt);
        page.find("#bannertextarea").html(content);
        page.find("#bannertextarea").show();
        
        // 공지사항은 관리자만 수정, 삭제 권한 부여
        if(userid != "admin" && userid != reg_usid) {
            $("#mnBanner .updateBtn").hide();
            $("#mnBanner .updateBtn").prop("disabled", true);
            $("#mnBanner .updateBtn2").prop("disabled", true);
            $("#mnBanner .deleteBtn").hide();
            $("#mnBanner .deleteBtn").prop("disabled", true);
        };
    });
    gfnTx("aweportal.manageBBS", "increaseReadcnt", {INVAR : invar}, function(OUTVAR) {});
    gfnTx("aweportal.manageBBS", "selectComm", {INVAR : invar}, function(OUTVAR){
        me.dataSet["CommList"] = [];
        $(".BannerCommListDiv").html("");
        for (let i = 0; i < OUTVAR.list.length; i++) {
            const el = OUTVAR.list[i];
            var CommList = {
                docid: el.ref_id,
                commid: el.val_1,
                comments: el.comments,
                reg_usid: el.reg_usid,
                dt: el.reg_dt,
                reg_nm: el.nm
            };
            me.dataSet["CommList"].push(CommList);
            me.fnDrawCommList(docid);
        };
    });
    gfnTx("aweportal.manageBBS", "selectFile", {INVAR : invar}, function(OUTVAR) {
        if(OUTVAR.fList.length == 0 ){
            $("#fileDragDesc").html("업로드된 파일이 없습니다.");
        }
        for (let i = 0; i < OUTVAR.fList.length; i++) {
            const el = OUTVAR.fList[i];
            var FileList = {
                fileid: el.fileid,
                file_tp: el.file_tp,
                file_nm: el.file_nm,
                filename: el.orgn_nm,
                fileSize: el.file_sz,
                file_dir: el.file_dir,
                file_url: el.file_url
            };
            me.dataSet["FileList"].push(FileList);
            me.fnDrawFileList(docid);
        };
    });
    // 게시글 수정 버튼 클릭시 이벤트 발생
    $("#mnBanner .updateBtn").on("click", function(e) {
        $("#"+pageid+" .tox-tinymce").show();
        tinyMCE.activeEditor.setContent($("#bannertextarea").html());
        $("#bannertextarea").hide();
        $("#"+pageid+ " .boardTitle").show();
        $("#mnBanner .fileUploadBtn").show();
        $("#mnBanner .updateBtn").hide();
        $("#mnBanner .updateBtn2").show();
        $("#mnBanner .titleDiv").hide();
    });   
    // 게시글 삭제 버튼 클릭시 이벤트 발생
    $("#mnBanner .deleteBtn").on("click", function(e) {
        gfnConfirm("게시글 삭제", "게시글을 삭제하시겠습니까?", function(confirm) {
            if(confirm) {
                me.fnDeleteBBS(docid);
                gMDI.openPage( "manageBanner", "배너 관리" );
                $("#"+pageid+" .closetab").click();
            }
        })
    });  
    $("#mnBanner .updateBtn2").on("click", function(e) {
        var title = $("#"+pageid+ " .boardTitle").val();
        var content = tinymce.activeEditor.getContent();
        gfnConfirm("게시글 수정", "게시글을 수정하시겠습니까?", function(confirm) {
            if(confirm) {
                if(isNull(content) || isNull(title)) {
                    gfnAlert("수정 실패", "제목과 내용을 모두 입력하세요.");
                    return;
                }
                else {
                    me.fnUpdateBBS(docid, title, content);
                    gfnAlert("수정 성공", "수정이 완료되었습니다.");
                    gfnTx("aweportal.manageBBS", "selectOneDoc", {INVAR : invar}, function(OUTVAR) {});
                    $("#"+pageid+" .tox-tinymce").hide();
                    $("#bannertextarea").html(content);
                    $("#bannertextarea").show();
                    $("#"+pageid+ " .boardTitle").hide();
                    $("#mnBanner .titleDiv").show();
                    $("#mnBanner .updateBtn").show();
                    $("#mnBanner .updateBtn2").hide();
                    $("#mnBanner .fileUploadBtn").hide();
                }
            }
        })
    }); 
    // 댓글 작성 버튼 클릭시 이벤트 발생
    $("#mnBanner .insertBannerCommBtn").on("click", function(e) {
        me.dataSet["CommList"] = [];
        me.fnInsertComm(docid, commnets);
    });
    $(".fileUploadBtn").click(function(e) {
        e.preventDefault();
        gfnUpload(docid, file_tp, ref_file_tp, function(arrFiles) {
            //저장된 파일목록(arrFiles)을 사용하여 첨부파일 목록을 Refresh한다.
            if(arrFiles.length > 0) {
                for (let i = 0; i < arrFiles.length; i++) {
                    const el = arrFiles[i];
                    var FileList = {
                        fileid: el.fileid,
                        file_tp: el.file_tp,
                        file_nm: el.file_nm,
                        filename: el.orgn_nm,
                        fileSize: el.file_sz,
                        file_dir: el.file_dir,
                        file_url: el.file_url
                };
                    me.dataSet["FileList"].push(FileList);
                    me.fnDrawFileList(docid);
                };
            } else {
                page.find("#dropZone #fileDragDesc").html("");
                page.find("#dropZone #fileDragDesc").append("업로드된 파일이 없습니다.");
            }
        });
    });
},
// 파일 목록 조회 메소드
me.fnDrawFileList= function(docid) {
    $("#dropZone #fileDragDesc").html("");
    $.each(me.dataSet["FileList"],function(idx,el) {
        var fileList = $(`<tr class="fileList" url='${el.file_url}' filename='${el.filename}'>`);
        fileList.append(`<td class="filename"><b>${el.filename}</b>&nbsp&nbsp&nbsp</td>`);
        if(el.fileSize > 1000000) { 
            var convertedSize = Math.round(el.fileSize/1000000);
            fileList.append(`<td class="fileSize">${convertedSize} MB</td>`);
        }
        else {
            var convertedSize = el.fileSize/1000;
            fileList.append(`<td class="fileSize">${convertedSize} KB</td>`);
        }
        fileList.append(`</tr>`);
        page.find("#dropZone #fileDragDesc").append(fileList);

        fileList.on("click", function(e){
            var oE = $(e.target);
            if(oE.isON("td.filename")) { 
                var oTR = oE.exactObj("tr[url]"); 
                var url = oTR.attr("url");
                var filename = oTR.attr("filename");
                function fnDownload(url,filename) {
                    var frm = $("<form action='/awegtx.jsp?pgm=aweportal.fileDownloader' target='_blank' " +
                                " method='POST' style='display:none'></form>");
                    var args = {url:url, filename:filename};
                    var sArgs = JSON.stringify(args);
                    frm.append("<input type='text' name='INVAR' value='"+sArgs+"'>");
                    frm.appendTo("#"+pageid); 
                    frm.submit();
                }
                fnDownload(url,filename);
            } else {
                var oTR = oE.exactObj("tr[url]"); 
                var url = oTR.attr("url");
                window.open(url,"_blank");
            }
        }); 
    });
},
// 게시글에 달린 댓글 조회 메소드
me.fnDrawCommList= function(docid) {
    var userid = gUserinfo.userid;
    page.find(".BannerCommListDiv").html("");
    $.each(me.dataSet["CommList"],function(idx,el) {
        var html = $(`<div id="updateCommDiv${el.commid}" style="display : none; margin-bottom : 20px;">`);
        html.append(`<textarea class="updateArea${el.commid}" placeholder="수정할 내용을 입력하세요"></textarea>`);
        html.append(`<br>`);
        html.append(`<button type='button' class='updateCommBtn' >댓글 수정</button>`);
        html.append(`<button type='button' class='returnBtn' >취소</button>`);
        html.append(`</div>`);
        
        var newComm = $(`<div id="${el.commid}" class="bbsComm" docid='${el.docid}'>`);
        newComm.append(`<i class="fas fa-user-circle"></i><span class="commReg_nm">&nbsp;<b>${el.reg_nm}</b></span>`);
        newComm.append(`<span class="commDt">${el.dt}</span><br>`);
        newComm.append(`<div class="comments">${el.comments}</div>`);
        newComm.append(html);
        newComm.append(`<button class="commUpdate">수정</button>`);
        newComm.append(`<button class="commDelete">삭제</button>`);
        newComm.append(`</div>`);
        page.find(".BannerCommListDiv").append(newComm);

        // 댓글은 관리자와 작성자만 수정, 삭제 권한 부여
        if(userid != "admin" && userid != el.reg_usid) {
            $("#mnBanner .commUpdate").hide();
            $("#mnBanner .commUpdate").prop("disabled", true);
            $("#mnBanner .commDelete").hide();
            $("#mnBanner .commDelete").prop("disabled", true);
        };
        // 댓글 삭제 버튼 클릭시 이벤트 발생
        newComm.on("click",".commDelete", function(e){
            var oE = $(e.target);
            var oTR = oE.exactObj("div[id]");
            var arg = {commid : oTR.attr("id")};
            invar = JSON.stringify(arg);
            if(oTR.length != 1) return;
            gfnConfirm("삭제 확인","댓글을 삭제 하시겠습니까?", function(confirm){
                if(confirm) {
                    gfnTx("aweportal.manageBBS", "deleteComm", {INVAR : invar}, function(OUTVAR) {});
                    $("#"+oTR.attr("id")).remove();
                }
            });
        });
        // 댓글 수정 버튼 클릭시 이벤트 발생
        newComm.on("click",".commUpdate", function(e){
            var oE = $(e.target);
            var oTR = oE.exactObj("div[id]");
            var bannerComDivId = oTR.attr("id");
            $("#"+pageid+" .BannerCommListDiv #updateCommDiv" + bannerComDivId).show();
            $("#"+pageid+" .BannerCommListDiv #" + bannerComDivId + " .commUpdate").hide();
            $("#"+pageid+" .BannerCommListDiv #" + bannerComDivId + " .commDelete").hide();
            if(oTR.length != 1) return;
            $("#"+pageid+" .BannerCommListDiv #updateCommDiv" + bannerComDivId + " .updateCommBtn").on("click", function(e) {
                var comments = $("#"+pageid+" .BannerCommListDiv .updateArea" + bannerComDivId).val();
                comments = comments.replace(/(?:\r\n|\r|\n)/g, '<br />');
                if(isNull(comments) || comments == undefined) {
                    gfnAlert("수정 실패", "댓글 내용을 입력해 주세요.");
                    return;
                }
                else {
                    me.fnUpdateComm(comments, bannerComDivId);
                    $("#"+ bannerComDivId + " .comments").html(comments);
                }
                $("#"+pageid+" .BannerCommListDiv #updateCommDiv" + bannerComDivId).hide();
                $("#"+pageid+" .BannerCommListDiv #" + bannerComDivId + " .commUpdate").show();
                $("#"+pageid+" .BannerCommListDiv #" + bannerComDivId + " .commDelete").show();
            });
        });
        newComm.on("click", ".returnBtn", function(e) {
            var oE = $(e.target);
            var oTR = oE.exactObj("div[id]");
            var bannerComDivId = oTR.attr("id");
            $("#"+bannerComDivId).hide();
            var commAreaId = bannerComDivId.split("updateCommDiv")[1];
            $("#"+pageid+" .BannerCommListDiv #" + commAreaId + " .commUpdate").show();
            $("#"+pageid+" .BannerCommListDiv #" + commAreaId + " .commDelete").show();
            $("#"+pageid+" .BannerCommListDiv #updateArea" + commAreaId).val("");
        });
    });
},
// 게시글 수정 메소드
me.fnUpdateBBS= function(docid, title, content) {
    var content = tinymce.activeEditor.getContent();
    var title = $("#"+pageid + " .boardTitle").val();
    var args = {title:title, content:content, docid:docid};
    var invar = JSON.stringify(args);
    gfnTx("aweportal.manageBBS", "updateDoc", {INVAR : invar}, function(OUTVAR){
        if(OUTVAR.rtnCd != "OK") {
            gfnAlert("수정 실패", "수정에 실패하였습니다.");
            return;
        }
    });
    $("#"+pageid+" .boardTitle2").html(title);
},
// 게시글 삭제 메소드
me.fnDeleteBBS=function(docid) {
    var args = {docid:docid};
    var invar = JSON.stringify(args);
    gfnTx("aweportal.manageBBS", "deleteDoc", {INVAR : invar}, function(OUTVAR){
        if(OUTVAR.rtnCd == "OK") {
            gfnAlert(" 삭제 완료", "게시글을 삭제하였습니다.");
        } else {
            gfnAlert(" 삭제 실패", "게시글 삭제에 실패하였습니다.");
        }
    });
}
// 댓글 작성 메소드
me.fnInsertComm= function(docid, comments) {
    var userid = gUserinfo.userid;
    var usernm = gUserinfo.usernm;
    var comments = $("#"+pageid+" #myBannerCommArea").val();
    comments = comments.replace(/(?:\r\n|\r|\n)/g, '<br />');
    var ref_info_tp = "T_DOC";
    var arg = {docid : docid, ref_info_tp: ref_info_tp, comments : comments};
    var invar = JSON.stringify(arg);
    var sysdate = new Date();
    var sDate = dateFormat(sysdate);
    if(!isNull(comments)){
        gfnTx("aweportal.manageBBS", "insertComm",{INVAR : invar}, function(OUTVAR){
            var html = $(`<div id="updateCommDiv${OUTVAR.commid}" style="display : none; margin-bottom : 20px;">`);
            html.append(`<textarea class="updateArea${OUTVAR.commid}" placeholder="수정할 내용을 입력하세요" style="width : 90%; height : 60px; margin-bottom : 10px; resize : none;"></textarea>`);
            html.append(`<br>`);
            html.append(`<button type='button' class='updateCommBtn' >댓글 수정</button>`);
            html.append(`<button type='button' class='returnBtn' >취소</button>`);
            html.append(`</div>`);

            var newComm = $(`<div id="${OUTVAR.commid}" class="bbsComm" docid='${docid}'>`);
            newComm.append(`<i class="fas fa-user-circle"></i><span class="commReg_nm">&nbsp;<span class="commReg_usid"><b>${usernm}</b></span>`);
            newComm.append(`<span class="commDt">${sDate}</span><br>`);
            newComm.append(`<div class="comments">${comments}</div>`);
            newComm.append(html);
            newComm.append(`<button class="commUpdate">수정</button>`);
            newComm.append(`<button class="commDelete">삭제</button>`);
            newComm.append(`</div>`);
            page.find(".BannerCommListDiv").append(newComm);
            $("#"+pageid+" #myBannerCommArea").val("");

            // 댓글 삭제 버튼 클릭시 이벤트 발생
            newComm.on("click",".commDelete", function(e){
                var oE = $(e.target);
                var oTR = oE.exactObj("div[id]");
                var arg = {commid : oTR.attr("id")};
                invar = JSON.stringify(arg);
                if(oTR.length != 1) return;
                gfnConfirm("삭제 확인","댓글을 삭제 하시겠습니까?", function(confirm){
                    if(confirm) {
                        gfnTx("aweportal.manageBBS", "deleteComm", {INVAR : invar}, function(OUTVAR) {});
                        $("#"+oTR.attr("id")).remove();
                    }
                });
            });
            // 댓글 수정 버튼 클릭시 이벤트 발생
            newComm.on("click",".commUpdate", function(e){
                var oE = $(e.target);
                var oTR = oE.exactObj("div[id]");
                var bannerComDivId = oTR.attr("id");
                $("#"+pageid+" .BannerCommListDiv #updateCommDiv" + bannerComDivId).show();
                $("#"+pageid+" .BannerCommListDiv #" + bannerComDivId + " .commUpdate").hide();
                $("#"+pageid+" .BannerCommListDiv #" + bannerComDivId + " .commDelete").hide();
                if(oTR.length != 1) return;
                $("#"+pageid+" .BannerCommListDiv #updateCommDiv" + bannerComDivId + " .updateCommBtn").on("click", function(e) {
                    var comments = $("#"+pageid+" .BannerCommListDiv .updateArea" + bannerComDivId).val();
                    comments = comments.replace(/(?:\r\n|\r|\n)/g, '<br />');
                    if(isNull(comments) || comments == undefined) {
                        gfnAlert("수정 실패", "댓글 내용을 입력해 주세요.");
                        return;
                    }
                    else {
                        me.fnUpdateComm(comments, bannerComDivId);
                        $("#"+ bannerComDivId + " .comments").html(comments);
                    }
                    $("#"+pageid+" .BannerCommListDiv #updateCommDiv" + bannerComDivId).hide();   
                    $("#"+pageid+" .BannerCommListDiv #" + bannerComDivId + " .commUpdate").show();
                    $("#"+pageid+" .BannerCommListDiv #" + bannerComDivId + " .commDelete").show();
                });
            });
            newComm.on("click", ".returnBtn", function(e) {
                var oE = $(e.target);
                var oTR = oE.exactObj("div[id]");
                var bannerComDivId = oTR.attr("id");
                $("#"+bannerComDivId).hide();
                var commAreaId = bannerComDivId.split("updateCommDiv")[1];
                $("#"+pageid+" .BannerCommListDiv #" + commAreaId + " .commUpdate").show();
                $("#"+pageid+" .BannerCommListDiv #" + commAreaId + " .commDelete").show();
                $("#"+pageid+" .BannerCommListDiv #updateArea" + commAreaId).val("");
            });
        })
    } 
    else {
        gfnAlert("등록 실패", "내용을 입력해 주세요.");
        return;
    }
},
// 댓글 수정 메소드
me.fnUpdateComm= function(comments, commid) {
    var args = {comments:comments, commid:commid};
    var invar = JSON.stringify(args);
    gfnTx("aweportal.manageBBS", "updateComm", {INVAR : invar}, function(OUTVAR){
        if(OUTVAR.rtnCd != "OK") {
            gfnAlert("수정 실패", "수정에 실패하였습니다.");
            return;
        } 
    });
}
$("#"+pageid+" .bannerSearchCond").on("change", function() {
    $("#"+pageid+" .searchKeyword").val("");
    if($("#"+pageid+" .bannerSearchCond").val() ==("all")) {
        $("#"+pageid+" .searchKeyword").prop("readonly", true);
        $("#"+pageid+" .searchKeyword").css("background-color", "rgb(226 226 226 / 93%)");
        $("#"+pageid+" .searchKeyword").css("border", "0.5px solid black");
    } else {
        $("#"+pageid+" .searchKeyword").prop("readonly", false);
        $("#"+pageid+" .searchKeyword").css("background-color", "#fff");
    }
});

$("#mnBanner .toList").click(function() {
    $("#mnBanner").hide();
    $("#toggle").show();
    me.dataSet["BannerList"] = [];
    gfnTx("aweportal.manageBBS", "selectAllDoc", {}, function(OUTVAR){
    for (let i = 0; i < OUTVAR.list.length; i++) {
        const el = OUTVAR.list[i];
        var BannerList = {
            docid: el.docid,
            title: el.title,
            content: el.content,
            reg_usid: el.reg_usid,
            dt: el.reg_dt,
            read_cnt: el.read_cnt,
            grpid : el.doc_fieldid,
            reg_nm: el.nm,
        };
        me.dataSet["BannerList"].push(BannerList);
    }
    me.fnDrawBannerList();
    })
    gMDI.openPage( "manageBanner", "배너 관리" );
    $(".active .closetab").click();
});

$("#toggle .toRegisterBBS").click(function() {
    gMDI.openPage( "registerBBS", "공지사항 등록" );
    $(".active .closetab").click();
});

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>