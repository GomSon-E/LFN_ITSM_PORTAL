<style>
    ul{
        list-style: none;
    }
    #webhooktest{
        border: 1px solid black;

    }
</style>
<div class="pageTop">
    <h2 style="text-align: center;">테스트페이지</h2>
    <!-- <button class="fnSearch">조회</button>
    <button class="fnAddrow">줄추가</button> -->    
    
</div>
<div class="pageContent"> 
    <h2 style="text-align: center;">테스트페이지</h2>
    <div>
        <ul id="list">
            <!-- <li>제목 : <input type="text"></li>
            <li>내용 : <input type="text"></li> -->
            <li>주문번호 : <input type="text" name="market_idx"></li>
            <li>주문상세번호 : <input type="text" name="basket_idx"></li>
            <li>상품코드 : <input type="text" name="goods_code"></li>
            <li>컬러코드 : <input type="text" name="color_code"></li>
            <li>사이즈코드 : <input type="text" name="size_code"></li>
            <li>수량 : <input type="text" name="ea"></li>
            <li>매장코드 : <input type="text" name="shop_code"></li>
            <li>확정여부 : <input type="text" name="confirm" value="true"></li>     
            <!-- <input type="text" name="numFloor"><br> -->
        </ul>
    </div>
    <div>
        <ul id="list2"></ul>
    </div>
    <button class="Popuptest">주문</button>
    <button class="Search">GET</button>
    <button class="PostSearch">syncSTK</button>
    <button class="Popuptest2">주문목록조회</button>
    <button class="userSearch">syncPrice</button>
    <button class="receiveOnlineOrder">receiveOnlineOrder</button>
    <button class="receiveOnlineDetail">receiveOnlineDetail</button>
    <button class="receiveOnlineConfirm">receiveOnlineConfirm</button>
</div>
<div id="webhooktest">사라지면 들어온것</div>
<script>
// autogen start /////////////////////////////////////////////////////////////////////////    
$(function() {
    var appid = "aweportal";   //수정할 것!
    var pgmid = "naverMessageTest";  //수정할 것!
    var page = $("*[pgmid='"+pgmid+"'].framepage").last(); /* html로 호출되기 때문에 현재 pageid는 스스로 알아내야함 */
    var pageid = page.attr("id");  
    var me = {
        //화면초기화
        fnInit : function() { 
            console.log("page initialized..");
            gfn[pageid] = me;
            me.appid    = appid;
            me.pgmid    = pgmid;
            me.pageid   = pageid;
            me.page     = page;  //자기자신을 참조할때 me.page (JQUERY Object)를 사용한다.

            // me.fnselectprofile();
            me.fnRandomMathString();
            const num = Math.random() * 999999999999;
            const numFloor = Math.floor(num + 100000000000).toString(36).substr(2,11);
            me.page.on("click","button",function(e){
                console.dir(e);
                var oE = $(e.target);
                // if(oE.hasClass("fnSearch")) me.fnSearch(); 
                // if(oE.hasClass("fnAddrow")) me.fnAddrow(); 
                if(oE.hasClass("Search")) me.fnSearch();
                if(oE.hasClass("PostSearch")) me.fnPostSearch();
                if(oE.hasClass("Popuptest")) me.fnPopuptest();
                if(oE.hasClass("Popuptest2")) me.fnPopuptest2();
                if(oE.hasClass("userSearch")) me.fnuserSearch();
                if(oE.hasClass("receiveOnlineOrder")) me.fnreceiveOnlineOrder();
                if(oE.hasClass("receiveOnlineDetail")) me.fnreceiveOnlineDetail();
                if(oE.hasClass("receiveOnlineConfirm")) me.fnreceiveOnlineConfirm();
            });

        },
        // fnselectprofile: function() {
		// 	//frameset 데이터로드 : 세션사용자정보를 사용하므로 args없음
        //     var args = {};
        //     var invar = JSON.stringify(args);
		// 	gfnTx("aweportal.manageProfile","selectprofile",{INVAR : invar}, function(OUTVAR){ 
		// 		logger(pgmid,"Init",OUTVAR);
		// 		if(OUTVAR.rtnCd=="OK") {
		// 			var dataList = OUTVAR.list; //조회된 용어목록데이터
        //             var oTbl = me.page.find("#list li input"); //조회된 데이터를 뿌려줄 테이블
        //             oTbl.children("*").remove(); //값을 바인팅 하기전에 테이블을 Clear
        //             for(var i=0; i<dataList.length; i++) { //조회된 용어목록데이터를 한건씩 루프돌리면서
        //                 var dataRow = dataList[i];  //dataRow = {col:"val",col2:"val2"}
        //                 for(var colid in dataRow) { //컬럼별로 루프돌리면서 컬럼값을 세팅 
        //                     $(`input[name="${colid}"]`).val(dataRow[colid]);
        //                 }
        //             } 
		// 		}else {    
        //             gfnAlert("조회오류",OUTVAR.rtnMsg);
        //         }
		// 	});
		// },
        // fntest: function() {
		// 	//frameset 데이터로드 : 세션사용자정보를 사용하므로 args없음
        //     page.on("click",".fntest",function(e){
        //         gMDI.openPage("manageProfileTest","프로필관리테스트",function(OUOTVAR){

        //         },"aweportal");
        //     })
		// },
        // fnmanageShop: function() {
		// 	//frameset 데이터로드 : 세션사용자정보를 사용하므로 args없음
        //     page.on("click",".fnmanageShop",function(e){
        //         gMDI.openPage("manageShop","매장정보관리테스트",function(OUOTVAR){

        //         },"aweportal");
        //     })
		// },
        //조회
        // fnSearch : function() {  
        //     var nm = me.page.find("input[name='nm']").val(); //조회조건에서 값 가져오기
        //     var args = {nm:nm}
        //     var invar = JSON.stringify(args);
        //     console.dir(invar);
        //     gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
        //         console.dir(OUTVAR);
        //         if(OUTVAR.rtnCd=="OK") {
        //             var dataList = OUTVAR.list; //조회된 용어목록데이터
        //             var oTbl = me.page.find("#list"); //조회된 데이터를 뿌려줄 테이블
        //             oTbl.children("*").remove(); //값을 바인팅 하기전에 테이블을 Clear
        //             for(var i=0; i<dataList.length; i++) { //조회된 용어목록데이터를 한건씩 루프돌리면서
        //                 var dataRow = dataList[i];  //dataRow = {col:"val",col2:"val2"}
        //                 var oRow = me.fnAddrow("retrieved"); //row그림추가 
        //                 for(var colid in dataRow) { //컬럼별로 루프돌리면서 컬럼값을 세팅 
        //                     oRow.find(`[name="${colid}"]`).val(dataRow[colid]); 
        //                 }
        //             } 
        //         } else {    
        //             gfnAlert("조회오류",OUTVAR.rtnMsg);
        //         }
        //     }
            
        //     )},
        //줄추가
        fnAddrow: function(stat) {
            var collist = ["usid","nm","nick_nm","email"];
            var oTbl = me.page.find("#list");
            var oRow = $(`<li></li>`);
            stat = (stat==undefined)?"new":stat;
            for(var i=0; i<collist.length; i++) {
                var colid = collist[i];
                var oCol = $(`<input type="text" name="${colid}" value="" placeholer="${stat}">`);
                var oCol2 = $(`<br>`);
                oCol.on("change",function(e){
                    var el = $(e.target);
                    var label = el.prev("label");
                    label.text( label.text()+"*" );
                });
                oRow.append(oCol,oCol2);
                oCol.before( $(`<label>${colid}</label>`) );                
            }
            
            oTbl.append(oRow); 
            return oRow;
        },
        //저장
        fnSearch : function() { 
            //입력된 값 가져오기..
            var list = [];
            var oRows = me.page.find("#list li");
            var row = {};
            $(oRows).find("input").each(function(colidx,oCol){
                var colid = $(oCol).attr("name");
                var val = $(oCol).val();
                row[colid] = val;
            });
            list.push(row);
            var args = {list:ar_order_info};
            var invar = JSON.stringify(args);
            console.dir(invar);
            gfnTx("aweportal.naverMessageTest","Search",{INVAR:invar},function(OUTVAR){
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("테스트성공","검색완료");
                    console.log(OUTVAR.sOUTVAR);
                    $("#webhooktest").html(OUTVAR.sOUTVAR);   
                } else {
                    gfnAlert("저장실패",OUTVAR.rtnMsg);
                }
            });
        },
        fnPostSearch : function() { 
            //입력된 값 가져오기..
            var list = [];
            var oRows = me.page.find("#list li");
            var row = {};
            $(oRows).find("input").each(function(colidx,oCol){
                var colid = $(oCol).attr("name");
                var val = $(oCol).val();
                row[colid] = val;
            });
            list.push(row);
            console.log(list);
            var args = {list:list};
            var invar = JSON.stringify(args);
            console.dir(invar);
            gfnTx("aweportal.naverMessageTest","PostSearch",{INVAR:invar},function(OUTVAR){
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("테스트성공","검색완료");
                    console.log(OUTVAR.sOUTVAR);
                    $("#webhooktest").html(OUTVAR.sOUTVAR);
                    console.log(OUTVAR.Code);
                    $("#webhooktest").add(OUTVAR.Code);
                } else {
                    gfnAlert("저장실패",OUTVAR.rtnMsg);
                }
            });
        },
        fnreceiveOnlineOrder : function() { 
            //입력된 값 가져오기..
            var list = [];
            var oRows = me.page.find("#list li");
            var row = {};
            $(oRows).find("input").each(function(colidx,oCol){
                var colid = $(oCol).attr("name");
                var val = $(oCol).val();
                row[colid] = val;
            });
            list.push(row);
            console.log(list);
            var args = {list:list};
            var invar = JSON.stringify(args);
            console.dir(invar);
            gfnTx("aweportal.naverMessageTest","receiveOnlineOrder",{INVAR:invar},function(OUTVAR){
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("테스트성공","검색완료");
                    console.log(OUTVAR.sOUTVAR);
                    $("#webhooktest").html(OUTVAR.sOUTVAR);   
                } else {
                    gfnAlert("저장실패",OUTVAR.rtnMsg);
                }
            });
        },
        fnPopuptest : function() { 
            //입력된 값 가져오기..
            var list = [];
            var list2 = [];
            var order = $("<div id='order'></div");
            var orderlist = $("<ul id='orderlist'></ul>");
            order.append(orderlist);
            var oRows = me.page.find("#list li");
            console.log(oRows);
            $(oRows).find("input").each(function(colidx,oCol){
                var colid = $(oCol).attr("name");
                var val = $(oCol).val();
                list.push(colid);
                list2.push(val);
            });
            var col = [
                {id : "itemcd", nm : "상품번호"},
                {id : "item_nm", nm : "상품명"},
                {id : "item_ea", nm : "수량"},
                {id : "item_price", nm : "가격"}
            ];
            
            for(i=0;i<col.length;i++){
                var oRow = $(`<<li></li>>`);
                var lists = col[i].nm;
                var oCol2 = $(`<input type="text" name="${list[i]}" value="${list2[i]}" readonly>`);
                oRow.append(oCol2);
                oRow.append(oCol3);
                oCol2.before($(`<label>${lists} : </label>`));
                orderlist.append(oRow);
            }
            var saveBtn = $(`<br><button class="saveBtn">주문수락</button>`);
            var cancelBtn = $(`<button class="cancel">취소</button>`);
            order.append(saveBtn);
            order.append(cancelBtn);
            gfnPopup("주문", order ,{resizable:false, width:1000,height:500,modal:false})
            saveBtn.on("click",function(){
                var oRows = order.find("#orderlist li");
                console.log(oRows);
                var row = {};
                oRows.find("input").each(function(colidx,oCol){
                    var colid = $(oCol).attr("name");
                    var val = $(oCol).val();
                    row[colid] = val;
                });
                var args = {list:row}
                var invar = JSON.stringify(args);
                console.log(invar);
                gfnTx("aweportal.naverMessageTest","Popuptest",{INVAR:invar},function(OUTVAR){
                console.log(OUTVAR);
                    if(OUTVAR.rtnCd=="OK") {
                        gfnAlert("수락됨","수락완료");
                    } else {
                        gfnAlert("오류발생",OUTVAR.rtnMsg);
                    }
                });
            });
            cancelBtn.on("click",function(){
                
            });
        },
        fnPopuptest2 : function() { 
            //입력된 값 가져오기..
            var args = {};
            var invar = JSON.stringify(args);
            gfnTx("aweportal.naverMessageTest","Popuptest2",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                var list = OUTVAR.list;
                console.log(list);
                var order = $("<div id='order'></div");
                var orderlist = $("<ul id='orderlist'></ul>");
                order.append(orderlist);
                var col = [
                    {id : "usid", nm : "아이디"},
                    {id : "nm", nm : "이름"},
                    {id : "nick_nm", nm : "닉네임"},
                    {id : "email", nm : "이메일"}
                ];
                for(u=0;u<list.length;u++){
                    var oRow = $(`<li></li>`);
                    for(i=0;i<col.length;i++){
                    var lists = col[i];
                    var lists2 = col[i].id;
                    var oCol2 = $(`<input type="text" name=${lists.id} value="" readonly>`);
                    oRow.append(oCol2);
                    oCol2.before($(`<label>${lists.nm} : </label>`));
                    }
                    orderlist.append(oRow);
                    var usid = list[u].usid;
                    var nm = list[u].nm;
                    var nick_nm = list[u].nick_nm;
                    var email = list[u].email;
                    
                }
                
                var saveBtn = $(`<br><button class="saveBtn">주문수락</button>`);
                var cancelBtn = $(`<button class="cancel">취소</button>`);
                order.append(saveBtn);
                order.append(cancelBtn);
                gfnPopup("주문", order ,{resizable:false, width:1000,height:500,modal:false})
                saveBtn.on("click",function(){
                    var oRows = order.find("#orderlist li");
                    console.log(oRows);
                    var row = {};
                    oRows.find("input").each(function(colidx,oCol){
                        var colid = $(oCol).attr("name");
                        var val = $(oCol).val();
                        row[colid] = val;
                    });
                    var args = {list:row}
                    var invar = JSON.stringify(args);
                    console.log(invar);
                });
                    } else {
                        gfnAlert("오류발생",OUTVAR.rtnMsg);
                    }
                });
            cancelBtn.on("click",function(){
                
            });
        },
        fnuserSearch : function() { 
            //입력된 값 가져오기..
            var list = [];
            var oRows = me.page.find("#list li");
            var row = {};
            $(oRows).find("input").each(function(colidx,oCol){
                var colid = $(oCol).attr("name");
                var val = $(oCol).val();
                row[colid] = val;
            });
            list.push(row);
            console.log(list);
            var args = {list:list};
            var invar = JSON.stringify(args);
            console.dir(invar);
            gfnTx("aweportal.naverMessageTest","userSearch",{INVAR:invar},function(OUTVAR){
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("테스트성공","검색완료");
                    console.log(OUTVAR.sOUTVAR);
                    $("#webhooktest").html(OUTVAR.sOUTVAR);   
                } else {
                    gfnAlert("저장실패",OUTVAR.rtnMsg);
                }
            });
        },
        fnreceiveOnlineDetail : function() { 
            //입력된 값 가져오기..
            var list = [];
            var oRows = me.page.find("#list li");
            var row = {};
            $(oRows).find("input").each(function(colidx,oCol){
                var colid = $(oCol).attr("name");
                var val = $(oCol).val();
                row[colid] = val;
            });
            list.push(row);
            console.log(list);
            var args = {list:list};
            var invar = JSON.stringify(args);
            console.dir(invar);
            gfnTx("aweportal.naverMessageTest","receiveOnlineDetail",{INVAR:invar},function(OUTVAR){
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("테스트성공","검색완료");
                    console.log(OUTVAR.sOUTVAR);
                    $("#webhooktest").html(OUTVAR.sOUTVAR);   
                } else {
                    gfnAlert("저장실패",OUTVAR.rtnMsg);
                }
            });
        },
        fnreceiveOnlineConfirm : function() { 
            //입력된 값 가져오기..
            var list = [];
            var oRows = me.page.find("#list li");
            var row = {};
            $(oRows).find("input").each(function(colidx,oCol){
                var colid = $(oCol).attr("name");
                var val = $(oCol).val();
                row[colid] = val;
            });
            list.push(row);
            console.log(list);
            var args = {list:list};
            var invar = JSON.stringify(args);
            console.dir(invar);
            gfnTx("aweportal.naverMessageTest","receiveOnlineConfirm",{INVAR:invar},function(OUTVAR){
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("테스트성공","검색완료");
                    console.log(OUTVAR.sOUTVAR);
                    $("#webhooktest").html(OUTVAR.sOUTVAR);   
                } else {
                    gfnAlert("저장실패",OUTVAR.rtnMsg);
                }
            });
        },
        fnRandomMathString : function(){
            let str = "";
            var count = 12;
            for(let i =0; i<count; i++){
                str += Math.floor(Math.random() * 36).toString(36);
            }
            $('input[name=numFloor]').val(str);
        }
        
    }
    
    //화면이 열릴때 화면초기화를 호출한다.
    if(typeof(me.fnInit)=='function') me.fnInit();
}); 
</script>