<style>[pgmid='manageBBS'].framepage .userClass { 
    width:100%; 
    }
    .bbsListDivFoot button, #mnBBS .bbsBtn button, #mnBBS .commDiv button {
        display:inline-block;
        color:white;
        font-weight: bold;
        cursor:pointer;
        background-color:#4b83d6;
        border: none;
        border-radius:0.25rem;
        padding:10px 15px;
        height:2rem;
        vertical-align:bottom;
        font-size:0.75rem;    
        white-space: nowrap;
        text-overflow: ellipsis;
    }
    .bbsListDivFoot button {
        height: auto !important;
    }
    .bbsListDivFoot button:hover, #mnBBS .bbsBtn button:hover, #mnBBS .commDiv button:hover, .bbsListDivFoot button:focus, #mnBBS .bbsBtn button:focus, #mnBBS .commDiv button:focus {
        color:#000;
        font-weight: bold;
        cursor:pointer;
        background-color:#eaeaea;
        border: none;
    }
    #mnBBS textarea, #mnBBS input, #toggleDiv input {
        font-family: "Noto Sans KR", sans-serif;
    }
    .flexColunm > * {
        flex: 0 0 auto;
    }
    .flexColunm > *:last-child {
        flex: 1 1 auto;
        height: unset !important;
    }
    #toggleDiv .bbsListDiv {
      
        /* overflow-y: scroll; */
    }

    #toggleDiv .bbsListDiv::-webkit-scrollbar {
    display: none;
    }


    #toggleDiv .BBSTable {
        width: 80%; 
        margin: 0 auto;
        margin-top : 20px;
        padding-top: 2%;
        padding-bottom: 5%;
        font-size: 1.2em;
        /* border: 1px solid #EFEFEF; */
        border-collapse: collapse;
      
        -ms-overflow-style: none; 

    }







    #toggleDiv .BBSTable > thead > tr > th { 
        background-color: #77b5fc; 
        color: white; 
        font-weight: normal;
    }
    #toggleDiv .BBSTable > thead > tr > th { 
        text-align: center; 
        line-height: 20px;
        height: 27px;
        padding: 15px;
        padding-top: 20px;
    }
    #toggleDiv .BBSTable > thead > tr > th:nth-child(1){
        width: 10%;
        border-top-left-radius: 50%;
    }
    #toggleDiv .BBSTable > thead > tr > th:nth-child(2){
        width: 60%
    }
    #toggleDiv .BBSTable > thead > tr > th:nth-child(3){
        width: 20%;
    }
    #toggleDiv .BBSTable > thead > tr > th:nth-child(4){
        width: 10%;
        border-top-right-radius: 50%;
    }
    #toggleDiv .BBSTable > tbody > tr{
        cursor: pointer;
        border-bottom: 1px solid #cccccc;
    
      
    }
    #toggleDiv .BBSTable > tbody > tr:nth-child(odd){
       /* background-color: #eeeeee; */
    }
    #toggleDiv .BBSTable > tbody > tr .title {
        text-align: left;    
    }
    #toggleDiv .BBSTable > tbody > tr .title:hover {
        text-decoration: underline;
    }
    #toggleDiv .BBSTable > tbody > tr > td {
        height: 35px;
        text-align: center; 
        padding: 5px 0px;
    }
    #toggleDiv .bbsListDivFoot > * {
        margin-right: 10px;
    }
    #toggleDiv .bbsListDivFoot{
        position: relative;
        margin-top: 30px;
        display: flex;
        justify-content: center;

    }
    #toggleDiv .bbsListDivFoot .bbsSearchCond{
        height: 37px;
        vertical-align: middle;
        width: 50px;
    }
    #toggleDiv .bbsListDivFoot input{
        line-height: 16px;
        vertical-align: middle;
        min-width: 350px;
    }
    #mnBBS .titleDiv {
        border: 1px solid rgb(231, 228, 228);
        border-inline: none;
        margin-top: 10px;
        margin-bottom: 30px;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    #mnBBS .docDiv, #mnBBS .commDiv{
        border : 1px solid rgb(197, 194, 194); 
        padding: 50px;
        margin : 30px;
        user-select: text;
    }
    #mnBBS .notice {
        font-size: 1.2em;
        font-weight: bold;
    }
    #mnBBS .contentForm {
        margin-bottom: 20px;
    }
    #mnBBS .boardTitle {
        width: 99%;
        margin-bottom : 20px; 
        margin-top : 20px; 
        display: none;
    }
    #mnBBS .boardTitle2 {
        width: 90%;
        
        height: 30px;
        margin-bottom : 20px; 
        margin-top : 10px;
        border: none;
        font-weight: bold;
        font-size: 1.8em;
    }
    #mnBBS .boardRegInfo {
        margin-bottom : 10px; 
        border: none;
        font-size: 1.2em;
    }
    #dropZone {
        margin-top: 5px;
        min-height: 80px;
        border : 1px solid rgb(204, 204, 204); 
    }
    #dropZone #fileDragDesc {
        margin: 10px;
    }
    #dropZone #fileDragDesc .fileList:hover {
        text-decoration: underline;
        cursor : pointer;
    }
    #dropZone > tr > td {
        margin-right : 5px;
    }
    #mnBBS .bbsBtn {
        margin-bottom: 10px;
        min-height: 25px;
        padding-top: 20px;
        border-top: 1px solid rgb(204, 204, 204);
    }
    #mnBBS .bbsBtn button {
        margin-right: 10px;
    }
    #mnBBS .toList {
        float: right;
        margin-right: 0px !important;
    }
    #mnBBS .insertCommDiv, #mnBBS .CommListDiv {
        margin-top : 20px;
        margin-bottom : 20px;
    }
    #myCommArea {
        width: 99.5%;
        height: 70px;
        margin-bottom : 20px;
        resize: none;
        padding: 5px;
    }
    #mnBBS .CommListDiv .bbsComm {
        font-size: 1.1em;
        padding: 10px 5px 10px 5px;
        margin-bottom : 2px;
        border : 1px solid rgb(231, 228, 228);
        border-inline: none;
    }
    #mnBBS .CommListDiv textarea {
        width : 99.5%; 
        height : 60px;
        padding: 5px; 
        margin-bottom : 10px; resize : none;
    }
    #mnBBS .CommListDiv .bbsComm span{
        margin-right : 20px;
    }
    #mnBBS .CommListDiv button {
        margin-right: 10px;
    }
    #mnBBS .comments{
        margin-top:10px; 
        margin-bottom:10px;
    }
    .off-screen {
        display: none;
    }
    #nav {
        margin-top: 30px;
        text-align: center;
    }
    #nav a {
        display: inline-block;
    padding: 5px 10px;
    margin-right: 0;
    font-family: Tahoma;
    background: border-box;
    color: #000;
    text-decoration: none;
    }
    #nav a.active {
        background: #1774ff;
        color: #fff;
        border-radius: 50%;
    }
    #detailtextarea {
        min-height: 350px;
        font-size: 1.5em;
    }</style>
    
    <!-- HTML autogen start ---------------------------------------------- -->            
    <div class="pageNav"></div>

    
    <div id="toggleDiv" class="flexColumn">
        <div class="pageTop"></div>
        <div class="bbsListDiv">
            <table class="BBSTable">
                <thead>
                <tr>
                    <th>작성자</th>
                    <th>제목</th>
                    <th>작성일자</th>
                    <th>조회수</th>
                </tr>    
                </thead>
                <tbody class="BBSTbody">
                </tbody>
            </table>
            <div class="bbsListDivFoot">
                <select class="docTag">
                    <option value="공지사항" selected>팩토리ERP 공지</option>
                    <option value="PLAS공지">PLAS 공지</option>
                    <option value="배너">배너</option>
                </select>
                <select class="bbsSearchCond">
                    <option value="ti">제목</option>
                    <option value="co">내용</option>
                    <option value="tico">제목+내용</option>
                    <option value="all">전체글</option>
                </select>
                <input type="text" class="searchKeyword"> 
                <button class="searchBtn"><i class="fa fa-search"></i></button>
                <button type="button" class="toRegisterBBS">새글 작성</button>
            </div>
        </div>
    </div>
    <div id="mnBBS" style="display: none;">
        <div class="docDiv">
            <form class="contentForm">
                <span class="notice">공지사항</span>
                <input type="text" class="boardTitle" placeholder="제목">
                <div class="titleDiv">
                    <div class="boardTitle2">
                    </div>
                    <div class="boardRegInfo" style="display: inline-block;">
                    </div>
                </div>
                <textarea id="mytextarea" class="boardContent" name="mytextarea3" placeholder="내용을 입력하세요"></textarea>
                <div id="detailtextarea" class="boardContent" style="display: none;"></div>
                <br>
                <div class="uploadedFile">
                    <i class="fas fa-file-alt"></i><span>&nbsp;&nbsp;업로드된 파일</span>
                    <div id="dropZone">
                        <div id="fileDragDesc"> 업로드된 파일이 없습니다. </div>
                    </div>
                </div>
            </form>
            <div class="bbsBtn">
                <button class="fileUploadBtn" style="display : none;">파일선택</button>
                <button type="button" class="updateBtn">수정</button>
                <button type="button" class="updateBtn2" style="display: none;">수정하기</button>
                <button type="button" class="deleteBtn">삭제</button>
                <button type="button" class="toList">목록으로</button>
            </div>
        </div>
        <div class="commDiv">
            <div class="insertCommDiv">
                <h2>댓글</h2>
                <form>
                    <textarea type="text" id="myCommArea" placeholder="댓글을 입력하세요"></textarea>
                    <br>
                    <button type="button" class="insertCommBtn" >댓글 작성</button>
                </form>
            </div>
            <div class="CommListDiv">
            </div>
        </div>
    </div>
    <!-- HTML autogen end ---------------------------------------------- -->
    <script>
    /*-- SCRIPT autogen start ---------------------------------------------- */        
    $(function() {
        var appid = "aweportal";
        var pgmid = "manageBBS"; 
        var page = $("*[pgmid='"+pgmid+"'].framepage").last();
        var pageid = page.attr("id"); 
        var me = {}
        var dataSet = {};
        var dataDef = {};
        var pageObj = {};
        var bEdit = false;
        me.fnInit = function() {
            gfn[pageid] = me; 
            me.appid    = appid;
            me.pgmid    = pgmid;
            me.pageid   = pageid;
            me.page     = page; 
            me.dataSet = dataSet;
            me.dataDef = dataDef;
            me.pageObj = pageObj;
            me.bEdit = bEdit;
    me.dataDef["_pgm"]={"ver":2.8,"upd_dt":"2022-08-24 10:28:34","remark":"","pgmid":"manageBBS","proc_mst_id":"","pgm_stat":"Y","sort_seq":61,"app_pgmid":"aweportal","shortcut":"","reg_dt":"2022-08-05 09:04:19","reg_usid":"mjw","pgm_nm":"공지사항 목록","upd_usid":"kihyunlee","pgm_tp":"UX","pgm_grp_nm":"포털","proc_mst_nm":"","app_pgm_nm":"포털","":"트랜젝션(메뉴)","crud":""};
    me.dataDef["_pgm_func"]=[];
    me.dataDef["_pgm_data"] = {};
    
            me.pageObj["_page"] = new gfnFramepage( me ); 
            for(var component_id in me.dataDef["_pgm_data"]) { 
                me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
            }  
            setTimeout(function(){
                $("#frameset").scrollTo(0); //스크롤 
            },10);
            if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
        } 
    /*-- SCRIPT autogen end ---------------------------------------------- */
    var file_tp = "BBS_ATTCH";
    var ref_file_tp = "T_DOC";
    
    /* 사용자초기화 */
    me.fnInitExtra=function() {
        try {
            if(gSYS=="PLAS") page.find(".docTag").val("PLAS공지");
        } catch {
            page.find(".docTag").val("공지사항");
        }
    
        //권한제어
        function _auth(auth) {
            $("#"+pageid+" .toRegisterBBS").hide();
            $("#"+pageid+" .toRegisterBBS").prop("disabled", true);  
            if(isNull(auth)) { 
                gfnAlert("시스템 사용권한 점검","화면에 대한 권한이 없습니다!");
                $("*[pageidx='"+me.pageid+"']").remove();
                delete gfn[me.pageid]; 
                me.page.remove(); 
            } else {
                if(isNull(auth.save_yn) || auth.save_yn != "Y") {
                    gfnAlert("시스템 사용권한 점검","화면에 대한 권한이 없습니다!");
                    $("*[pageidx='"+me.pageid+"']").remove();
                    delete gfn[me.pageid]; 
                    me.page.remove(); 
                } else {
                    $("#"+pageid+" .toRegisterBBS").show();
                    $("#"+pageid+" .toRegisterBBS").removeProp("disabled");  
                    $("#"+pageid+" .toRegisterBBS").removeAttr("disabled");   
                }
            } 
        }
        if(subset(gds.comcd,"grpcd","pgm_auth").length==0) {
            gfnGetData("pgm_auth",function(rtn){
                _auth(subset(rtn,"pgmid",pgmid)[0]);
            }); 
        } else {
            _auth(subset(subset(gds.comcd,"grpcd","pgm_auth"),"pgmid",pgmid)[0]) ;
        }
    
    
        me.dataSet["BBSList"] = [];
        me.dataSet["FileList"] = [];
        me.dataSet["CommList"] = [];
    
    
    
    
        me.fnSearchAll();
    }
    
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //사용자 컴포넌트/컨트롤
        else if(component.userComponent=="myCompoId") {
            //if(evt=="dblclick" && col=="colid") {...}
        }
    } 
    
    me.fnSearchAll=function() {
        var args = {};
        args.docTag = page.find(".docTag").val();
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid, "selectAllDoc", {INVAR:invar}, function(OUTVAR){
            for (let i = 0; i < OUTVAR.list.length; i++) {
                const el = OUTVAR.list[i];
                var BBSList = {
                    docid: el.docid,
                    title: el.title,
                    content: el.content,
                    reg_usid: el.reg_usid,
                    dt: el.reg_dt,
                    read_cnt: el.read_cnt,
                    grpid : el.doc_fieldid,
                    reg_nm: el.nm,
                };
                me.dataSet["BBSList"].push(BBSList);
            }
            me.fnDrawBBSList();
        })
    }
    
    page.find("#toggleDiv .searchBtn").on("click", function() {
        me.dataSet["BBSList"] = [];
        var disp = $("#"+pageid+" .bbsSearchCond").val();
        var term = $("#"+pageid+" .searchKeyword").val();
        var args = {disp: disp, term: term};
        args.docTag = page.find(".docTag").val();
        var invar = JSON.stringify(args);
        if(disp == "all") {
            gfnTx(appid+"."+pgmid, "selectAllDoc", {INVAR:invar}, function(OUTVAR){
                for (let i = 0; i < OUTVAR.list.length; i++) {
                    const el = OUTVAR.list[i];
                    var BBSList = {
                        docid: el.docid,
                        title: el.title,
                        content: el.content,
                        reg_usid: el.reg_usid,
                        dt: el.reg_dt,
                        read_cnt: el.read_cnt,
                        grpid : el.doc_fieldid,
                        reg_nm: el.nm,
                    };
                    me.dataSet["BBSList"].push(BBSList);
                    me.fnDrawBBSList();
                }
            })
            return;
        } else if(isNull(term) || term == undefined) {
            gfnAlert("검색 실패", "검색어를 입력해 주세요.");
            return;
        }
        gfnTx(appid+"."+pgmid, "searchDoc", {INVAR : invar}, function(OUTVAR){
            if(OUTVAR.list.length == 0) {
                gfnAlert("검색 실패", "검색 결과가 존재하지 않습니다.");
                $("#"+pageid+" .searchKeyword").val("");
                return;
            }
            else {
                for (let i = 0; i < OUTVAR.list.length; i++) {
                    const el = OUTVAR.list[i];
                    var BBSList = {
                        docid: el.docid,
                        title: el.title,
                        content: el.content,
                        reg_usid: el.reg_usid,
                        dt: el.reg_dt,
                        read_cnt: el.read_cnt,
                        grpid : el.doc_fieldid,
                        reg_nm: el.nm,
                    };
                    me.dataSet["BBSList"].push(BBSList);
                    me.fnDrawBBSList();
                }
            }    
        })
        $("#"+pageid+" .searchKeyword").val("");
    }); 
    
    $("#"+pageid+" #mytextarea").attr("id",pageid+"mytextarea");
        var plugins = [
        "advlist", "autolink", "lists", "link", "image", "charmap", "print", "preview", "anchor",
        "searchreplace", "visualblocks", "code", "fullscreen", "insertdatetime", "media", "table",
        "paste", "code", "help", "wordcount", "save"
    ];
    var edit_toolbar = 'formatselect fontselect fontsizeselect |'
                + ' forecolor backcolor |'
                + ' bold italic underline strikethrough |'
                + ' alignjustify alignleft aligncenter alignright |'
                + ' bullist numlist |'
                + ' table tabledelete |'
                + ' link image';
    var selector = '#'+pageid+'mytextarea';
    tinymce.init({
        selector: selector,
        branding: false,
        forced_root_block: false,
        language: "ko_KR",
        plugins: plugins,
        toolbar: edit_toolbar,
        height: 450,
        statusbar: false,
        resize: false,
        deprecation_warnings: false,
        content_style: "body {margin : 10px}",
        paste_data_images: true
    });
    // 날짜 형식 메소드
    function dateFormat(date) {
        let month = date.getMonth() + 1;
        let day = date.getDate();
        let hour = date.getHours();
        let minute = date.getMinutes();
        let second = date.getSeconds();
    
        month = month >= 10 ? month : '0' + month;
        day = day >= 10 ? day : '0' + day;
        hour = hour >= 10 ? hour : '0' + hour;
        minute = minute >= 10 ? minute : '0' + minute;
        second = second >= 10 ? second : '0' + second;
    
        return date.getFullYear() + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;
    }
    
    // 게시글 목록 조회 메소드
    me.fnDrawBBSList= function() {
        page.find(".BBSTable .BBSTbody").html("");
        $.each(me.dataSet["BBSList"],function(idx,el) {
            if(el.title.length > 50) {
                el.title = el.title.substr(0, 49) + "..."; 
            }
            var bbsList = $(`<tr class="bbs" docid='${el.docid}'>`);
            bbsList.append(`<td class="reg_nm">${el.reg_nm}</td> `);
            bbsList.append(`<td class="title"><b>${el.title}</b></td> `);
            bbsList.append(`<td class="dt">${el.dt}</td>`);
            bbsList.append(`<td class="read_cnt">${el.read_cnt}</td>`);
            bbsList.append(`</tr>`);
            page.find(".BBSTable .BBSTbody").append(bbsList);
            bbsList.on("click",function(e){
                var oE = $(e.target);
                var oTR = oE.exactObj("tr[docid]");
                if(oTR.length != 1) return;
                me.fnShowDetail(oTR.attr("docid"));
            });
        });
        if(me.dataSet["BBSList"].length%15 != 0) {
            var len = 15 - (me.dataSet["BBSList"].length%15);
            for (let index = 0; index < len; index++) {
                var emptyList = $(`<tr class="bbs" style="cursor : auto;">`);
                emptyList.append(`<td class="reg_nm"></td> `);
                emptyList.append(`<td class="title"></td> `);
                emptyList.append(`<td class="dt"></td>`);
                emptyList.append(`<td class="read_cnt"></td>`);
                emptyList.append(`</tr>`);
                page.find(".BBSTable .BBSTbody").append(emptyList);
            }
        }
    
        /********* pagination 시작 ***********/
        var rowPerPage = 15;
        page.find('#nav').remove();
        var $BBSTable = $("#"+pageid+" .BBSTable");
        $BBSTable.after('<div id="nav">');
        var $tr = $($BBSTable).find('tbody tr');
        var rowTotals = $tr.length;
        var pageTotal = Math.ceil(rowTotals/ rowPerPage);
        var i = 0;
        $('<a href="#" class="toFirstList" style="background-color:white; color:white; pointer-events:none;"></a>').attr('rel', 0).html('<<').appendTo('#'+pageid+' #nav');
        for (; i < pageTotal; i++) {
            $('<a href="#"></a>')
                .attr('rel', i)
                .attr('class', "idx"+i)
                .html(i + 1)
                .appendTo('#nav');
        }
        $('<a href="#" class="toLastList"></a>').attr('rel', pageTotal-1).html('>>').appendTo('#'+pageid+' #nav');
        $("#nav .idx0").addClass('active');
        if(pageTotal == 1) {
            $("#nav").css("display", "none");
        }
    
        $tr.addClass('off-screen')
            .slice(0, rowPerPage)
            .removeClass('off-screen');
    
        var $pagingLink = $('#'+pageid+' #nav a');
        $pagingLink.on('click', function (e) {
            var oE = $(e.target);
            var oTR = oE.exactObj("a[rel]");
            var pageIdx = oTR.attr("rel");
            if(pageIdx == (pageTotal-1)) {
                page.find(".toLastList").css("background-color", "white");
                page.find(".toLastList").css("color", "white");
                page.find(".toLastList").css("cursor", "auto");
                page.find(".toLastList").css("pointer-events", "none");
            } else {
          
                page.find(".toLastList").css("color", "black");
                page.find(".toLastList").css("cursor", "pointer");
                page.find(".toLastList").css("pointer-events", "auto");
            }
    
            if(pageIdx == 0) {
                page.find(".toFirstList").css("background-color", "white");
                page.find(".toFirstList").css("color", "white");
                page.find(".toFirstList").css("cursor", "auto");
                page.find(".toFirstList").css("pointer-events", "none");
            } else {
           
                page.find(".toFirstList").css("color", "black");
                page.find(".toFirstList").css("cursor", "pointer");
                page.find(".toFirstList").css("pointer-events", "auto");
            }
    
            e.preventDefault();
            var $this = $(this);
            if ($this.hasClass('active')) {
                return;
            }
            $pagingLink.removeClass('active');
            $this.addClass('active');
    
            if ($this.hasClass('toLastList')) {
                page.find(".toLastList").css("background-color", "white");
                page.find(".toLastList").css("color", "white");
                page.find(".idx" + (pageTotal-1)).addClass('active');
            }
            if ($this.hasClass('toFirstList')) {
                page.find(".toFirstList").css("background-color", "white");
                page.find(".toFirstList").css("color", "white");
                page.find(".idx0").addClass('active');
            }
    
            var currPage = $this.attr('rel');
            var startItem = currPage * rowPerPage;
            var endItem = startItem + rowPerPage;
            $tr.css('opacity', '0.0')
                .addClass('off-screen')
                .slice(startItem, endItem)
                .removeClass('off-screen')
                .animate({opacity: 1}, 300);
    
        });
        $pagingLink.filter(':first').addClass('active');
        /********* pagination 끝 ***********/
    }
    // 게시글 상세정보 조회 메소드
    me.fnShowDetail= function(docid) {
        me.dataSet["FileList"] = [];
        page.find("#fileDragDesc").html("");
        $("#"+pageid+" .tox-tinymce").hide();
        var title = $("#"+pageid+ " .boardTitle").val();
        var content = tinymce.activeEditor.getContent();
        var commnets = $("#"+pageid+ " #myCommArea").val();
        var userid = gUserinfo.userid;
        var arg = {docid : docid};
        var invar = JSON.stringify(arg);
        gfnTx(appid+"."+pgmid, "selectOneDoc", {INVAR : invar}, function(OUTVAR) {
            var title = OUTVAR.list[0].title;
            if(title.length > 50) {
                title = title.substr(0, 49) + "...";
            }
            var content = OUTVAR.list[0].content;
            var reg_usid = OUTVAR.list[0].reg_usid;
            var reg_nm = OUTVAR.list[0].nm;
            var reg_dt = OUTVAR.list[0].reg_dt;
            var expire_dt = OUTVAR.list[0].expire_dt;
            page.find("#toggleDiv").hide();
            page.find("#mnBBS").show();
            page.find("#mnBBS .boardTitle").val(title);
            page.find("#mnBBS .boardTitle2").html(title);
            page.find("#mnBBS .boardRegInfo").html("<i class='fas fa-user-circle ' style='color :rgb(197, 194, 194)'></i> <b>" + reg_nm + "</b>&nbsp;&nbsp;&nbsp;<i class='fas fa-clock' style='color :rgb(197, 194, 194)'></i> <b> 노출 기간</b>  " + reg_dt + " ~ " + expire_dt);
            page.find("#detailtextarea").html(content);
            page.find("#detailtextarea").show();
            
            // 공지사항은 관리자만 수정, 삭제 권한 부여
            if(userid != "admin" && userid != reg_usid) {
                $("#mnBBS .updateBtn").hide();
                $("#mnBBS .updateBtn").prop("disabled", true);
                $("#mnBBS .updateBtn2").prop("disabled", true);
                $("#mnBBS .deleteBtn").hide();
                $("#mnBBS .deleteBtn").prop("disabled", true);
            };
        });
        gfnTx(appid+"."+pgmid, "increaseReadcnt", {INVAR : invar}, function(OUTVAR) {});
        gfnTx(appid+"."+pgmid, "selectComm", {INVAR : invar}, function(OUTVAR){
            for (let i = 0; i < OUTVAR.list.length; i++) {
                const el = OUTVAR.list[i];
                var CommList = {
                    docid: el.ref_id,
                    commid: el.val_1,
                    comments: el.comments,
                    reg_usid: el.reg_usid,
                    dt: el.reg_dt,
                    reg_nm: el.nm
                };
                me.dataSet["CommList"].push(CommList);
                me.fnDrawCommList(docid);
            };
        });
        gfnTx(appid+"."+pgmid, "selectFile", {INVAR : invar}, function(OUTVAR) {
            if(OUTVAR.fList.length == 0 ){
                $("#fileDragDesc").html("업로드된 파일이 없습니다.");
            }
            for (let i = 0; i < OUTVAR.fList.length; i++) {
                const el = OUTVAR.fList[i];
                var FileList = {
                    fileid: el.fileid,
                    file_tp: el.file_tp,
                    file_nm: el.file_nm,
                    filename: el.orgn_nm,
                    fileSize: el.file_sz,
                    file_dir: el.file_dir,
                    file_url: el.file_url
                };
                me.dataSet["FileList"].push(FileList);
                me.fnDrawFileList(docid);
            };
        });
        // 게시글 수정 버튼 클릭시 이벤트 발생
        $("#mnBBS .updateBtn").on("click", function(e) {
            $("#"+pageid+" .tox-tinymce").show();
            tinyMCE.activeEditor.setContent($("#detailtextarea").html());
            page.find("#detailtextarea").hide();
            $("#"+pageid+ " .boardTitle").show();
            page.find("#mnBBS .fileUploadBtn").show();
            page.find("#mnBBS .updateBtn").hide();
            page.find("#mnBBS .updateBtn2").show();
            page.find("#mnBBS .titleDiv").hide();
        });   
        // 게시글 삭제 버튼 클릭시 이벤트 발생
        $("#mnBBS .deleteBtn").on("click", function(e) {
            gfnConfirm("게시글 삭제", "게시글을 삭제하시겠습니까?", function(confirm) {
                if(confirm) {
                    me.fnDeleteBBS(docid);
                    gMDI.openPage( "manageBBS", "공지사항 관리", function(){
                        gMDI.closeTab(me.pageid)
                    },"aweportal" );
                }
            })
        });  
        $("#mnBBS .updateBtn2").on("click", function(e) {
            var title = $("#"+pageid+ " .boardTitle").val();
            var content = tinymce.activeEditor.getContent();
            gfnConfirm("게시글 수정", "게시글을 수정하시겠습니까?", function(confirm) {
                if(confirm) {
                    if(isNull(content) || isNull(title)) {
                        gfnAlert("수정 실패", "제목과 내용을 모두 입력하세요.");
                        return;
                    }
                    else {
                        me.fnUpdateBBS(docid, title, content);
                        gfnAlert("수정 성공", "수정이 완료되었습니다.");
                        gfnTx(appid+"."+pgmid, "selectOneDoc", {INVAR : invar}, function(OUTVAR) {});
                        $("#"+pageid+" .tox-tinymce").hide();
                        page.find("#detailtextarea").html(content);
                        page.find("#detailtextarea").show();
                        $("#"+pageid+ " .boardTitle").hide();
                        page.find("#mnBBS .titleDiv").show();
                        page.find("#mnBBS .updateBtn").show();
                        page.find("#mnBBS .updateBtn2").hide();
                        page.find("#mnBBS .fileUploadBtn").hide();
                    }
                }
            })
        }); 
        // 댓글 작성 버튼 클릭시 이벤트 발생
        page.find("#mnBBS .insertCommBtn").on("click", function(e) {
            me.fnInsertComm(docid, commnets);
        });
        page.find(".fileUploadBtn").click(function(e) {
            e.preventDefault();
            gfnUpload(docid, file_tp, ref_file_tp, function(arrFiles) {
                //저장된 파일목록(arrFiles)을 사용하여 첨부파일 목록을 Refresh한다.
                me.dataSet["FileList"] = [];
                if(arrFiles.length > 0) {
                    for (let i = 0; i < arrFiles.length; i++) {
                        const el = arrFiles[i];
                        var FileList = {
                            fileid: el.fileid,
                            file_tp: el.file_tp,
                            file_nm: el.file_nm,
                            filename: el.orgn_nm,
                            fileSize: el.file_sz,
                            file_dir: el.file_dir,
                            file_url: el.file_url
                    };
                        me.dataSet["FileList"].push(FileList);
                        me.fnDrawFileList(docid);
                    };
                } else {
                    page.find("#dropZone #fileDragDesc").html("");
                    page.find("#dropZone #fileDragDesc").append("업로드된 파일이 없습니다.");
                }
            });
        });
    },
    // 파일 목록 조회 메소드
    me.fnDrawFileList= function(docid) {
        page.find("#dropZone #fileDragDesc").html("");
        $.each(me.dataSet["FileList"],function(idx,el) {
            var fileList = $(`<tr class="fileList" url='${el.file_url}' filename='${el.filename}'>`);
            fileList.append(`<td class="filename"><b>${el.filename}</b>&nbsp&nbsp&nbsp</td>`);
            if(el.fileSize > 1000000) { 
                var convertedSize = Math.round(el.fileSize/1000000);
                fileList.append(`<td class="fileSize">${convertedSize} MB</td>`);
            }
            else {
                var convertedSize = el.fileSize/1000;
                fileList.append(`<td class="fileSize">${convertedSize} KB</td>`);
            }
            fileList.append(`</tr>`);
            page.find("#dropZone #fileDragDesc").append(fileList);
    
            fileList.on("click", function(e){
                var oE = $(e.target);
                // if(oE.isON("td.filename")) { 
                //     var oTR = oE.exactObj("tr[url]"); 
                //     var url = oTR.attr("url");
                //     var filename = oTR.attr("filename");
                //     function fnDownload(url,filename) {
                //         var frm = $("<form action='/awegtx.jsp?pgm=aweportal.fileDownloader' target='_blank' " +
                //                     " method='POST' style='display:none'></form>");
                //         var args = {url:url, filename:filename};
                //         var sArgs = JSON.stringify(args);
                //         console.log(sArgs);
                //         frm.append("<input type='text' name='INVAR' value='"+sArgs+"'>");
                //         frm.appendTo("#"+pageid); 
                //         console.log(frm);
                //         frm.submit();
                //     }
                //     fnDownload(url,filename);
                // } else {
                    var oTR = oE.exactObj("tr[url]"); 
                    var url = oTR.attr("url");
                    var filename = oTR.attr("filename");
                    gfnDownloadDirect(url, filename);
                    console.log(url);
                    console.log(filename);
                //}
            }); 
        });
    },
    // 게시글에 달린 댓글 조회 메소드
    me.fnDrawCommList= function(docid) {
        var userid = gUserinfo.userid;
        page.find(".CommListDiv").html("");
        $.each(me.dataSet["CommList"],function(idx,el) {
            var html = $(`<div id="updateCommDiv${el.commid}" style="display : none; margin-bottom : 20px;">`);
            html.append(`<textarea class="updateArea${el.commid}" placeholder="수정할 내용을 입력하세요"></textarea>`);
            html.append(`<br>`);
            html.append(`<button type='button' class='updateCommBtn' >댓글 수정</button>`);
            html.append(`<button type='button' class='returnBtn' >취소</button>`);
            html.append(`</div>`);
            
            var newComm = $(`<div id="${el.commid}" class="bbsComm" docid='${el.docid}'>`);
            newComm.append(`<i class="fas fa-user-circle"></i><span class="commReg_nm">&nbsp;<b>${el.reg_nm}</b></span>`);
            newComm.append(`<span class="commDt">${el.dt}</span><br>`);
            newComm.append(`<div class="comments">${el.comments}</div>`);
            newComm.append(html);
            newComm.append(`<button class="commUpdate">수정</button>`);
            newComm.append(`<button class="commDelete">삭제</button>`);
            newComm.append(`</div>`);
            page.find(".CommListDiv").append(newComm);
    
            // 댓글은 관리자와 작성자만 수정, 삭제 권한 부여
            if(userid != "admin" && userid != el.reg_usid) {
                page.find("#mnBBS .commUpdate").hide();
                page.find("#mnBBS .commUpdate").prop("disabled", true);
                page.find("#mnBBS .commDelete").hide();
                page.find("#mnBBS .commDelete").prop("disabled", true);
            };
            // 댓글 삭제 버튼 클릭시 이벤트 발생
            newComm.on("click",".commDelete", function(e){
                var oE = $(e.target);
                var oTR = oE.exactObj("div[id]");
                var arg = {commid : oTR.attr("id")};
                invar = JSON.stringify(arg);
                if(oTR.length != 1) return;
                gfnConfirm("삭제 확인","댓글을 삭제 하시겠습니까?", function(confirm){
                    if(confirm) {
                        gfnTx(appid+"."+pgmid, "deleteComm", {INVAR : invar}, function(OUTVAR) {});
                        page.find("#"+oTR.attr("id")).remove();
                    }
                });
            });
            // 댓글 수정 버튼 클릭시 이벤트 발생
            newComm.on("click",".commUpdate", function(e){
                var oE = $(e.target);
                var oTR = oE.exactObj("div[id]");
                var commDivId = oTR.attr("id");
                $("#"+pageid+" .CommListDiv #updateCommDiv" + commDivId).show();
                $("#"+pageid+" .CommListDiv #" + commDivId + " .commUpdate").hide();
                $("#"+pageid+" .CommListDiv #" + commDivId + " .commDelete").hide();
                if(oTR.length != 1) return;
                $("#"+pageid+" .CommListDiv #updateCommDiv" + commDivId + " .updateCommBtn").on("click", function(e) {
                    var comments = $("#"+pageid+" .CommListDiv .updateArea" + commDivId).val();
                    comments = comments.replace(/(?:\r\n|\r|\n)/g, '<br />');
                    if(isNull(comments) || comments == undefined) {
                        gfnAlert("수정 실패", "댓글 내용을 입력해 주세요.");
                        return;
                    }
                    else {
                        me.fnUpdateComm(comments, commDivId);
                        page.find("#"+ commDivId + " .comments").html(comments);
                    }
                    $("#"+pageid+" .CommListDiv #updateCommDiv" + commDivId).hide();
                    $("#"+pageid+" .CommListDiv #" + commDivId + " .commUpdate").show();
                    $("#"+pageid+" .CommListDiv #" + commDivId + " .commDelete").show();
                });
            });
            newComm.on("click", ".returnBtn", function(e) {
                var oE = $(e.target);
                var oTR = oE.exactObj("div[id]");
                var commDivId = oTR.attr("id");
                page.find("#"+commDivId).hide();
                var commAreaId = commDivId.split("updateCommDiv")[1];
                $("#"+pageid+" .CommListDiv #" + commAreaId + " .commUpdate").show();
                $("#"+pageid+" .CommListDiv #" + commAreaId + " .commDelete").show();
                $("#"+pageid+" .CommListDiv #updateArea" + commAreaId).val("");
            });
        });
    },
    // 게시글 수정 메소드
    me.fnUpdateBBS= function(docid, title, content) {
        var content = tinymce.activeEditor.getContent();
        var title = $("#"+pageid + " .boardTitle").val();
        var args = {title:title, content:content, docid:docid};
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid, "updateDoc", {INVAR : invar}, function(OUTVAR){
            if(OUTVAR.rtnCd != "OK") {
                gfnAlert("수정 실패", "수정에 실패하였습니다.");
                return;
            }
        });
        $("#"+pageid+" .boardTitle2").html(title);
    },
    // 게시글 삭제 메소드
    me.fnDeleteBBS=function(docid) {
        var args = {docid:docid};
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid, "deleteDoc", {INVAR : invar}, function(OUTVAR){
            if(OUTVAR.rtnCd == "OK") {
                gfnAlert(" 삭제 완료", "게시글을 삭제하였습니다.");
            } else {
                gfnAlert(" 삭제 실패", "게시글 삭제에 실패하였습니다.");
            }
        });
    }
    // 댓글 작성 메소드
    me.fnInsertComm= function(docid, comments) {
        var userid = gUserinfo.userid;
        var usernm = gUserinfo.usernm;
        var comments = $("#"+pageid+" #myCommArea").val();
        comments = comments.replace(/(?:\r\n|\r|\n)/g, '<br />');
        var ref_info_tp = "T_DOC";
        var arg = {docid : docid, ref_info_tp: ref_info_tp, comments : comments};
        var invar = JSON.stringify(arg);
        var sysdate = new Date();
        var sDate = dateFormat(sysdate);
        if(!isNull(comments)){
            gfnTx(appid+"."+pgmid, "insertComm",{INVAR : invar}, function(OUTVAR){
                var html = $(`<div id="updateCommDiv${OUTVAR.commid}" style="display : none; margin-bottom : 20px;">`);
                html.append(`<textarea class="updateArea${OUTVAR.commid}" placeholder="수정할 내용을 입력하세요" style="width : 90%; height : 60px; margin-bottom : 10px; resize : none;"></textarea>`);
                html.append(`<br>`);
                html.append(`<button type='button' class='updateCommBtn' >댓글 수정</button>`);
                html.append(`<button type='button' class='returnBtn' >취소</button>`);
                html.append(`</div>`);
    
                var newComm = $(`<div id="${OUTVAR.commid}" class="bbsComm" docid='${docid}'>`);
                newComm.append(`<i class="fas fa-user-circle"></i><span class="commReg_nm">&nbsp;<span class="commReg_usid"><b>${usernm}</b></span>`);
                newComm.append(`<span class="commDt">${sDate}</span><br>`);
                newComm.append(`<div class="comments">${comments}</div>`);
                newComm.append(html);
                newComm.append(`<button class="commUpdate">수정</button>`);
                newComm.append(`<button class="commDelete">삭제</button>`);
                newComm.append(`</div>`);
                page.find(".CommListDiv").append(newComm);
                $("#"+pageid+" #myCommArea").val("");
    
                // 댓글 삭제 버튼 클릭시 이벤트 발생
                newComm.on("click",".commDelete", function(e){
                    var oE = $(e.target);
                    var oTR = oE.exactObj("div[id]");
                    var arg = {commid : oTR.attr("id")};
                    invar = JSON.stringify(arg);
                    if(oTR.length != 1) return;
                    gfnConfirm("삭제 확인","댓글을 삭제 하시겠습니까?", function(confirm){
                        if(confirm) {
                            gfnTx(appid+"."+pgmid, "deleteComm", {INVAR : invar}, function(OUTVAR) {});
                            $("#"+oTR.attr("id")).remove();
                        }
                    });
                });
                // 댓글 수정 버튼 클릭시 이벤트 발생
                newComm.on("click",".commUpdate", function(e){
                    var oE = $(e.target);
                    var oTR = oE.exactObj("div[id]");
                    var commDivId = oTR.attr("id");
                    $("#"+pageid+" .CommListDiv #updateCommDiv" + commDivId).show();
                    $("#"+pageid+" .CommListDiv #" + commDivId + " .commUpdate").hide();
                    $("#"+pageid+" .CommListDiv #" + commDivId + " .commDelete").hide();
                    if(oTR.length != 1) return;
                    $("#"+pageid+" .CommListDiv #updateCommDiv" + commDivId + " .updateCommBtn").on("click", function(e) {
                        var comments = $("#"+pageid+" .CommListDiv .updateArea" + commDivId).val();
                        comments = comments.replace(/(?:\r\n|\r|\n)/g, '<br />');
                        if(isNull(comments) || comments == undefined) {
                            gfnAlert("수정 실패", "댓글 내용을 입력해 주세요.");
                            return;
                        }
                        else {
                            me.fnUpdateComm(comments, commDivId);
                            page.find("#"+ commDivId + " .comments").html(comments);
                        }
                        $("#"+pageid+" .CommListDiv #updateCommDiv" + commDivId).hide();   
                        $("#"+pageid+" .CommListDiv #" + commDivId + " .commUpdate").show();
                        $("#"+pageid+" .CommListDiv #" + commDivId + " .commDelete").show();
                    });
                });
                newComm.on("click", ".returnBtn", function(e) {
                    var oE = $(e.target);
                    var oTR = oE.exactObj("div[id]");
                    var commDivId = oTR.attr("id");
                    page.find("#"+commDivId).hide();
                    var commAreaId = commDivId.split("updateCommDiv")[1];
                    $("#"+pageid+" .CommListDiv #" + commAreaId + " .commUpdate").show();
                    $("#"+pageid+" .CommListDiv #" + commAreaId + " .commDelete").show();
                    $("#"+pageid+" .CommListDiv #updateArea" + commAreaId).val("");
                });
            })
        } 
        else {
            gfnAlert("등록 실패", "내용을 입력해 주세요.");
            return;
        }
    },
    // 댓글 수정 메소드
    me.fnUpdateComm= function(comments, commid) {
        var args = {comments:comments, commid:commid};
        var invar = JSON.stringify(args);
        gfnTx("aweportal.manageBBS", "updateComm", {INVAR : invar}, function(OUTVAR){
            if(OUTVAR.rtnCd != "OK") {
                gfnAlert("수정 실패", "수정에 실패하였습니다.");
                return;
            } 
        });
    }
    $("#"+pageid+" .bbsSearchCond").on("change", function() {
        $("#"+pageid+" .searchKeyword").val("");
        if($("#"+pageid+" .bbsSearchCond").val() ==("all")) {
            $("#"+pageid+" .searchKeyword").prop("readonly", true);
            $("#"+pageid+" .searchKeyword").css("background-color", "rgb(226 226 226 / 93%)");
            $("#"+pageid+" .searchKeyword").css("border", "0.5px solid black");
        } else {
            $("#"+pageid+" .searchKeyword").prop("readonly", false);
            $("#"+pageid+" .searchKeyword").css("background-color", "#fff");
        }
    });
    
    $("#mnBBS .toList").click(function() { 
        gMDI.openPage( "manageBBS", "공지사항 관리", function() {
            gMDI.closeTab(me.pageid); 
        }, "aweportal" );
    });
    
    $("#toggleDiv .toRegisterBBS").click(function() { 
        gMDI.openPage( "registerBBS", "공지사항 등록", function() {
            gMDI.closeTab(me.pageid); 
        }, "aweportal" );
    });
    
    /*-- SCRIPT autogen ---------------------------------------------------- */        
    if(typeof(me.fnInit)=='function') me.fnInit();
    });
    
    </script>