<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="format-detection" content="telephone=no" />
    <title>LF Networks ITSM</title>
</head>

<body id="body">

    <header id="frameGNB">
        <div class="gnb">
            <nav class="menu">
                <div class="logo">
                    <img src="servers.png" alt="" onclick="openNav()" width="60">
                    <img class="mainLogo" src="logo.png" alt="" width="180">
                </div>

                <div class="menu-right">
                    <button class="toggle"><i class="fas fa-toggle-off"></i></button>
                    <button class="alarm" onclick="gMDI.openPage('manageAlert', '알림 목록');">
                        <i class="far fa-comment"></i>
                        <span></span>
                    </button>
                    <button class="user" onclick="menuToggle();"><i class="fas fa-user-circle"></i></button>
                </div>
            </nav>
        </div>

        <div class="userInfo hidden">
            <ul class="userInfo-item">
                <div class="p-2">
                    <div class="media">
                        <div class="media-body">
                            <!-- 아이디 -->
                            <p id="userid" class="d-block fs-8 link-secondary">ID</p>
                            <span class="d-flex align-items-center">
                                <!-- 직책 -->
                                <span id="usernicknm" class="initial-wrap">AJ</span>
                                <!-- 이름 -->
                                <span id="usernm">usernm</span>
                                <span>님 환영합니다.</span>
                            </span>
                        </div>
                    </div>
                </div>
                <li class="profile"><i class="fas fa-user-edit"></i> 프로필 관리</li>
                <li class="changePwd"><i class="fas fa-pencil-alt"></i>비밀번호변경</li>
                <li class="logout"><i class="fas fa-sign-out-alt"></i>로그아웃</li>
            </ul>
        </div>
    </header>

    <div id="frameset">

        <!---사이드 네비바----->
        <div id="mySidenav">
            <button class="closebtn" id="closebtn" onclick="closeNav()">&times;</button>
            <div class="logoside">
                <!----로고 애니메이션----->
                <a class="link" onclick="location.reload()">
                    <img src="gear.png" alt="logo" width="200" height="200">
                    <img src="letter.png" alt="logo" width="200" height="200">
                    <img src="lfn.png" alt="logo" width="200" height="200">
                </a>
            </div>

            <!------앱버튼------->
            <nav id="frameApp" style="position:absolute; width: auto; ">
                <div class="appMenu">
                    <ul class="APP" style="width:300px"></ul>
                    <!--하위메뉴 사용자랑 포털들-->
                    <div class="PGM" style="display: none;"></div>
                </div>
            </nav>
        </div>

        <!----탭밑에 컨텐츠 화면들----->
        <main id="frameMain">
            <div id="frameTab"></div>
        </main>

    </div>

    <!-- status -->
    <div id="status">
        <ul></ul>
    </div>

    <!-- progress -->
    <div id="progress" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Progress 창입니다.</h5>
                </div>
                <div class="modal-body">
                    <p>Progress 내용입니다.</p>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- popup -->
    <div id="popup" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">popup 창입니다.</h5>
                <button class="layerBtn btn-close" data-bs-dismiss="modal" aria-label="Close"
                    onclick="gfnCloseLayer('popup')"></button>
            </div>
            <div class="modal-body">
                <p>popup 내용입니다.</p>
            </div>
        </div>
    </div>

</body>

<script>
    //mainLogo 로고 클릭시 리로드
    $(".mainLogo").on("click", function () {
        location.reload();
    });

    function menuToggle() {
        const toggleMenu = document.querySelector(".menu");
        toggleMenu.classList.toggle("active");
    }

    /*사이드 메뉴 열기*/

    function openNav() {

        document.getElementById("mySidenav").style.width = "300px";
        document.getElementById("closebtn").style.color = "white";


        /*모바일 767px일 경우 */

        if (window.outerWidth < 767) {
            document.querySelector("#mySidenav").style.zIndex = 15;
            document.getElementById("frameMain").style.marginLeft = "0";
            document.querySelector(".gnb").style.marginLeft = "0";
            document.getElementById("frameMain").style.opacity = "0.3";
            document.querySelector("nav").style.opacity = "0.3";
        }

        /*데스크탑일 경우*/

        else {
            document.getElementById("frameMain").style.marginLeft = "300px";
            document.querySelector(".gnb").style.marginLeft = "300px";
        }
    }

    /*사이드 메뉴 닫기*/

    function closeNav() {

        document.getElementById("mySidenav").style.width = "0";
        document.getElementById("frameMain").style.marginLeft = "0";
        document.querySelector(".gnb").style.marginLeft = "0";

        document.getElementById("frameMain").style.opacity = "1";
        document.querySelector("nav").style.opacity = "1";
        document.getElementById("closebtn").style.color = "transparent";


        $(".PGM").slideUp();
        $(".app").removeClass("selected");

    }

    function newPagenav() {

        document.getElementById("mySidenav").style.width = "0";
        document.getElementById("frameMain").style.marginLeft = "0";
        document.querySelector(".gnb").style.marginLeft = "0";

        document.getElementById("frameMain").style.opacity = "1";
        document.querySelector("nav").style.opacity = "1";
        document.getElementById("closebtn").style.color = "transparent";

        if ($(".toggle > i").hasClass("fa-toggle-on")) {
            $(".framepage.active").css("height", "calc(100vh - 80px)")
        }
    }

</script>

<script>
    var wH, wW, bH, bW, fH, fW, mH, mW, rem; //화면상태 추적
</script>

<script>
    /*-- SCRIPT autogen start ---------------------------------------------- */
    $(function () {
        var appid = "aweportal";
        var pgmid = "frameset";
        var page = $("*[pgmid='" + pgmid + "'].framepage").last();
        var pageid = page.attr("id");
        var me = {}
        var dataSet = {};
        var dataDef = {};
        var pageObj = {};
        var bEdit = false;
        me.fnInit = function () {
            gfn[pageid] = me;
            me.appid = appid;
            me.pgmid = pgmid;
            me.pageid = pageid;
            me.page = page;
            me.dataSet = dataSet;
            me.dataDef = dataDef;
            me.pageObj = pageObj;
            me.bEdit = bEdit;
            me.dataDef["_pgm"] = { "ver": 2.6, "upd_dt": "2022-10-27 09:04:25", "remark": "", "pgmid": "frameset", "proc_mst_id": "", "pgm_stat": "Y", "sort_seq": 92, "app_pgmid": "aweportal", "shortcut": "", "reg_dt": "2022-10-12 17:14:15", "reg_usid": "kihyunlee", "pgm_nm": "포털프레임셋", "upd_usid": "kihyunlee", "pgm_tp": "TX", "pgm_grp_nm": "공통", "proc_mst_nm": "", "app_pgm_nm": "FO Portal", "": "트랜젝션(화면)", "crud": "" };
            me.dataDef["_pgm_func"] = [];
            me.dataDef["_pgm_data"] = {};

            me.pageObj["_page"] = new gfnFramepage(me);
            for (var component_id in me.dataDef["_pgm_data"]) {
                me.pageObj[component_id] = new gfnComponent(me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me);
            }
            setTimeout(function () {
                $("#frameset").scrollTo(0); //스크롤 
            }, 10);
            if (typeof (me.fnInitExtra) == 'function') me.fnInitExtra();
        }
        /*-- SCRIPT autogen end ---------------------------------------------- */
        /* 사용자초기화 */
        me.fnInitExtra = function () {
            if (isNull(gUserinfo.usersession)) location.reload();
            pageid = "frameset";
            page = $("#body"); //frameset의 page는 "#body"임에 주의한다!

            gFrameset = me; //frameset에 Access할때 gFrameset사용 
            me.appid = appid;
            me.pgmid = pgmid;
            me.pageid = pageid;
            me.page = page;
            me.dataSet = dataSet;

            try {
                //최초 로드시 스크롤탑 처리
                window.addEventListener('load', function () {
                    setTimeout(scrollTo, 0, 0, 1);
                }, false);

                //화면이 바뀔때 사이즈정보 표시
                $(window).on("resize rotate orientationchange", me.fnFramesetLayout);

            } catch (e) {
                console.error(`${pgmid} window.load : ${e}`);
            }

            me.fnRetrieveInit();
        }

        //frameset 데이터로드 : 세션사용자정보를 사용하므로 args없음 
        me.fnRetrieveInit = function () {
            gfnTx("aweportal.frameset", "retrieveInit", {}, function (OUTVAR) {
                if (OUTVAR.rtnCd == "OK") {
                    gds.comcd = OUTVAR.comcd;   //공통코드
                    gUserinfo.defval = OUTVAR.defval;  //사용자기본값
                    gUserinfo.usergrp = OUTVAR.usergrp; //사용자그룹
                    gds.menu = OUTVAR.menu;    //권한화면목록
                    gds.notice = OUTVAR.notice;  //사용자알림

                    encdeckey = "lfnetworks";   //메세지 암호화 복호화 키

                    $("#usernicknm").text(gUserinfo.usernicknm.substr(0, 2));
                    $("#usernm").text(gUserinfo.usernm);
                    if (!gUserinfo.usergrp.some(e => e.role_tp == "ADM")) $("#usergrp").css("display", "none");
                    $("#userid").text(gUserinfo.userid);

                    me.fnInitMDI();
                    me.fnShowFrameApp();
                    me.fnEHFrameGNB();
                    me.fnEHFrameApp();
                    me.fnEHFrameTabToggle();
                    me.fnEHFrameUser();
                    me.fnEHFrameSet();
                    me.fnEHMessageReceive();
                    me.fnFramesetLayout();

                    //비번변경해야할 경우
                    gfnTx("aweportal.frameset", "checkChangePwd", {}, function (OUTVAR) {
                        //console.log(OUTVAR);
                        if (OUTVAR.rtnCd == "OK") {
                            var pwd_yn = OUTVAR.list[0].temp_yn;
                            if (pwd_yn == "Y") {
                                gfnAlert("비밀번호 변경 요청", "비밀번호가 초기화 또는 변경요청되었습니다. 비밀번호를 변경한 후 [저장]하시면 다시 접속됩니다!");
                                gMDI = new gfnMDI($("#frameMain"), $("#frameTab")); //gMDI초기화 
                                var pgmid = "changePwd";
                                var pgmnm = "비밀번호 변경";
                                var changePwd = $("<div></div>");
                                gMDI.openPageOne(pgmid, pgmnm);

                            }
                        }
                    });
                }
            });
        }

        //frameSet 화면크기 //KES MOBILE버전 바꿈
        me.fnFramesetLayout = function () {
            //프레임셋 화면크기 추적
            wH = toNum($(window).outerHeight(), 0);
            wW = toNum($(window).outerWidth(), 0);

            //mobile모드가 아니면 frameBottom을 frameGNB로 도킹시킨다  
            var frameBottom = $("#frameBottom");
            var bottomH = 0;

            if (wW < 768) {
                $("body").addClass("mobile");
                me.fnShowFrameLeftBar(false);
                $("#frameRight").after(frameBottom);
                frameBottom.removeClass("dock");
                frameBottom.addClass("bottom");
                bottomH = frameBottom.outerHeight();
            } else {
                $("body").removeClass("mobile");
                $("#frameGNB .CI").after(frameBottom); //docking
                frameBottom.removeClass("bottom");
                frameBottom.addClass("dock");
            }

            $("#frameset").css("margin-bottom", bottomH + "px");

            bH = toNum($("body").outerHeight(), 0);
            bW = toNum($("body").outerWidth(), 0);
            fH = toNum($("#frameset").outerHeight(), 0);
            fW = toNum($("#frameset").outerWidth(), 0);
            mH = toNum($("#frameMain").outerHeight(), 0);
            mW = toNum($("#frameMain").outerWidth(), 0);

            var oRem = $("#ruler");
            $("body").append(oRem);
            rem = toNum(oRem.outerHeight(), 0);
            oRem.text(mW + "," + mH + " / " + fW + "," + fH + " / " + bW + "," + bH + " / " + wW + "," + wH + " (" + rem + "px/rem)");


            /* JQUERYUI HACK : window변경시 다이얼로그 닫기 */
            if (!$("body").hasClass("mobile")) {
                $("[role='dialog']").each(function (idx, el) {
                    var dialogId = $(el).attr("aria-describedby");
                    $("#" + dialogId).dialog("close");
                });

                $(".gButtonsetpanel").hide();
            }
        }

        //gMDI
        me.fnInitMDI = function () {
            gMDI = new gfnMDI($("#frameMain"), $("#frameTab")); //gMDI초기화 
            gMDI.loadHome(); //frameMain에 frameHome 로드
        }

        /*kes 여기부터*/
        me.fnShowFrameApp = function () {
            var showMenu = function (app_pgm_nm) {

                //$.each(subset(gds.menu, "app_pgm_nm", app_pgm_nm), function(idx, row) {
                var pgms = subset(gds.menu, "app_pgm_nm", app_pgm_nm);
                sort(pgms, "sort_seq");
                $.each(pgms, function (idx, row) {
                    //idx 시작 값 0 이벤트 - 기존 APP 메뉴 대분류 제거, 새로운 APP 메뉴 대분류 생성
                    if (idx == 0) {
                        page.find("#frameApp .appMenu .PGM .app").remove();
                        var app = $("<div><h3></h3></div>");
                        app.addClass("app");
                        app.attr("app", app_pgm_nm);
                        page.find("#frameApp .appMenu .PGM").append(app);
                    }

                    // Apps 메뉴 구조      

                    // Apps 메뉴 버튼들
                    // hasClass() boolean - 이미 생성된 중분류가 있는지 확인 후 대분류에 append()
                    if (page.find("#frameApp .appMenu .PGM .app div").hasClass(row.pgm_grp_nm) == false) {
                        var grp = $("<div></div>");

                        grp.addClass(row.pgm_grp_nm);
                        grp.append("<div class='pgmgrp'>" + row.pgm_grp_nm + "</div>") //부제목 하위메뉴
                        grp.append("<ul class='box'></ul>") //하위메뉴의 하위메뉴
                        page.find("#frameApp .appMenu .PGM .app").append(grp);
                    }

                    //Apps 메뉴 버튼들
                    //subset()으로 분류된 요소를 each() 반복 - row를 통해 program 정보를 해당 중분류에 append()
                    var pgm = $("<li></li>");
                    pgm.addClass("pgm");
                    pgm.text(row.pgm_nm);
                    pgm.attr("pgmid", row.pgmid);
                    pgm.attr("pgmgrp", row.pgm_grp_nm);
                    if (row.fav_yn == "Y") pgm.addClass("fav");
                    page.find("#frameApp .appMenu .PGM div[class='" + row.pgm_grp_nm + "'] .box").append(pgm);
                });
            }

            //menu에 app 추가
            var applistDistinct = extract(gds.menu, ["app_pgm_nm", "app_seq"], "distinct");
            applistDistinct = applistDistinct.filter(el => !isNull(el.app_pgm_nm));
            sort(applistDistinct, "app_seq");
            var applist = [];
            for (var x = 0; x < applistDistinct.length; x++) {
                applist.push(applistDistinct[x].app_pgm_nm);
            }
            $.each(applist, function (idx, row) {
                if (idx == 0) page.find("#frameApp .appMenu .APP .app").remove();

                //extract()로 중복 제거한 applist를 each()로 반복 - row값 idx 0인 경우만 showMenu로 전달
                var app = $("<div app='" + row + "'></div>");
                app.addClass("app")
                app.text(row);
                page.find("#frameApp .appMenu .APP").append(app);
            });

            //event-handler(frameGNB) : frameApp menu click event 상위메뉴 클릭하면 하위메뉴 뜨게 하는것
            var content = $(".PGM").parent().attr("app")

            page.find("#frameApp .appMenu .APP .app").on("click", function (e) {
                //Apps 을 클릭하면 하단에 pgm리스트를 표시한다.
                showMenu($(e.target).text());
                $(this).append($(".PGM"))

                if ($(".PGM").parent().attr("app") !== content) {
                    $(".PGM").slideDown();
                    $(this).toggleClass('selected')
                    $(this).siblings().removeClass('selected');
                    content = $(".PGM").parent().attr("app")
                }
                else {
                    $(".PGM").slideToggle();
                    $(this).toggleClass('selected')
                }
            });

            page.find("#frameApp .appMenu .PGM").on("click", ".pgm", function (e) {
                //pgm을 클릭하면 해당 화면을 열어준다.
                var menu = $(e.target);
                var pgmid = menu.attr("pgmid");
                var pgmnm = menu.text();
                gMDI.openPage(pgmid, pgmnm);
                page.find("#frameHome").css("display", "block") //메뉴선택시 패널 숨김
                $("#frameTab").show()
                $(".toggle > i").addClass("fa-toggle-off")
                $(".toggle > i").removeClass("fa-toggle-on")
                newPagenav(); 
            });
        }

        me.fnShowFrameLeftBar = function (bShow) {
            if (bShow == undefined) {
                if (page.find("#frameLeft").hasClass("leftMini")) bShow = true;
                else bShow = false;
            }
            if (bShow) {
                if ($("#frameBottom nav .screen").hasClass("max")) $("#frameGNB").css("display", "block");
                $("#frameMain .btnShow").removeClass("closed");
            } else {
                if ($("#frameBottom nav .screen").hasClass("max")) $("#frameGNB").css("display", "none");
                $("#frameMain .btnShow").addClass("closed");
            }
        }
        
        /*kes여기까지*/

        me.fnEHFrameGNB = function () {

            $("#frameGNB .gnb nav .notice").on({
                click: function () {
                    $("#frameGNB .gnb nav .notice").attr("style", "background-color:unset");
                    $("#frameGNB .gnb nav .notice i").css("color", "white");
                    $("#frameAlert").toggleClass("hidden");
                }
            })
            $(page).on({
                click: function (e) {
                    if (!$("#frameGNB .gnb nav .notice").has(e.target).length && !$("#frameAlert").has(e.target).length) {
                        $("#frameAlert").addClass("hidden");
                    }
                }
            });
        }

        me.fnEHFrameApp = function () {
            //메뉴표시 바깥 클릭시 메뉴 숨기기 
            document.querySelector("#frameMain").addEventListener('click', closeNav);
        }

        me.fnEHFrameTabToggle = function () {
            $("#frameGNB .gnb .toggle").on({
                click: function () {                    
                    $(".toggle > i").toggleClass("fa-toggle-off")
                    $(".toggle > i").toggleClass("fa-toggle-on")
                    if ($(".toggle > i").hasClass("fa-toggle-on")) {
                        $(".framepage.active").css("height", "calc(100vh - 80px)")
                    } 
                    else {
                        $(".framepage.active").css("height", "calc(100vh - 125px)")
                    }
                    $("#frameTab").toggle();
                }
            })
        }

        me.fnEHFrameUser = function () {
            $("#frameGNB .gnb nav .user").on({
                click: function (e) {
                    $(".userInfo").toggleClass("hidden");
                }
            })
            $(".userInfo").on({
                click: function (e) {
                    var oE = $(e.target);

                    if (oE.isON(".profile")) gMDI.openPage("manageProfile", "프로필 관리");
                    else if (oE.isON(".changePwd")) gMDI.openPage("changePwd", "비밀번호 변경");
                    else if (oE.isON(".withdrawlUser")) gMDI.openPage("withdrawlUser", "회원탈퇴");
                    else if (oE.isON(".logout")) gfnLogout();
                }
            });
            $(page).on({
                click: function (e) {
                    if (!$("#frameGNB .gnb nav .user").has(e.target).length && !$("#frameGNB .list").has(e.target).length) {
                        $(".userInfo").addClass("hidden");
                    }
                }
            });
        }

        me.fnEHMessageReceive = function () {
            setInterval(function () {
                var args = { usid: gUserinfo.userid };
                var invar = JSON.stringify(args);
                gfnTx(appid + "." + pgmid, "checkMsg", { INVAR: invar }, function (OUTVAR) {
                    if (OUTVAR.num[0]["num"] > 0) {
                        $(".alarm>i").removeClass("far fa-comment")

                        $(".alarm>i").addClass("fas fa-comment-dots")

                        $(".alarm>span").show()
                        $(".alarm>span").text(OUTVAR.num[0]["num"])

                    }
                    else {
                        $(".alarm>i").removeClass("fas fa-comment-dots")
                        $(".alarm>i").addClass("far fa-comment")

                        $(".alarm>span").hide()
                    }
                }, true)
            }, 5000);
        }

        me.fnEHFrameSet = function () {
            $("#frameset").on({
                scroll: function () {
                    if ($("body").hasClass("mobile") == false) {
                        var scrollTop = $("#frameset").scrollTop();
                        var frameLeft = $("#frameLeft");
                        if (scrollTop < 2 * rem) { //스크롤이 충분히(2rem) 올라왔으면 마진 0
                            frameLeft.css("margin-top", 0);
                        } else {
                            var Lmt = nzl(toNum(frameLeft.css("margin-top").replaceAll("px", "")), 0);
                            var LH = frameLeft.outerHeight();
                            var MH = $("#frameMain").outerHeight();
                            if (Lmt + LH < MH && scrollTop + LH < MH) { //frameMain이 더 크다고 가정할때 왼쪽이 더 작으면
                                frameLeft.css("margin-top", scrollTop + "px"); //스크롤Top만큼 마진을 넣어줌
                            }
                        }
                    }
                    //화면크기 추적
                    me.fnFramesetLayout();
                }
            })
        }

        /*-- SCRIPT autogen ---------------------------------------------------- */
        if (typeof (me.fnInit) == 'function') me.fnInit();
    });

</script>