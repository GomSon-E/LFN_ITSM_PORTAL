<style>
    ul{
        list-style: none;
    }
</style>
<div class="pageTop">
    <h2 style="text-align: center;">매장 경영인 프로필</h2>
    <!-- <button class="fnSearch">조회</button>
    <button class="fnAddrow">줄추가</button> -->    
    <button class="fnSave">저장</button>
    <button class="fntest">프로필정보테스트페이지이동</button>
    <button class="fnmanageShop">매장정보테스트페이지이동</button>
</div>
<div class="pageContent"> 
    <h2 style="text-align: center;">매장 경영인 정보</h2>
    <ul id="list">
        <li>이름 : <input type="text" name="nm"></li>
        <br>
        <li>전화번호 : <input type="text" name="career"></li>
        <br>
        <li>경력사항 : <input type="text" name="photo"></li>
        <br>
        <li>EMAIL : <input type="text" name="email"></li>
        <br>
        <li>기타사항 : <input type="text" name="etc"></li>
    </ul>
</div>
<script>
// autogen start /////////////////////////////////////////////////////////////////////////    
$(function() {
    var appid = "aweportal";   //수정할 것!
    var pgmid = "manageManager";  //수정할 것!
    var page = $("*[pgmid='"+pgmid+"'].framepage").last(); /* html로 호출되기 때문에 현재 pageid는 스스로 알아내야함 */
    var pageid = page.attr("id");  
    var me = {
        //화면초기화
        fnInit : function() { 
            console.log("page initialized..");
            gfn[pageid] = me;
            me.appid    = appid;
            me.pgmid    = pgmid;
            me.pageid   = pageid;
            me.page     = page;  //자기자신을 참조할때 me.page (JQUERY Object)를 사용한다.

            me.fnselectprofile();

            me.page.on("click","button",function(e){
                console.dir(e);
                var oE = $(e.target);
                // if(oE.hasClass("fnSearch")) me.fnSearch(); 
                // if(oE.hasClass("fnAddrow")) me.fnAddrow(); 
                if(oE.hasClass("fnSave")) me.fnSave();
                if(oE.hasClass("fntest")) me.fntest();
                if(oE.hasClass("fnmanageShop")) me.fnmanageShop();
            });

        },
        fnselectprofile: function() {
			//frameset 데이터로드 : 세션사용자정보를 사용하므로 args없음
            var args = {};
            var invar = JSON.stringify(args);
			gfnTx("aweportal.manageProfile","selectprofile",{INVAR : invar}, function(OUTVAR){ 
				logger(pgmid,"Init",OUTVAR);
				if(OUTVAR.rtnCd=="OK") {
					var dataList = OUTVAR.list; //조회된 용어목록데이터
                    var oTbl = me.page.find("#list li input"); //조회된 데이터를 뿌려줄 테이블
                    oTbl.children("*").remove(); //값을 바인팅 하기전에 테이블을 Clear
                    for(var i=0; i<dataList.length; i++) { //조회된 용어목록데이터를 한건씩 루프돌리면서
                        var dataRow = dataList[i];  //dataRow = {col:"val",col2:"val2"}
                        for(var colid in dataRow) { //컬럼별로 루프돌리면서 컬럼값을 세팅 
                            $(`input[name="${colid}"]`).val(dataRow[colid]);
                        }
                    } 
				}else {    
                    gfnAlert("조회오류",OUTVAR.rtnMsg);
                }
			});
		},
        fntest: function() {
			//frameset 데이터로드 : 세션사용자정보를 사용하므로 args없음
            page.on("click",".fntest",function(e){
                gMDI.openPage("manageProfileTest","프로필관리테스트",function(OUOTVAR){

                },"aweportal");
            })
		},
        fnmanageShop: function() {
			//frameset 데이터로드 : 세션사용자정보를 사용하므로 args없음
            page.on("click",".fnmanageShop",function(e){
                gMDI.openPage("manageShop","매장정보관리테스트",function(OUOTVAR){

                },"aweportal");
            })
		},
        //조회
        // fnSearch : function() {  
        //     var nm = me.page.find("input[name='nm']").val(); //조회조건에서 값 가져오기
        //     var args = {nm:nm}
        //     var invar = JSON.stringify(args);
        //     console.dir(invar);
        //     gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
        //         console.dir(OUTVAR);
        //         if(OUTVAR.rtnCd=="OK") {
        //             var dataList = OUTVAR.list; //조회된 용어목록데이터
        //             var oTbl = me.page.find("#list"); //조회된 데이터를 뿌려줄 테이블
        //             oTbl.children("*").remove(); //값을 바인팅 하기전에 테이블을 Clear
        //             for(var i=0; i<dataList.length; i++) { //조회된 용어목록데이터를 한건씩 루프돌리면서
        //                 var dataRow = dataList[i];  //dataRow = {col:"val",col2:"val2"}
        //                 var oRow = me.fnAddrow("retrieved"); //row그림추가 
        //                 for(var colid in dataRow) { //컬럼별로 루프돌리면서 컬럼값을 세팅 
        //                     oRow.find(`[name="${colid}"]`).val(dataRow[colid]); 
        //                 }
        //             } 
        //         } else {    
        //             gfnAlert("조회오류",OUTVAR.rtnMsg);
        //         }
        //     }
            
        //     )},
        // 줄추가
        // fnAddrow: function(stat) {
        //     var collist = ["nm","nick_nm","photo","email"];
        //     var oTbl = me.page.find("#list");
        //     var oRow = $(`<li></li>`);
        //     stat = (stat==undefined)?"new":stat;
        //     for(var i=0; i<collist.length; i++) {
        //         var colid = collist[i];
        //         var oCol = $(`<input type="text" name="${colid}" value="" placeholer="${stat}">`);
        //         var oCol2 = $(`<br>`);
        //         oCol.on("change",function(e){
        //             var el = $(e.target);
        //             var label = el.prev("label");
        //             label.text( label.text()+"*" );
        //         });
        //         oRow.append(oCol,oCol2);
        //         oCol.before( $(`<label>${colid}</label>`) );                
        //     }
            
        //     oTbl.append(oRow); 
        //     return oRow;
        // },
        //저장
        fnSave : function() { 
            //입력된 값 가져오기..
            var list = [];
            var oRows = me.page.find("#list li");
        
            var row = {};
            $(oRows).find("input").each(function(colidx,oCol){
                var colid = $(oCol).attr("name");
                var val = $(oCol).val();
                row[colid] = val;
            });
            list.push(row);
            console.dir(list);
            var args = {list:list}
            var invar = JSON.stringify(args);
            gfnTx("aweportal.manageProfile","save",{INVAR:invar},function(OUTVAR){
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("저장성공","저장되었습니다.");
                    me.fnselectprofile();
                } else {
                    gfnAlert("저장실패",OUTVAR.rtnMsg);
                }
            });
        }
    }  
    
    //화면이 열릴때 화면초기화를 호출한다.
    if(typeof(me.fnInit)=='function') me.fnInit();
}); 
</script>