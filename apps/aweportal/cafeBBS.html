<style>[pgmid='cafeBBS'].framepage .userClass { 
width:100%; 
}
button {
    margin-right : 10px;
}
.flexColunm > * {
    flex: 0 0 auto;
}
.flexColunm > *:last-child {
    flex: 1 1 auto;
    height: unset !important;
}
.pageContent .boardTitle {
    width: 75%;
    margin-bottom : 20px; 
    margin-top : 20px;
}
#grpList {
    height: 22px;
    position: relative;
    margin-right: 10px;
    margin-top: 20px;
    margin-bottom: 20px;
}
.btn-wrapper{
    margin-bottom: 20px;
}
.btn-wrapper button {
    display:inline-block;
    color:white;
    font-weight: bold;
    cursor:pointer;
    background-color:#3e3e3a;
    border: none;
    border-radius:0.25rem;
    padding:.125rem 0.5rem; 
    height:1.75rem;
    vertical-align:bottom;
    font-size:0.75rem;    
    white-space: nowrap;
    text-overflow: ellipsis;
}
.btn-wrapper .submit {
    float: right;
}
.btn-wrapper button:hover, .btn-wrapper button:focus {
    color:#000;
    font-weight: bold;
    cursor:pointer;
    background-color:#eaeaea;
    border: none;
}</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond">
    <div class="cafename">
    </div>
</div>
<div class="pageContent flexColumn">
    <form enctype="multipart/form-data" method="post" id="contentForm">
        <input type="text" class="boardTitle" placeholder="제목">
        <textarea id="mytextarea" class="boardContent" name="mytextarea" placeholder="내용을 입력하세요"></textarea>
        <br>
    </form>
    <div class="btn-wrapper">
        <button class="uploadBtn"><i class="fas fa-paperclip"></i> 파일업로드</button>
        <button type="button" class="toCafeHome">카페홈으로</button>
        <button type="button" class="submit" >작성하기</button>
    </div>
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "aweportal";
    var pgmid = "cafeBBS"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"pgmid":"cafeBBS","pgm_nm":"카페 게시판 등록","pgm_tp":"UX","proc_mst_id":"","proc_mst_nm":"","remark":"","ver":0.2,"pgm_stat":"Y","reg_usid":"admin","reg_dt":"2021-11-03 12:07:52","upd_usid":"admin","upd_dt":"2021-11-03 12:07:52","app_pgmid":"aweportal","pgm_grp_nm":"카페","sort_seq":11,"shortcut":"","crud":"","app_pgm_nm":"포털"};
me.dataDef["_pgm_func"]=[];
me.dataDef["_pgm_data"] = {};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */
// 업로드 날짜를 폴더명으로 설정
var dateDir = date("today", "yyyymmdd_hh24miss");
// 처음 게시글 작성시 UUID를 미리 채번
var UUID = "";
gfnGetUUID(20, function(OUTVAR) {
    UUID = OUTVAR;
});
var file_tp = "BBS_ATTCH";
var ref_file_tp = "T_DOC";

var grp_id = gParam["cafe_grpid"];
var grp_nm = gParam["cafe_grpnm"];

$("#"+pageid+" #mytextarea").attr("id",pageid+"mytextarea");
var plugins = [
    "advlist", "autolink", "lists", "link", "image", "charmap", "print", "preview", "anchor",
    "searchreplace", "visualblocks", "code", "fullscreen", "insertdatetime", "media", "table",
    "paste", "code", "help", "wordcount", "save"
];
var edit_toolbar = 'formatselect fontselect fontsizeselect |'
            + ' forecolor backcolor |'
            + ' bold italic underline strikethrough |'
            + ' alignjustify alignleft aligncenter alignright |'
            + ' bullist numlist |'
            + ' table tabledelete |'
            + ' link image';
var selector = '#'+pageid+'mytextarea';
tinymce.init({
    selector: selector,
    branding: false,
    forced_root_block: false,
    language: "ko_KR",
    plugins: plugins,
    toolbar: edit_toolbar,
    height: 550,
    statusbar: false,
    resize: false,
    paste_data_images: true
});


/* 사용자초기화 */
me.fnInitExtra=function() {
   //해당cafe grp_nm title에 써주기
    var oList = me.page.find('.cafename').html("");
    var cafe_nm = $(`<h3>${grp_nm}</h3>`);
    oList.append(cafe_nm);
}
/* 이벤트핸들러 */
me.fnEH=function(component, evt, row, col, val) { 
    //console.log(evt+","+row+","+col+","+val);
    //화면기능버튼이 눌리면 
    if (component==me.pageObj["_pageFunc"]){ 
        if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
    }
    //사용자 컴포넌트/컨트롤
    else if(component.userComponent=="myCompoId") {
        //if(evt=="dblclick" && col=="colid") {...}
    }
}


$(".submit").click(function(e){
    var docid = UUID;
    var title = $(".active .boardTitle").val();
    var content = tinymce.activeEditor.getContent();
    var userid = gUserinfo.userid;
    // var grp_nm = $("#grpList option:selected").val();
    var args = {"docid" : docid, "title":title, "content":content, "doc_template_id":grp_nm, "userid":userid, "updid":userid};
    var invar = JSON.stringify(args);
    if(!isNull(title) && !isNull(content)){
        gfnTx(appid+"."+pgmid, "insertDoc", {INVAR : invar}, function(OUTVAR){
            if(OUTVAR.rtnCd == "OK") {
                $(".active .boardTitle").val("");
                tinyMCE.activeEditor.setContent("");
                gfnAlert("등록 성공", "게시글이 등록되었습니다.");
                $(".active .closetab").click();
                $("a.tab[grpid='"+grp_id+"'] .closetab").click();
                $("li[grpid='"+grp_id+"']").trigger("click");
            }
        });
    } else {
        gfnAlert("등록 실패", "제목과 내용을 모두 입력하세요");
    }
});
$(".active .uploadBtn").click(function(e) {
    gfnUpload(UUID, file_tp, ref_file_tp, function(arrFiles) {
        //저장된 파일목록(arrFiles)을 사용하여 첨부파일 목록을 Refresh한다.
    });
});
$(".active .toCafeHome").click(function() {
    $(".active .closetab").click();
    $("li[grpid='"+grp_id+"']").trigger("click");
});


/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>