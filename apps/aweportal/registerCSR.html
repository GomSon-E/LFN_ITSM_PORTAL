<style>[pgmid='registerCSR'].framepage .pageContent .componentContainer:not(.contentClosed) {
    min-height: 20em; 
}

[pgmid='registerCSR'].framepage textarea {
    resize: vertical;
}</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageTop"></div>
<div class="pageGuide"></div>
<div class="pageContent flexColumn">
    <div id='mst'></div>
    <div id='list'></div> 
    <div id='filelist'></div>
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "aweportal";
    var pgmid = "registerCSR"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":0.8,"upd_dt":"2022-06-03 12:22:01","remark":"프로그램에 대한 시스템 보완요청을 등록한다.","pgmid":"registerCSR","proc_mst_id":"","pgm_stat":"Y","sort_seq":67,"app_pgmid":"aweportal","shortcut":"","reg_dt":"2022-06-03 12:22:01","reg_usid":"kihyunlee","pgm_nm":"CSR등록","upd_usid":"kihyunlee","pgm_tp":"TX","pgm_grp_nm":"포털","proc_mst_nm":"","app_pgm_nm":"포털","":"트랜젝션(화면)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-save","reg_dt":"2022-06-03 12:22:01","reg_usid":"","func_nm":"요청저장","upd_usid":"","upd_dt":"2022-06-03 12:22:01","func_tp":"DB_W","remark":"요청내용을 입력한 후 저장하면 시스템 담당자에게 전달됩니다.","pgmid":"registerCSR","sort_seq":"1","funcid":"save","content":"CSR요청내역 저장","crud":"R","id":"0"},{"func_icon":"fas fa-close","reg_dt":"2022-06-03 12:22:01","reg_usid":"","func_nm":"닫기","upd_usid":"","upd_dt":"2022-06-03 12:22:01","func_tp":"EH","remark":null,"pgmid":"registerCSR","sort_seq":"2","funcid":"close","content":"화면닫기","crud":"R","id":"1"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["mst"]={"sort_seq":"1","data_id":"mst","data_nm":"신규요청등록","data_icon":null,"component_pgmid":"aweForm","component_option":{"func":[{"funcid":"upload","func_nm":"파일업로드","func_icon":"fas fa-image"}]},"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":"앱","colid":"appid","colnm":"앱","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":"앱","colid":"app_nm","colnm":"명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"pgmid","colnm":"프로그램ID","dtype":"text","etype":"raw","attr":"pk","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"pgm_nm","colnm":"프로그램명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":"요청자","colid":"userid","colnm":"사용자ID","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":"요청자","colid":"user_nm","colnm":"사용자명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"comment_tp","colnm":"요청유형","dtype":"text","etype":"sel","attr":"keycol ","defval":"CSR","w":"15","h":null,"refcd":"CSR_TP","option":"sel:comment_tp::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"title","colnm":"요청제목","dtype":"text","etype":"txt","attr":"keycol","defval":null,"w":"30","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":null,"colid":"content","colnm":"요청내용","dtype":"text","etype":"tarea","attr":"keycol","defval":null,"w":"45","h":"10","refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"}]};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"2","data_id":"list","data_nm":"요청처리내역","data_icon":null,"component_pgmid":"agGrid","component_option":{"func":[{"funcid":"search","func_nm":"재조회","func_icon":"fas fa-refresh"}]},"inout_tp":"OUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"comment_tp","colnm":"유형","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"title","colnm":"요구사항제목","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"content","colnm":"요구사항내역","dtype":"text","etype":"pre","attr":null,"defval":null,"w":"30","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_usid","colnm":"등록자ID","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_dt","colnm":"등록일시","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"12","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"}]};
me.dataDef["_pgm_data"]["filelist"]={"sort_seq":"3","data_id":"filelist","data_nm":"업로드 파일목록","data_icon":"fas fa-list","component_pgmid":"agGrid","component_option":{"gridOpt":"rn chk","gridOptions":{"statusBar":"false"},"func":[{"funcid":"delRow","func_nm":"선택파일삭제","func_icon":"fas fa-minus"}]},"inout_tp":"INOUT","content":[{"sort_seq":"1","section":null,"section_icon":null,"colgrp":null,"colid":"fileid","colnm":"파일ID","dtype":"text","etype":"raw","attr":"pk","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":"2","section":null,"section_icon":null,"colgrp":null,"colid":"orgn_nm","colnm":"등록파일명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":"3","section":null,"section_icon":null,"colgrp":null,"colid":"file_ext","colnm":"확장자","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":"4","section":null,"section_icon":null,"colgrp":null,"colid":"file_url","colnm":"파일주소","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":"5","section":null,"section_icon":null,"colgrp":null,"colid":"file_dir","colnm":"파일경로","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":"6","section":null,"section_icon":null,"colgrp":null,"colid":"file_sz","colnm":"파일크기","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":"7","section":null,"section_icon":null,"colgrp":null,"colid":"sort_seq","colnm":"정렬순서","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":"8","section":null,"section_icon":null,"colgrp":null,"colid":"download","colnm":"다운로드","dtype":"text","etype":"btn","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */
var gPgmid = gParam["pgmid"];
var file_tp = "REQ_ATTCH";
var ref_file_tp = pgmid;
var UUID = "";
gfnGetUUID(20, function(OUTVAR) {
    UUID = OUTVAR;
});
        /* 사용자초기화 */
me.fnInitExtra=function() { 
    console.log(gParam);
    var initData = {appid: gParam.appid, pgmid: gParam.pgmid, userid: gUserinfo.userid, user_nm: gUserinfo.usernm, comment_tp:"CSR" }
    if(!isNull(gParam.dataDef)&&!isNull(gParam.dataDef._pgm)&&!isNull(gParam.dataDef._pgm.app_pgm_nm)) {
        initData.app_nm = gParam.dataDef._pgm.app_pgm_nm;
    } else {
        initData.app_nm = gfnCdNm("APP_PGMID", initData.appid, "nm");
    }
    if(!isNull(gParam.dataDef)&&!isNull(gParam.dataDef._pgm)&&!isNull(gParam.dataDef._pgm.pgm_nm)) {
        initData.pgm_nm = gParam.dataDef._pgm.pgm_nm;
    } else {
        var pgmInfo = subset(gds.menu, "pgmid", initData.pgmid);
        if(pgmInfo.length > 0) initData.pgm_nm = pgmInfo[0].pgm_nm;
        else initData.pgm_nm = "프로그램:"+initData.pgmid;
    } 
    me.pageObj.mst.componentBody.find("textarea").css("resize","vertical"); 
    me.pageObj["mst"].importData(initData);
    me.initData = initData;
    me.fnSearch(); 
}
/* 이벤트핸들러 */
me.fnEH=function(component, evt, row, col, val) { 
    //console.log(evt+","+row+","+col+","+val);
    //화면기능버튼이 눌리면 
    if (component==me.pageObj["_pageFunc"]){ 
        if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
    }
    //mst:신규요청등록 이벤트처리     
    else if(component==me.pageObj["mst"]) {
        //if(evt=="change" && col=="colid") {...}
        if(evt=="componentFunc") {
            if(row=="upload") {
                gfnUpload(UUID, file_tp, ref_file_tp, function(arrFiles) {
                    for (let i = 0; i < arrFiles.length; i++) {
                        const el = arrFiles[i];
                    }
                    me.pageObj.filelist.importData(arrFiles);
                });
            }
        }
    }

    //list:요청처리내역 이벤트처리     
    else if(component==me.pageObj["list"]) {
        if(evt=="componentFunc" && row=="search") {
            me.fnSearch();
        }
        if(evt=="dblclick") {
            var rowData = component.getRowData(row);
            me.pageObj.mst.importData( rowData ); 
        }
    }

    //사용자 컴포넌트/컨트롤
    else if(component.userComponent=="myCompoId") {
        //if(evt=="dblclick" && col=="colid") {...}
    }
}
//search:조회 
me.fnSearch=function() {
    if( isNull(me.pageObj["mst"].getVal("pgmid")) ) return;
    var args = me.pageObj["mst"].exportData()[0];
    //console.log(args);
    var invar = JSON.stringify(args);
    gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
        //console.log(OUTVAR);
        if(OUTVAR.rtnCd=="OK") {
            me.pageObj["list"].importData(OUTVAR.list);
        } else {
            gfnAlert("조회오류",OUTVAR.rtnMsg);
        }
    });
}

//save:요청저장 
me.fnSave=function() {
    if( !me.pageObj["mst"].chkValid() ) return;
    var args = {};
    var docid = UUID;
    args.mst = me.pageObj["mst"].exportData();
    args.mst[0].docid = docid;
    var invar = JSON.stringify(args);
    gfnTx(appid+"."+pgmid,"save",{INVAR:invar},function(OUTVAR){
        if(OUTVAR.rtnCd=="OK") {
            gfnAlert("저장성공","시스템요청이 저장되었습니다. 담당자 확인/조치 연락드리겠습니다.");
            me.fnSearch();
            me.pageObj.mst.reset();
            me.pageObj.filelist.reset();
            me.pageObj["mst"].importData(me.initData);
        } else {
            gfnAlert("저장오류",OUTVAR.rtnMsg);
        }
    });
}

//close:닫기 
me.fnClose=function() {
    var myPopupId = me.page.exactObj("[role='dialog']").attr("aria-describedby");
    $("#"+myPopupId).dialog("close");
}


/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>