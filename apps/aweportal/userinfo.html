<style>
#content.userinfo {
    width: 100%;
    min-height: 6em; 
}
#result.userinfo {
    width: calc(100% - 1em);
    min-height: 6em;
    background-color: beige;    
    max-height: 10em;
    overflow-y: auto;
}
#result.userinfo ul.chatlog {
    display: flex;
    flex-direction: column;
    flex-wrap: nowrap;
    align-content: flex-start;
    justify-content: flex-start;
    align-items: flex-start;
    gap: 0.5em;
    padding: 1em;
    width: 100%;
}
#result.userinfo li {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    align-content: flex-end;
    justify-content: flex-start;
    align-items: flex-end;
}

#result.userinfo li.mymsg {
    margin-left: auto;
    flex-direction: row-reverse;
}
#result.userinfo li span.msg {
    padding: 1em;
    border: 1px solid hsl(30 50% 50%);
    border-radius: 1em;
    background-color: hsl(0,0%,100%);
}
#result.userinfo li span.dt {
    color: hsl(180 30% 50%);
    font-size: 0.2em;
}
</style>
<div class="pageNav">네비게이션트리, 공통화면버튼</div>
<div class="pageTop">화면명+조회조건요약, 기능버튼</div>
<div class="pageCond">조회조건폼</div>
<div class="pageGuide">화면사용가이드</div>
<div class="pageContent">
    화면의 본문내용
    <div id="editor">
        <input type="text" id="target" value="#result" /><br/>
        <textarea id="content" class="userinfo"></textarea> 
    </div>
    <div id="result" class="userinfo">
        <ul class="chatlog"></ul>
    </div>
</div>
<script>
$(function() { //page
    var appid = "aweportal";
    var pgmid = "userinfo";  
    var page = $("*[pgmid='"+pgmid+"']").last(); /* html로 호출되기 때문에 현재 pageid는 스스로 알아내야함 */
    var pageid = page.attr("id"); 

    var me = { //instance 
        fnInit : function() {
            gfn[pageid] = me;
            me.appid    = appid;
            me.pgmid    = pgmid;
            me.pageid   = pageid;
            me.page     = page;
 
            //화면초기화 
            me.dataSet = {};
            me.pageObj = {};
            me.bEdit = false;  /* 수정여부 for 빠져나가기, 재조회 */ 
            me.dataSet["_pgm"] = [
                {
                    pgmid:"userinfo", pgm_nm:"HTML Append를 눈으로 확인하자",
                    pgm_grp_nm:"프로그램개발",
                    app_pgmid:"aweportal", app_pgm_nm:"워크벤치",
                    shortcut:"LKH1"
                }
            ][0]; 
            me.dataSet["_pgm_func"] = [
                {
                    funcid:"apply", func_nm:"반영", func_icon:"fas fa-broom",
                    remark:"입력한 html블럭을 result영역으로 표시합니다."
                }, 
                {
                    funcid:"apply2", func_nm:"반영(추가)", func_icon:"fas fa-broom",
                    remark:"입력한 html블럭을 result영역으로 표시합니다."
                }  , 
                {
                    funcid:"homeRun", func_nm:"테스트", func_icon:"fas fa-broom" 
                }  
            ];    

            me.pageObj["_framepage"] = new gfnFramepage( me ); 
            me.pageObj["_pageFunc"] = new gfnButtonSet( "#"+me.pageid+" .pageFunc",
                 me.dataSet["_pgm_func"], 
                 me.fnEH );
            //이벤트 핸들러
            page.on("keyup",function(e){
                var oE = $(e.target); 
                if(oE.isON("#content") && e.keyCode==13 && e.ctrlKey == false) { 
                    var usernm = page.find("#target").val();
                    var msg = page.find("#content").val();
                    me.fnHomeRun( usernm, msg );
                    page.find("#content").val("");
                } 
            });
            me.dataSet["chat"] = [];
            page.find("#target").val( gUserinfo.usernm );
        },
        fnEH: function(component, evt, row, col, val) {
            console.dir(arguments);
            //component가 me.pageObj["_pageFunc"]이면 화면 기능버튼이 실행된 것이다. 
            if(component==me.pageObj["_pageFunc"]) { 
                //evt => 발생된 이벤트명 
                //row => funcid
                //col => 치환된 func명 
                me[col](); 
            }
        },
        fnApply: function() {
            var sResult = $("#"+me.pageid+" #target").val();
            var sContent = $("#"+me.pageid+" #content").val();

            $("#"+me.pageid+" "+sResult).html(sContent);
        } ,
        fnApply2: function() {
            var sResult = $("#"+me.pageid+" #target").val();
            var sContent = $("#"+me.pageid+" #content").val();

            $("#"+me.pageid+" "+sResult).append(sContent);
        }, 
        fnHomeRun: function(usernm, msg) {
            if(isNull(msg)) return;
            var chat = {
                usnm:usernm, 
                msg:msg, 
                dt:date("today","yy-mm-dd hh24:mi:ss")
            };
            me.dataSet["chat"].push( chat );
            me.fnDrawChat();
        },
        fnDrawChat: function() {
            page.find("#result .chatlog").html("");
            $.each(me.dataSet["chat"],function(idx,el) {
                var oChat = $("<li></li>"); 
                oChat.append(`<span class='usnm'>${el.usnm}</span>`);
                oChat.append(`<span class='msg'>${el.msg}</span>`);
                oChat.append(`<span class='dt'>${el.dt}</span>`);
                if(el.usnm == gUserinfo.usernm) oChat.addClass("mymsg");
                page.find("#result .chatlog").append(oChat);
            });
            page.find("#result").scrollTo( page.find("ul.chatlog").outerHeight() ); 
        } 
    }  
    if(typeof(me.fnInit)=='function') me.fnInit();
}); 
</script>