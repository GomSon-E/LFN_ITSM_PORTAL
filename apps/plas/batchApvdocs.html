<style>[pgmid='batchApvdocs'].framepage .userClass { 
width:100%; 
}</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent">
    <ul id="tabs">
        <li refid="list">목록</li>
        <li refid="det">상세</li> 
    </ul>
    <div id="list" class="flexColumn">
    </div>
    <div id="det" class="flexColumn">
    </div>
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "plas";
    var pgmid = "batchApvdocs"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":1.5,"upd_dt":"2022-10-28 14:57:47","remark":"","pgmid":"batchApvdocs","proc_mst_id":"","pgm_stat":"N","sort_seq":9999,"app_pgmid":"plas","shortcut":"","reg_dt":"2022-10-28 14:57:47","reg_usid":"jjr","pgm_nm":"결재대기알림(배치)","upd_usid":"jjr","pgm_tp":"UX","pgm_grp_nm":"","proc_mst_nm":"","app_pgm_nm":"경영관리","":"트랜젝션(메뉴)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-search","reg_dt":"2022-10-28 14:57:47","reg_usid":"","func_nm":"조회","upd_usid":"","upd_dt":"2022-10-28 14:57:47","func_tp":"DB_R","remark":null,"pgmid":"batchApvdocs","sort_seq":"1","funcid":"search","content":null,"crud":"R","id":"0"},{"func_icon":"fas fa-comment","reg_dt":"2022-10-28 14:57:47","reg_usid":"","func_nm":"메시지발송","upd_usid":"","upd_dt":"2022-10-28 14:57:47","func_tp":null,"remark":null,"pgmid":"batchApvdocs","sort_seq":"3","funcid":"sendMsg2","content":null,"crud":"R","id":"1"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["pageCond"]={"sort_seq":"1","data_id":"pageCond","data_nm":"조회조건","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":"BOT","section_icon":"fas fa-robot","colgrp":null,"colid":"bot_activated","colnm":"활성화","dtype":"text","etype":"cbx","attr":null,"defval":"\"N\"","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":"BOT","section_icon":null,"colgrp":null,"colid":"bot_cycle","colnm":"주기(m/s)","dtype":"num","etype":"txt","attr":null,"defval":"60000","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":"BOT","section_icon":null,"colgrp":null,"colid":"bot_active","colnm":"상태","dtype":"text","etype":"txt","attr":"disabled ","defval":"\"on\"","w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":"BOT","section_icon":null,"colgrp":null,"colid":"bot_time","colnm":"최근시간","dtype":"text","etype":"txt","attr":"disabled","defval":null,"w":"11","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":"JOB(공휴일,연차데이 제외)","section_icon":"fa fa-clock","colgrp":null,"colid":"job_day","colnm":"요일","dtype":"text","etype":"sel","attr":"keycol ","defval":"\"평일\"","w":null,"h":null,"refcd":"[\"평일\",\"주말\"]","option":"multi:day_time::cd","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":"JOB(공휴일,연차데이 제외)","section_icon":null,"colgrp":null,"colid":"job_time","colnm":"시간","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"30","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":"JOB(공휴일,연차데이 제외)","section_icon":null,"colgrp":null,"colid":"job_running","colnm":"Running","dtype":"text","etype":"txt","attr":"disabled","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":"JOB(공휴일,연차데이 제외)","section_icon":null,"colgrp":null,"colid":"job_running_time","colnm":"최근시간","dtype":"text","etype":"txt","attr":"disabled","defval":null,"w":"11","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":"JOB(공휴일,연차데이 제외)","section_icon":null,"colgrp":null,"colid":"job_result","colnm":"실행결과","dtype":"text","etype":"txt","attr":"hidden","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"}]};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"2","data_id":"list","data_nm":"결재대기 목록","data_icon":null,"component_pgmid":"agGrid","component_option":{"remark":"봇 실행 : 활성화 체크 / JOB 시간 변경 가능"},"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"rcv_usid","colnm":"결재대기자","dtype":"text","etype":"sel","attr":"readonly keycol ","defval":null,"w":"15","h":null,"refcd":"USID","option":"sel:rcv_usid::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"cnt_doc","colnm":"건수","dtype":"num","etype":"raw","attr":"readonly","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"title","colnm":"제목","dtype":"text","etype":"raw","attr":"hidden","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"detail","colnm":"상세보기","dtype":"text","etype":"btn","attr":"readonly center","defval":null,"w":null,"h":null,"refcd":null,"option":"문서목록:fas fa-list","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"message","colnm":"메시지보내기","dtype":"text","etype":"btn","attr":"readonly center ","defval":null,"w":null,"h":null,"refcd":null,"option":"발송:fas fa-comment","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"}]};
me.dataDef["_pgm_data"]["det"]={"sort_seq":"3","data_id":"det","data_nm":"상세보기","data_icon":null,"component_pgmid":"agGrid","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"doc_template_id","colnm":"구분","dtype":"text","etype":"sel","attr":"readonly","defval":null,"w":"20","h":null,"refcd":"DOC_TEMPLATE_ID","option":"sel:doc_template_id::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"docid","colnm":"문서ID","dtype":"text","etype":"none","attr":"hidden","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"doc_no","colnm":"문서번호","dtype":"text","etype":"raw","attr":"readonly","defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"title","colnm":"제목","dtype":"text","etype":"raw","attr":"readonly keycol","defval":null,"w":"40","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_usid","colnm":"상신자이름","dtype":"text","etype":"sel","attr":"readonly","defval":null,"w":"15","h":null,"refcd":"USID","option":"sel:reg_usid::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_dt","colnm":"등록일","dtype":"text","etype":"raw","attr":"readonly","defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */

    /* 사용자초기화 */
    me.fnInitExtra=function() {
        //탭 설정
        gfnTab(pageid, "tabs"); 

        //me.fnSearch();
        //날짜조회
        me.fnSearchDay();
        
        //me.pageObj.pageCond.componentBody.find("[colid='job_time']").attr("type","time");
        //me.pageObj.pageCond.setVal("job_time","14:00");//date("today","hh24:mi"));
        // me.pageObj.pageCond.setVal("job_time",date("today","hh24:mi"));
        me.pageObj.pageCond.setVal("job_time","(date('today','hh24:mi')=='08:50'||date('today','hh24:mi')=='14:00')?true:false");
        
        //봇 실행
        //me.fnBot();
    }
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        else if(component==me.pageObj.pageCond){
            if(evt=="change"){
                if(col=="bot_activated"){
                    var args = me.pageObj.pageCond.exportData()[0];
                    if(args.bot_activated=="Y"){
                        component.setVal("bot_active","on");
                        me.fnBot();
                        //console.log("ok");
                    }else{
                        component.setVal("bot_activated","N");
                        component.setVal("bot_active","off");
                        component.setVal("job_running","N");
                        me.pageObj.pageCond.setVal("bot_time",date("today","yyyy-mm-dd hh24:mi:ss"));
                        //me.fnBot();
                    }
                }
            }
            
        }
        //list:결재대기 목록 이벤트처리     
        else if(component==me.pageObj["list"]) {
            if(evt=="click") {
                if(row >= 0 ) {
                    if ( col=="detail") {
                        var rowData = me.pageObj.list.getRowData(row); 
                        console.log(rowData);
                        rowData.currow = row; //선택된 rowid를 넘겨줌 
                        me.page.find("#tabs li[refid='det']").trigger("click");
                        me.fnSearchDet(rowData.rcv_usid);    
                    }
                    
                    if ( col=="message") {
                        var rowData = me.pageObj.list.getRowData(row); 
                        console.log(rowData);
                        rowData.currow = row; //선택된 rowid를 넘겨줌 
                        me.fnSendMsg([rowData]);    
                    }
                }
            }
            
            if(evt=="componentFunc") {
                if(row=="addRow") {
                    component.addRow();
                } else if(row=="delRow") {
                    component.delRow();
                }
            }
            //if(evt=="change" && col=="colid") {...}
        }
        
        else if(component==me.pageObj["det"]){
            if(evt=="dblclick") {
                //gfnShowPlasDoc(component.getVal(row,"docid"), "framepage"); 
                $.extend(true,gParam||{},{INVAR:{docid:component.getVal(row,"docid")}}); //gParam.INVAR.docid
        		
        		//me.openPage(pgmid,pagenm, afnCallback, appid);
        		gMDI.openPage("plasDocUpd","문서보기",function(OUTVAR){},"plas");
            }
        }

        //사용자 컴포넌트/컨트롤
        else if(component.userComponent=="myCompoId") {
            //if(evt=="dblclick" && col=="colid") {...}
        }
    }
    
    //봇 활성화
    me.fnBot = function(){
        var args = me.pageObj.pageCond.exportData()[0];
        var botCycle = nvl(args.bot_cycle,60000);
        var job_time = eval(me.pageObj.pageCond.getVal("job_time"));
        //목록은 조회
        me.fnSearch();
        
        console.log(job_time);
        console.log(args.bot_activated);
        
        try{
            if(args.bot_activated=="Y"){ //활성화
                if(args.bot_active=="on"){
                    if(job_time){ //true면
                        me.fnRun(function(run){
                            //결과기록
                            console.log("콜백확인",run);
                            me.pageObj.pageCond.setVal("bot_time",date("today","yyyy-mm-dd hh24:mi:ss"));
                            me.pageObj.pageCond.setVal("bot_active","on"); 
                            me.pageObj.pageCond.setVal("job_running",run);
                            me.pageObj.pageCond.setVal("job_running_time",date("today","yyyy-mm-dd hh24:mi:ss"));
                            setTimeout(me.fnBot, botCycle);
                        });
                    }else{
                        me.pageObj.pageCond.setVal("bot_time",date("today","yyyy-mm-dd hh24:mi:ss"));
                        me.pageObj.pageCond.setVal("job_running","N");
                        setTimeout(me.fnBot, botCycle);
                    }
                }else{
                    me.pageObj.pageCond.setVal("bot_time",date("today","yyyy-mm-dd hh24:mi:ss"));
                    setTimeout(me.fnBot, botCycle);
                }
                
            }else{ //비활성화
                me.pageObj.pageCond.setVal("bot_time",date("today","yyyy-mm-dd hh24:mi:ss"));
                me.pageObj.pageCond.setVal("bot_active","off");   
                return;
            }
        }catch(e) {
            me.pageObj.pageCond.setVal("bot_time",date("today","yyyy-mm-dd hh24:mi:ss"));
            me.pageObj.pageCond.setVal("bot_active","exception");
            console.log("fnBot Exception:");
            console.log(e); 
            //익셉션이 발생하더라도 쉼없이 Tick한다. 
            if(me.pageObj.pageCond.getVal("bot_activated")=="Y") { 
                me.pageObj.pageCond.setVal("bot_active","on");
                setTimeout(me.fnBot,botCycle);
            }
        }
    }
    
    //JOB Running
    me.fnRun = function(fnCallback){
        try{
            //조회
            // var args = me.pageObj.pageCond.exportData()[0];
            // var invar = JSON.stringify(args); 
            // gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            //     if(OUTVAR.rtnCd=="OK") {
            //         me.pageObj.list.importData(OUTVAR.list);
            //         var today_date = date("today","yyyy-mm-dd","yyyymmdd").replaceAll("-","");
            //         var job_time = eval(me.pageObj.pageCond.getVal("job_time"));    
            //         (gParam.day).forEach(e=>{
            //             if(e.ymd == today_date){
            //                 //if(args.job_time==date("today","hh24:mi")){ //현 시각, 오후2시면
            //                  console.log("yeah~!");
            //                  //발송or저장 OUTVAR.list
            //                  me.fnSendMsg(OUTVAR.list);
            //             } 
            //         })
            //     }else {
            //         gfnAlert("조회 오류",OUTVAR.rtnMsg);
            //     }
            // });
            
            // 테스트 데이터
            // var args = {};
            // var invar = JSON.stringify(args); 
            // gfnTx(appid+"."+pgmid,"searchTest",{INVAR:invar},function(OUTVAR){
            //     if(OUTVAR.rtnCd=="OK") {
            //         console.log(OUTVAR.list);
            //         me.fnSendMsg(OUTVAR.list);
            //     }else {
            //         gfnAlert("조회 오류",OUTVAR.rtnMsg);
            //     }
            // });
            console.log("testing");
            
            if(typeof(fnCallback)=='function') fnCallback("Y");
        }catch(e){
            if(typeof(fnCallback)=='function') fnCallback("N");
        }
    }
    
    //결재 대기 리스트 조회
    me.fnSearch = function(){
        var args = {};
        var invar = JSON.stringify(args); 
        //console.log(args);
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.rtnCd=="OK") {
                //console.log(OUTVAR);
                me.pageObj.list.importData(OUTVAR.list);
            }else {
                gfnAlert("조회 오류",OUTVAR.rtnMsg);
            }
        });
    }
    
    //결재문서 상세보기
    me.fnSearchDet = function(usid){
        var args = {rcv_usid : usid}; 
        var invar = JSON.stringify(args); 
        console.log(args);
        gfnTx(appid+"."+pgmid,"searchDet",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                //console.log(OUTVAR);
                me.pageObj.det.importData(OUTVAR.list);
            }else {
                gfnAlert("조회 오류",OUTVAR.rtnMsg);
            }
        });
    }
    
    //메시지 발송 - run
    me.fnSendMsg = function(list){
        list.forEach(e=>{
            var useremail = e.rcv_usid+"@lfnetworks.co.kr";
            var msg = "＊결재 대기 알림＊\n\n  - 결재 대기중인 문서가 "+e.cnt_doc+"개 있습니다.\n  - 아래 링크 확인 후, 결재 부탁드립니다.";
            if(e.cnt_doc > 1){
                //결재대기 목록 페이지로
                var url = "https://fo.lfnetworks.co.kr/plas.jsp";
                var ref_info = e.docid;
                gfnSendMsg("naverworks", useremail, msg, url, function(OUTVAR) {
                    //me.fnSearch(me.docid);   
                    //$.extend(true,gParam||{},{INVAR:{docid:e.docid}}); //gParam.INVAR.docid
            		
            		//me.openPage(pgmid,pagenm, afnCallback, appid);
            		//gMDI.openPage("plasDocUpd","문서보기",function(OUTVAR){},"plas");
            		
                }, ref_info, pgmid);   
            }else{
                //해당문서 링크
                var url = "https://fo.lfnetworks.co.kr/plas.jsp?d="+e.docid;
                var ref_info = e.docid;
                gfnSendMsg("naverworks", useremail, msg, url, function(OUTVAR) {
                    
                }, ref_info, pgmid);    
            }
        })
    }
    
    //즉시 전체 메시지 발송
    me.fnSendMsg2 = function(){
        var args = {};
        var invar = JSON.stringify(args); 
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.rtnCd=="OK") {
                me.pageObj.list.importData(OUTVAR.list);
                var list = OUTVAR.list;
                list.forEach(e=>{
                    var useremail = e.rcv_usid+"@lfnetworks.co.kr";
                    var msg = "＊결재 대기 알림＊\n\n  - 결재 대기중인 문서가 "+e.cnt_doc+"개 있습니다.\n";
                    if(e.cnt_doc > 1){
                        //결재대기 목록 페이지로
                        var url = "https://fo.lfnetworks.co.kr/plas.jsp";
                        msg += "  (아래 링크 확인 후, 결재 부탁드립니다.)";
                        var ref_info = e.docid;
                        gfnSendMsg("naverworks", useremail, msg, url, function(OUTVAR) {
                            //me.fnSearch(me.docid);   
                            //$.extend(true,gParam||{},{INVAR:{docid:e.docid}}); //gParam.INVAR.docid
                    		
                    		//me.openPage(pgmid,pagenm, afnCallback, appid);
                    		//gMDI.openPage("plasDocUpd","문서보기",function(OUTVAR){},"plas");
                    		
                        }, ref_info, pgmid);   
                    }else{
                        //해당문서 링크
                        var url = "https://fo.lfnetworks.co.kr/plas.jsp?d="+e.docid;
                        msg += " - 제목 : ["+e.title+"]\n  (아래 링크 확인 후, 결재 부탁드립니다.)";
                        var ref_info = e.docid;
                        gfnSendMsg("naverworks", useremail, msg, url, function(OUTVAR) {
                            
                        }, ref_info, pgmid);    
                    }
                })
            }else {
                gfnAlert("조회/메시지발송 오류",OUTVAR.rtnMsg);
            }
        });
    }
    
    //날짜조회(연차데이,공휴일 제외 등)
    me.fnSearchDay = function(){
        var args = me.pageObj.pageCond.exportData()[0];
        
        if(args.day_time == "평일"){
            args.day_time = 'N';
        }else if(args.day_time == "주말"){
            args.day_time = 'Y';
        }else{
            args.day_time = ['Y','N'];
        }
        //console.log(args);
        var invar = JSON.stringify(args); 
        //console.log(args);
        gfnTx(appid+"."+pgmid,"searchDay",{INVAR:invar},function(OUTVAR){
            //console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                //console.log(OUTVAR.day);
                gParam.day = OUTVAR.day; 
            }else {
                gfnAlert("조회 오류",OUTVAR.rtnMsg);
            }
        });
    }
    
function gfnSendMsg(toSys, useremail, msg, url, afnCallback, ref_info, pgmid) {
    
	if(toSys=="naverworks") {
		var userlist = ($.type(useremail)=='array')?useremail:[useremail]; //사용자ID
		var type = "link";  //or "text" // 텍스트 또는 링크
		var textMsg = msg; //메세지
		var link = nvl(url,"https://fo.lfnetworks.co.kr/plas.jsp"); //링크
		
		var usid = [];
		for(var i = 0; i<userlist.length; i++){
			usid.push({'usid':userlist[i], 'msg':textMsg, 'type':type, 'link':link});
		}
		var args = {};
		args.usidlist = usid;
		var invar = JSON.stringify(args);
		gfnTx("api.plas_naver_bot","sendMsg2",{INVAR:invar},function(OUTVAR){
			console.log(OUTVAR);
			if(OUTVAR.rtnCd=="OK") {
				var args2 = {};
				args2.list = [];
				userlist.forEach(el=>{
					var row = {usid:el.split("@")[0]}; 
					row.comments = textMsg+" "+nvl(url,"");
				    row.ref_info = nvl(ref_info,"");
				    row.pgmid    = nvl(pgmid,"registerAlert"); 
					args2.list.push( row ); 
				});
				var invar2 = JSON.stringify(args2);
				gfnTx("aweportal.registerAlert","saveLog2",{INVAR:invar2},function(OUTVAR2){
					if(OUTVAR2.rtnCd=="OK") {
						afnCallback(OUTVAR);
					} else {
						console.log(OUTVAR2);
					}
				});
			} else {
				gfnAlert("메세지 발송(네이버웍스 bot 전송) 오류",OUTVAR.rtnMsg);
			}
		});	
	}
}

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>