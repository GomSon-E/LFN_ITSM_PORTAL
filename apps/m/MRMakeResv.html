<style>.awePop .framepage {
    background-color: white !important;
    position: relative;
}

.awePop .btnClose {
    content: "X";
    color: #6d2c2c;
    position: absolute;
    top: 0.25em;
    right: 0.75em;
    font-size: 2em;
    cursor: pointer;
} 

.awePop .pageTitle {
    display: none;
}
.awePop .framepage .btnPdf {
    display:none;
}

.awePop .componentFunc h5 {
    color: red;
}

.aweForm label {
    width: 9em !important;
    flex: 8 1 auto;
}

.aweForm pre.aweCol {
    line-height: 1.2;
    white-space: break-spaces;
}

</style>

<!-- HTML autogen start ---------------------------------------------- --> 
<div class="btnClose">X</div>           
<div class="pageContent">
    <ul id="tabs">
        <li refid="mst">예약 정보</li> 
        <li refid="user">예약자 정보</li> 
        <li refid="room">회의실 정보</li>
    </ul>
    <div id='mst'></div> 
    <div id='user'></div> 
    <div id='room'></div> 
</div>
<div class="pageTop"></div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "m";
    var pgmid = "MRMakeResv"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":0.6,"upd_dt":"2022-10-05 14:31:15","remark":"","pgmid":"MRMakeResv","proc_mst_id":"","pgm_stat":"Y","sort_seq":13,"app_pgmid":"m","shortcut":"","reg_dt":"2022-10-05 14:31:15","reg_usid":"jjr","pgm_nm":"예약하기","upd_usid":"jjr","pgm_tp":"TX","pgm_grp_nm":"스마트워크_회의실관리","proc_mst_nm":"","app_pgm_nm":"회의실예약시스템","":"트랜젝션(화면)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fa fa-calendar","reg_dt":"2022-10-05 14:31:15","reg_usid":"","func_nm":"예약하기","upd_usid":"","upd_dt":"2022-10-05 14:31:15","func_tp":null,"remark":null,"pgmid":"MRMakeResv","sort_seq":"1","funcid":"save","content":null,"crud":"R","id":"0"},{"func_icon":"fa fa-door-open","reg_dt":"2022-10-05 14:31:15","reg_usid":"","func_nm":"바로시작","upd_usid":"","upd_dt":"2022-10-05 14:31:15","func_tp":null,"remark":null,"pgmid":"MRMakeResv","sort_seq":"2","funcid":"run","content":null,"crud":"R","id":"1"},{"func_icon":"fa fa-ban","reg_dt":"2022-10-05 14:31:15","reg_usid":"","func_nm":"닫기","upd_usid":"","upd_dt":"2022-10-05 14:31:15","func_tp":null,"remark":null,"pgmid":"MRMakeResv","sort_seq":"3","funcid":"cancel","content":null,"crud":"R","id":"2"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["mst"]={"sort_seq":"1","data_id":"mst","data_nm":"예약 정보","data_icon":null,"component_pgmid":"aweForm","component_option":{"remark":"*예약가능시간 : 07:00 ~ 23:59"},"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"room_loc","colnm":"위치","dtype":"text","etype":"txt","attr":"readonly","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"room_nm","colnm":"회의실","dtype":"text","etype":"txt","attr":"readonly","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"resv_nm","colnm":"회의명","dtype":"text","etype":"txt","attr":"pk","defval":null,"w":"30","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"attend","colnm":"인원수","dtype":"num","etype":"txt","attr":"keycol","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":"예약정보","section_icon":null,"colgrp":null,"colid":"resv_dt","colnm":"회의일","dtype":"ymd","etype":"txt","attr":"keycol readonly","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":"예약정보","section_icon":null,"colgrp":null,"colid":"start_time","colnm":"시작시각","dtype":"text","etype":"txt","attr":"keycol","defval":null,"w":null,"h":null,"refcd":"MR_START_TIME","option":"sel:start_time::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":"예약정보","section_icon":null,"colgrp":null,"colid":"end_time","colnm":"종료시각","dtype":"text","etype":"txt","attr":"keycol","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":"예약정보","section_icon":null,"colgrp":null,"colid":"duration_time","colnm":"사용시간","dtype":"text","etype":"txt","attr":"readonly","defval":null,"w":"4","h":null,"refcd":"MR_DURATION_TIME","option":"sel:duration_time::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":"예약자","section_icon":null,"colgrp":null,"colid":"comcd","colnm":"소속사","dtype":"text","etype":"txt","attr":"readonly","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":10,"section":"예약자","section_icon":null,"colgrp":"성명","colid":"nm","colnm":"예약자","dtype":"text","etype":"txt","attr":"readonly","defval":null,"w":"5","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":11,"section":"예약자","section_icon":null,"colgrp":"성명","colid":"jobgradenm","colnm":"직급","dtype":"text","etype":"txt","attr":"readonly","defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"},{"sort_seq":12,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"메모","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"50","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"11"}]};
me.dataDef["_pgm_data"]["user"]={"sort_seq":"2","data_id":"user","data_nm":"예약자정보","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"nm","colnm":"성명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"email","colnm":"이메일","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"tel_no","colnm":"연락처","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"comcd","colnm":"소속사","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"deptnm","colnm":"부서","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"jobrolenm","colnm":"직책","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"jobgradenm","colnm":"직급","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"}]};
me.dataDef["_pgm_data"]["room"]={"sort_seq":"3","data_id":"room","data_nm":"회의실정보","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"room_loc","colnm":"층수","dtype":"text","etype":"raw","attr":"keycol","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"room_id","colnm":"회의실ID","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"room_nm","colnm":"회의실명","dtype":"text","etype":"raw","attr":"pk","defval":null,"w":"30","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"room_remark","colnm":"사용규칙","dtype":"text","etype":"pre","attr":null,"defval":null,"w":"50","h":"3","refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"quota_usage","colnm":"당월사용율","dtype":"text","etype":"pre","attr":null,"defval":null,"w":"50","h":"3","refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"limit_cd","colnm":"회의실구분","dtype":"text","etype":"pre","attr":null,"defval":null,"w":"50","h":"3","refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"max_time","colnm":"최대사용시간","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"max_user","colnm":"권장최대인원","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":null,"colid":"resv_forward","colnm":"예약개시일수","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":10,"section":null,"section_icon":null,"colgrp":null,"colid":"forward_dt","colnm":"예약가능일","dtype":"ymd","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":11,"section":null,"section_icon":null,"colgrp":null,"colid":"room_stat","colnm":"현재상태","dtype":"text","etype":"txt","attr":"disabled","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */
    /* 사용자초기화 */
    me.fnInitExtra=function() {
        //탭 설정
        gfnTab(pageid, "tabs"); 
        //사용자 컴포넌트 
        //me.dataDef["_pgm_data"][myCompoId] = {...};
        //me.pageObj["myCompoId"] = new gfnComponent( me.pageid, myCompoId, me.dataDef["_pgm_data"][myCompoId], me.fnEH, me); 
        //me.pageObj["myCompoId"].userComponent = "myCompoId";
        
        //사용자 컨트롤  
        //var myColinfo = {colid:...} 
        //me.pageObj["myColId"] = new gfnControl(myColinfo, me.fnEH) 
        //me.page.find("#myCol").append(me.pageObj["myColId"].dispObj);
        //me.pageObj["myColId"].getVal(); / myCol.setVal(val);...
        me.pageObj.mst.componentBody.find("[colid='resv_dt']").attr("type","date");
        me.pageObj.mst.componentBody.find("[colid='start_time']").attr("type","time");
        me.pageObj.mst.componentBody.find("[colid='end_time']").attr("type","time");
        
        
        me.page.find(".btnClose").on('click', function() {
            gfnClosePop(); 
        }); 
 
        me.room_id    = gParam.room_id;
    	me.aymd       = gParam.aymd;
    	me.start_time = gParam.start_time;
        if(!isNull(me.room_id)) {
            me.fnNew();
        } else {
            gfnStatus("회의실 확인","회의실 정보가 잘못되었습니다. 다시 시도하세요...");
            gfnClosePop();
        }
    } 
    me.fnCancel=function() {
        gfnClosePop();
    }
    
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //mst:회의실 정보 이벤트처리     
        else if(component==me.pageObj["mst"]) {
            if(evt=="componentFunc") {
                if(row=="addRow") {
                    component.addRow();
                } else if(row=="delRow") {
                    component.delRow();
                }
            }
            if(evt=="change") {
                if (col=="start_time"||col=="end_time") {
                    var start_time = me.pageObj.mst.getVal("start_time");
                    var end_time = me.pageObj.mst.getVal("end_time");
                    me.pageObj.mst.setVal("duration_time",timeDiff(start_time, end_time));    
                } 
            }
        }

        //사용자 컴포넌트/컨트롤
        else if(component.userComponent=="myCompoId") {
            //if(evt=="dblclick" && col=="colid") {...}
        }
    }
    
    //예약기본값 조회 
    me.fnNew=function() {  
        //me.room_id    = gParam.room_id;
    	//me.aymd       = gParam.aymd;
    	//me.start_time = gParam.start_time;
        var args        = me.pageObj.mst.exportData()[0]; 
        args.room_id    = me.room_id;
        args.aymd       = nvl(args.resv_dt, isYmd(me.aymd)?me.aymd:date("today","yyyy-mm-dd","yyyymmdd"));
    	args.start_time = nvl(args.start_time, nvl(me.start_time,date("today","hh24:mi"))); 
    	args.duration_time = nvl(args.duration_time,"1:00");
    	args.resv_nm    = nvl(args.resv_nm,"");
    	args.attend     = nvl(args.attend,2);
    	args.remark     = nvl(args.remark,"");
    	
    	/* 관리자 등록시에는 사용자ID를 받아서 저장 args.userid = gUserinfo.userid; */ 
    	/* 화면에서 정보를 만들어주지 않고 조회해서 값을 가져온다. */ 
    	console.log(args); 
        var invar = JSON.stringify(args); 
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){ 
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                me.pageObj.mst.importData(OUTVAR.mst,"C"); 
                var start_time = me.pageObj.mst.getVal("start_time");
                var end_time = me.pageObj.mst.getVal("end_time");
                me.pageObj.mst.setVal("duration_time",timeDiff(start_time, end_time));   
                me.pageObj.mst.componentTop.find(".quickGuide").text("*예약가능시간 : "+me.pageObj.mst.getVal("min_start_time")+" ~ "+me.pageObj.mst.getVal("max_end_time") );
                me.pageObj.room.importData(OUTVAR.mst); 
                me.pageObj.user.importData(OUTVAR.mst); 
                
                //Validation사항은 미리 띄워준다.
                if(OUTVAR.mst.length > 0) {
                    var args = me.pageObj.mst.exportData();
                    if( args.room_id=="1F02" || args.room_id=="1F05"  ) { //LFN 100%
                        //if(toNum(nvl(args.tp_quota_usage,0)) > 8*22*0.2 && (args.comcd=="TRIBONS"||args.comcd=="PASTEL")) {
                        if(args.comcd != "LFN"){
                           gfnStatus("사용Quota확인","Meeting Room 2/5은 LF네트웍스 100%사용으로 지정되어 트라이/파스텔 추가 예약할 수 없습니다. 사용필요시, 관리자에게 문의해주세요."); 
                        }
                        //}
                    }
                    if( args.room_id=="1F01" || args.room_id=="1F03" || args.room_id=="1F04"  ) { //T/P 80%
                        if(toNum(nvl(args.l_quota_usage,0)) > 8*22*0.2 && args.comcd=="LFN")  {
                            gfnStatus("사용Quota확인","Meeting Room 1,3/4는 트라이/파스텔 80% 사용으로 지정되어 LF네트워크 추가 예약할 수 없습니다."); 
                        }
                    }
                    var curtime = date("today","hh24:mi");
                    if( !(timeDiff(curtime,args.start_time) <= "0:10" || timeDiff(curtime,args.start_time) >= "23:50") ) {
                        gfnStatus("바로시작 확인","예약시간 10분 이전/초과하여 바로 사용처리 할 수 없습니다. 예약하기를 해주세요."); 
                    }
                    // if( isNull(gParam.r) || gParam.r != args.room_id ) {
                    //     gfnStatus("바로시작 확인","바로시작(입실) 처리는 회의실에 부착된 바코드 스캔시에만 가능합니다.");
                    // }
                    if( args.start_time >= "09:00" && args.start_time <= "12:45" && (args.room_id=="1F03" ||args.room_id=="1F04") ) {
                        if(gUserinfo.userid!="tnwls7866") {
                            gfnStatus("우선사용 등록된 회의실","Meeting Room 3/4 는 한시적으로 오전동안 트라이/파스텔 생산담당 우선 사용예정입니다.<br/>회의실 사용조정이 필요한 경우 회의실담당자에게 문의바랍니다."); 
                        }
                    }
                } 
            } else {
                gfnAlert("오류",OUTVAR.rtnMsg); 
            }
        });
    }
    
    //예약하기 
    me.fnSave=function(bRun) {
        if( !me.pageObj.mst.chkValid() ) return; 
        var args = me.pageObj.mst.exportData()[0];
        if( args.start_time >= args.end_time ) {
            gfnAlert("예약시간 확인","예약 사용시간이 지정되지 않았거나 시간의 선후가 바뀌었습니다.<br/>(*시작시간을 변경하여 비어있는 시간에 예약이 되지 않는 경우 해당시간대에서 [예약하기]해주세요!)");
            return false;
        }
        if( args.start_time < args.min_start_time ) {
            gfnAlert("예약시간 확인","시작시각이 예약가능한 시작시각("+args.min_start_time+")보다 이전입니다.<br/>(*시작시간을 변경하여 비어있는 시간에 예약이 되지 않는 경우 해당시간대에서 [예약하기]해주세요!)");
            return false;
        }
        if( args.end_time > args.max_end_time ) {
            gfnAlert("예약시간 확인","종료시각이 예약가능한 종료시각("+args.max_end_time+")보다 이후입니다.");
            return false;
        } 
        if( isNull(args.duration_time) || toNum(args.duration_time) < 0 ) {
            gfnAlert("예약시간 확인","예약 사용시간이 지정되지 않았거나 시간의 선후가 바뀌었습니다.<br/>(*시작시간을 변경하여 비어있는 시간에 예약이 되지 않는 경우 해당시간대에서 [예약하기]해주세요!)");
            return;
        } 
        if( args.room_id=="1F02" || args.room_id=="1F05"  ) { //LFN 100%
            if(args.comcd != "LFN"){
               gfnStatus("사용Quota확인","Meeting Room 2/5은 LF네트웍스 100%사용으로 지정되어 트라이/파스텔 추가 예약할 수 없습니다. 사용필요시, 관리자에게 문의해주세요."); 
               return false;
            }
        }
        if( args.room_id=="2F01") { //LFN 100%
            if(args.comcd != "LFN"){
               gfnStatus("사용Quota확인","2층 소회의실은 LF네트웍스 100%사용으로 지정되어 트라이/파스텔 추가 예약할 수 없습니다."); 
               return false;
            }
        }
        if( args.room_id=="1F01" || args.room_id=="1F03" || args.room_id=="1F04"  ) { //T/P 80%
            if(toNum(nvl(args.l_quota_usage,0)) > 8*22*0.2 && args.comcd=="LFN")  {
                gfnAlert("사용Quota확인","Meeting Room 1,3/4는 트라이/파스텔 80% 사용으로 지정되어 LF네트워크 추가 예약할 수 없습니다.");
                return false;
            }
        }
        if( args.start_time >= "09:00" && args.start_time <= "12:45" && (args.room_id=="1F03" ||args.room_id=="1F04") ) {
            if(gUserinfo.userid!="tnwls7866") {
                gfnAlert("우선사용 등록된 회의실","Meeting Room 3/4 는 한시적으로 오전동안 트라이/파스텔 생산담당 우선 사용예정입니다.<br/>회의실 사용조정이 필요한 경우 회의실담당자에게 문의바랍니다.");
                return;
            }
        }
        if(bRun) {
            var curtime = date("today","hh24:mi");
            if( !(timeDiff(curtime,args.start_time) <= "0:10" || timeDiff(curtime,args.start_time) >= "23:50") ) {
                gfnAlert("바로시작 확인","예약시간 10분 이전/초과하여 바로 사용처리 할 수 없습니다. 예약하기를 해주세요.");
                return false;
            }
            // if( isNull(gParam.r) || gParam.r != args.room_id ) {
            //     gfnAlert("바로시작 확인","바로시작(입실) 처리는 회의실에 부착된 바코드 스캔시에만 가능합니다.");
            //     return false;
            // }            
            if( args.resv_cd_stat != "D") {
                gfnAlert("회의실 사용시작 확인","회의실 예약상태일때만 사용처리 가능합니다!");
                return;
            } 
            var curymd = date("today","yyyymmdd");
            var aymd = args.resv_dt;
            if( curymd != aymd ) {
                gfnAlert("회의실 사용시작 확인","회의실 사용처리는 당일에만 가능합니다!");
                return;
            }
            var curtime = date("today","hh24:mi");
            var start_time = args.start_time;
            var end_time = args.end_time; 
            if( !(timeDiff(start_time,curtime) <= "0:10" || timeDiff(start_time,curtime) >= "23:50") ) { 
                gfnAlert("회의실 사용시작 확인","회의실 사용은 예약시간 10분 전 사용처리 가능 합니다.");
                return;
            }
            if( curtime > end_time ) {
                gfnAlert("회의실 사용시작 확인","예약된 종료시간 이후입니다. 예약취소처리만 가능 합니다.");
                return;
            }
            if( gUserinfo.userid != args.user_id) { //예약자와 세션사용자가 다르면 빠른인증 필요
                if(!gfnCheckQpass("회의실사용(입실)", args.user_id)) return;  
            }
        }
        var invar = JSON.stringify(args);
        var func = bRun?"run":"save";
        gfnTx(appid+"."+pgmid,func,{INVAR:invar},function(OUTVAR){ 
            if(OUTVAR.rtnCd=="OK") {
                if(bRun) { 
                    function _fnCallback() {
                        gfnAlert("회의실사용(입실)","회의실사용(입실) 처리 되었습니다.");
                        gfnClosePop();
                        gfn.home.fnRefresh();  
                    }
                    //메시지 발송
                    var msg = "["+args.room_nm+"] "+args.resv_nm+"("+date(args.resv_dt,"yyyymmdd","yyyy년mm월dd일(weekday)")+" "+args.start_time+" ~ "+args.end_time+") 회의가 시작 되었습니다."
                    if(args.comcd=="LFN") {
                        gfnSendMsg("naverworks",args.email,"회의실 예약시스템 -"+args.nm+"님("+args.email+"), "+msg,null,_fnCallback); 
                    } else {
                        gfnSendMsg("jandi",args.email,"회의실 예약시스템 -"+args.nm+"님("+args.email+"), "+msg,null,_fnCallback); 
                    }
                } else {
                    function _fnCallback() {
                        gfnAlert("회의실예약","회의실예약 처리 되었습니다.");
                        gfnClosePop();
                        gfn.home.fnRefresh();  
                    }
                    //메시지 발송
                    var msg = "["+args.room_nm+"] "+args.resv_nm+"("+date(args.resv_dt,"yyyymmdd","yyyy년mm월dd일(weekday)")+" "+args.start_time+" ~ "+args.end_time+") 회의가 예약 되었습니다."
                    if(args.comcd=="LFN") {
                        gfnSendMsg("naverworks",args.email,"회의실 예약시스템 -"+args.nm+"님("+args.email+"), "+msg,null,_fnCallback); 
                    } else {
                        gfnSendMsg("jandi",args.email,"회의실 예약시스템 -"+args.nm+"님("+args.email+"), "+msg,null,_fnCallback); 
                    }
                }
            } else {
                gfnAlert("오류",OUTVAR.rtnMsg); 
            }
        });
    }
    
    //예약과 함께 바로 시작하기 
    me.fnRun=function() {
        me.fnSave(true);
    } 
    //이어서 예약하기
    me.fnAddResv=function() {
        var args = me.pageObj.mst.exportData()[0]; 
        gfnClosePop();
        gfn.home.fnMakeResv(args.room_id, args.resv_dt, nvl(args.completion_time,args.end_time));    
    }
    

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>