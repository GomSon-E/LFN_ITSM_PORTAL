<style>.mainContent .framepage {
    margin: 1em;
    border-radius: 1em;
    padding: 1em;
    background-color: #ffffff5a !important;
} 

.mainContent .framepage .pageCond{  
    border-radius: 1em; 
}

.mainContent .pageContent .componentContainer {
    height: unset !important;
}
.calendar caption#mm {
    background-color: var(--navBG);
    font: var(--fontBig);
    color: var(--navColor);
}

.calendar thead th {
    background-color: whitesmoke;
    text-align: center;
    padding: 3px;
    width: calc(100% / 7);
}

.calendar thead th:nth-child(1) {
    background-color: orangered;
}

.calendar thead th:nth-child(7) {
    background-color: dodgerblue;
}

.calendar tbody td {
    min-height: 4em;
    height: 6em;
    line-height: 1;
    vertical-align: top;
    padding: 3px;
    border-bottom: 1px solid #aeaeae;
    border-right: 1px dashed #aeaeae;
    background-color: #ffffff50;
}

[pgmid='MRStatus'] .aweCalendar .calendar #top b {
    font: var(--fontBig);
    color: royalblue;
    font-weight: bold;
    font-size: 13px;
}

[pgmid='MRStatus'] .aweCalendar .calendar #top b:hover {
    font: var(--fontBig);
    color: #c2255c;
    cursor: pointer;
    font-weight: bold;
    font-size: 13px;
}

.calendar .resv:hover {
    border-radius: 2px;
    border: 1px solid #ffff004d;
    background-color: rgba(255,255,255,0.95);
    cursor: pointer;
}

.aweCalendar {
    overflow-x: auto;
}

.calendar .doResv {
    margin-left: 1em;
    font-size: smaller;
    color: royalblue; 
}

.calendar .doResv:hover {
    color: yellow;
    cursor: pointer;
}


[pgmid='MRStatus'].framepage .userClass { 
width:100%; 
}
[pgmid='MRStatus'] table#tb{
    font-size: 13px;
}

[pgmid='MRStatus'] .component table tbody td {
    padding: var(--marginSmall) 30px;
}
[pgmid='MRStatus'] .component table tbody td:last-child {
    text-align: center;
}
[pgmid='MRStatus'] .pageCond {
    display: flex;
    justify-content: space-between;
    padding: 16px 28px;
}
[pgmid='MRStatus'] p#nows{
    display: inline-block;
}
[pgmid='MRStatus'] .componentHeader{
    justify-content: center;
    font-size: 14px;
    padding: 4px 0;
}

[pgmid='MRStatus'] .component table tbody tr {
    height: 3.8em;
}
[pgmid='MRStatus'] div#pop {
    position: absolute;
    top: 35%;
    left: 10%;
    width: 80%; 
    background-color: white;
    z-index: 99;
    border: 1px solid #b9b9b9;
    border-radius: 16px;
    box-shadow: 1em 1em 1em rgba(30,30,30,0.5);
}

[pgmid='MRStatus'] #pop h2 {
    padding: 8px 16px;
    background-color: cornsilk;
    border-bottom: 5px solid darkgrey;
}
[pgmid='MRStatus'] #pop .pop_body {
    padding: 16px;
    font-size: 13px;
}
[pgmid='MRStatus'] #pop .pop_body p {
    padding-bottom: 8px;
}
[pgmid='MRStatus'] #pop input#attend {
    width: 20%;
}
[pgmid='MRStatus'] .btnArea {
    text-align: right;
}
/* [pgmid='MRStatus'] button#pop_btn {
    margin: 0 10px;
    padding: 4px 8px;
} */
[pgmid='MRStatus'] button {
    color: #fff;
    background-color: #727e8a;
    border-color: #727e8a;
    margin: 0 10px;
    padding: 6px 8px;
    border: none;
    border-radius: 6px;
    cursor:pointer;
}
[pgmid='MRStatus'] select#mr {
    box-sizing: border-box;
    width: 100px;
    padding: 4px;
    font-size: 14px;
    border-radius: 6px;
}
[pgmid='MRStatus'] select#dur-time {
    box-sizing: border-box;
    width: 72px;
    padding: 2px;
    font-size: 13px;
    border-radius: 6px;
}
[pgmid='MRStatus'] input {
    height: 24px;
    font-size: 13px;
    /*
    border: 0;
    border-radius: 15px;
    outline: none;
    */
    min-width: 150px;
    padding-left: 10px;
    background-color: rgb(233, 233, 233);
}


[pgmid='MRStatus'] .sectionHeader span {
    background-color: #707070;
    color: #fff;
    padding: 6px 12px;
    border-radius: 7px;
}


div#calendar{
    height:60vh !important;
    padding: 0 150px;
}
table.fc-col-header {
    width: 100% !important;
}
.fc-daygrid-body.fc-daygrid-body-unbalanced,
table.fc-scrollgrid-sync-table {
    width: 100% !important;
}
td.fc-daygrid-day.fc-day.fc-day-sat.fc-day-past, td.fc-daygrid-day.fc-day.fc-day-sat.fc-day-future { color:#0000FF; }     /* 토요일 */
td.fc-daygrid-day.fc-day.fc-day-sun.fc-day-past, td.fc-daygrid-day.fc-day.fc-day-sun.fc-day-future { color:#FF0000; }    /* 일요일 */
td.fc-daygrid-day.fc-day-today {color:rgb(9 164 255);}

/* 
td.fc-daygrid-day.fc-day.fc-day-sat.fc-day-past{ color:#0000FF; }     
td.fc-daygrid-day.fc-day.fc-day-sun.fc-day-past { color:#FF0000; } 
td.fc-daygrid-day.fc-day-today {color:rgb(9 164 255);}
table.fc-col-header {
    width: 100vw !important
}
.fc-daygrid-body.fc-daygrid-body-unbalanced, .fc-scrollgrid-sync-table{
    width: 100vw !important;
} */
@media (max-width: 480px)
{
    [pgmid='MRStatus'] .component table {
        width: 100%;
    }

    [pgmid='MRStatus'] .component table tbody td {
        padding: 5px 8px 5px 20px;
    }
    div#calendar{
        height:57vh !important;
        padding: 0;
    }
    table.fc-col-header {
        width: 100vw !important
    }
    .fc-daygrid-body.fc-daygrid-body-unbalanced, .fc-scrollgrid-sync-table{
        width: 100vw !important;
    }
    [pgmid='MRStatus'] div#pop {
        overflow: scroll;
    }
}</style>
<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageTop"></div>
<div class="pageCond"></div> 
<div class="pageContent"> 
    <div id='list'></div> 
</div>  
<!-- HTML back ---------------------------------------------- 
<div class="layer">
<div class="pageCond componentContainer" data-scroll>
    <h2>* 예약하기</h2> 
    <select id="mr">
        <option value="mr1">회의실1</option>
        <option value="mr2">회의실2</option>
        <option value="mr3">회의실3</option>
        <option value="mr4">회의실4</option>  
    </select>
</div>

<div id="grp">
    <div id='calendar' class="componentContainer" data-scroll></div>


    <div class="section componentContainer" data-scroll>
        <div class="sectionHeader">
            
        </div>
        <div class="sectionBody">
            <div class="component" style="flex:1 1 var(--navWidth)">
                <div class="componentHeader">
                    <h2><i class="fas fa-file"></i> <p class="date" id="nows" title="달력선택날짜"></p></h2> 
                    <a href="#" class="btn">View All</a> 
                </div>
                <table id = "tb">
                    <colgroup>
                        <col style="width:25%">
                        <col style="width:75%">
                    </colgroup>
                    <thead>
                        <tr>
                            <td>시간</td>
                            <td>회의목록</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id = "09" name="t9">
                            <td id="time">오전 9시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id = "10" name="t10">
                            <td id="time">오전 10시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="11" name="t11">
                            <td id="time">오전 11시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="12" name="t12">
                            <td id="time">오후 12시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="13" name="t13">
                            <td id="time">오후 1시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="14" name="t14">
                            <td id="time">오후 2시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="15" name="t15">
                            <td id="time">오후 3시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="16" name="t16">
                            <td id="time">오후 4시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="17" name="t17">
                            <td id="time">오후 5시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="18" name="t18">
                            <td id="time">오후 6시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="19" name="t19">
                            <td id="time">오후 7시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="20" name="t20">
                            <td id="time">오후 8시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="21" name="t21">
                            <td id="time">오후 9시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="22" name="t22">
                            <td id="time">오후 10시</td>
                            <td id="list"></td>
                        </tr>
                        <tr id="23" name="t23">
                            <td id="time">오후 11시</td>
                            <td id="list"></td>
                        </tr>
                    
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</div>


<div id="pop" style="display:none;">
    <div class="pop_inner">
        <p>팝업테스트</p>
        <button type="button" class="btn_close">닫기</button>
    </div>
</div -->

<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "m";
    var pgmid = "MRStatus"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":1.3,"upd_dt":"2022-09-20 14:27:38","remark":"","pgmid":"MRStatus","proc_mst_id":"","pgm_stat":"Y","sort_seq":22,"app_pgmid":"m","shortcut":"","reg_dt":"2022-09-20 14:27:38","reg_usid":"jjr","pgm_nm":"회의실현황","upd_usid":"jjr","pgm_tp":"TX","pgm_grp_nm":"스마트워크_회의실관리","proc_mst_nm":"","app_pgm_nm":"회의실예약시스템","":"트랜젝션(화면)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-search","reg_dt":"2022-09-20 14:27:38","reg_usid":"","func_nm":"검색","upd_usid":"","upd_dt":"2022-09-20 14:27:38","func_tp":"DB_R","remark":null,"pgmid":"MRStatus","sort_seq":"1","funcid":"search","content":null,"crud":"R","id":"0"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["pageCond"]={"sort_seq":"1","data_id":"pageCond","data_nm":"조회조건","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":"OUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"room_id","colnm":"회의실","dtype":"text","etype":"sel","attr":"keycol","defval":"\"1F01\"","w":null,"h":null,"refcd":"gds.rooms","option":"multi:room_id::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"resv_dt","colnm":"예약월","dtype":"text","etype":"txt","attr":"keycol","defval":"date(\"today\",\"yyyy-mm\")","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"}]};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"2","data_id":"list","data_nm":"회의실별 월별 예약내역","data_icon":null,"component_pgmid":"aweCalendar","component_option":{"caltype":"LFN","fnTemplate":"gfn.fnCalTemplate"},"inout_tp":"OUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"resv_dt","colnm":"일자","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"resv_nm","colnm":"회의명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"start_time","colnm":"시작시간","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"end_time","colnm":"종료시간","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"resv_stat","colnm":"상태","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"resv_no","colnm":"회의번호","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */
/*
    function onchangeDay(yy,mm,dd){ 
        document.querySelector("#nows").innerText= yy+"년"+mm+"월"+dd+"일"; 
    }
    // 오늘날짜 
    var today = new Date();
    var year = today.getFullYear(); 
    var month = today.getMonth() + 1;
    if(month<10) month = `0${month}`
    var date1 = today.getDate();
    if(date1<10) date1 = `0${date1}`
    var today_date = year+month+date1;
    var pickDate = '';
*/    
    /* 사용자초기화 */
    me.fnInitExtra=function() {
        gds.users.forEach(el=>{
            el.cd = el.usid;
        }) 
        gds.rooms.forEach(el=>{
            el.cd = el.room_id;
            el.nm = el.room_loc+" - "+el.room_nm;
        }) 
        if(gUserinfo.admin_yn=="Y") {
            me.dataDef._pgm_data["pageCond"].content[0].attr = "keycol"; //.replace(/readonly/gi,"");
        }
        //me.dataDef._pgm_data["pageCond"].content[2].attr = "keycol"; //.replace(/readonly/gi,"");
        delete me.pageObj.pageCond; 
        me.page.find(".pageCond *").remove();
        me.pageObj["pageCond"] = new gfnComponent( me.pageid, "pageCond", me.dataDef["_pgm_data"]["pageCond"], me.fnEH, me); 
        
        me.pageObj.pageCond.col['resv_dt'].obj.attr("type","month");
        me.pageObj.pageCond.setVal("resv_dt",date("today","yyyy-mm"));
        
        gfn.fnCalTemplate=function(data){
            return `<div class='resv' resv_no='${data.resv_no}'><span class='resv_term'>${data.start_time}~${data.end_time}</span> <span class='resv_stat'>${data.resv_stat}</span><br><b class='resv_nm'>${data.resv_nm}</b></div>`;
        }    
        
        me.pageObj.list.componentBody.on("click",".resv",function(e){
            var resv = $(e.target).exactObj(".resv");
            var ymd  = resv.exactObj("#body td").attr("id");
            var resv_no = resv.attr("resv_no"); 
            
            var PopLayer = $("<div class='awePopLayer'></div>");
            $("body").append(PopLayer);
        	var Pop = $("<div class='awePop'></div>");
        	PopLayer.append(Pop);
        	gParam.resv_no = resv_no;
        	gfnLoad("MRShowResvInfo",Pop,OUTVAR=>{
        		if(OUTVAR.rtnCd=="OK") {
        			console.log("예약 정보보기 Loaded!")
        		} 
        	},true); 
        });
        
        me.fnSearch(); 

    }
			
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //사용자 컴포넌트/컨트롤
        else if(component.userComponent=="myCompoId") {
            //if(evt=="dblclick" && col=="colid") {...}
        }
    }
    
    me.fnSearch=function() {
        if( !me.pageObj["pageCond"].chkValid() ) return;
        
        var args = me.pageObj["pageCond"].exportData()[0]; 
        var dtt = args.resv_dt;
        dtt = dtt.replace("-","")+"01";
        me.pageObj.list.initCalendar(dtt);  
        
        //console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                // if(OUTVAR.list.length==0) me.pageObj.list.initCalendar(args.resv_dt);
                // else me.pageObj["list"].importData(OUTVAR.list); 
                console.log(OUTVAR.list);
                me.pageObj["list"].importData(OUTVAR.list);
                
                /***캘린더공통 수정된뒤 현황 보이지 않아 다시 append해서 수정완료 _ 2022.08.02***/
                var commonarr =[];
				var num = OUTVAR.list.length;
				for(let i=0;i<=num;i++){
					commonarr.push(OUTVAR.list[i]); 
				}
				if((args.room_id).length > 1){ /* 회의실 여러개 조회시, 목록에 회의실 포함해서 뿌리기 22.10.11 */
				    for (let i=0 ;i<num;i++){
    				    me.page.find('#'+commonarr[i].ymd + ' #cont').text("");
    					//!isNull(commonarr[i]) ? me.page.find('#'+commonarr[i].ymd + ' #cont').append(`${commonarr[i].resv_stat}<br>${commonarr[i].resv_nm}<br>${commonarr[i].start_time}~${commonarr[i].end_time}`):"";
    				    !isNull(commonarr[i]) ? me.page.find('#'+commonarr[i].ymd).append(`<div class='resv' resv_no='${commonarr[i].resv_no}'><span class='resv_term'>${commonarr[i].start_time}~${commonarr[i].end_time} </span><span class='resv_stat'>${commonarr[i].resv_stat} </span><br><span class='room_loc'>${commonarr[i].room_loc} - </span><span class='room_nm'>${commonarr[i].room_nm}</span><br><b class='resv_nm'>${commonarr[i].resv_nm}</b></div><br>`):"";
    				}
				}else{
				    for (let i=0 ;i<num;i++){
    				    me.page.find('#'+commonarr[i].ymd + ' #cont').text("");
    				    !isNull(commonarr[i]) ? me.page.find('#'+commonarr[i].ymd).append(`<div class='resv' resv_no='${commonarr[i].resv_no}'><span class='resv_term'>${commonarr[i].start_time}~${commonarr[i].end_time} </span><span class='resv_stat'>${commonarr[i].resv_stat} </span><br><b class='resv_nm'>${commonarr[i].resv_nm}</b></div><br>`):"";
    				}
				}
				
                /**********************************************/
				
                setTimeout( function() {
                    me.page.find("tbody td > #top").each(function(idx,el){
                        var tdDay = $(el).parent("td");
                        var dt    = date(tdDay.attr("id"),"yyyymmdd"); 
                        var today = date("today");
                        if(dt >= today) {
                            $(el).children("span").remove();
                            var doResv = $("<span class='doResv' data-dt='"+dt+"'>예약하기</span>"); 
                            $(el).append(doResv);
                            doResv.on("click",function(e){
                                // var room_id = me.pageObj.pageCond.getVal("room_id"); 
                                // if(isNull(room_id)) {
                                //     gfnAlert("예약하기 확인","상단 조회조건에서 회의실을 선택한 후 클릭해주세요!");
                                //     return;
                                // }else if(room_id.length>1){
                                //     gfnAlert("회의실 확인","상단 조회조건에서 예약하려는 하나의 회의실만 선택해주세요.");
                                //     return;
                                // }
                                // var aymd    = date(dt,"yyyy-mm-dd","yyyymmdd");
                                // var start_time = "09:00";
                                // gfn.home.fnMakeResv(room_id, aymd, start_time);
                                gParam.dt = dt;
                                console.log("gParam.dt="+gParam.dt);
                                //$("[pgmid='MRStatus_TimeRoom'] #today .componentFunc .quickGuide").text(gParam.dt);
                                // me.fnCallback();
                                gfnLoad("MRStatus_TimeRoom",$(".mainContent"),OUTVAR=>{
                            		if(OUTVAR.rtnCd=="OK") {
                            			console.log("시간별 회의실별 현황 Loaded!")
                            		} 
                            	},true);
                            }); 
                        }
                        /*날짜클릭시 조회*/
                        var dDay = $(el).children("b");
                        dDay.on("click",function(e){
                            //console.log(dt);
                            gParam.dt = dt;
                            console.log("gParam.dt="+gParam.dt);
                            //$("[pgmid='MRStatus_TimeRoom'] #today .componentFunc .quickGuide").text(gParam.dt);
                            // me.fnCallback();
                            gfnLoad("MRStatus_TimeRoom",$(".mainContent"),OUTVAR=>{
                        		if(OUTVAR.rtnCd=="OK") {
                        			console.log("시간별 회의실별 현황 Loaded!")
                        		} 
                        	},true);
                        });
                        
                    });
                }, 1000);
                
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }
    
    me.fnSearchDay =function(date){
        var args = {};
        
        // args.resv_dt = '20220401'
        // args.resv_dt = date ? date: today_date; 
        if(date) args.resv_dt = date;
        else{
            //현황에서 넘어온 창이 아닐때는 오늘날짜 보여주기
            if(gParam.pickDate ){
                args.resv_dt = gParam.pickDate;
                var yy=gParam.pickDate.substr(0,4);
                var mm=gParam.pickDate.substr(4,2);
                var dd=gParam.pickDate.substr(6,2);
                onchangeDay(yy,mm,dd);
            }
            else{
                args.resv_dt = today_date;
                onchangeDay(year,month,date1);
            }
        }
        // args.room_id = 'mr1' //document.querySelector('select#mr').value //select change이벤트에도 적용
        args.room_id = document.querySelector('#mr option:checked').value;
        var room_nm = document.querySelector('#mr option:checked').text;
        document.querySelector('.sectionHeader').innerHTML = `<span>${room_nm}</span> 회의실 현황`
        
        console.log(args);
        var invar = JSON.stringify(args);

        gfnTx(appid+"."+pgmid,"searchday",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.rtnCd=="OK") {
                console.log(OUTVAR);
                var data = OUTVAR.list;
                //리셋
                document.querySelectorAll('tbody tr #list').forEach(function (item, index, arr) {
                    item.innerHTML = "";
                })
                //start_time, duration_time
                //user_id : 예약자
                //resv_nm : 회의명
                for(let i=0;i<data.length;i++){
                    document.querySelectorAll('tbody tr').forEach(function (item, index, arr) {
                        // console.log(item.querySelector('#list'));
                        if(data[i].resv_cd_stat !== 'N'){ //취소 아닐때
                            if(Number(data[i].start_time) == item.getAttribute('id')){
                                item.querySelector('#list').innerText = data[i].resv_nm +' / '+data[i].user_id;
                                if(Number(data[i].duration_time > 1)){
                                    //사용시간 1시간 이상이면 그에 맞게 뿌려줌
                                    let ci = index; 
                                    for(let j=1;j<Number(data[i].duration_time);j++){
                                        ci++;
                                        arr[ci].querySelector('#list').innerText = data[i].resv_nm +' / '+data[i].user_id;
                                    }
                                }
                            }
                        }
                    })
                }

                //예약 안잡혀있을시 예약하기 버튼띄우기
                document.querySelectorAll('tbody tr #list').forEach(function (item, index, arr) {
                    if(item.innerText === "" || item.innerText == undefined){
                        var btn = document.createElement('button');
                        btn.innerText = "예약하기";
                        btn.id = "resv";
                        btn.setAttribute("date",JSON.parse(invar).resv_dt);
                        btn.setAttribute("start-time",item.parentNode.getAttribute('id'));
                        btn.setAttribute("link","pop");
                        item.append(btn);
                    }
                })
                me.fnClickReserve();
            } else {
                gfnAlert("오류",OUTVAR.rtnMsg);
            }
        });
    }
    me.fnSearchRoom = function(){
        //document.querySelector('#mr option:checked').value
        var args = {};
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"searchroom",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.rtnCd=="OK") {
                console.log(OUTVAR);
                var data = OUTVAR.list;
                me.dataSet["rooms"] = data;
                var item = document.querySelector('select#mr');
                for(var i=0;i<data.length;i++){
                    var option = document.createElement('option');
                    option.value = data[i].room_id;
                    option.innerText = data[i].room_nm;
                    item.append(option);
                }

                var index = 0;
                if(gParam.pickRoom){
                    //회의실현황에서 연결된 회의실index찾아 값 selected
                    document.querySelectorAll('#mr option').forEach((val,i)=>{
                        if(val.getAttribute('value') == gParam.pickRoom) index = i;    
                    })
                }
                else{
                    // document.querySelector('#mr').options[0].selected = true; //mr1
                }
                document.querySelector('#mr').options[index].selected = true;

                //select 뿌려준 후 호출
                me.fnSearchDay();

            } else {
                gfnAlert("오류",OUTVAR.rtnMsg);
            }
        });

        var select = document.querySelector("#mr");
        select.addEventListener('change',()=>{
            console.log('change option');
            me.fnSearchDay(pickDate);
        });

    }

    me.fnClickReserve = function () {
        //예약하기 버튼클릭시 팝업호출
        //button#resv date, start-time 속성
        var resvBtn = document.querySelectorAll('button#resv');
        for(var i=0;i<resvBtn.length;i++){
            resvBtn[i].addEventListener('click',(e)=>{
                var tgt = e.target;
                var date = tgt.getAttribute('date');
                var startTime = tgt.getAttribute('start-time');
                me.fnDrawPop(tgt,date,startTime);
                targetLink = tgt.getAttribute('link');
                document.getElementById(targetLink).style.display = 'block';
                document.querySelector('.layer').style.pointerEvents = "none";
                document.querySelector('.layer').style.backgroundColor = "rgb(227, 227, 227)";
                // $('.layer').css("pointer-events","none");
            })
        }
    }

    me.fnDrawPop = function (tgt,date,startTime) {
        var pop = document.querySelector('#pop');
        var room = document.querySelector('#mr option:checked').text;
        // var head = document.createElement('h2');
        // h2.innerText = "회의실 예약하기"
        // pop.append(head);
        var dateSet = date.replace(/(\d{4})(\d{2})(\d{2})/g,'$1-$2-$3');
        var str = "";
        str += "<h2>회의실 예약하기</h2><div class='pop_body'>" ;
        str += `<p class="room">&nbsp;회 의 실 : ${room}</p>`;
        str += `<p class="day">일&nbsp; &nbsp; &nbsp; 자 &nbsp;: ${dateSet}</p>`;
        str += `<p class="start-time">시작시각 : ${startTime} 시</p>`;
        str += `<p>사용시간 : <select id ="dur-time"> </select> <span id="end-time"></span></p>`;
        str += `<p>참여인원 : <input id="attend"></input> 명</p>`;
        str += `<p>&nbsp;회 의 명 : <input id='resv_nm'></input></p>`;
        str += `<br/><br/><p>(예약시간이 되면 5분이내로 입실처리 해주셔야 합니다.)</p>`;
        str += '<p>예약을 진행하시겠습니까?</p></br></br>'

        str += '<div class="btnArea"><button type="button" id="pop_btn" class="btn_close">닫기</button>';
        str += '<button type="button" id="pop_btn" class="btn_save">확인</button></div></div>';
        pop.innerHTML = str;

        //select option 회의실당 최대시간까지 선택가능
        // function findMr(){
        //     for(let i=0; i<me.dataSet["rooms"].length; i++){
        //         if(me.dataSet["rooms"][i].room_nm == room) return me.dataSet["rooms"][i];
        //     }
        // }
        var select = document.querySelector('select#dur-time');
        // var roomId = document.querySelector('#mr option:checked').value;
        var max_time = 0;
        for(let mr of me.dataSet["rooms"]){
            if(mr.room_nm == room) max_time = Number(mr.max_time);
        }
        var option = "";
        for(let i=1; i<=max_time; i++){
            option += `<option value=${i}>${i}시간</option>`;
        }
        select.innerHTML = option;

        //change
        select.addEventListener('change',(e)=>{
            var dur_time = e.target.value;
            var end_time = document.querySelector('span#end-time');
            var time = Number(startTime)+Number(dur_time);
            if(time>24) end_time.innerText = "(24시를 넘었습니다.)";
            else end_time.innerText = '( '+time+' 시까지)'; 
            e.target.parentNode.append(end_time);
        })
        

        var popClose = document.querySelectorAll('.btn_close');
        for(var j=0;j<popClose.length;j++){
            popClose[j].addEventListener('click',(e)=>{
                console.log(e.target);
                // e.target.parentNode.parentNode.style.display = 'none';
                document.querySelector('#pop').style.display = 'none';
                document.querySelector('.layer').style.pointerEvents = "auto";
                document.querySelector('.layer').style.backgroundColor = "var(--mainBG)";
            })
        }

        var popSave = document.querySelector('.btn_save');
        popSave.addEventListener('click',(e)=>{
            me.fnSave(date,startTime);
        })
    }

    me.fnSave = function(date,startTime) {
        var roomId = document.querySelector('#mr option:checked').value;
        var result = confirm("예약하시겠습니까?");
        var pop = document.querySelector('#pop');
        var max_user = 0;
        for(let mr of me.dataSet["rooms"]){
            if(mr.room_id == roomId) max_user = Number(mr.max_user);
        }
        var attend = document.querySelector('input#attend').value;
        var resv_nm = document.querySelector('input#resv_nm').value;

        if(result){
            if(attend == ""||resv_nm== ""){
                gfnAlert("예약실패","참여인원 또는 회의명을 입력하지 않았습니다. 입력해주세요.");
            }    
            else if(max_user < attend){
                gfnAlert("예약실패","이 회의실의 최대 사용인원은 "+max_user+"명으로 제한되어 있습니다.");
            }     
            else{
                var dur_time = Number(document.querySelector('select#dur-time option:checked').value);
                var resv_btn = document.querySelectorAll('button#resv');
                startTime = Number(startTime);
                for(let i=startTime; i<startTime+dur_time; i++){    
                    if(document.querySelector('tr[name=t'+i+'] #list').innerText !== '예약하기'){
                        gfnAlert("예약실패",i+"시는 이미 예약되어 있는 시간입니다. 사용시간을 다시 선택해주세요.");
                        return;
                    }
                }
                //저장
                var args = {};
                args.resv_dt = date;
                args.room_id = roomId;
                args.start_time = startTime;
                args.duration_time = dur_time;
                args.resv_cd_stat = "D"; //처음 예약상태값
                args.user_id = gUserinfo.userid;
                args.resv_nm = resv_nm;
                args.attend = attend;
                //reg_usid, reg_dt, upd_usid, upd_dt

                var invar = JSON.stringify(args);
                gfnTx(appid+"."+pgmid,"save",{INVAR:invar},function(OUTVAR){
                    console.log(OUTVAR);
                    if(OUTVAR.rtnCd=="OK") {
                        console.log(OUTVAR);
                        gfnAlert("예약완료","예약되었습니다.");
                        document.querySelector('#pop').style.display = 'none';
                        document.querySelector('.layer').style.pointerEvents = "auto";
                        document.querySelector('.layer').style.backgroundColor = "var(--mainBG)";
                        //다시뿌려주기 
                        me.fnSearchDay();
                    } else {
                        gfnAlert("오류",OUTVAR.rtnMsg);
                    }
                });
            }
        }
    }




/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>