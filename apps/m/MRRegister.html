<style>[pgmid='MRRegister'].framepage .userClass { 
    width:100%; 
}
[pgmid='MRRegister'].framepage { 
    margin: var(--marginBig);
}
[pgmid='MRRegister'] .component .componentHeader{
    background-color : var(--mainBG);
    /*var(--mainBG);*/
}

.fa-arrow-left:before {
    content: "\f060";
    color : var(--colorWarn);
}

#btnSave{
    background-color : var(--colorWarn);
}

[pgmid='MRRegister'] .component{
    max-height: calc(3*(var(--tableMinHeight)));
}
 
[pgmid='MRRegister'] .component form { 
	row-gap: 0;
}

[pgmid='MRRegister'] .component form label { 
	flex-wrap : nowrap;
}

[pgmid='MRRegister'] .component::-webkit-scrollbar-thumb
{
    background: var(--colorWarn);
}

[pgmid='MRRegister'] .component form label textarea{ 
	align-content: left;
    text-align: left;
    align-items: left;
    justify-content:left;
    vertical-align: left;
}</style>
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent">
    <div id='det'>
        <div class="sectionBody"> 
            <div id="pageObj_Form" class="component" style="flex:1 1 var(--tableMinWidth)">
                <div class="componentHeader">
                    <a href="#" id = "btnBack" data-pgm="MRRegisterList"><i class="fas fa-arrow-left fa-3x"></i></a>
                    <a href="#" class="btn" id="btnSave"><i class="fas fa-save"></i> 저장</a>
                </div>
                <form> 
                    <label data-text="회의실 번호">
                        <input id="room_id" name="room_id" type="text">
                    </label>
                    <label data-text="회의실 명">
                        <input id="room_nm"  name="room_nm" type="text">
                    </label>
                    <!--<div class="form-inline form-group">-->
                    <label data-text="최대 사용 시간">
                        <input id="max_time"  name="max_time" type="number">
                    </label>
                    <label data-text="최대 인원수">
                        <input id="max_user"  name="max_user" type="number">
                    </label>
                    <label data-text="층수">
                        <select id="room_loc" name="room_loc">
                            <option label="1층">1층</option>
                            <option label="2층">2층</option>
                            <option label="3층">3층</option>
                            <option label="4층">4층</option>
                            <option label="5층">5층</option>
                            <option label="6층">6층</option>
                            <option label="7층">7층</option>
                            <option label="8층">8층</option>
                            <option label="9층">9층</option>
                        </select>
                    </label> 
                    <label data-text="위치 및 사용안내">
                        <textarea id="room_remark" name="room_remark" rows="4" cols="50" escapeXml="false">
위치: MTU빌딩 1층
회사/부서:
                        </textarea>
                    </label>
                    <label data-text="사용 제약구분">
                        <select id="limit_cd" name="limit_cd">
                            <option label="일반 회의실">일반 회의실</option>
                            <option label="5분 이내 사용 필요">5분 이내 사용 필요</option>
                        </select>
                    </label>
                    <label data-text="회의실 사진">
                        <!--<input id="icon_url"  name="icon_url" type="image">-->
                        <!--<input type="file" id="real-input" class="image_inputType_file" accept="img/*" required multiple>--> <!--style="display : none;"-->
                        <!--<button class="browse-btn">사진업로드</button>-->
                        <input id="real-input" type="file" accept="image/*" ><!--onchange="me.loadFile(event)"-->
                        <img id="output"/>
                    </label>
                    <canvas id="myCanvas" width="290" height="150">your canvas loads here</canvas>
                </form>
            </div>
            <form name="uploadForm" id="uploadForm" enctype="multipart/form-data" method="post" style="height:1px">
                <input type="file" id="fileSelector" multiple="multiple"/>
            </form>
        </div>
    </div>

</div>
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "m";
    var pgmid = "MRRegister"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":0.7,"upd_dt":"2022-05-12 10:39:43","remark":"","pgmid":"MRRegister","proc_mst_id":"","pgm_stat":"Y","sort_seq":999,"app_pgmid":"m","shortcut":"","reg_dt":"2022-04-06 22:04:40","reg_usid":"jjr","pgm_nm":"회의실등록","upd_usid":"kihyunlee","pgm_tp":"TX","pgm_grp_nm":"스마트워크_회의실관리","proc_mst_nm":"","app_pgm_nm":"회의실예약시스템","":"트랜젝션(화면)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":null,"reg_dt":"2022-04-06 22:04:40","reg_usid":"","func_nm":"저장","upd_usid":"","upd_dt":"2022-04-06 22:04:40","func_tp":"EH","remark":null,"pgmid":"MRRegister","sort_seq":"1","funcid":"save","content":null,"crud":"R","id":"0"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["det"]={"sort_seq":"1","data_id":"det","data_nm":"상세정보","data_icon":null,"component_pgmid":"FreeForm","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"mr_no","colnm":"회의실 번호","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"mr_nm","colnm":"회의실 명","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"mr_maxtime","colnm":"최대 사용시간","dtype":"num","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"location_mrinfo","colnm":"위치 및 사용안내","dtype":"text","etype":"tarea","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"restriction","colnm":"사용 제약구분","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"mr_image","colnm":"회의실 사진","dtype":"text","etype":"img","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */
  /* 사용자초기화 */
    me.fnInitExtra=function() {

        me.dataSet["image"] = [];

        const back = document.querySelector('#btnBack');
        back.addEventListener('click', function(e){
            //console.log("YES");
            if(!isNull(back.getAttribute("data-pgm"))) {
                const pgm = back.getAttribute("data-pgm");
                const mainContent = document.querySelector(".mainContent");
                gfnLoad(pgm,mainContent,OUTVAR=>{},true); 
            } else {  
                gfnAlert("테스트"+e.target.innerText,"토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b><br>토글 엄청나게 깜짝 놀랄일을 알려줄꺼야<br> <b>강조</b>");
            }
        });

        //회의실 정보 입력후 저장
        const save = document.querySelector('#btnSave');
        save.addEventListener('click', function(e){
            me.fnSave();
            me.submitFile();
        });

        //목록에서 가져온 회의실 id
        var room_id = sessionStorage.getItem("room_id");
        if(room_id != null){
            console.log(room_id);
            me.fnMrSearch(room_id);
            sessionStorage.clear();
        }
        
        const browseBtn = document.querySelector('.browse-btn');
        const realInput = document.querySelector('#real-input');

        realInput.addEventListener('change', ()=>{
            me.loadFile(event);
        })
    }

    me.loadFile = function(event) {
        var output = document.getElementById('output');
        output.src = URL.createObjectURL(event.target.files[0]);
        output.onload = function() {
            URL.revokeObjectURL(output.src); // free memory
        }
    };

    me.submitFile = function(){
        var formData = new FormData();
        var files = $('#fileSelector')[0].files;
        console.log(files);
        formData.append('file',files[0]);
        console.log(formData);
        
        $.ajax({
            url: 'awegtx.jsp?pgm=m.MRRegister&func=save',
            data: formData,
            type: 'POST',
            enctype : 'multipart/form-data',
            processData: false,
            contentType: false,
            dataType : 'json',
            cache : false,
            timeout: 60000,
            success: function (data) {
                alert("이미지 업로드 성공");
            }
        });
    }
    
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //det:상세정보 이벤트처리     
        else if(component==me.pageObj["det"]) {
            if(evt=="componentFunc") {
                if(row=="addRow") {
                    component.addRow();
                } else if(row=="delRow") {
                    component.delRow();
                }
            }
            //if(evt=="change" && col=="colid") {...}
        }

        //사용자 컴포넌트/컨트롤
        else if(component.userComponent=="myCompoId") {
            //if(evt=="dblclick" && col=="colid") {...}
        }
    }
    
    //save:저장 
    me.fnSave=function() {
        
        var con = confirm("입력한 회의실 정보를 저장하시겠습니까?");
        if(con){
            var args = {};
            var elements = document.querySelector("form").elements;
            for (const item of elements) {
                if(item.name=="max_time" || item.name=="max_user"){
                    args[item.name] = Number(item.value);
                }else{
                    args[item.name] = item.value;
                }
            }
            //var icon = document.querySelector('#real-input');
            //args.icon_url = output.src;

            //args.icon_url = "https://www.gocad.co.kr/files/attach/images/244/839/959/%ED%9A%8C%EC%9D%98%EC%8B%A4.jpg";
            console.log(args);
            //var select = document.getElementById("limit_cd");
            //console.log(select.value);
            
            var invar = JSON.stringify(args);
            gfnTx(appid+"."+pgmid,"save",{INVAR:invar},function(OUTVAR){
                //console.log(OUTVAR);
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("저장성공","입력한 정보가 저장되었습니다.");
                    console.log(OUTVAR);
                    //me.fnSearch();
                } else {
                    gfnAlert("저장오류",OUTVAR.rtnMsg);
                }
            });
        }
    }
    
    //각 회의실 세부정보 조회
    me.fnMrSearch = function(room_id){
        var args = {"room_id":room_id};
        console.log(args);
        
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"searchMr",{INVAR:invar},function(OUTVAR){
            //console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                var info = OUTVAR.list[0];
                console.log(info);
                var elements = document.querySelector("form").elements;
                //console.log(elements[0]);
                for (let j = 0; j<elements.length; j++) {
                    for(let i = 0; i<Object.keys(info).length; i++){
                        if(elements[j].name == Object.keys(info)[i]){
                            elements[j].value = info[Object.keys(info)[i]];
                        }
                    }
                }

                var myCanvas = document.getElementById("myCanvas");
                var myContext = myCanvas.getContext("2d");
                
                myCanvas.width="290"; // Optional
                myCanvas.height="150"; // Optional

                var myImage=new Image();
                
                myImage.src = info.icon_url;
                //myImage.src = "https://www.gocad.co.kr/files/attach/images/244/839/959/%ED%9A%8C%EC%9D%98%EC%8B%A4.jpg";
                //console.log(myImage.src);
                myImage.onload=function(){
                    myContext.drawImage(myImage,0,0,myCanvas.width,myCanvas.height);
                };


            } else {
                gfnAlert("오류",OUTVAR.rtnMsg);
            }
        });
    }

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>