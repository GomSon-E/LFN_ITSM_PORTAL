<style>[pgmid='detailManageProcess'].framepage .userClass { 
width:100%; 
}

[pgmid='detailManageProcess'] .flexColunm > * {
    flex: 0 0 auto;
}
[pgmid='detailManageProcess'] .flexColunm > *:last-child {
    flex: 1 1 auto;
    height: unset !important;
}

[pgmid='detailManageProcess'] .uploadedFile {
    margin: 30px 0;
}

[pgmid='detailManageProcess'] .commDiv button {
    display:inline-block;
    color:white;
    font-weight: bold;
    cursor:pointer;
    background-color:#3e3e3a;
    border: none;
    border-radius:0.25rem;
    padding:.125rem 0.5rem; 
    height:1.75rem;
    vertical-align:bottom;
    font-size:0.75rem;    
    white-space: nowrap;
    text-overflow: ellipsis;
}
[pgmid='detailManageProcess'] #dropZone {
    margin-top: 5px;
    min-height: 80px;
    border : 1px solid rgb(204, 204, 204); 
}
[pgmid='detailManageProcess'] #dropZone #fileDragDesc {
    margin: 10px;
}
[pgmid='detailManageProcess'] #dropZone #fileDragDesc .fileList:hover {
    text-decoration: underline;
	cursor : pointer;
}
[pgmid='detailManageProcess'] #dropZone > tr > td {
    margin-right : 5px;
}


[pgmid='detailManageProcess'] #myCommArea {
    width: 98%;
    height: 70px;
    margin-bottom : 20px;
    resize: none;
    padding: 5px;
}
[pgmid='detailManageProcess'] .CommListDiv .bbsComm {
    font-size: 1.1em;
    padding: 10px 5px 10px 5px;
    margin-bottom : 2px;
    border-bottom : 1px solid rgb(231, 228, 228);
}
[pgmid='detailManageProcess'] .CommListDiv textarea {
    width : 98%; 
    height : 60px;
    padding: 5px; 
    margin-bottom : 10px; resize : none;
}
[pgmid='detailManageProcess'] .CommListDiv .bbsComm span{
    margin-right : 20px;
}
[pgmid='detailManageProcess'] .CommListDiv button {
    margin-right: 10px;
}
[pgmid='detailManageProcess'] .comments{
    margin-top:10px; 
    margin-bottom:10px;
}

[pgmid='detailManageProcess'] button.insertCommBtn {
    float: right;
    margin-right: 0px !important;
}
</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageTop"></div>
<div class="pageGuide"></div>
<div class="pageContent flexColumn">
    <div id='mst' ></div>
    <div class="uploadedFile">
        <div style="width:100%;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;align-items:center;">
            <div>
                <i class="fas fa-file-alt"></i><span>&nbsp;&nbsp;내역 첨부파일</span>
            </div>    
            <div class="uploadedFileBtn"> 
            </div>
        </div>
        
        <div id="dropZone">
            <div id="fileDragDesc"> 업로드된 파일이 없습니다. </div>
        </div>
    </div>
    <!--<div id='filelist'></div>-->
    
    <div class="commDiv">
        <div class="insertCommDiv">
            <h2>댓글</h2>
            <form>
                <textarea type="text" id="myCommArea" placeholder="댓글을 입력하세요"></textarea>
                <br>
                <button type="button" class="insertCommBtn" >댓글 작성</button>
            </form>
        </div>
        <div class="CommListDiv">
        </div>
    </div>

</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "dt_pms";
    var pgmid = "detailManageProcess"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":0.7,"upd_dt":"2022-05-30 18:24:29","remark":"","pgmid":"detailManageProcess","proc_mst_id":"","pgm_stat":"Y","sort_seq":2,"app_pgmid":"dt_pms","shortcut":"","reg_dt":"2022-05-30 18:24:29","reg_usid":"kihyunlee","pgm_nm":"프로세스 상세페이지","upd_usid":"kihyunlee","pgm_tp":"TX","pgm_grp_nm":"업무분석","proc_mst_nm":"","app_pgm_nm":"전사DT/PI","":"트랜젝션(화면)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-save","reg_dt":"2022-05-30 18:24:29","reg_usid":"","func_nm":"저장","upd_usid":"","upd_dt":"2022-05-30 18:24:29","func_tp":"DB_W","remark":null,"pgmid":"detailManageProcess","sort_seq":"1","funcid":"save","content":"프로세스 저장","crud":"R","id":"0"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["mst"]={"sort_seq":"1","data_id":"mst","data_nm":"내역","data_icon":null,"component_pgmid":"aweForm","component_option":{"func":[{"funcid":"upload","func_nm":"파일업로드","func_icon":"fas fa-image"}]},"inout_tp":"INOUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"sort_seq","colnm":"No","dtype":"num","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":"프로세스","colid":"proc_lv_1","colnm":"레벨1","dtype":"text","etype":"txt","attr":"rowSpan","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":"프로세스","colid":"proc_lv_2","colnm":"레벨2","dtype":"text","etype":"txt","attr":"rowSpan","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":"프로세스","colid":"proc_lv_3","colnm":"레벨3","dtype":"text","etype":"txt","attr":"rowSpan","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":"프로세스","colid":"proc_lv_4","colnm":"레벨4","dtype":"text","etype":"txt","attr":"rowSpan","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"purpose","colnm":"목적","dtype":"text","etype":"tarea","attr":null,"defval":null,"w":"25","h":"3","refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"role","colnm":"직무","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"content","colnm":"업무내용","dtype":"text","etype":"tarea","attr":null,"defval":null,"w":"50","h":"5","refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":null,"colid":"in_desc","colnm":"INPUT","dtype":"text","etype":"tarea","attr":null,"defval":null,"w":"50","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":10,"section":null,"section_icon":null,"colgrp":null,"colid":"out_desc","colnm":"산출물","dtype":"text","etype":"tarea","attr":null,"defval":null,"w":"50","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":11,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"정책/제약","dtype":"text","etype":"tarea","attr":null,"defval":null,"w":"25","h":"3","refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"},{"sort_seq":12,"section":null,"section_icon":null,"colgrp":null,"colid":"term","colnm":"업무주기","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"11"},{"sort_seq":13,"section":null,"section_icon":null,"colgrp":"작성정보","colid":"reg_usid","colnm":"등록자","dtype":"text","etype":"sel","attr":"disabled","defval":null,"w":null,"h":null,"refcd":"USID","option":"sel:reg_usid::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"12"},{"sort_seq":14,"section":null,"section_icon":null,"colgrp":"작성정보","colid":"reg_dt","colnm":"등록일시","dtype":"text","etype":"raw","attr":"disabled","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"13"},{"sort_seq":15,"section":null,"section_icon":null,"colgrp":"작성정보","colid":"upd_usid","colnm":"변경자","dtype":"text","etype":"sel","attr":"disabled","defval":null,"w":null,"h":null,"refcd":"USID","option":"sel:upd_usid::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"14"},{"sort_seq":16,"section":null,"section_icon":null,"colgrp":"작성정보","colid":"upd_dt","colnm":"수정일시","dtype":"text","etype":"raw","attr":"disabled","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"15"}]};
me.dataDef["_pgm_data"]["filelist"]={"sort_seq":"2","data_id":"filelist","data_nm":"업로드 파일목록","data_icon":"fas fa-list","component_pgmid":"agGrid","component_option":{"gridOpt":"rn chk","gridOptions":{"statusBar":"false"},"func":[{"funcid":"delRow","func_nm":"선택파일삭제","func_icon":"fas fa-minus"}]},"inout_tp":"INOUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"fileid","colnm":"파일ID","dtype":"text","etype":"raw","attr":"pk","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"orgn_nm","colnm":"등록파일명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"file_ext","colnm":"확장자","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"file_url","colnm":"파일주소","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"file_dir","colnm":"파일경로","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"file_sz","colnm":"파일크기","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"sort_seq","colnm":"정렬순서","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"download","colnm":"다운로드","dtype":"text","etype":"btn","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */
var file_tp = "PROCESS_ATTCH";
var ref_file_tp = "T_PROC_MST";
    /* 사용자초기화 */
    me.fnInitExtra=function() {
        me.fnsearch = gObj.fnsearch;
        me.dataSet["FileList"] = [];
        me.dataSet["CommList"] = [];
        
        var arg = gObj["rowData"];
        arg.docid = gObj["docid"];
        
        me.pageObj["mst"].importData(arg);
        var invar = JSON.stringify(arg);

        
        gfnTx(appid+"."+pgmid,"searchFile",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.rtnCd=="OK") {
                me.pageObj["filelist"].importData(OUTVAR.fileRes);
                for (let i = 0; i < OUTVAR.fileRes.length; i++) {
                    const el = OUTVAR.fileRes[i];
                    var FileList = {
                        fileid: el.fileid,
                        file_tp: el.file_tp,
                        file_nm: el.file_nm,
                        filename: el.orgn_nm,
                        fileSize: el.file_sz,
                        file_dir: el.file_dir,
                        file_url: el.file_url
                    };
                    me.dataSet["FileList"].push(FileList);
                    me.fnDrawFileList(gObj["docid"]);
                };
                
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
        
        // 댓글 작성 버튼 클릭시 이벤트 발생
        $(".insertCommBtn").on("click", function(e) {
            me.fnInsertComm(arg.docid);
        });
        
        //댓글 조회
        gfnTx(appid+"."+pgmid, "selectComm", {INVAR : invar}, function(OUTVAR){
            for (let i = 0; i < OUTVAR.list.length; i++) {
                const el = OUTVAR.list[i];
                var CommList = {
                    docid: el.ref_id,
                    commid: el.val_1,
                    comments: el.comments,
                    reg_usid: el.reg_usid,
                    dt: el.reg_dt,
                    reg_nm: el.nm
                };
                me.dataSet["CommList"].push(CommList);
                me.fnDrawCommList(arg.docid);
            };
        });
        
        //form TextArea resizable 
        me.pageObj.mst.componentBody.find("textarea").css("resize","vertical");
        me.page.find("button[funcid='upload']").appendTo(".uploadedFileBtn");
        
    }
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //mst:내역 이벤트처리     
        else if(component==me.pageObj["mst"]) {
            if(evt=="componentFunc") {
                if(row=="upload") {
                    gfnUpload(gObj["docid"], file_tp, ref_file_tp, function(arrFiles) {
                        //저장된 파일목록(arrFiles)을 사용하여 첨부파일 목록을 Refresh한다.
                        me.dataSet["FileList"] = []; 
                        if(arrFiles.length > 0) {
                            for (let i = 0; i < arrFiles.length; i++) {
                                const el = arrFiles[i];
                                var FileList = {
                                    fileid: el.fileid,
                                    file_tp: el.file_tp,
                                    file_nm: el.file_nm,
                                    filename: el.orgn_nm,
                                    fileSize: el.file_sz,
                                    file_dir: el.file_dir,
                                    file_url: el.file_url
                                };
                                me.dataSet["FileList"].push(FileList);
                                me.fnDrawFileList(gObj["docid"]);
                            };
                        } else {
                            page.find("#dropZone #fileDragDesc").html("");
                            page.find("#dropZone #fileDragDesc").append("업로드된 파일이 없습니다.");
                        }
                    });
                }
            }
        }

        //filelist:업로드 파일목록 이벤트처리     
        else if(component==me.pageObj["filelist"]) {
            if (evt=="click" && col=="download") {
                var rows = me.pageObj.filelist.selectedRows();
                var rowData = me.pageObj.filelist.getRowData(rows);
                var url = rowData.file_url;
                var filename = rowData.orgn_nm;
                function fnDownload(url,filename) {
                    var frm = $("<form action='/awegtx.jsp?pgm=aweportal.fileDownloader' target='_blank' " +
                                " method='POST' style='display:none'></form>");
                    var args = {url:url, filename:filename};
                    var sArgs = JSON.stringify(args);
                    frm.append("<input type='text' name='INVAR' value='"+sArgs+"'>");
                    frm.appendTo("#"+pageid);
                    frm.submit();
                }
                fnDownload(url,filename);
            }
        }

        //사용자 컴포넌트/컨트롤
        else if(component.userComponent=="myCompoId") {
            //if(evt=="dblclick" && col=="colid") {...}
        }
    }
    //save:저장 
    me.fnSave=function() {
        if( !me.pageObj["mst"].chkValid() ) return;
        var args = me.pageObj["mst"].exportData()[0];
        var docid = gObj["docid"];
        args.docid = docid;

        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"saveRes",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.rtnCd=="OK") {
                gfnAlert("저장성공","처리내역이 저장되었습니다.");
                me.fnsearch();
            } else {
                gfnAlert("저장오류",OUTVAR.rtnMsg);
            }
        });
    }
    
    
    // 파일 목록 조회 메소드
    me.fnDrawFileList= function(docid) {
        $("#dropZone #fileDragDesc").html("");
        $.each(me.dataSet["FileList"],function(idx,el) {
            var fileList = $(`<tr class="fileList" url='${el.file_url}' filename='${el.filename}'>`);
            fileList.append(`<td class="filename"><b>${el.filename}</b>&nbsp&nbsp&nbsp</td>`);
            if(el.fileSize > 1000000) { 
                var convertedSize = Math.round(el.fileSize/1000000);
                fileList.append(`<td class="fileSize">${convertedSize} MB</td>`);
            }
            else {
                var convertedSize = el.fileSize/1000;
                fileList.append(`<td class="fileSize">${convertedSize} KB</td>`);
            }
            fileList.append(`</tr>`);
            page.find("#dropZone #fileDragDesc").append(fileList);
    
            fileList.on("click", function(e){
                var oE = $(e.target);
                var oTR = oE.exactObj("tr[url]"); 
                var url = oTR.attr("url");
                var filename = oTR.attr("filename");
                gfnDownloadDirect(url, filename);
            }); 
        });
    }
    
    
    // 게시글에 달린 댓글 조회 메소드
    me.fnDrawCommList= function(docid) {
        var userid = gUserinfo.userid;
        page.find(".CommListDiv").html("");
        console.log(me.dataSet["CommList"]);
        $.each(me.dataSet["CommList"],function(idx,el) {
            console.log('each',el);
            var html = $(`<div id="updateCommDiv${el.commid}" style="display : none; margin-bottom : 20px;">`);
            html.append(`<textarea class="updateArea${el.commid}" placeholder="수정할 내용을 입력하세요"></textarea>`);
            html.append(`<br>`);
            html.append(`<button type='button' class='updateCommBtn' >댓글 수정</button>`);
            html.append(`<button type='button' class='returnBtn' >취소</button>`);
            html.append(`</div>`);
            
            var newComm = $(`<div id="${el.commid}" class="bbsComm" docid='${el.docid}'>`);
            newComm.append(`<i class="fas fa-user-circle"></i><span class="commReg_nm">&nbsp;<b>${el.reg_nm}</b></span>`);
            newComm.append(`<span class="commDt">${el.dt}</span><br>`);
            newComm.append(`<div class="comments">${el.comments}</div>`);
            newComm.append(html);
            newComm.append(`<button class="commUpdate" id="${idx}">수정</button>`);
            newComm.append(`<button class="commDelete" id="${idx}">삭제</button>`);
            newComm.append(`</div>`);
            page.find(".CommListDiv").append(newComm);
    
            // 댓글은 관리자와 작성자만 수정, 삭제 권한 부여
            if(userid != "admin" && userid != el.reg_usid) {
                $("#"+idx + ".commUpdate").hide();
                $("#"+idx + ".commUpdate").prop("disabled", true);
                $("#"+idx + ".commDelete").hide();
                $("#"+idx + ".commDelete").prop("disabled", true);
            };
            // 댓글 삭제 버튼 클릭시 이벤트 발생
            newComm.on("click",".commDelete", function(e){
                var oE = $(e.target);
                var oTR = oE.exactObj("div[id]");
                var arg = {commid : oTR.attr("id")};
                invar = JSON.stringify(arg);
                if(oTR.length != 1) return;
                gfnConfirm("삭제 확인","댓글을 삭제 하시겠습니까?", function(confirm){
                    if(confirm) {
                        gfnTx(appid+"."+pgmid, "deleteComm", {INVAR : invar}, function(OUTVAR) {});
                        $("#"+oTR.attr("id")).remove();
                    }
                });
            });
            // 댓글 수정 버튼 클릭시 이벤트 발생
            newComm.on("click",".commUpdate", function(e){
                var oE = $(e.target);
                var oTR = oE.exactObj("div[id]");
                var commDivId = oTR.attr("id");
                $(" .CommListDiv #updateCommDiv" + commDivId).show();
                $(" .CommListDiv #" + commDivId + " .commUpdate").hide();
                $(" .CommListDiv #" + commDivId + " .commDelete").hide();
                if(oTR.length != 1) return;
                $(" .CommListDiv #updateCommDiv" + commDivId + " .updateCommBtn").on("click", function(e) {
                    var comments = $(" .CommListDiv .updateArea" + commDivId).val();
                    comments = comments.replace(/(?:\r\n|\r|\n)/g, '<br />');
                    if(isNull(comments) || comments == undefined) {
                        gfnAlert("수정 실패", "댓글 내용을 입력해 주세요.");
                        return;
                    }
                    else {
                        me.fnUpdateComm(comments, commDivId);
                        $("#"+ commDivId + " .comments").html(comments);
                    }
                    $(" .CommListDiv #updateCommDiv" + commDivId).hide();
                    $(" .CommListDiv #" + commDivId + " .commUpdate").show();
                    $(" .CommListDiv #" + commDivId + " .commDelete").show();
                });
            });
            newComm.on("click", ".returnBtn", function(e) {
                var oE = $(e.target);
                var oTR = oE.exactObj("div[id]");
                var commDivId = oTR.attr("id");
                $("#"+commDivId).hide();
                var commAreaId = commDivId.split("updateCommDiv")[1];
                $(" .CommListDiv #" + commAreaId + " .commUpdate").show();
                $(" .CommListDiv #" + commAreaId + " .commDelete").show();
                $(" .CommListDiv #updateArea" + commAreaId).val("");
            });
        });
    }
    
    
    // 댓글 작성 메소드
    me.fnInsertComm= function(docid) {
        var userid = gUserinfo.userid;
        var usernm = gUserinfo.usernm;
        var comments = $("#myCommArea").val();
        comments = comments.replace(/(?:\r\n|\r|\n)/g, '<br />');
        var ref_info_tp = "T_PROC_MST";
        var arg = {docid : docid, ref_info_tp: ref_info_tp, comments : comments};
        var invar = JSON.stringify(arg);
        var sysdate = new Date();
        var sDate = dateFormat(sysdate);
        if(!isNull(comments)){
            gfnTx(appid+"."+pgmid, "insertComm",{INVAR : invar}, function(OUTVAR){
                var html = $(`<div id="updateCommDiv${OUTVAR.commid}" style="display : none; margin-bottom : 20px;">`);
                html.append(`<textarea class="updateArea${OUTVAR.commid}" placeholder="수정할 내용을 입력하세요" style="width : 90%; height : 60px; margin-bottom : 10px; resize : none;"></textarea>`);
                html.append(`<br>`);
                html.append(`<button type='button' class='updateCommBtn' >댓글 수정</button>`);
                html.append(`<button type='button' class='returnBtn' >취소</button>`);
                html.append(`</div>`);
    
                var newComm = $(`<div id="${OUTVAR.commid}" class="bbsComm" docid='${docid}'>`);
                newComm.append(`<i class="fas fa-user-circle"></i><span class="commReg_nm">&nbsp;<span class="commReg_usid"><b>${usernm}</b></span>`);
                newComm.append(`<span class="commDt">${sDate}</span><br>`);
                newComm.append(`<div class="comments">${comments}</div>`);
                newComm.append(html);
                newComm.append(`<button class="commUpdate">수정</button>`);
                newComm.append(`<button class="commDelete">삭제</button>`);
                newComm.append(`</div>`);
                page.find(".CommListDiv").append(newComm);
                $(" #myCommArea").val("");
    
                // 댓글 삭제 버튼 클릭시 이벤트 발생
                newComm.on("click",".commDelete", function(e){
                    var oE = $(e.target);
                    var oTR = oE.exactObj("div[id]");
                    var arg = {commid : oTR.attr("id")};
                    invar = JSON.stringify(arg);
                    if(oTR.length != 1) return;
                    gfnConfirm("삭제 확인","댓글을 삭제 하시겠습니까?", function(confirm){
                        if(confirm) {
                            gfnTx(appid+"."+pgmid, "deleteComm", {INVAR : invar}, function(OUTVAR) {});
                            $("#"+oTR.attr("id")).remove();
                        }
                    });
                });
                // 댓글 수정 버튼 클릭시 이벤트 발생
                newComm.on("click",".commUpdate", function(e){
                    var oE = $(e.target);
                    var oTR = oE.exactObj("div[id]");
                    var commDivId = oTR.attr("id");
                    $(" .CommListDiv #updateCommDiv" + commDivId).show();
                    $(" .CommListDiv #" + commDivId + " .commUpdate").hide();
                    $(" .CommListDiv #" + commDivId + " .commDelete").hide();
                    if(oTR.length != 1) return;
                    $(" .CommListDiv #updateCommDiv" + commDivId + " .updateCommBtn").on("click", function(e) {
                        var comments = $(" .CommListDiv .updateArea" + commDivId).val();
                        comments = comments.replace(/(?:\r\n|\r|\n)/g, '<br />');
                        if(isNull(comments) || comments == undefined) {
                            gfnAlert("수정 실패", "댓글 내용을 입력해 주세요.");
                            return;
                        }
                        else {
                            me.fnUpdateComm(comments, commDivId);
                            $("#"+ commDivId + " .comments").html(comments);
                        }
                        $(" .CommListDiv #updateCommDiv" + commDivId).hide();   
                        $(" .CommListDiv #" + commDivId + " .commUpdate").show();
                        $(" .CommListDiv #" + commDivId + " .commDelete").show();
                    });
                });
                newComm.on("click", ".returnBtn", function(e) {
                    var oE = $(e.target);
                    var oTR = oE.exactObj("div[id]");
                    var commDivId = oTR.attr("id");
                    $("#"+commDivId).hide();
                    var commAreaId = commDivId.split("updateCommDiv")[1];
                    $(" .CommListDiv #" + commAreaId + " .commUpdate").show();
                    $(" .CommListDiv #" + commAreaId + " .commDelete").show();
                    $(" .CommListDiv #updateArea" + commAreaId).val("");
                });
            })
        } 
        else {
            gfnAlert("등록 실패", "내용을 입력해 주세요.");
            return;
        }
        
        // 날짜 형식 메소드
        function dateFormat(date) {
            let month = date.getMonth() + 1;
            let day = date.getDate();
            let hour = date.getHours();
            let minute = date.getMinutes();
            let second = date.getSeconds();
        
            month = month >= 10 ? month : '0' + month;
            day = day >= 10 ? day : '0' + day;
            hour = hour >= 10 ? hour : '0' + hour;
            minute = minute >= 10 ? minute : '0' + minute;
            second = second >= 10 ? second : '0' + second;
        
            return date.getFullYear() + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;
        }
    }
    
    // 댓글 수정 메소드
    me.fnUpdateComm= function(comments, commid) {
        var args = {comments:comments, commid:commid};
        var invar = JSON.stringify(args);
        gfnTx("aweportal.manageBBS", "updateComm", {INVAR : invar}, function(OUTVAR){
            if(OUTVAR.rtnCd != "OK") {
                gfnAlert("수정 실패", "수정에 실패하였습니다.");
                return;
            } 
        });
    }

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>