
<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent flexRow">
    <div id="list" style="flex:1 1 30%" class="flexColumn"></div>
    <div style="flex:1 1 calc( 70% - 2em )" class="flexColumn" >
        <div id="tbl"></div>
        <div id="colist" class="flexColumn"></div>
    </div>
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "workbench";
    var pgmid = "migrateTable"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"pgmid":"migrateTable","pgm_nm":"데이터이관","pgm_tp":"UX","proc_mst_id":"","proc_mst_nm":"","remark":"","ver":0.08,"pgm_stat":"Y","reg_usid":"lkh","reg_dt":"2021-10-12 15:39:45","upd_usid":"lkh","upd_dt":"2021-10-12 15:39:45","app_pgmid":"workbench","pgm_grp_nm":"시스템개발","sort_seq":1,"shortcut":"","crud":"","app_pgm_nm":"개발워크벤치"};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-search","reg_dt":"2021-10-12 15:39:45","reg_usid":"","func_nm":"조회","upd_usid":"","upd_dt":"2021-10-12 15:39:45","func_tp":"DB_R","remark":null,"pgmid":"migrateTable","sort_seq":"1","funcid":"search","content":"테이블목록 조회","crud":"R"},{"func_icon":"fas fa-database","reg_dt":"2021-10-12 15:39:45","reg_usid":"","func_nm":"개발->운영","upd_usid":"","upd_dt":"2021-10-12 15:39:45","func_tp":"DB_W","remark":null,"pgmid":"migrateTable","sort_seq":"10","funcid":"export","content":null,"crud":"R"},{"func_icon":"fas fa-database","reg_dt":"2021-10-12 15:39:45","reg_usid":"","func_nm":"운영->개발","upd_usid":"","upd_dt":"2021-10-12 15:39:45","func_tp":"DB_W","remark":null,"pgmid":"migrateTable","sort_seq":"11","funcid":"import","content":null,"crud":"R"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"1","data_id":"list","data_nm":"테이블목록","data_icon":null,"component_pgmid":"agGrid","component_option":{"height":"56.7em","remark":"더블클릭하면 테이블 정보를 조회할 수 있습니다."},"inout_tp":"OUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"sort_seq","colnm":"No.","dtype":"num","etype":"raw","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"5","h":null},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"t_id","colnm":"테이블ID","dtype":"text","etype":"raw","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"8","h":null},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"tbl_nm","colnm":"테이블명","dtype":"text","etype":"raw","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고","dtype":"text","etype":"raw","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"15","h":null}]};
me.dataDef["_pgm_data"]["tbl"]={"sort_seq":"2","data_id":"tbl","data_nm":"테이블정보","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":"INOUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"sort_seq","colnm":"정렬순서","dtype":"num","etype":"txt","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"3","h":null},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"t_id","colnm":"테이블ID","dtype":"text","etype":"txt","attr":"pk","len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"tbl_nm","colnm":"테이블명","dtype":"text","etype":"txt","attr":"keycol","len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"25","h":null},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고","dtype":"text","etype":"tarea","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"50","h":"5"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"val_1","colnm":"정보영역","dtype":"text","etype":"txt","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"val_2","colnm":"특이사항","dtype":"text","etype":"txt","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"15","h":null},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"val_3","colnm":"제약사항","dtype":"text","etype":"txt","attr":null,"len":null,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"15","h":null},{"sort_seq":8,"section":"개발","section_icon":"fas fa-exclamation-triangle","colgrp":null,"colid":"dev_col_cnt","colnm":"컬럼수","dtype":"num","etype":"raw","attr":null,"defval":null,"w":8,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":9,"section":"개발","section_icon":"fas fa-exclamation-triangle","colgrp":null,"colid":"dev_row_cnt","colnm":"Row수","dtype":"num","etype":"raw","attr":null,"defval":null,"w":8,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":10,"section":"운영","section_icon":"fas fa-exclamation-triangle","colgrp":null,"colid":"prod_col_cnt","colnm":"컬럼수","dtype":"num","etype":"raw","attr":null,"defval":null,"w":8,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":11,"section":"운영","section_icon":"fas fa-exclamation-triangle","colgrp":null,"colid":"prod_row_cnt","colnm":"Row수","dtype":"num","etype":"raw","attr":null,"defval":null,"w":8,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"}]};
me.dataDef["_pgm_data"]["colist"]={"sort_seq":"3","data_id":"colist","data_nm":"컬럼목록","data_icon":null,"component_pgmid":"agGrid","component_option":{"height":"39em","func":[{"funcid":"colNm","func_nm":"컬럼정보","func_icon":"fas fa-search"},{"funcid":"addRow","func_nm":"줄추가","func_icon":"fas fa-plus"},{"funcid":"delRow","func_nm":"줄삭제","func_icon":"fas fa-minus"}]},"inout_tp":"INOUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"sort_seq","colnm":"No.","dtype":"num","etype":"txt","attr":"fixL","len":"5","defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"5","h":null},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"col_id","colnm":"컬럼ID","dtype":"text","etype":"txt","attr":"pk fixL","len":30,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"8","h":null},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"col_nm","colnm":"컬럼명","dtype":"text","etype":"txt","attr":"fixL","len":30,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":"입력","colid":"remark","colnm":"비고","dtype":"text","etype":"tarea","attr":null,"len":100,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"10","h":null},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"datatype","colnm":"데이터타입","dtype":"text","etype":"txt","attr":null,"len":20,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"7","h":null},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"not_null","colnm":"NotNull","dtype":"text","etype":"cbx","attr":null,"len":"2","defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"3","h":null},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"def_val","colnm":"기본값","dtype":"text","etype":"txt","attr":null,"len":50,"defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"5","h":null},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"pk_seq","colnm":"PK","dtype":"num","etype":"txt","attr":null,"len":"2","defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"3","h":null},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":null,"colid":"ix_01","colnm":"IDX#1","dtype":"num","etype":"txt","attr":null,"len":"2","defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"3","h":null},{"sort_seq":10,"section":null,"section_icon":null,"colgrp":null,"colid":"ix_02","colnm":"IDX#2","dtype":"num","etype":"txt","attr":null,"len":"2","defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"3","h":null},{"sort_seq":11,"section":null,"section_icon":null,"colgrp":null,"colid":"ix_03","colnm":"IDX#3","dtype":"num","etype":"txt","attr":null,"len":"2","defval":null,"refcd":null,"option":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"3","h":null},{"sort_seq":12,"section":null,"section_icon":null,"colgrp":"입력","colid":"val_1","colnm":"C1","dtype":"text","etype":"txt","attr":"auto","len":"10","defval":null,"refcd":"DICT","option":"sel:val_1::nm","valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"7","h":null},{"sort_seq":13,"section":null,"section_icon":null,"colgrp":"입력","colid":"val_2","colnm":"C2","dtype":"text","etype":"txt","attr":"auto","len":"10","defval":null,"refcd":"DICT","option":"sel:val_2::nm","valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"7","h":null},{"sort_seq":14,"section":null,"section_icon":null,"colgrp":"입력","colid":"val_3","colnm":"C3","dtype":"text","etype":"txt","attr":"auto","len":"10","defval":null,"refcd":"DICT","option":"sel:val_3::nm","valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"7","h":null},{"sort_seq":15,"section":null,"section_icon":null,"colgrp":"입력","colid":"val_4","colnm":"C4","dtype":"text","etype":"txt","attr":"auto","len":"10","defval":null,"refcd":"DICT","option":"sel:val_4::nm","valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"7","h":null},{"sort_seq":16,"section":null,"section_icon":null,"colgrp":"입력","colid":"val_5","colnm":"C5","dtype":"text","etype":"txt","attr":null,"len":"10","defval":null,"refcd":"DICT","option":"sel:val_5::nm","valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","w":"7","h":null}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */

            /* 사용자초기화 */
    me.fnInitExtra=function() {
        if(gUserinfo.server=='prod') {
            gfnAlert("데이터이관 프로그램 실행","운영환경에서는 실행할 수 없는 메뉴입니다.");
            gMDI.closeTab(me.pageid);
        }
        //조회조건 없으므로 화면오픈시 조회
        me.fnSearch();
    }
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //테이블목록
        else if(component==me.pageObj["list"]) {
            if(evt=="dblclick") {
                if(row < 0) return;
                me.fnSearchTbl( component.getVal(row,"t_id") );
            }
        }
        //컬럼컨트롤
        else if(component==me.pageObj["colist"]) {
            if(evt=="componentFunc") {
                if(row=="colNm") {
                    me.fnColNm();
                } else if (row=="addRow"||row=="delRow") {
                    component[row](); //addRow/delRow
                }
            } 
            else if(evt=="change") { 
                if(row < 0) return; 
                if(col=="val_1"||col=="val_2"||col=="val_3"||col=="val_4"||col=="val_5") {
                    me.fnColNm(row);
                }
            }
        }
    }
    //colNm:컬럼정보세팅
    me.fnColNm=function(row) {
        var component = me.pageObj["colist"];
        function fnColInfo(row) { 
            //val_1~val_5가 입력될때 컬럼ID와 컬럼명, 데이터타입을 추가한다.
            var datatype = component.getVal(row,"datatype");
            var val_1 = component.getVal(row,"val_1"); var nm_1 = gfnCdNm("DICT",val_1,"nm"); datatype = nvl(gfnCdNm("DICT",val_1,"val_1"),datatype);
            var val_2 = component.getVal(row,"val_2"); var nm_2 = gfnCdNm("DICT",val_2,"nm"); datatype = nvl(gfnCdNm("DICT",val_2,"val_1"),datatype);
            var val_3 = component.getVal(row,"val_3"); var nm_3 = gfnCdNm("DICT",val_3,"nm"); datatype = nvl(gfnCdNm("DICT",val_3,"val_1"),datatype);
            var val_4 = component.getVal(row,"val_4"); var nm_4 = gfnCdNm("DICT",val_4,"nm"); datatype = nvl(gfnCdNm("DICT",val_4,"val_1"),datatype);
            var val_5 = component.getVal(row,"val_5"); var nm_5 = gfnCdNm("DICT",val_5,"nm"); datatype = nvl(gfnCdNm("DICT",val_5,"val_1"),datatype);
            var col_id = val_1 + (isNull(val_2)?"":"_"+val_2)+ (isNull(val_3)?"":"_"+val_3)+ (isNull(val_4)?"":"_"+val_4)+ (isNull(val_5)?"":"_"+val_5);
            var col_nm = nm_1+nm_2+nm_3+nm_4+nm_5;
            component.setVal(row,"col_id",col_id);
            component.setVal(row,"col_nm",col_nm);
            component.setVal(row,"datatype",datatype); 
        }
        if(row == undefined) {
            for(var i=0; i < component.countRow(); i++ ) {
                var nodeid = component.getNodeId(i);
                fnColInfo(nodeid);
            }
        } else {
            fnColInfo(row);
        }
    }
    //search:조회 
    me.fnSearch=function(rowFocusAfterSearch) { 
        var args = {pgmid:pgmid} 
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            //console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                me.pageObj["list"].importData(OUTVAR.list);
                if(rowFocusAfterSearch != undefined) {
                    me.pageObj["list"].focusRow(rowFocusAfterSearch);
                }  
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }
    //searchTbl: 테이블정보조회
    me.fnSearchTbl=function(t_id) { 
        var args = {t_id:t_id} 
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"searchTbl",{INVAR:invar},function(OUTVAR){
            //console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                me.pageObj["tbl"].reset();
                me.pageObj["tbl"].importData(OUTVAR.tbl);
                me.pageObj["tbl"].setVal("dev_col_cnt",OUTVAR.dev_col_cnt);
                me.pageObj["tbl"].setVal("dev_row_cnt",OUTVAR.dev_row_cnt);
                me.pageObj["tbl"].setVal("prod_col_cnt",OUTVAR.prod_col_cnt);
                me.pageObj["tbl"].setVal("prod_row_cnt",OUTVAR.prod_row_cnt);
                me.pageObj["colist"].reset();
                me.pageObj["colist"].importData(OUTVAR.colist);
                var curRow = me.pageObj["list"].focusedRow();
                me.fnSearch(curRow);
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }      
    //Export 운영반영
    me.fnExport=function() { 
        if(me.pageObj.tbl.getVal("dev_col_cnt")!=me.pageObj.tbl.getVal("prod_col_cnt")) {
            gfnAlert("테이블구조 확인","컬럼 갯수가 상이합니다. 컬럼구조가 다른 경우 복사 중 오류 발생합니다. 먼저 테이블 구조를 반영하십시오!");            
            return;
        }
        
        function fnAlterTbl(t_id, tbl_nm) {
            var args = { t_id : t_id, tbl_nm: tbl_nm, colist: me.pageObj["colist"].exportData(), bZAK: bZAK, bCopy: bCopy } ;
            //console.log(args);
            var invar = JSON.stringify(args);
            gfnTx(appid+"."+pgmid,"export",{INVAR:invar},function(OUTVAR){
                console.log(OUTVAR);
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("테이블 데이터 이관","테이블 데이터가 이관 되었습니다. (백업테이블:"+OUTVAR.rtnMsg+")");
                    me.fnSearchTbl(t_id);
                } else {
                    gfnAlert("저장오류",OUTVAR.rtnMsg);
                }
            });
        } 
        var t_id = me.pageObj["tbl"].getVal("t_id");
        var tbl_nm = me.pageObj["tbl"].getVal("tbl_nm");
        var bZAK = "Y";
        var bCopy = "Y";
        gfnConfirm("테이블 데이터 이관",`테이블 [${t_id}]${tbl_nm}을 운영환경으로 이관하시겠습니까?`,function(bConfirm){
            if(bConfirm)  fnAlterTbl(t_id, tbl_nm);
        });
    }
    
    //Import 운영데이터 가져오기 반영
    me.fnImport=function() { 
        if(me.pageObj.tbl.getVal("dev_col_cnt")!=me.pageObj.tbl.getVal("prod_col_cnt")) {
            gfnAlert("테이블구조 확인","컬럼 갯수가 상이합니다. 컬럼구조가 다른 경우 복사 중 오류 발생합니다. 먼저 테이블 구조를 반영하십시오!");
            return;
        }
        
        function fnAlterTbl(t_id, tbl_nm) {
            var args = { t_id : t_id, tbl_nm: tbl_nm, colist: me.pageObj["colist"].exportData(), bZAK: bZAK, bCopy: bCopy } ;
            //console.log(args);
            var invar = JSON.stringify(args);
            gfnTx(appid+"."+pgmid,"import",{INVAR:invar},function(OUTVAR){
                console.log(OUTVAR);
                if(OUTVAR.rtnCd=="OK") {
                    gfnAlert("테이블 데이터 이관","테이블 데이터가 이관 되었습니다. (백업테이블:"+OUTVAR.rtnMsg+")");
                    me.fnSearchTbl(t_id);
                } else {
                    gfnAlert("저장오류",OUTVAR.rtnMsg);
                }
            });
        } 
        var t_id = me.pageObj["tbl"].getVal("t_id");
        var tbl_nm = me.pageObj["tbl"].getVal("tbl_nm");
        var bZAK = "Y";
        var bCopy = "Y";
        gfnConfirm("테이블 데이터 이관",`테이블 [${t_id}]${tbl_nm}을 개발환경으로 이관하시겠습니까?`,function(bConfirm){
            if(bConfirm) fnAlterTbl(t_id, tbl_nm);
        });
    }

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>