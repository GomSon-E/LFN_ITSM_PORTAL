<style>[pgmid='yearPSI'].framepage .userClass { 
width:100%; 
}</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent">
    <div id='list'></div> 
</div>
<div id="pageCondPop" style="height:550px">
    <div id='pageCondCol' style="height:100%"></div> 
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "fo_eis";
    var pgmid = "yearPSI"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":2,"upd_dt":"2022-08-10 18:06:37","remark":"1) 수불데이터(=조회 가능한 정보항목)은 \"기간, 매장/창고, 상품, 이동유형, 수량/금액\"으로 분류할 수 있습니다.\n2) 조회조건을 입력하여 조회하려는 대상을 한정하고, 조회하려는 정보항목을 [행레이블 편집]하여 지정합니다.\n3)~5) 전사수불현황, 매장수불현황, 물류수불현황 등 목적에 맞는 리포트를 조회할 수 있습니다.\n","pgmid":"yearPSI","proc_mst_id":"","pgm_stat":"Y","sort_seq":45,"app_pgmid":"fo_eis","shortcut":"","reg_dt":"2022-07-22 20:04:03","reg_usid":"kihyunlee","pgm_nm":"전사 수불현황","upd_usid":"kihyunlee","pgm_tp":"UX","pgm_grp_nm":"주간회의","proc_mst_nm":"","app_pgm_nm":"FO EIS","":"트랜젝션(메뉴)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-search","reg_dt":"2022-07-22 20:04:03","reg_usid":"","func_nm":"조회","upd_usid":"","upd_dt":"2022-07-22 20:04:03","func_tp":"DB_R","remark":"매장/창고, 일자, 상품, 수불이동유형별 전사 수불정보를 조회합니다.","pgmid":"yearPSI","sort_seq":"1","funcid":"search","content":null,"crud":"R","id":"0"},{"func_icon":"fa fa-gear","reg_dt":"2022-07-22 20:04:03","reg_usid":"","func_nm":"행레이블 편집","upd_usid":"","upd_dt":"2022-07-22 20:04:03","func_tp":"EH","remark":"조회하려는 행필드와 열그룹을 지정하려면 [행레이블 편집]을 클릭하세요.","pgmid":"yearPSI","sort_seq":"2","funcid":"colEdit","content":null,"crud":"R","id":"1"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["pageCond"]={"sort_seq":"1","data_id":"pageCond","data_nm":"조회조건","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":"매장/창고","colid":"whcd","colnm":"창고코드","dtype":"text","etype":"sel","attr":null,"defval":null,"w":"15","h":null,"refcd":"whcd","option":"multi:whcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":"기준일","colid":"from_dt","colnm":"시작일","dtype":"ymd","etype":"txt","attr":"pk ymd","defval":"date(\"1st\")","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":"기준일","colid":"to_dt","colnm":"종료일","dtype":"ymd","etype":"txt","attr":"pk ymd","defval":"date(\"today\")","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"mat_tp","colnm":"상품유형","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"MAT_TP","option":"multi:mat_tp::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"suprcd","colnm":"공급사","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"supr","option":"multi:suprcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"yyyy","colnm":"상품연도","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"YYYY","option":"multi:yyyy::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"sson_cd","colnm":"시즌","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"SBSN_CD","option":"multi:sson_cd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"brcd","colnm":"브랜드","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"brcd","option":"multi:brcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"itemcd","colnm":"품목","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"item","option":"multi:itemcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":10,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"stcd","colnm":"스타일(Like)","dtype":"text","etype":"txt","attr":"upper","defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":11,"section":"이동유형","section_icon":null,"colgrp":null,"colid":"mov_cat0","colnm":"입판재","dtype":"text","etype":"sel","attr":null,"defval":null,"w":"15","h":null,"refcd":"MOV_CAT0","option":"multi:mov_cat0::cd","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"20"},{"sort_seq":12,"section":"이동유형","section_icon":null,"colgrp":null,"colid":"mov_cat1","colnm":"이동구분","dtype":"text","etype":"sel","attr":null,"defval":null,"w":"15","h":null,"refcd":"MOV_CAT1","option":"multi:mov_cat1::cd","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"19"},{"sort_seq":13,"section":"이동유형","section_icon":null,"colgrp":null,"colid":"mov_tp","colnm":"이동유형","dtype":"text","etype":"sel","attr":null,"defval":null,"w":"15","h":null,"refcd":"MOV_TP","option":"multi:mov_tp::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"18"},{"sort_seq":14,"section":"정보항목","section_icon":"fa fa-gear","colgrp":null,"colid":"cols","colnm":"행 레이블","dtype":"text","etype":"btn","attr":null,"defval":"편집","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"},{"sort_seq":15,"section":"정보항목","section_icon":null,"colgrp":null,"colid":"disp_cols","colnm":"표시항목","dtype":"text","etype":"sel","attr":"keycol","defval":"[\"qty\"]","w":"15","h":null,"refcd":"[{\"cd\":\"qty\",\"nm\":\"수량\"},{\"cd\":\"price_amt\",\"nm\":\"소가액\"},{\"cd\":\"sale_vat_amt\",\"nm\":\"판가액\"},{\"cd\":\"cost_amt\",\"nm\":\"원가액\"}]","option":"multi:disp_cols::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"11"},{"sort_seq":16,"section":"정보항목","section_icon":null,"colgrp":null,"colid":"minus_yn","colnm":"출고(-)표시","dtype":"text","etype":"cbx","attr":null,"defval":"\"Y\"","w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"12"},{"sort_seq":17,"section":"정보항목","section_icon":null,"colgrp":null,"colid":"mov_yn","colnm":"이동중표시","dtype":"text","etype":"cbx","attr":null,"defval":"\"N\"","w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"13"},{"sort_seq":18,"section":"정보항목","section_icon":null,"colgrp":null,"colid":"cdnm_opt","colnm":"코드명표시","dtype":"text","etype":"sel","attr":null,"defval":"\"명\"","w":"8","h":null,"refcd":"[\"명\",\"코드\",\"[코드]명\",\"명(코드)\"]","option":"sel:cdnm_opt::cd","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"14"},{"sort_seq":19,"section":"조회옵션","section_icon":null,"colgrp":null,"colid":"factor","colnm":"금액단위","dtype":"text","etype":"sel","attr":null,"defval":"\"백만\"","w":"5","h":null,"refcd":"[\"천\",\"백만\",\"십억\"]","option":"sel:factor::cd","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"15"},{"sort_seq":20,"section":"조회옵션","section_icon":null,"colgrp":null,"colid":"remove_vat_yn","colnm":"부가세제외","dtype":"text","etype":"cbx","attr":null,"defval":"\"Y\"","w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"16"},{"sort_seq":21,"section":"조회옵션","section_icon":null,"colgrp":null,"colid":"display_old_wh_yn","colnm":"폐점포함","dtype":"text","etype":"cbx","attr":null,"defval":"\"N\"","w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"17"}]};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"2","data_id":"list","data_nm":"전사 수불현황표","data_icon":null,"component_pgmid":"agGrid","component_option":{"remark":"* 금액단위 및 VAT포함여부: 조회조건에 따름"},"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":"기간","colid":"mov_yr","colnm":"연도","dtype":"text","etype":"raw","attr":"borderL fixL","defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":"기간","colid":"mov_ym","colnm":"연월","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"9","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":"기간","colid":"mov_ymw","colnm":"주차","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"2","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":"기간","colid":"mov_dt","colnm":"일자","dtype":"ymd","etype":"raw","attr":"fixL","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":"매장/창고","colid":"chnl","colnm":"채널","dtype":"text","etype":"raw","attr":"borderL fixL","defval":null,"w":"6","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":"Y","section_icon":null,"colgrp":"매장/창고","colid":"whcd","colnm":"매장","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"6","h":null,"refcd":"whcd","option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":"매장/창고","colid":"counter_chnl","colnm":"상대채널","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"6","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"28"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":"매장/창고","colid":"counter_whcd","colnm":"상대매장","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"6","h":null,"refcd":"whcd","option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":"상품","colid":"mat_tp","colnm":"상품유형","dtype":"text","etype":"raw","attr":"borderL fixL","defval":null,"w":"6","h":null,"refcd":"MAT_TP","option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":10,"section":null,"section_icon":null,"colgrp":"상품","colid":"suprcd","colnm":"공급사코드","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"8","h":null,"refcd":"supr","option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":11,"section":null,"section_icon":null,"colgrp":"상품","colid":"yyyy","colnm":"상품연도","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":12,"section":null,"section_icon":null,"colgrp":"상품","colid":"sson_cd","colnm":"시즌","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"5","h":null,"refcd":"SBSN_CD","option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"},{"sort_seq":13,"section":null,"section_icon":null,"colgrp":"상품","colid":"brcd","colnm":"브랜드","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"6","h":null,"refcd":"brcd","option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"11"},{"sort_seq":14,"section":null,"section_icon":null,"colgrp":"상품","colid":"itemcd","colnm":"품목","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"6","h":null,"refcd":"item","option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"12"},{"sort_seq":15,"section":null,"section_icon":null,"colgrp":"상품","colid":"stcd","colnm":"스타일","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"13"},{"sort_seq":16,"section":null,"section_icon":null,"colgrp":"상품","colid":"goods_cd","colnm":"상품코드","dtype":"text","etype":"raw","attr":"fixL","defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"14"},{"sort_seq":17,"section":"Y","section_icon":"1","colgrp":"이동유형","colid":"mov_cat0","colnm":"입판재","dtype":"text","etype":"raw","attr":"borderL","defval":null,"w":"5","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"15"},{"sort_seq":18,"section":"Y","section_icon":"2","colgrp":"이동유형","colid":"mov_cat1","colnm":"이동구분","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"16"},{"sort_seq":19,"section":null,"section_icon":null,"colgrp":"이동유형","colid":"mov_tp","colnm":"이동유형","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"15","h":null,"refcd":"MOV_TP","option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"17"},{"sort_seq":20,"section":null,"section_icon":null,"colgrp":"이동유형","colid":"mov_cat2","colnm":"이동상세","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"12","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"18"},{"sort_seq":21,"section":"입판재","section_icon":null,"colgrp":"이동구분","colid":"qty","colnm":"수량","dtype":"num","etype":"raw","attr":"borderL","defval":null,"w":"6","h":null,"refcd":null,"option":"valCol","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"19"},{"sort_seq":22,"section":"입판재","section_icon":null,"colgrp":"이동구분","colid":"price_amt","colnm":"소가액","dtype":"num","etype":"raw","attr":null,"defval":null,"w":"8","h":null,"refcd":null,"option":"valCol","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"20"},{"sort_seq":23,"section":"입판재","section_icon":null,"colgrp":"이동구분","colid":"sale_vat_amt","colnm":"판가액","dtype":"num","etype":"raw","attr":null,"defval":null,"w":"8","h":null,"refcd":null,"option":"valCol","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"21"},{"sort_seq":24,"section":"입판재","section_icon":null,"colgrp":"이동구분","colid":"cost_amt","colnm":"원가액","dtype":"num","etype":"raw","attr":null,"defval":null,"w":"7","h":null,"refcd":null,"option":"valCol","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"22"},{"sort_seq":25,"section":"입판재","section_icon":null,"colgrp":"이동구분","colid":"mov_qty","colnm":"이동중수량","dtype":"num","etype":"raw","attr":"dim","defval":null,"w":"6","h":null,"refcd":null,"option":"valCol","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"23"},{"sort_seq":26,"section":"입판재","section_icon":null,"colgrp":"이동구분","colid":"mov_price_amt","colnm":"이동중소가액","dtype":"num","etype":"raw","attr":"dim","defval":null,"w":"8","h":null,"refcd":null,"option":"valCol","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"24"},{"sort_seq":27,"section":"입판재","section_icon":null,"colgrp":"이동구분","colid":"mov_sale_vat_amt","colnm":"이동중판가액","dtype":"num","etype":"raw","attr":"dim","defval":null,"w":"8","h":null,"refcd":null,"option":"valCol","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"25"},{"sort_seq":28,"section":"입판재","section_icon":null,"colgrp":"이동구분","colid":"mov_cost_amt","colnm":"이동중원가액","dtype":"num","etype":"raw","attr":"dim","defval":null,"w":"7","h":null,"refcd":null,"option":"valCol","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"26"},{"sort_seq":29,"section":null,"section_icon":null,"colgrp":"비고","colid":"remark_add","colnm":"비고","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"20","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"27"}]};
me.dataDef["_pgm_data"]["pageCondCol"]={"sort_seq":"3","data_id":"pageCondCol","data_nm":"조회하려는 필드 설정","data_icon":null,"component_pgmid":"agGrid","component_option":{"func":[{"funcid":"apply","func_nm":"적용","func_icon":"fas fa-check"}]},"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"colgrp","colnm":"구분","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"colid","colnm":"컬럼ID","dtype":"text","etype":"none","attr":"hidden","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"colnm","colnm":"필드명","dtype":"text","etype":"raw","attr":"keycol","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"section","colnm":"행표시","dtype":"text","etype":"cbx","attr":"center","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"colFormula","colnm":"행소계","dtype":"text","etype":"none","attr":"hidden","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"section_icon1","colnm":"열그룹1","dtype":"text","etype":"cbx","attr":"borderL keycol center","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"section_icon2","colnm":"열그룹2","dtype":"text","etype":"cbx","attr":"keycol center","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"section_icon","colnm":"열그룹","dtype":"text","etype":"none","attr":"hidden","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */

    /* 사용자초기화 */
    me.fnInitExtra=function() {
        //탭 설정
        //gfnTab(pageid, "tabs", {"multi-active":"off","toggle-switch":"on"}); 
        //사용자 컴포넌트 
        //me.dataDef["_pgm_data"][myCompoId] = {...};
        //me.pageObj["myCompoId"] = new gfnComponent( me.pageid, myCompoId, me.dataDef["_pgm_data"][myCompoId], me.fnEH, me); 
        //me.pageObj["myCompoId"].userComponent = "myCompoId";
        //사용자 컨트롤
        //var myColinfo = {colid:...}
        //me.pageObj["myColId"] = new gfnControl(myColinfo, me.fnEH) 
        //me.page.find("#myCol").append(me.pageObj["myColId"].dispObj);
        //me.pageObj["myColId"].getVal(); / myCol.setVal(val);...    
        //me.fnSearch();
        
        //Layout편집
        me.colinfo = me.dataDef._pgm_data.list.content;
        me.cols = {valCols:[],keyCols:[]};
        /* MS실험실기능
        me.colinfo.group(col=>{
            if(col.option=="valCol") return "valCols"
            else return "keyCols";
        }); 
        */
        me.colinfo.forEach((col,i)=>{
           var colinfo = $.extend(true,{},col);     
           if(col.option=="valCol") me.cols["valCols"].push(colinfo);
           else me.cols["keyCols"].push(colinfo);
        });
        //section_icon value(1/2) => section_icon1/2 로 넣어줌
        me.cols.keyCols.forEach(colinfo=>{
            if(colinfo.section_icon=="1") colinfo.section_icon1="Y"; 
            else colinfo.section_icon1="N";
            if(colinfo.section_icon=="2") colinfo.section_icon2="Y";
            else colinfo.section_icon2="N";
        });
        me.pageObj.pageCondCol.importData(me.cols.keyCols); 
        //console.log(me.cols);
        
        me.pageCondPop = me.page.find("#pageCondPop");
        me.pageCondPopup = null; 
        me.pageCondPopup = gfnPopup("화면 정보항목 설정",me.pageCondPop,{width:709, height:600, close:function(){ } });
        me.pageCondPopup.dialog("close");
    }
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //pageCond:조회조건 이벤트처리     
        else if(component==me.pageObj["pageCond"]) {
            if(evt=="change" && col=="to_dt") {
                //var to_dt = component.getVal("to_dt");
                //component.setVal("from_dt",to_dt.substring(0,4)+"0101");
            }
            if(evt=="click" && (col=="cols"||col=="rows")) {
                me.pageCondPopup.dialog("open");
            }
        }

        //list:월별 매장별 입고-판매-재고 현황 이벤트처리     
        else if(component==me.pageObj["list"]) {
            if(evt=="componentFunc") {
                if(row=="addRow") {
                    component.addRow();
                } else if(row=="delRow") {
                    component.delRow();
                }
            }
            if(evt=="dblclick") {
                console.log(arguments); 
            }
        }
        else if(component==me.pageObj["pageCondCol"]) {
            if(evt=="componentFunc") {
                if(row=="apply") {
                    me.fnApplyLayout();
                }
            }
            if(evt=="change") { 
                function RadioRows(component, keycolid, keycolval, radioColid, checked, syncColid) {
                    var rowData = component.exportData();
                    rowData.forEach(rowdata=>{
                        if(rowdata[keycolid]==keycolval) {
                            if(checked=="Y") {
                                rowdata[radioColid]="Y";
                                rowdata[syncColid]="Y";
                            } else {
                                rowdata[radioColid]="N";
                                rowdata[syncColid]="N";
                            }
                        }    
                        else rowdata[radioColid]="N";
                    });
                    component.importData(rowData);
                }
                if(col=="section_icon1"||col=="section_icon2") {
                    RadioRows(component, "colid", component.getVal(row,"colid"), col, val, "section");
                    var rowData = component.exportData();
                    rowData.forEach(rowdata=>{
                        if(rowdata["section_icon1"]=="Y") rowdata["section_icon"]="1";
                        else if(rowdata["section_icon2"]=="Y") rowdata["section_icon"]="2"; 
                        else rowdata["section_icon"]="";
                    });
                    component.importData(rowData);                    
                }
            }
        }

        //사용자 컴포넌트/컨트롤
        else if(component.userComponent=="myCompoId") {
            //if(evt=="dblclick" && col=="colid") {...}
        }
    }
    
    me.fnColEdit=function(){
        me.pageCondPopup.dialog("open");
    }
    
    //조회조건에 따른 화면양식 설정
    me.fnApplyLayout=function(){
        var cols = me.pageObj.pageCondCol.exportData();
        var keycolinfo = cols.filter(col=>(col.section=="Y" && isNull(col.section_icon))); 
        var itersection = cols.find(col=>col.section_icon=="1"); 
        var itergroup   = cols.find(col=>col.section_icon=="2"); 
        //아래에서는 보여주기만 하는 용도
        var valcolinfo = []; 
        var valColOpt = me.pageObj.pageCond.getVal("disp_cols");
        me.cols["valCols"].forEach(col=>{
            valColOpt.forEach(opt=>{
                if(inStr(col.colid,opt)>=0) {
                    var colinfo = $.extend(true,{},col);
                    valcolinfo.push(colinfo);
                }
            });  
        });  
        valcolinfo.forEach(valcol=>{
            valcol.section = isNull(itersection)?"":itersection.colnm;
            valcol.colgrp  = isNull(itergroup)?"":itergroup.colnm;
        });
        //valcolinfo = valcolinfo.concat(valcoltemp);  
        //console.log(valcolinfo);
        var listcolinfo = keycolinfo.concat(valcolinfo); 
        me.dataDef["_pgm_data"]["list"].content=listcolinfo; 
        //me.pageObj["list"].init(); 
        me.pageObj.list = new gfnComponent( me.pageid, "list", me.dataDef["_pgm_data"]["list"], me.fnEH, me); 
        me.pageObj.list.gridOptions.api.setGroupHeaderHeight(30)
        me.pageCondPopup.dialog("close");
    }
    //search:조회 
    me.fnSearch=function() {
        if( !me.pageObj["pageCond"].chkValid() ) return;
        //조회할 키 컬럼 추출 
        var cols = me.pageObj.pageCondCol.exportData();
        var keycolinfo = cols.filter(col=>col.section=="Y"); 
        var args = me.pageObj["pageCond"].exportData()[0]; 
        args.keycols = extract(keycolinfo,"colid").toString();
        console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                var list = OUTVAR.list;
                /* 조회된 결과에 따라 iteration columns 세팅 */
                var cols = me.pageObj.pageCondCol.exportData();
                /* section='Y' 키컬럼. section_icon=1/2 크로스탭레벨. colFormula=키컬럼 중 소계표시컬럼 */
                var keycolinfo = $.extend(true,[], cols.filter(col=>(col.section=="Y" && isNull(col.section_icon)))); 
                keycolinfo.forEach(col=>{col.section="";}); //키컬럼은 크로스탭으로 올라가지 않도록 section을 닦아준다. 

                // 크로스탭 sectionVal_groupVal_valcolid 형태로 테이블Definition을 수정하고, 데이터셋도 새로 생성할 것임
                var itersection = cols.find(col=>col.section_icon=="1"); 
                var itergroup   = nvl(cols.find(col=>col.section_icon=="2"),cols.find(col=>col.section_icon=="1")); 
                var keymix = [];
                list.forEach(row=>{
                    //조회된 데이터에서 크로스탭레벨1~2로 구성된 컬럼명을 생성한다.
                    keymix.push({key:row[itersection.colid]+"~"+row[itergroup.colid], section:row[itersection.colid], colgrp:row[itergroup.colid]});
                }); 
                keymix = sort(keymix,"key"); //키값 기준으로 정렬한 후
                for(var i=keymix.length-1;i>0;i--) {
                    //Distinct 처리한다.
                    if(keymix[i].key == keymix[i-1].key) keymix.splice(i,1);
                }
                /* 표시항목에 해당하는 컬럼만 그리드에 추가한다. */
                var valColOpt = me.pageObj.pageCond.getVal("disp_cols");
                var valCols = []; //여기에 값컬럼들이 세팅된다. 
                me.cols["valCols"].forEach(col=>{  //정보컬럼에 대해서
                    valColOpt.forEach(opt=>{       //표시항목 조회조건에서 
                        if(inStr(col.colid,opt)>=0) { //표시항목 인건 중 
                            var bAdd = true;  
                            if(inStr(col.colid,"mov") >= 0 && me.pageObj.pageCond.getVal("mov_yn")!="Y" ) bAdd = false; 
                            if(bAdd) {
                                var colinfo = $.extend(true,{},col) 
                                valCols.push(colinfo); //valCols에 colinfo를 넣어주고
                            }
                        }
                    });  
                }); 
                /* 위에서 만든 keymix의 섹션,컬럼그룹별로 컬럼ID를 생성하여 넣어준다. */
                var valcolinfo = []; 
                keymix.forEach(key=>{
                    var valcoltemp = $.extend(true,[],valCols); 
                    valcoltemp.forEach(valcol=>{
                        valcol.section = key.section;
                        valcol.colgrp  = key.colgrp;
                        valcol.colid = key.section+"_"+key.colgrp+"_"+valcol.colid;
                        //console.log(key.section+"_"+key.colgrp);
                    });
                    valcolinfo = valcolinfo.concat(valcoltemp);                                              
                }); 
                var listcolinfo = keycolinfo.concat(valcolinfo); 
                listcolinfo = listcolinfo.concat( me.colinfo.find(col=>col.colid=="remark_add") ); 
                me.dataDef["_pgm_data"]["list"].content=listcolinfo; 
                me.pageObj.list = new gfnComponent( me.pageid, "list", me.dataDef["_pgm_data"]["list"], me.fnEH, me); 
                me.pageObj.list.gridOptions.api.setGroupHeaderHeight(30);
                
                /* list를 크로스탭 데이터로 변환한다. */
                //function isObject(obj) {
                //    return obj != null && typeof obj === 'object';
                //}
                function isEqualKey(obj1,obj2) {
                    const keys1 = Object.keys(obj1);
                    const keys2 = Object.keys(obj2);
                    if(keys1.length != keys2.length) return false;
                    for(const key of keys1) {
                        const val1 = obj1[key];
                        const val2 = obj2[key];
                        //const areObjs = isObject(val1) && isObject(val2);
                        if(val1 !== val2) { //areObjs && !isEqualKey(val1,val2) || !areObjs && val1 !== val2
                            return false
                        }
                    }
                    return true;
                }
                //console.log(keycolinfo);
                var lisb = [];
                list.forEach((row,idx)=>{
                    /* lisb keycols 값 채우고 */
                    var keyval = {};
                    keycolinfo.forEach(key=>{
                        if(!isNull(key.colid)) keyval[key.colid] = row[key.colid];
                    });
                    //console.log(keyval);
                    var rowidx = lisb.findIndex(el=>{
                        var rowkeyval = {};
                        keycolinfo.forEach(key=>{ 
                            if(!isNull(key.colid)) rowkeyval[key.colid] = el[key.colid];
                        }); 
                        //console.log(rowkeyval); 
                        return isEqualKey(keyval,rowkeyval);
                    })
                    //console.log(rowidx); 
                    if(rowidx==undefined || rowidx < 0) {
                        rowidx = lisb.push($.extend(true,{},keyval))-1;
                    }
                    //console.log(lisb);
                    //console.log(rowidx);
                    /* keymix를 사용하여 valcols를 확장해줌 */
                    valCols.forEach(val=>{
                        var colid = row[itersection.colid]+"_"+row[itergroup.colid]+"_"+val.colid;
                        lisb[rowidx][colid] = row[val.colid];
                    });                                             
                });
                list = lisb;
                
                
                /* 코드명 치환 */
                var cdnm_opt = me.pageObj.pageCond.getVal("cdnm_opt");
                var cdnmCols = keycolinfo.filter(col=>!isNull(col.refcd)); //refcd가 있는 건 가져오기.
                //console.log(cdnmCols);
                var lds = {};
                cdnmCols.forEach(col=>{  //코드명 치환처리가 늦어져서 gds 대신 실제 결과에 해당하는 lds 를 구성하여 사용
                    var codelist = extract(list, col.colid, "distinct");                     //데이터에 존재하는 코드만 추출하여
                    lds[col.refcd] = gds.comcd.filter(cd=>cd.grpcd==col.refcd).filter(cd=>inStr(codelist,cd.cd)>=0); //lds를 구성함
                })
                if(cdnm_opt != "코드" ) {
                    //console.log(lds);
                    list.forEach(function(el,i){
                        cdnmCols.forEach(col=>{
                            var cdnm = lds[col.refcd].find(code=>code.cd==el[col.colid]);
                            if(!isNull(cdnm)) {
                                if(cdnm_opt=="명") {
                                    el[col.colid] = cdnm.nm;
                                } if(cdnm_opt=="[코드]명") {
                                    el[col.colid] = "["+el[col.colid]+"]"+cdnm.nm;
                                } else if(cdnm_opt=="명(코드)") {
                                    el[col.colid] = cdnm.nm+"("+el[col.colid]+")";
                                }
                            }
                        })
                    });  
                }
                
                //var total_row = list.shift();  
                me.pageObj["list"].importData(list);
                //me.pageObj.list.gridOptions.api.setPinnedTopRowData([total_row]);
                me.pageObj.list.total("top");
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }


/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>