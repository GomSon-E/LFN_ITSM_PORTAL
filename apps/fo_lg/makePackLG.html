<style>[pgmid='makePackLG'].framepage .userClass { 
width:100%; 
}

[pgmid='makePackLG'].framepage .flex {
display: flex;
flex-direction: row;
flex-wrap: nowrap;
align-content: flex-start;
justify-content: center;
align-items: flex-start;
}

[pgmid='makePackLG'].framepage .flex > div {
    flex: 1 1 50%;
}

[pgmid='makePackLG'].framepage .scan { 
    max-height: 5em;
    margin-top: 5px;
    width: 100%;
    display: flex;
}

[pgmid='makePackLG'].framepage .scan input { 
    width: 100%;
    min-height: 2em;
    font-size: 1.5em;
    font-weight: bolder;
    border: 2px solid coral;
    background-color: beige;
    text-align: center;
}

[pgmid='makePackLG'].framepage .scan button { 
    font-size: 1.2em;
    border: 2px solid coral;
    margin-left: 5px;
    display: flex;
    text-align: center;
    vertical-align: middle;
}
</style>

<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent flex flexRow" >
    <div id="packlist" style="flex:1 1 70%" class="flexColumn"></div>
    <div id="t3" style="flex:1 1 calc(30% - 3em)" class="flexColumn">
        <div id='mst'></div>      
        <div class="scan">
            <input id="scan" name="scanbox" type="text" inputmode="none" placeholder="상품코드 스캔">
            <button id="pop" >그 외 상품 추가</button>
        </div>
        <div id='goodslist' class="flexColumn"></div>        
    </div>
</div>
<div class = "barcode" style="display:none"></div>

<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "fo_lg";
    var pgmid = "makePackLG"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"pgmid":"makePackLG","pgm_nm":"물류박스패킹관리(PC)","pgm_tp":"UX","proc_mst_id":"","proc_mst_nm":"","remark":"","ver":1.6,"pgm_stat":"Y","reg_usid":"jjr","reg_dt":"2022-02-25 15:09:41","upd_usid":"jjr","upd_dt":"2022-02-25 15:09:41","app_pgmid":"fo_lg","pgm_grp_nm":"출고","sort_seq":24,"shortcut":"","crud":"","app_pgm_nm":"물류"};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-search","reg_dt":"2022-02-25 15:09:41","reg_usid":"","func_nm":"조회","upd_usid":"","upd_dt":"2022-02-25 15:09:41","func_tp":"DB_R","remark":null,"pgmid":"makePackLG","sort_seq":"1","funcid":"search","content":"박스패킹목록조회","crud":"R","id":"0"},{"func_icon":"fas fa-file","reg_dt":"2022-02-25 15:09:41","reg_usid":"","func_nm":"신규","upd_usid":"","upd_dt":"2022-02-25 15:09:41","func_tp":"DB_W","remark":null,"pgmid":"makePackLG","sort_seq":"2","funcid":"new","content":"신규 박스번호 생성","crud":"R","id":"1"},{"func_icon":"fas fa-save","reg_dt":"2022-02-25 15:09:41","reg_usid":"","func_nm":"저장","upd_usid":"","upd_dt":"2022-02-25 15:09:41","func_tp":"DB_W","remark":null,"pgmid":"makePackLG","sort_seq":"3","funcid":"saveGoods","content":"박스별 상품목록 저장","crud":"R","id":"2"},{"func_icon":"fas fa-file-upload","reg_dt":"2022-02-25 15:09:41","reg_usid":"","func_nm":"패킹정보 업로드(LF)","upd_usid":"","upd_dt":"2022-02-25 15:09:41","func_tp":"EH","remark":null,"pgmid":"makePackLG","sort_seq":"4","funcid":"extraupload","content":"20SS 패킹업로드","crud":"R","id":"3"},{"func_icon":"fas fa-print","reg_dt":"2022-02-25 15:09:41","reg_usid":"","func_nm":"패킹라벨","upd_usid":"","upd_dt":"2022-02-25 15:09:41","func_tp":"EH","remark":null,"pgmid":"makePackLG","sort_seq":"5","funcid":"printlabel","content":"수락(확정)내역 박스라벨 발행","crud":"R","id":"4"},{"func_icon":"fas fa-print","reg_dt":"2022-02-25 15:09:41","reg_usid":"","func_nm":"패킹송장","upd_usid":"","upd_dt":"2022-02-25 15:09:41","func_tp":"EH","remark":null,"pgmid":"makePackLG","sort_seq":"6","funcid":"printpack","content":"수락(확정)내역 박스송장 발행","crud":"R","id":"5"},{"func_icon":"fas fa-plus","reg_dt":"2022-02-25 15:09:41","reg_usid":"","func_nm":"패킹키생성","upd_usid":"","upd_dt":"2022-02-25 15:09:41","func_tp":"EH","remark":null,"pgmid":"makePackLG","sort_seq":"7","funcid":"addpackkey","content":"패킹키 생성","crud":"R","id":"6"},{"func_icon":"fas fa-trash","reg_dt":"2022-02-25 15:09:41","reg_usid":"","func_nm":"삭제","upd_usid":"","upd_dt":"2022-02-25 15:09:41","func_tp":"DB_W","remark":null,"pgmid":"makePackLG","sort_seq":"8","funcid":"delete","content":"패킹정보 삭제처리","crud":"R","id":"7"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["pageCond"]={"sort_seq":"1","data_id":"pageCond","data_nm":"조회조건","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"shopcd","colnm":"창고코드","dtype":"text","etype":"sel","attr":null,"defval":null,"w":"12","h":null,"refcd":"whcd","option":"sel:shopcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_cd","colnm":"상품(like)","dtype":"text","etype":"txt","attr":"upper","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"box_barcd","colnm":"패킹바코드","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":"패킹일","colid":"dt_from","colnm":"일자From","dtype":"ymd","etype":"txt","attr":"ymd","defval":"date(\"today\")","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":"패킹일","colid":"dt_to","colnm":"일자to","dtype":"ymd","etype":"txt","attr":"ymd","defval":"date(\"today\")","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"pack_tp","colnm":"패킹유형","dtype":"text","etype":"sel","attr":null,"defval":null,"w":"10","h":null,"refcd":"PACK_TP","option":"multi:pack_tp::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"box_keycd","colnm":"패킹키","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"BOX_KEYCD ","option":"multi:box_keycd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"cd_stat","colnm":"상태","dtype":"text","etype":"sel","attr":null,"defval":"N","w":null,"h":null,"refcd":"PACK_STAT_CD","option":"multi:pack_stat_cd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_usid","colnm":"등록자","dtype":"text","etype":"sel","attr":null,"defval":"gUserinfo.userid","w":null,"h":null,"refcd":"USID","option":"multi:reg_usid::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"}]};
me.dataDef["_pgm_data"]["packlist"]={"sort_seq":"2","data_id":"packlist","data_nm":"패킹목록","data_icon":null,"component_pgmid":"agGrid","component_option":{"gridOpt":"chk"},"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"box_no","colnm":"패킹번호","dtype":"text","etype":null,"attr":null,"defval":null,"w":"18","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"count('box_no')+\"건\"","remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"pack_tp","colnm":"유형","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_cd","colnm":"상품코드","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_cnt","colnm":"상품수","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_qty","colnm":"입수량","dtype":"num","etype":"raw","attr":null,"defval":"0","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"box_keycd","colnm":"패킹키코드","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"link_info","colnm":"링크정보","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"22","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":13,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_usid","colnm":"등록자","dtype":"text","etype":"sel","attr":"readonly","defval":null,"w":null,"h":null,"refcd":"USID","option":"sel:reg_usid::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":14,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_dt","colnm":"등록일시","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":15,"section":null,"section_icon":null,"colgrp":null,"colid":"delete","colnm":"삭제","dtype":"text","etype":"btn","attr":"fixR","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"},{"sort_seq":16,"section":null,"section_icon":null,"colgrp":null,"colid":"box_barcd","colnm":"패킹바코드","dtype":"text","etype":null,"attr":null,"defval":null,"w":"18","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"11"},{"sort_seq":99,"section":null,"section_icon":null,"colgrp":null,"colid":"box_seq","colnm":"패킹순번","dtype":"text","etype":"raw","attr":"hidden","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"12"},{"sort_seq":99,"section":null,"section_icon":null,"colgrp":null,"colid":"whcd","colnm":"창고코드","dtype":"text","etype":null,"attr":"hidden ","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"13"},{"sort_seq":99,"section":null,"section_icon":null,"colgrp":null,"colid":"box_dt","colnm":"박스일자","dtype":"text","etype":"raw","attr":"hidden ","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"14"}]};
me.dataDef["_pgm_data"]["mst"]={"sort_seq":"3","data_id":"mst","data_nm":"패킹정보","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"whcd","colnm":"창고코드","dtype":"text","etype":null,"attr":"readonly ","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"box_no","colnm":"패킹번호","dtype":"text","etype":"raw","attr":"readonly ","defval":null,"w":"13","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"box_barcd","colnm":"패킹바코드","dtype":"text","etype":"raw","attr":"readonly ","defval":null,"w":"13","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"pack_tp","colnm":"패킹유형","dtype":"text","etype":"sel","attr":"keycol","defval":"BOX","w":null,"h":null,"refcd":"PACK_TP","option":"all:pack_tp::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_usid","colnm":"등록자","dtype":"text","etype":"sel","attr":"readonly ","defval":null,"w":null,"h":null,"refcd":"USID","option":"sel:reg_usid::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"reg_dt","colnm":"등록일시","dtype":"text","etype":"raw","attr":"readonly ","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"box_keycd","colnm":"패킹키코드","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"BOX_KEYCD ","option":"sel:box_keycd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"20","h":"3","refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"}]};
me.dataDef["_pgm_data"]["goodslist"]={"sort_seq":"4","data_id":"goodslist","data_nm":"상품목록","data_icon":null,"component_pgmid":"agGrid","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"delete","colnm":"줄삭제","dtype":"text","etype":"btn","attr":null,"defval":null,"w":"5","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_cd","colnm":"상품코드","dtype":"text","etype":"raw","attr":"pk","defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_nm","colnm":"상품명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"minus","colnm":"-","dtype":"text","etype":"btn","attr":null,"defval":null,"w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"qty","colnm":"수량","dtype":"num","etype":"raw","attr":"keycol","defval":null,"w":"5","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"plus","colnm":"+","dtype":"text","etype":"btn","attr":null,"defval":null,"w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"box_no","colnm":"패킹번호","dtype":"text","etype":"raw","attr":"hidden","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_seq","colnm":"상제품순번","dtype":"num","etype":"raw","attr":"hidden","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */

    /* 사용자초기화 */
    me.fnInitExtra=function() {
        //탭 설정
        gfnTab(pageid, "tabs");  
        
        //이벤트바인딩
        me.page.find(".scan").keydown(function(key){
            if(key.keyCode == 13){
                me.fnGoodsSearch();
            }
        });
        me.page.find("#pop").click(function(e) {
            me.fnaddGoods();
        });

        //매장정보
        me.shopcd = gUserinfo.deptcd;         
        me.pageObj.pageCond.setVal("shopcd",me.shopcd);
        
        //화면 열릴때 박스목록 조회
        me.fnSearch();
    }
    
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //pageCond:조회조건 이벤트처리     
        else if(component==me.pageObj["pageCond"]) { 
        }
        
        //packlist:박스목록 이벤트처리     
        else if(component==me.pageObj["packlist"]) { 
            //Box정보 조회 
            if(evt=="focus") {
                if(row >=0 ) {
                    var rowData = me.pageObj.packlist.getRowData(row); 
                    me.fnselectBoxGoods(rowData);
                }
            }
            if(evt=="click") { 
                //박스삭제 
                if ( col=="delete") { 
                    if(row >= 0 ) {
                        me.fndeleteBox(row); 
                    }
                }   
            } 
        }

        //goodslist:상품목록 이벤트처리     
        else if(component==me.pageObj["goodslist"]) {
            if(evt=="click" ) {
                //선택된 상품Row 삭제
                if ( col=="delete") { 
                   console.log(row);
                   me.fndeleteGoods(row);  

                //수량 더해주기/빼주기
                } else if( col=="plus") {
                    component.setVal(row,"qty",Number(component.getVal(row,"qty"))+1);
                    me.pageObj.goodslist.total("bottom");
                } else if ( col=="minus") {
                    component.setVal(row,"qty",component.getVal(row,"qty")-1);
                    me.pageObj.goodslist.total("bottom");

                } 
            }
        }  
    }


    //***************************************************************************/
    //search:조회 
    me.fnSearch=function() {
        var args = me.pageObj["pageCond"].exportData()[0];
        args.shopcd = me.pageObj.pageCond.getVal("shopcd");
        console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                me.pageObj["packlist"].importData(OUTVAR.list,"C");
                me.pageObj.packlist.sizeColumnsToFit();
                me.pageObj.mst.reset(); 
                me.pageObj.goodslist.reset();
                me.pageObj.packlist.total("top");
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    } 
    
   me.fnsearch=function() {
        var args = me.pageObj["pageCond"].exportData()[0];
        args.shopcd = me.pageObj.pageCond.getVal("shopcd");
        console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                me.pageObj["packlist"].importData(OUTVAR.list,"C");
                me.pageObj.packlist.sizeColumnsToFit();
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    } 
    
    //***************************************************************************/
    //신규 박스추가
    me.fnNew=function() { 
        var row =  me.pageObj.packlist.addRow();
        me.fnSaveBoxSeq(row);
    } 
    
    //신규박스 채번 
    me.fnSaveBoxSeq=function(num,fnCallback) {
        
        function fnSetseq() {
            var args = me.pageObj["pageCond"].exportData()[0];
            args.shopcd = me.pageObj.pageCond.getVal("shopcd");
            console.log(args);
            var invar = JSON.stringify(args);
            gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
                console.log(OUTVAR);
                if(OUTVAR.rtnCd=="OK") {
                    me.pageObj["packlist"].importData(OUTVAR.list,"C");
                    me.pageObj.packlist.sizeColumnsToFit();
                    var newnum= OUTVAR.list.length;
                    console.log(newnum);
                    var rowData = me.pageObj.packlist.getRowData(newnum-1); 
                    console.log(rowData);
                    me.fnselectBoxGoods(rowData);
                    me.page.find("#scan").focus();   
                } else {
                    gfnAlert("조회오류",OUTVAR.rtnMsg);
                }
            });
        } 
        
        var args = me.pageObj["mst"].exportData()[0];
        args.shopcd =  me.pageObj.pageCond.getVal("shopcd");
		console.log(args);
		var invar = JSON.stringify(args);
		gfnTx(appid+"."+pgmid,"saveBoxSeq",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {  
                me.pageObj.goodslist.reset(); 
                fnSetseq();
                if(!isNull(fnCallback)) fnCallback();
            } else {
                gfnAlert("채번 오류",OUTVAR.rtnMsg);
            }
        }); 
    } 
    
    //***************************************************************************/
    //박스삭제
    me.fndeleteBox=function(row) {
        var args = me.pageObj["packlist"].getRowData(row);
        function _fnDeleteBox() { 
            console.log(args);
            var invar = JSON.stringify(args);
            gfnTx(appid+"."+pgmid,"deleteBox",{INVAR:invar},function(OUTVAR){
                console.log(OUTVAR);
                if(OUTVAR.rtnCd=="OK") {
                    gfnStatus("삭제성공 - 입력한 정보가 삭제되었습니다."); 
                    me.fnSearch(); 
                } else {
                    gfnAlert("저장오류",OUTVAR.rtnMsg);
                     
                }
            });
        }
        if (args.cd_stat=='N'){
            gfnConfirm("패킹정보 삭제확인","패킹("+args.box_no+")와 상품정보를 삭제하시겠습니까?",function(rtn){
            if(rtn) _fnDeleteBox(); 
            });
        }
        else if (args.cd_stat=='Y'){
            gfnAlert("삭제 불가","삭제 불가능합니다");
        }
    }
    
    //***************************************************************************/
    //선택된 박스상품 조회
    me.fnselectBoxGoods=function(boxinfo) {
        var args = boxinfo;
        args.shopcd =  me.pageObj.pageCond.getVal("shopcd");
        console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"selectBoxGoods",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") { 
                me.pageObj.mst.importData([boxinfo]);
                me.pageObj["goodslist"].importData(OUTVAR.list,"C");
                me.pageObj.goodslist.sizeColumnsToFit(); 
                me.page.find("#scan").focus(); 
                var to_whcd = me.pageObj.mst.getVal("to_whcd") 
                var whcd_nm = gfnCdNm("whcd",to_whcd,"nm"); 
                me.pageObj.mst.setVal("to_wh_nm",whcd_nm); //nm
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }

    //***************************************************************************/
    //상품스캔 
    me.fnGoodsSearch=function() {
        if( isNull(me.pageObj.mst.getVal("box_no") )) {
            gfnStatus("패킹번호 확인 - 패킹을 선택하거나 신규 패킹을 생성 후 스캔하십시오.");
            me.page.find("#scan").val(""); 
            return;
        }
        var barcd = upper(me.page.find("input[name=scanbox]").val()); 
        if(isNull(barcd)) return;
        var args = {barcd : barcd};
        args.shopcd =  me.pageObj.pageCond.getVal("shopcd");
        var invar = JSON.stringify(args); 
        gfnTx(appid+"."+pgmid,"goodsSearch",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                
                if(isNull(OUTVAR.list)||OUTVAR.list.length==0) {
                    gfnStatus("상품검색오류 - 바코드 또는 상품코드에 해당하는 상품을 검색할 수 없습니다!");
                    return;
                }
                me.bEdit = true;
                var item = OUTVAR.list[0];
                /* 목록 중 상품이 있으면 수량을 증가시켜줌, 신규 건은 위로 쌓이도록 */
                var goodslist = me.pageObj.goodslist;
                var bSkipAdd = false;
                for(var i=0; i < goodslist.countRow(); i++) {
                    var row = goodslist.getNodeId(i);
                    if(goodslist.getVal(row,"goods_cd")==item.goods_cd) { //&& goodslist.getVal(row,"rtn_yn")!='Y'
                        goodslist.setVal(row,"qty", (toNum(goodslist.getVal(row,"qty"))+1) );    
                        bSkipAdd = true;
                        break;
                    }
                }
                if(!bSkipAdd) {
                    item.qty=1;
                    goodslist.addRow(item,-1);
                } 
                me.pageObj.goodslist.total("bottom");
                me.page.find("input[name=scanbox]").val(""); 
                me.page.find("#scan").focus(); 

            } else {
                gfnAlert("조회오류***"+OUTVAR.rtnCd, OUTVAR.rtnMsg);
            }
        });
    }

    //***************************************************************************/
    //save:저장 
    me.fnSaveGoods=function() {
        if( isNull(me.pageObj["mst"].getVal("box_no") )) {
            gfnStatus("패킹번호 확인 - 패킹을 선택하거나 신규 패킹을 생성 후 스캔하십시오.");
            me.page.find("#scan").val("");
            return;
        }        
        var args = me.pageObj["mst"].exportData()[0];
        args.shopcd =  me.pageObj.pageCond.getVal("shopcd");
        args.list = me.pageObj.goodslist.exportData();  
        if(isNull(args.list)||args.list.length==0) {
            gfnStatus("상품 저장오류 - 해당 패킹에 상품이 비었습니다!");
            me.fnselectBoxGoods(args);
            return;
        }
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"saveGoods",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                gfnStatus("패킹 상품정보 저장/삭제 성공");
                me.fnsearch();
            } else {
                gfnAlert("저장오류",OUTVAR.rtnMsg);
            }
        });        
    } 
    
    //***************************************************************************/
    //상품삭제
    me.fndeleteGoods=function(row) {
        me.pageObj.goodslist.delRow(row, true);
        me.fnSaveGoods();
    } 
    
    me.fnAddpackkey=function(){
       var searchPop = $("<div id='soPop' class='framepage active'></div>");
        var searchPopup = null;
        gfnLoad("fo_lg","popupPackKey",searchPop,function(){
            searchPopup = gfnPopup("패킹 키 등록",searchPop,{width:"80vw", height:900});
        })
        
        function _fnSearchPackKey() {
            searchPopup.dialog("close");
            gfnTx("aweportal.frameset","retrieveInit",{}, function(OUTVAR){ 
                if(OUTVAR.rtnCd=="OK") {
                     gds.comcd         = OUTVAR.comcd; 
                 me.pageObj["pageCond"] = new gfnComponent( me.pageid, "pageCond", me.dataDef["_pgm_data"]["pageCond"], me.fnEH, me); 
                } 
		    });
        }
        gParam.fncallback = _fnSearchPackKey;
    }
    
    me.fnExtraupload=function(){
       var searchPop = $("<div id='soPop' class='framepage active'></div>");
        var searchPopup = null;
        gfnLoad("fo_lg","popupPackUpload",searchPop,function(){
            searchPopup = gfnPopup("패킹 상품 리스트",searchPop,{width:"80vw", height:900});
        })
        
        function _fnSearchPack() {
            searchPopup.dialog("close");
            me.fnSearch();
            
        }
        gParam.whcd = me.pageObj.pageCond.getVal("shopcd");
        gParam.fncallback = _fnSearchPack;
    }

    me.fnaddGoods=function() {
        var shopcd = me.pageObj.pageCond.getVal("shopcd");
        var searchPop = $("<div id='soPop' class='framepage active'></div>");
        var searchPopup = null;
        gfnLoad("fo_pos","popupAddGoods",searchPop,function(){
            searchPopup = gfnPopup("패킹 상품 리스트",searchPop,{width:600, height:800});
        })

        function _fnSearchPack(arrPacklist) {
            var goodslist = me.pageObj.goodslist.exportData();
            goodslist = goodslist.concat(arrPacklist);
            me.pageObj.goodslist.importData(goodslist,"C");
            me.pageObj.goodslist.sizeColumnsToFit(); 
            if(!isNull(searchPopup)) searchPopup.dialog("close");
            me.pageObj.goodslist.total("bottom");
        }
        //팝업호출해서 열기.. 
        gParam.whcd = me.pageObj.pageCond.getVal("shopcd");
        gParam.fncallback = _fnSearchPack; 
    }

    me.fnPrintlabel=function() {
        var seldata = me.pageObj.packlist.exportData("selected")
        var selnum=seldata.length;
         var sortSeldata = seldata.sort();
        var n =0;
        var j =0;
        var goodscd = []; //박스별 상품코드 담아두는 리스트
        var goodsqty = []; //박스별 상품수량 담아두는 리스트
        var goodsnm = []; //박스별 상품명 담아두는 리스트
        var html_lst = [];
        for(var i = 0; i<selnum; i++){
            html_lst.push("html"+i);
        }

        var newPage = window.open('','_blank','directories=no,titlebar=no,toolbar=no, location=no, status=no, menubar=no, scrollbars=no,resizable=no, width=1024, height=1024');

        var idx=0;
        function fnAsync(){
            var args = sortSeldata[idx];        
            var total_qty = 0; //총수량
            var invar = JSON.stringify(args);
            if(idx<sortSeldata.length){
                gfnTx(appid+"."+pgmid,"selectBoxGoods",{INVAR:invar},function(OUTVAR){
                    console.log(OUTVAR);
                    if(OUTVAR.rtnCd=="OK") { 
                        for(var i = 0; i<OUTVAR.list.length; i++){
                        total_qty += Number(OUTVAR.list[i].qty);
                        goodscd.push(OUTVAR.list[i].goods_cd);
                        goodsnm.push(OUTVAR.list[i].goods_nm);
                        goodsqty.push(OUTVAR.list[i].qty);
                        }
                        openPrint(OUTVAR.INVAR,total_qty,goodscd,goodsnm,goodsqty); //OUTVAR.INVAR
                        total_qty=0;
                        goodscd.length=0;
                        goodsqty.length=0;
                        goodsnm.length=0;
                        n+=1;
                        idx++;
                        
                        fnAsync();
                    } else {
                    gfnAlert("조회오류",OUTVAR.rtnMsg);
                    }
                });
            }
        } 
        fnAsync();
        
        //박스수만큼 찍어낸다
        function openPrint(pack,total_qty,goodscd,goodsnm,goodsqty) {
            var k=n;
            //선택한 만큼 찍어낸다
            var whcd_nm = gfnCdNm("whcd",pack.to_whcd,"nm"); 

            
            html_lst[k] = "<html>";
            //사이즈 조절, css
            html_lst[k] += "<head><style type='text/css'> .boxLabel {border-collapse:collapse;border-spacing:0;text-align:center; vertical-align:middle; font-weight: bold;}.boxLabel .change{font-size:30px; font-weight: bold; border-bottom:hidden} .boxLabel .data{font-size:20px; padding:5px 2px;} .boxLabel .date{font-size: 15px;}.boxLabel .from{ font-size: 15px;} .boxLabel .to{font-size: 15px;}.boxLabel .code{font-size: 15px;} .boxLabel tr{border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal; font-size: 1;}.boxLabel td{border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal; font-size: 15px;}.boxLabel th{border-color:black; border-style:solid; border-width:1px; font-weight:bold;overflow:hidden; word-break:normal;} .boxLabel .goods{border-right: 4px black solid;} .boxLabel .boxNum_data{font-weight: bold; text-align:center; vertical-align:middle; font-size: 30px;} .barcode_img>object {width: 80%; height: 50px;} .boxLabel .boxNum{font-weight: bold; text-align:center; vertical-align:middle;}.boxLabel .allcnt_data{font-weight: bold; text-align:center; vertical-align:middle; font-size:30px;} /*Web Print*/ body {margin: 0; padding-left: 28; padding-top:18; padding-bottom:10;} .boxLabel{border: 3px black solid; width: 200mm/*112mm*/; /*225*/height: 140mm/*84mm*/; /*175*/}@page {size: 140mm 110mm; /*7.62cm 5.08cm 94 64 96 62*/ /*인쇄기본설정 => w:66mm, h:88mm*/margin: 0;}@media print {.page { margin: 0;border: initial; border-radius: initial; width: initial; min-height: initial; box-shadow: initial; background: initial; page-break-after: always; padding-top:38;}}</style></head>";
            html_lst[k] += "<body>";
            html_lst[k] += "<div class='page'>";
            html_lst[k] += "<table class='boxLabel' style='table-layout:fixed'>";
            html_lst[k] += "<thead>";
            
            html_lst[k] += "<tr><th class='date' style='width:25mm'>일자</th><th class='from' style='width:40mm;'>보내는곳</th><th class='code' style='width:30mm;'>코드</th><th class='code'>매장 박스번호</th><th class='to'>받는곳</th><th class='code' style='width:30mm;'>코드</th></tr>";
            
            //일자 형식 변환  ex) 2021-04-27
            var date = (seldata[k].box_dt).substring(0, 4)+"-"+(seldata[k].box_dt).substring(4, 6)+"-"+(seldata[k].box_dt).substring(6, 8);
            //매장 박스번호 - 박스번호에서 뒤에 4자리 가져오기 -> ex. ITS-20211213-0001
            var box_no_sub = pack.box_no.slice(-4); // ex.0001
            
            //일자, 보내는곳, 보내는곳코드, 받는곳, 받는곳코드
            html_lst[k] += "<tr><td style='font-size:17px;'>"+date+"</td>";
            html_lst[k] += "<td class = 'data'>" +gUserinfo.deptnm+ "</td>";
            html_lst[k] += "<td class = 'data'>" + pack.shopcd+ "</td>";
            html_lst[k] += "<td class = 'data'>" + box_no_sub + "</td>"; //박스번호 0001
            html_lst[k] += "<td class = 'data'>" + whcd_nm+ "</td>";
            html_lst[k] += "<td  class = 'data'>" + pack.to_whcd+ "</td></tr>";
            html_lst[k] += "</thead>";
            html_lst[k] += "<tbody>";
            j++;    

            //박스바코드 - 데이터
            var data   = pack.box_barcd; 
            var format = "code128"; 
            
            //console.log(data+":"+format);
            $(".barcode").barcode(data, format, {
                "barWidth"   : 1,
    		    "barHeight"  : 50,
    		    "moduleSize" : 5,
    		    "bgColor"    : 'hsl(0 0% 100%)',
    		    "color"      : 'hsl(0 0% 0%)',
    		    "fontSize"   : 10,
    		    "showHRI"    : true, // false시에 숫자 안보임
    		    "output"     : 'bmp', // 그려주는 방식을 css, svg, bmp, canvas 중에서 선택
            }).css("width","100%");
    
            src = $(".barcode object").attr("data");

            //반품(이동구분명) REA, REC, RED ...
            html_lst[k] += "<tr><td class='change'>"+"</td>";
            
            //박스바코드
            html_lst[k] += "<td class='barcode' colspan='5'><div class='barcode_img'><object type='image/bmp' data="+src+"></object></div></td></tr>";
        
            //박스바코드번호 형식 변환 (공백추가)
            var boxnum_sp = data.substr(0,5)+" "+data.substr(5,6)+" "+data.substring(11, );

            html_lst[k] += "<tr><td>" +"</td>";

            //박스바코드번호
            html_lst[k] += "<td class='boxNum_data' colspan='4'>"+boxnum_sp+"</td>";

            //박스별 총수량
            html_lst[k] += "<td class='allcnt_data' >"+total_qty+"ea</td></tr>";

            if(goodscd.length <= 10){ //상품 갯수가 10개 이하일때

                var cnt = 0;
                var cnt_right = 0;
                for(var i = 0; i<goodscd.length; i++){ 
                    cnt++;
                    html_lst[k] += "<tr>";
                    html_lst[k] += "<td>"+(i+1)+"</td>";
                    html_lst[k] += "<td>"+goodscd[i]+"</td>";
                    html_lst[k] += "<td class='goods'>"+goodsqty[i]+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "</tr>";
                }
                for(var i = 0; i<10-cnt; i++){
                    html_lst[k] += "<tr>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "<td class='goods'>"+"<br>"+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "</tr>";
                }
            }else { //상품 갯수가 10개 이상일 때
            
                var cnt_right = 0;

                if(goodscd.length <= 20){ //상품 갯수가 20개이하
                    
                    for(var i = 0; i<goodscd.length-10; i++){
                        cnt_right++;
                        html_lst[k] += "<tr>";
                        html_lst[k] += "<td>"+(i+1)+"</td>";
                        html_lst[k] += "<td>"+goodscd[i]+"</td>";
                        html_lst[k] += "<td class='goods'>"+goodsqty[i]+"</td>";
                        html_lst[k] += "<td>"+(i+11)+"</td>";
                        html_lst[k] += "<td>"+goodscd[i+10]+"</td>";
                        html_lst[k] += "<td>"+goodsqty[i+10]+"</td>";
                        html_lst[k] += "</tr>";
                    }
                    //console.log(cnt_right);
                    for(var i = cnt_right; i<10; i++){
                        html_lst[k] += "<tr>";
                        html_lst[k] += "<td>"+(i+1)+"</td>";
                        html_lst[k] += "<td>"+goodscd[i]+"</td>";
                        html_lst[k] += "<td class='goods'>"+goodsqty[i]+"</td>";
                        html_lst[k] += "<td>"+"<br>"+"</td>";
                        html_lst[k] += "<td>"+"<br>"+"</td>";
                        html_lst[k] += "<td>"+"<br>"+"</td>";
                        html_lst[k] += "</tr>";
                    }
                }else{ //상품 갯수가 20개 이상일때
                
                    for(var i = 0; i<9; i++){
                        html_lst[k] += "<tr>";
                        html_lst[k] += "<td>"+(i+1)+"</td>";
                        html_lst[k] += "<td>"+goodscd[i]+"</td>";
                        html_lst[k] += "<td class='goods'>"+goodsqty[i]+"</td>";
                        html_lst[k] += "<td>"+(i+11)+"</td>";
                        html_lst[k] += "<td>"+goodscd[i+11]+"</td>";
                        html_lst[k] += "<td>"+goodsqty[i+11]+"</td>";
                        html_lst[k] += "</tr>";
                    } 
                    html_lst[k] += "<tr>";
                    html_lst[k] += "<td>"+10+"</td>";
                    html_lst[k] += "<td>"+goodscd[9]+"</td>";
                    html_lst[k] += "<td class='goods'>"+goodsqty[9]+"</td>";
                    html_lst[k] += "<td>...</td>";
                    html_lst[k] += "<td>... 외"+ Number(goodscd.length-20) +"</td>";
                    html_lst[k] += "<td>...</td>";
                    html_lst[k] += "</tr>";
                }
            }
            html_lst[k] += "</tbody>";
            html_lst[k] += "</table>";
            html_lst[k] += "</div>";
            html_lst[k] += "</body>";
            html_lst[k] += "</html>";
            if(html_lst.length==k+1){
                for(var i = 0; i<html_lst.length; i++){
                newPage.document.write(html_lst[i]);
                }
                //newPage.document.write(html);
                 newPage.focus();
                 newPage.print();  
            }
        }
    }
    
    //print3 : 박스송장 발행
    me.fnPrintpack=function() {
        var seldata = me.pageObj.packlist.exportData("selected")
        var sortSeldata = seldata.sort();
        var selnum=seldata.length;
        var n =0;
        var j =0;
        var goodscd = []; //박스별 상품코드 담아두는 리스트
        var goodsqty = []; //박스별 상품수량 담아두는 리스트
        var goodsnm = []; //박스별 상품명 담아두는 리스트
        var html_lst = [];
        for(var i = 0; i<selnum; i++){
            html_lst.push("html"+i);
        }

        var newPage = window.open('','_blank','directories=no,titlebar=no,toolbar=no, location=no, status=no, menubar=no, scrollbars=no,resizable=no, width=1024, height=1024');
    
        var idx=0;
        //for(var k = 0; k<selnum; k++){ 
        function fnAsync(){
            var args = sortSeldata[idx];        
            var total_qty = 0; //총수량
            var invar = JSON.stringify(args);
            if(idx<sortSeldata.length){
                gfnTx(appid+"."+pgmid,"selectBoxGoods",{INVAR:invar},function(OUTVAR){
                    console.log(OUTVAR);
                    if(OUTVAR.rtnCd=="OK") { 
                        for(var i = 0; i<OUTVAR.list.length; i++){
                        total_qty += Number(OUTVAR.list[i].qty);
                        goodscd.push(OUTVAR.list[i].goods_cd);
                        goodsnm.push(OUTVAR.list[i].goods_nm);
                        goodsqty.push(OUTVAR.list[i].qty);
                        }
                        openPrint(OUTVAR.INVAR,total_qty,goodscd,goodsnm,goodsqty); //OUTVAR.INVAR
                        total_qty=0;
                        goodscd.length=0;
                        goodsqty.length=0;
                        goodsnm.length=0;
                        n+=1;
                        idx++;
                        
                        fnAsync();
                    } else {
                    gfnAlert("조회오류",OUTVAR.rtnMsg);
                    }
                });
            }
        } 
        fnAsync();
       
        function openPrint(pack,total_qty,goodscd,goodsnm,goodsqty) {
            var k=n;
            //선택한 만큼 찍어낸다
            var whcd_nm = gfnCdNm("whcd",pack.to_whcd,"nm"); 

            html_lst[k] = "<html>";
            //사이즈 조절, css
            html_lst[k] += "<head><style type='text/css'> .boxLabel {border-collapse:collapse;border-spacing:0;text-align:center; vertical-align:middle; font-weight: bold;}.boxLabel .change{font-size:30px; font-weight: bold; border-bottom:hidden}.boxLabel .data{font-size:20px; padding:5px 2px;} .boxLabel .date{font-size: 15px;}.boxLabel .from{ font-size: 15px;} .boxLabel .to{font-size: 15px;}.boxLabel .code{font-size: 15px;} .boxLabel tr{border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal; font-size: 1;}.boxLabel td{border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal; font-size: 13px;} .boxLabel th{border-color:black; border-style:solid; border-width:1px; font-weight:bold;overflow:hidden; word-break:normal;}.boxLabel .boxNum_data{font-weight: bold; text-align:center; vertical-align:middle; font-size: 30px;} .boxLabel .boxNum{font-weight: bold; text-align:center; vertical-align:middle;}.boxLabel .allcnt_data{font-weight: bold; text-align:center; vertical-align:middle; font-size:30px;} /*Web Print*/ body {margin: 0; padding-left: 28; padding-top:18;} .barcode_img>object {width: 80%; height: 50px;} .boxLabel{border: 3px black solid; width:100% height:100%}  .page {width: 210mm; min-height: 297mm;} @media print {.page { margin: 0;border: initial; border-radius: initial; width: initial; min-height: initial; box-shadow: initial; background: initial; page-break-after: always; /*padding-top:38;*/}}</style></head>";
            html_lst[k] += "<body>";
            html_lst[k] += "<div class='page'>";
            html_lst[k] += "<table class='boxLabel' style='table-layout:fixed'>";
            html_lst[k] += "<thead>";
            html_lst[k] += "<tr><th class='date' style='width:25mm'>일자</th><th class='from' style='width:35mm;'>보내는곳</th><th class='code' style='width:45mm;'>코드</th><th class='to' colspan='2' style='width:35mm;'>받는곳</th><th class='code' style='width:35mm;'>코드</th></tr>";
            
            //일자 형식 변환  ex) 2021-04-27
            var date = (pack.box_dt).substring(0, 4)+"-"+(pack.box_dt).substring(4, 6)+"-"+(pack.box_dt).substring(6, 8);

            
            //일자, 보내는곳, 보내는곳코드, 받는곳, 받는곳코드
            html_lst[k] += "<tr><td style='font-size:17px;'>"+ date +"</td>";
            html_lst[k] += "<td class = 'data'>" + gUserinfo.deptnm + "</td>";
            html_lst[k] += "<td class = 'data'>" + pack.shopcd + "</td>";
            html_lst[k] += "<td colspan='2'  class = 'data'>" +whcd_nm+ "</td>";
            html_lst[k] += "<td  class = 'data'>" + pack.to_whcd + "</td></tr>";
            html_lst[k] += "</thead>";
            html_lst[k] += "<tbody>";
        

            function goodsNm(x) {
                return (goodsnm[x]).substr(0, (goodsnm[x]).length - 11);
            }
            
            j++;    
           
           //상품명 뒤에 상품코드 자르고 상품명만 가져오기
           
            //박스바코드 - 데이터
            var data   = pack.box_barcd; 
            var format = "code128"; 
            
            //console.log(data+":"+format);
            $(".barcode").barcode(data, format, {
                "barWidth"   : 1,
    		    "barHeight"  : 50,
    		    "moduleSize" : 5,
    		    "bgColor"    : 'hsl(0 0% 100%)',
    		    "color"      : 'hsl(0 0% 0%)',
    		    "fontSize"   : 10,
    		    "showHRI"    : true, // false시에 숫자 안보임
    		    "output"     : 'bmp', // 그려주는 방식을 css, svg, bmp, canvas 중에서 선택
            }).css("width","100%");
    
            src = $(".barcode object").attr("data");

            //매장 박스번호 - 박스번호에서 뒤에 4자리 가져오기 -> ex. ITS-20211213-0001
            var box_no_sub = pack.box_no.slice(-4); // ex.0001
            
            //반품(이동구분명) REA, REC, RED ..
            html_lst[k] += "<tr><td rowspan='2' style='border-bottom:hidden;' class='change'>"+ "</td>";
            html_lst[k] += "<td style='font-size:15px;'>"+ "매장 패킹번호" +"</td>";
            //박스바코드
            html_lst[k] += "<td class='barcode' rowspan='2' colspan='4'><div class='barcode_img' style='width:400px;'><object type='image/bmp' data="+src+"></object></div></td></tr>";

        
            //매장박스번호
            html_lst[k] += "<td class = 'data'>"+ box_no_sub +"</td>";
            
            //박스바코드
            //html_lst[k] += "<td class='barcode' colspan='4'><div class='barcode_img' style='width:400px;'><object type='image/bmp' data="+src+"></object></div></td></tr>";
        
            //박스번호 형식 변환 (공백추가)
            var boxnum_sp = data.substr(0,5)+" "+data.substr(5,6)+" "+data.substring(11, );
            
            html_lst[k] += "<tr><td>" +"</td>";
            
            //박스번호
            html_lst[k] += "<td class='boxNum_data' colspan='4'>"+boxnum_sp+"</td>";

            //박스별 총수량
            html_lst[k] += "<td class='allcnt_data' >"+total_qty+"ea</td></tr>";

            //상품순번, 상품코드, 상품명, 수량, 확인수량, 비고
            html_lst[k] += "<tr>";
            html_lst[k] += "<td style='font-size:15px'>"+"No."+"</td>";
            html_lst[k] += "<td style='font-size:15px'>"+"상품코드"+"</td>";
            html_lst[k] += "<td style='font-size:15px'>"+"상품명"+"</td>";
            html_lst[k] += "<td style='font-size:15px'>"+"수량"+"</td>"; 
            html_lst[k] += "<td style='font-size:15px'>"+"확인수량"+"</td>"; 
            html_lst[k] += "<td style='font-size:15px'>"+"비고"+"</td>"; 
            html_lst[k] += "</tr>";

             for(var i = 0; i<38; i++){
               if(typeof goodscd[i]== "undefined"){
                    html_lst[k] += "<tr>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>";
                    html_lst[k] += "<td>"+"<br>"+"</td>"; 
                    html_lst[k] += "<td>"+"<br>"+"</td>"; 
                    html_lst[k] += "<td>"+"<br>"+"</td>"; 
                    html_lst[k] += "</tr>";
               }else{
                html_lst[k] += "<tr>";
                html_lst[k] += "<td>"+ (i+1) +"</td>";
                html_lst[k] += "<td>"+ goodscd[i] +"</td>";
                html_lst[k] += "<td>"+ goodsNm(i) +"</td>";
                html_lst[k] += "<td>"+ goodsqty[i] +"</td>"; 
                html_lst[k] += "<td>"+""+"</td>"; 
                html_lst[k] += "<td>" +"</td>"; 
                html_lst[k] += "</tr>";
               }
            }
            
            html_lst[k] += "</tbody>";
            html_lst[k] += "</table>";
            html_lst[k] += "</div>";
            html_lst[k] += "</body>";
            html_lst[k] += "</html>";
       
            if(html_lst.length==k+1){
                for(var i = 0; i<html_lst.length; i++){
                newPage.document.write(html_lst[i]);
                }
                //newPage.document.write(html);
                 newPage.focus();
                 newPage.print();  
            }
        } 
    }
    
    me.fnDelete=function() {
        var data = me.pageObj.packlist.exportData("selected");
        if(data.length <= 0) {
            gfnAlert("패킹삭제 확인","패킹목록에서 선택된 건이 없습니다.");
            return;
        }
        data.forEach(el=>{
           if(el.cd_stat=='X') {
               gfnStatus("이미 삭제된 패킹정보["+el.box_no+"]입니다!");
           } else if (el.cd_stat=='Y') { 
               gfnAlert("패킹삭제 확인","패킹정보["+el.box_no+"]는 물류문서에 지정되어 사용 중이므로 삭제할 수 없습니다.");
               return;
           }
        });
        var args = {};
        args.list = data; 
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"deletePacks",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                gfnAlert("저장성공","패킹정보를 삭제처리 하였습니다.");
                me.fnsearch();
            } else {
                gfnAlert("저장오류",OUTVAR.rtnMsg);
            }
        });    
    }


/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>