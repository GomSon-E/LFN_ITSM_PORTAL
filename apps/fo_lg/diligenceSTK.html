<style>[pgmid='diligenceSTK'].framepage .userClass { 
width:100%; 
}</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent flexRow">
    <div id='list' style="flex:1 1 50%" class="flexColumn"></div>
    <div style="flex:1 1 calc(50% - 3em)" class="flexColumn">
        <div id='mst'></div>
        <div id='det' class="flexColumn"></div> 
    </div> 
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "fo_lg";
    var pgmid = "diligenceSTK"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":1.6,"upd_dt":"2022-06-24 14:23:55","remark":"","pgmid":"diligenceSTK","proc_mst_id":"","pgm_stat":"Y","sort_seq":60,"app_pgmid":"fo_lg","shortcut":"","reg_dt":"2022-06-24 14:23:55","reg_usid":"jjr","pgm_nm":"1. 매장 재고실사","upd_usid":"jjr","pgm_tp":"UX","pgm_grp_nm":"재고실사","proc_mst_nm":"","app_pgm_nm":"물류","":"트랜젝션(메뉴)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-search","reg_dt":"2022-06-24 14:23:55","reg_usid":"","func_nm":"조회","upd_usid":"","upd_dt":"2022-06-24 14:23:55","func_tp":"DB_R","remark":"매장 특정상품의 현재고를 조회하고 실사결과 조정수량을 수불 반영하는 화면입니다.","pgmid":"diligenceSTK","sort_seq":"1","funcid":"search","content":"재고실사등록 현황 조회","crud":"R","id":"0"},{"func_icon":"fas fa-file","reg_dt":"2022-06-24 14:23:55","reg_usid":"","func_nm":"신규","upd_usid":"","upd_dt":"2022-06-24 14:23:55","func_tp":"EH","remark":null,"pgmid":"diligenceSTK","sort_seq":"2","funcid":"new","content":"신규 재고실사등록 시작","crud":"R","id":"1"},{"func_icon":"fas fa-save","reg_dt":"2022-06-24 14:23:55","reg_usid":"","func_nm":"임시저장","upd_usid":"","upd_dt":"2022-06-24 14:23:55","func_tp":"DB_W","remark":null,"pgmid":"diligenceSTK","sort_seq":"3","funcid":"save","content":"재고실사내역 저장","crud":"R","id":"2"},{"func_icon":"fas fa-check","reg_dt":"2022-06-24 14:23:55","reg_usid":"","func_nm":"확정(수불반영)","upd_usid":"","upd_dt":"2022-06-24 14:23:55","func_tp":"DB_W","remark":null,"pgmid":"diligenceSTK","sort_seq":"4","funcid":"cfm","content":"재고실사내역 수불반영","crud":"R","id":"3"},{"func_icon":"fas fa-print","reg_dt":"2022-06-24 14:23:55","reg_usid":"","func_nm":"재고실사표발행","upd_usid":"","upd_dt":"2022-06-24 14:23:55","func_tp":"EH","remark":null,"pgmid":"diligenceSTK","sort_seq":"5","funcid":"print","content":"재고실사표 발행","crud":"R","id":"4"},{"func_icon":"fas fa-trash","reg_dt":"2022-06-24 14:23:55","reg_usid":"","func_nm":"취소","upd_usid":"","upd_dt":"2022-06-24 14:23:55","func_tp":"DB_W","remark":null,"pgmid":"diligenceSTK","sort_seq":"6","funcid":"cancel","content":"수불반영내역 취소","crud":"R","id":"5"},{"func_icon":"fas fa-trash","reg_dt":"2022-06-24 14:23:55","reg_usid":"","func_nm":"삭제","upd_usid":"","upd_dt":"2022-06-24 14:23:55","func_tp":"DB_R","remark":null,"pgmid":"diligenceSTK","sort_seq":"7","funcid":"delete","content":"삭제처리","crud":"R","id":"6"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["pageCond"]={"sort_seq":"1","data_id":"pageCond","data_nm":"조회조건","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"whcd","colnm":"매장/창고","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"whcd","option":"multi:whcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":"실사일","colid":"dt_from","colnm":"일자_from","dtype":"ymd","etype":"txt","attr":"ymd","defval":"date(\"1st\")","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":"실사일","colid":"dt_to","colnm":"일자_to","dtype":"ymd","etype":"txt","attr":"ymd","defval":"date(\"today\")","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"cd_stat","colnm":"문서상태","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"SD_ORD_STAT","option":"multi:cd_stat::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"}]};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"2","data_id":"list","data_nm":"재고실사 목록","data_icon":null,"component_pgmid":"agGrid","component_option":{"remark":"* 실사 및 조정 소비자가액: VAT포함, 원가액: VAT제외"},"inout_tp":"OUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"lg_ord_no","colnm":"수불전표","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"cd_stat","colnm":"문서상태","dtype":"text","etype":"sel","attr":"readonly","defval":null,"w":null,"h":null,"refcd":"SD_ORD_STAT","option":"sel:cd_stat::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"lg_dt","colnm":"수불일","dtype":"ymd","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"whcd","colnm":"매장/창고","dtype":"text","etype":"sel","attr":"readonly","defval":null,"w":null,"h":null,"refcd":"whcd","option":"sel:whcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"내용/비고","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"sku_cnt","colnm":"상품수","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"stk_qty","colnm":"전산재고량","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":"실사","colid":"cfm_qty","colnm":"실사수량","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":"실사","colid":"cfm_price_amt","colnm":"소가액","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":10,"section":null,"section_icon":null,"colgrp":"실사","colid":"cfm_cost_amt","colnm":"원가액","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":11,"section":null,"section_icon":null,"colgrp":"조정","colid":"qty","colnm":"조정수량","dtype":"num","etype":"raw","attr":"keycol","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"},{"sort_seq":12,"section":null,"section_icon":null,"colgrp":"조정","colid":"init_price_amt","colnm":"소가액","dtype":"num","etype":"raw","attr":"keycol","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"11"},{"sort_seq":13,"section":null,"section_icon":null,"colgrp":"조정","colid":"cost_amt","colnm":"원가액","dtype":"num","etype":"raw","attr":"keycol","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"12"},{"sort_seq":14,"section":null,"section_icon":null,"colgrp":null,"colid":"upd_usid","colnm":"작업자","dtype":"text","etype":"sel","attr":"disabled","defval":null,"w":null,"h":null,"refcd":"USID","option":"sel:upd_usid::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"13"},{"sort_seq":15,"section":null,"section_icon":null,"colgrp":null,"colid":"upd_dt","colnm":"작업일","dtype":"text","etype":"raw","attr":"disabled","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"14"}]};
me.dataDef["_pgm_data"]["mst"]={"sort_seq":"3","data_id":"mst","data_nm":"재고실사 등록","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":"INOUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"lg_ord_no","colnm":"수불전표","dtype":"text","etype":"raw","attr":"pk","defval":"\"TBD\"","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"lg_dt","colnm":"수불일","dtype":"ymd","etype":"txt","attr":"ymd keycol","defval":"date(\"today\")","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"whcd","colnm":"매장/창고","dtype":"text","etype":"sel","attr":"keycol","defval":null,"w":null,"h":null,"refcd":"whcd","option":"sel:whcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"cd_stat","colnm":"문서상태","dtype":"text","etype":"sel","attr":"readonly","defval":"\"D\"","w":null,"h":null,"refcd":"SD_ORD_STAT","option":"sel:cd_stat::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"내용/비고","dtype":"text","etype":"txt","attr":"keycol","defval":null,"w":"50","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"}]};
me.dataDef["_pgm_data"]["det"]={"sort_seq":"4","data_id":"det","data_nm":"실사상품 목록","data_icon":null,"component_pgmid":"agGrid","component_option":{"gridOpt":"rn chk","gridOptions":{"singleClickEdit":"false"},"remark":"추가줄수:","content":[{"colid":"rowCnt","colnm":"줄수","dtype":"num","etype":"txt","defval":"1"}],"func":[{"funcid":"popSTK","func_nm":"현재고 가져오기","func_icon":"fas fa-open"},{"funcid":"addRow","func_nm":"줄추가","func_icon":"fas fa-plus"},{"funcid":"delRow","func_nm":"줄삭제","func_icon":"fas fa-minus"}]},"inout_tp":"INOUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_cd","colnm":"상품코드","dtype":"text","etype":"txt","attr":"pk","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"bf_stk_qty","colnm":"전산재고량","dtype":"num","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"cfm_qty","colnm":"실사수량","dtype":"num","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":"조정","colid":"qty","colnm":"조정수량","dtype":"num","etype":"raw","attr":"disabled","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":"조정","colid":"init_price","colnm":"소비자가","dtype":"num","etype":"raw","attr":"disabled ","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"\" \"","remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":"조정","colid":"init_price_amt","colnm":"소가액","dtype":"num","etype":"raw","attr":"disabled","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":"조정","colid":"cost_amt","colnm":"원가액","dtype":"num","etype":"raw","attr":"disabled","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"stk_qty","colnm":"현재고량","dtype":"num","etype":"raw","attr":"disabled","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */

    /* 사용자초기화 */
    me.fnInitExtra=function() {
        //탭 설정
        //gfnTab(pageid, "tabs", {"multi-active":"off","toggle-switch":"on"}); 
        //사용자 컴포넌트 
        //me.dataDef["_pgm_data"][myCompoId] = {...};
        //me.pageObj["myCompoId"] = new gfnComponent( me.pageid, myCompoId, me.dataDef["_pgm_data"][myCompoId], me.fnEH, me); 
        //me.pageObj["myCompoId"].userComponent = "myCompoId";
        //사용자 컨트롤
        //var myColinfo = {colid:...}
        //me.pageObj["myColId"] = new gfnControl(myColinfo, me.fnEH) 
        //me.page.find("#myCol").append(me.pageObj["myColId"].dispObj);
        //me.pageObj["myColId"].getVal(); / myCol.setVal(val);...    
        me.fnNew();
    }
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //pageCond:조회조건 이벤트처리     
        else if(component==me.pageObj["pageCond"]) { 
        }

        //list:재고실사 목록 이벤트처리     
        else if(component==me.pageObj["list"]) {
            if(evt=="focus") {
                if(row >= 0) { 
                    var lg_ord_no = component.getVal(row,"lg_ord_no");
                    // component.selectRows(undefined, false);
                    // component.selectRow(row);
                    me.fnSearchMst(lg_ord_no);
                } 
            }
        }

        //mst:재고실사 등록 이벤트처리     
        else if(component==me.pageObj["mst"]) { 
        }

        //det:실사상품 목록 이벤트처리     
        else if(component==me.pageObj["det"]) {
            if(evt=="componentFunc") {
                if(row=="popSTK") {
                    me.fnPopSTK();    
                } else if(row=="addRow") {
                    var copyrow = {}; 
                        copyrow["crud"] = "C"; 
                    var rowCnt = component._componentCond["rowCnt"].getVal();
                    var curData = component.exportData();
                    for(var i=0; i < rowCnt; i++) {
                        curData.push($.extend({},copyrow));
                    }
                    component.importData(curData); 
                    component.total("top");
                } else if(row=="delRow") {
                    component.delRow();
                    component.total("top");
                }
            }
            if(evt=="change") {
                component.setVal(row, "qty", toNum(component.getVal(row,"cfm_qty"))-toNum(component.getVal(row, "bf_stk_qty")));
                component.total("top");
            }
            if(evt=="paste"){
                 me.fnCalcSum();
                 me.pageObj.det.total("top");
            }
        } 
    }
    
    me.fnCalcSum = function() { //component, row, evt
        var det = me.pageObj.det.exportData();
        var sum = 0;
        for(var i=0; i < det.length; i++) {
            det[i].qty = toNum(det[i].cfm_qty-det[i].bf_stk_qty);
        }
        me.pageObj.det.importData(det);
        me.pageObj.det.total("top");
    }
    
    //search:조회 
    me.fnSearch=function() {
        if( !me.pageObj["pageCond"].chkValid() ) return;
        var args = me.pageObj["pageCond"].exportData()[0];
        //console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            //console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                me.pageObj["list"].importData(OUTVAR.list);
                me.pageObj["list"].total("top");
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }

    me.fnNew=function() {
        me.pageObj.mst.reset(); 
        me.pageObj.det.reset();
        me.fnSetMode();
    }
    
    me.fnPopSTK=function() {
        var whcd = me.pageObj.mst.getVal("whcd");
        var mov_dt = me.pageObj.mst.getVal("lg_dt");
        if(isNull(whcd)) {
            gfnAlert("재고조회 확인","매장/창고가 입력되지 않았습니다.");
            return; 
        }
        var searchPop = $("<div id='popSTK' class='framepage active'></div>");
        var searchPopup = null;
        
        gfnLoad("fo_lg","diligenceSTKpop",searchPop,function(){
            searchPopup = gfnPopup("매장/창고 재고현황",searchPop,{width:650, height:800});
        })

        function _fnPopSTK(arrlist) {
            console.log(arrlist);
            var det = me.pageObj.det.exportData();
            det = det.concat(arrlist);
            me.pageObj.det.importData(det,"C");
            if(!isNull(searchPopup)) searchPopup.dialog("close");
            me.pageObj.det.total("top");
        }
        //팝업호출해서 열기.. 
        gObj.whcd = whcd; 
        gObj.mov_dt = mov_dt;
        gObj.fnCallback = _fnPopSTK; 
    }

    //문서상태에 따른 폼 설정
    me.fnSetMode=function() {
        var mst = me.pageObj.mst.exportData()[0];
        var det = me.pageObj.det.exportData();
        
        me.pageObj.mst.reset();
        me.pageObj["mst"].importData(mst); 
        console.log(mst.cd_stat);
        if(isNull(mst.cd_stat) || mst.cd_stat=="D") {
            me.pageObj.mst.col["whcd"].obj.select2({dropdownAutoWidth : true});  
            /*
            "remark":"추가줄수:",
            "content":[{"colid":"rowCnt","colnm":"줄수","dtype":"num","etype":"txt","defval":"1"}],
            "func":[
              {"funcid":"popSTK","func_nm":"현재고 가져오기","func_icon":"fas fa-open"},    
              {"funcid":"addRow","func_nm":"줄추가","func_icon":"fas fa-plus"},
              {"funcid":"delRow","func_nm":"줄삭제","func_icon":"fas fa-minus"}]
            */
            me.pageObj.det.componentFunc.show();
            /*
            goods_cd	상품코드	1 -> 0
            bf_stk_qty	전산재고량	2 -> 1
            cfm_qty	실사수량	3 -> 2
            qty	조정수량	4 -> 3
            init_price	소비자가	5 -> 4
            init_price_amt	소가액	6 -> 5
            cost_amt	원가액	7 -> 6
            stk_qty	현재고량	8 -> 7
            */
            //me.dataDef._pgm_data.det.content[1].attr+=" hidden" 
            //me.dataDef._pgm_data.det.content[2].attr+=" hidden"
            me.dataDef._pgm_data.det.content[4].attr+=" hidden"
            me.dataDef._pgm_data.det.content[5].attr+=" hidden"
            me.dataDef._pgm_data.det.content[6].attr+=" hidden"
            me.dataDef._pgm_data.det.content[7].attr+=" hidden" 
        } else {
            me.pageObj.det.componentFunc.hide();
            //me.dataDef._pgm_data.det.content[1].attr = me.dataDef._pgm_data.det.content[1].attr.replaceAll(/ hidden/gi,""); 
            //me.dataDef._pgm_data.det.content[2].attr = me.dataDef._pgm_data.det.content[2].attr.replaceAll(/ hidden/gi,""); 
            me.dataDef._pgm_data.det.content[4].attr = me.dataDef._pgm_data.det.content[4].attr.replaceAll(/ hidden/gi,""); 
            me.dataDef._pgm_data.det.content[5].attr = me.dataDef._pgm_data.det.content[5].attr.replaceAll(/ hidden/gi,""); 
            me.dataDef._pgm_data.det.content[6].attr = me.dataDef._pgm_data.det.content[6].attr.replaceAll(/ hidden/gi,""); 
            me.dataDef._pgm_data.det.content[7].attr = me.dataDef._pgm_data.det.content[7].attr.replaceAll(/ hidden/gi,""); 
        } 
        me.pageObj.det.reset();        
        me.pageObj.det.importData(det);
        me.pageObj["det"].total("top");
    } 

    //searchMst:조회 
    me.fnSearchMst=function(lg_ord_no) {
        if( isNull(lg_ord_no)) return;
        var args = {lg_ord_no:lg_ord_no} 
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"searchMst",{INVAR:invar},function(OUTVAR){
            //console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") { 
                me.pageObj["mst"].importData(OUTVAR.mst); 
                me.pageObj["det"].importData(OUTVAR.det);
                me.fnSetMode(); 
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }
    
    //save:임시저장 
    me.fnSave=function() {
        if( !me.pageObj["mst"].chkValid() ) return;
        if( !me.pageObj["det"].chkValid() ) return;
        var args = me.pageObj["mst"].exportData()[0];
        args.det = me.pageObj["det"].exportData();
        //console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"save",{INVAR:invar},function(OUTVAR){
            //console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                gfnAlert("저장성공","입력한 정보가 저장되었습니다.");
                me.fnSearch();
                me.fnSearchMst(args.lg_ord_no);
                //me.fnNew();
            } else {
                gfnAlert("저장오류",OUTVAR.rtnMsg);
            }
        });
    }

    //cfm:확정(수불반영) 
    me.fnCfm=function() {
        if( !me.pageObj["mst"].chkValid() ) return;
        if( !me.pageObj["det"].chkValid() ) return;
        var args = me.pageObj["mst"].exportData()[0];
        if( args.cd_stat != 'D') {
            gfnAlert("확정(수불반영) 확인","임시저장 상태의 건만 확정할 수 있습니다.");
            return;
        }
        args.det = me.pageObj["det"].exportData();
        var invar = JSON.stringify(args);
        console.log(args);
        gfnTx(appid+"."+pgmid,"cfm",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                //서비스 후처리 : 
                gfnAlert("성공","수불반영 하였습니다."); 
                me.fnSearch();
                me.fnSearchMst(args.lg_ord_no);
                //me.fnNew();
            } else {
                gfnAlert("오류",OUTVAR.rtnMsg);
            }
        });
    }

    //cancel:취소 
    me.fnCancel=function() {
        if( !me.pageObj["mst"].chkValid() ) return;
        var args = me.pageObj["mst"].exportData()[0];
        if( args.cd_stat != 'F') {
            gfnAlert("확정취소 확인","완료 상태의 건만 확정취소 할 수 있습니다.");
            return;
        }
        console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"cancel",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                //서비스 후처리 : 
                gfnAlert("성공","수불반영 취소하였습니다."); 
                me.fnSearch();
                me.fnNew();
            } else {
                gfnAlert("오류",OUTVAR.rtnMsg);
            }
        });
    }
    

    //delete:삭제 
    me.fnDelete=function() {
        if( !me.pageObj["mst"].chkValid() ) return;
        var args = me.pageObj["mst"].exportData()[0];
        if( args.cd_stat != 'D') {
            gfnAlert("삭제 확인","임시저장 상태의 건만 삭제 할 수 있습니다.");
            return;
        }
        console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"delete",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                //서비스 후처리 : 
                gfnAlert("성공","등록정보를 삭제 상태변경 하였습니다."); 
                me.fnSearch();
                me.fnNew();
            } else {
                gfnAlert("오류",OUTVAR.rtnMsg);
            }
        });
    }

    //print: 재고실사표 발행 
    me.fnPrint2=function() {
        //var args = me.pageObj["list"].exportData("selected")[0];
        var args = me.pageObj.mst.exportData()[0];
        console.log(args);
        var invar = JSON.stringify(args);
        
        //일자 형식 변환  ex) 2021-04-27
        function dateSub(x){
            return x.substring(0, 4)+"-"+ x.substring(4, 6)+"-"+ x.substring(6, 8);    
        } 
        //콤마 추가
        function numCom(x){
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');    
        } 
        
        var html = "<html>";
        //사이즈 조절, css
        html += "<head><style type='text/css'> .stk, .stk2 {white-space:pre/*nowrap*/; border-collapse:collapse; border-spacing:0; /*text-align:center;*/ vertical-align:middle; font-weight: bold;} .stk .subsum7, .stk2 .subsum7 { background-color: hsl(90deg 85% 89%); } .stk .subsum15, .stk2 .subsum15{ background-color: hsl(120deg 80% 89%); } .stk .subsum31, .stk2 .subsum31 { background-color: hsl(200deg 75% 89%); } .stk .subsum127, .stk2 .subsum127 { background-color: hsl(200deg 65% 89%); } .stk .tag, .stk2 .tag{ border-top: 1px black solid; border-bottom: 1px black solid;} .stk .tag2, .stk2 .tag2{background-color: rgb(220, 220, 220);} .stk .pad, .stk2 .pad{text-align:right; /*padding-top:5px; padding-bottom:5px;*/} .stk tr, .stk2 tr{border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal; } .stk td, .stk2 td{padding-left: 5px; padding-right: 5px; font-size:12px; border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal;} .stk th, .stk2 th{ padding-left: 5px; padding-right: 5px; padding-top: 5px; padding-bottom: 5px; font-size:14px; border-color:black; border-style:solid; border-width:1px; font-weight:bold;overflow:hidden; word-break:normal;} /*Web Print*/ .stk, .stk2{border: 1px black solid;} .page {width: 210mm; min-height: 297mm;} @media screen {.stk2 .headnone { display: none; } } @media print { .stk2 .printnone{ display: none; }/*tr.pbreak {display: block; page-break-before: always;}*/ .stk, .stk2{ margin: 0;border: initial; border-radius: initial; width: initial; min-height: initial; box-shadow: initial; background: initial; page-break-before: always;}}</style></head>";
        html += "<body>";
        html += "<div class='page'>";
        html += "<table class='stk' style='table-layout:fixed'>";
        
        //발행 데이터 가져오기
        gfnTx(appid+"."+pgmid,"print",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.rtnCd=="OK") {
                console.log(OUTVAR);
                var mst = OUTVAR.mst[0]; //헤더
                var list = OUTVAR.list;  //요약
                var det = OUTVAR.det;    //상세
                
                /*******헤더*******************************************************************/
                html += "<thead>";
                mstTd(); //헤더 함수
                
                html += "<tbody>";
                /*******요약*******************************************************************/
                html += "<tr><th colspan='14' style='text-align:left; border-top:hidden; border-left:hidden; border-right:hidden;'>□ 요약</th</tr>";
                html += "<tr class='tag2'>";
                html += "<th rowspan='2' colspan='2'>구분</th>";
                html += "<th rowspan='2'>품목수</th>";
                html += "<th rowspan='2'>스타일수</th>";
                html += "<th rowspan='2'>상품수</th>";
                html += "<th colspan='3'>전산재고</th>";
                html += "<th colspan='3'>실사</th>";
                html += "<th colspan='3'>조정</th>";
                html += "</tr>";
                
                html += "<tr class='tag2'>";
                for(var i=0; i<3; i++){
                    html += "<th>수량</th>";
                    html += "<th>소가액</th>";
                    html += "<th>원가액</th>";
                }
                html += "</tr>";
                
                //요약 리스트
                for(var i =0; i<list.length; i++){
                    if(list[i].subsumrow=="subsum15") html += "<tr class='subsum15'>";
                    else if(list[i].subsumrow=="subsum31") html += "<tr class='subsum31'>";
                    else if(list[i].subsumrow=="subsum127") html += "<tr class='subsum127'>";
                    else html += "<tr>";
                    listTd(i); //요약 리스트 함수
                    html += "</tr>";
                }
                html += "</tbody>";
                
                html += "</table>";
                html += "<table class='stk2' style='table-layout:fixed'>";
                html += "<tbody>";
                
                /*******헤더*******************************************************************/
                html += "<thead class='headnone'>";
                mstTd(); //헤더함수
                
                /*******상세*******************************************************************/
                html += "<tr class='printnone'><th colspan='14' style='border-top:hidden; border-left:hidden; border-right:hidden; border-bottom:hidden;'>"+"<br>"+"</th</tr>";
                html += "<tr><th colspan='14' style='text-align:left; border-top:hidden; border-left:hidden; border-right:hidden;'>□ 브랜드 품목별</th</tr>";
                html += "<tr class='tag2'>";
                html += "<th rowspan='2' colspan='2' style='text-align:center;'>구분</th>";
                html += "<th rowspan='2' colspan='3''>상품코드</th>"; /* style='text-align:center;*/
                html += "<th colspan='3'>전산재고</th>";
                html += "<th colspan='3'>실사</th>";
                html += "<th colspan='3'>조정</th>";
                html += "</tr>";
                
                html += "<tr class='tag2'>";
                for(var i=0; i<3; i++){
                    html += "<th>수량</th>";
                    html += "<th>소가액</th>";  
                    html += "<th>원가액</th>";
                }
                html += "</tr>";
                
                //상세 리스트
                for(var i =0; i<det.length; i++){
                    if(det[i].subsumrow=="subsum7") html += "<tr class='subsum7'>";
                    else if(det[i].subsumrow=="subsum15") html += "<tr class='subsum15'>";
                    else if(det[i].subsumrow=="subsum31") html += "<tr class='subsum31'>";
                    else if(det[i].subsumrow=="subsum127") html += "<tr class='subsum127'>";
                    else html += "<tr>";
                    detTd(i); //상세 리스트 함수
                    html += "</tr>";
                }
                /*******************************************************************************/
                html += "</tbody>";
                html += "</table>";
                html += "</div>";
                html += "</body>";
                html += "</html>";
                
                function mstTd(){ //헤더함수
                    html += "<tr>";
                    html += "<th colspan='3' class='tag2'>제목</th>";
                    html += "<th colspan='2'>"+"재고실사표"+"</th>";
                    html += "<th colspan='2' class='tag2'>매장/창고</th>";
                    html += "<th colspan='3'>"+ mst.whcd +" "+ mst.wh_nm +"</th>";
                    html += "<th class='tag2'>실사일</th>"
                    html += "<th colspan='3'>"+ dateSub(mst.lg_dt)+ "</th>";
                    html += "</tr>";
                    
                    html += "<tr>";
                    html += "<th colspan='3' class='tag2'>내용/비고</th>";
                    html += "<th colspan='7'>"+ mst.remark+"</th>";
                    html += "<th class='tag2'>담당</th>"
                    html += "<th colspan='3'>"+ mst.usernm +" ("+ mst.upd_dt +")</th>";
                    html += "</tr>";
                    html += "<tr><th colspan='14' style='border-left:hidden; border-right:hidden; border-bottom:hidden;'>"+"<br>"+"</th></tr>";
                    html += "</thead>";
                }
                
                function detTd(i){ //상세 리스트 함수
                    html += "<td colspan = '2'>"+ det[i].grp_tp +"</td>";
                    html += "<td colspan = '3' style='text-align:center;'>"+ det[i].goods_cd +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(det[i].stk_qty),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(det[i].stk_price_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(det[i].stk_cost_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(det[i].cfm_qty),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(det[i].cfm_price_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(det[i].cfm_cost_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(det[i].adj_qty),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(det[i].adj_price_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(det[i].adj_cost_amt),'') +"</td>";
                }
                
                function listTd(i){ //요약 리스트 함수
                    html += "<td colspan = '2'>"+ list[i].grp_tp +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].item_cnt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].st_cnt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].goods_cnt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].stk_qty),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].stk_price_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].stk_cost_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].cfm_qty),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].cfm_price_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].cfm_cost_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].adj_qty),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].adj_price_amt),'') +"</td>";
                    html += "<td class='pad'>"+ nzl(numCom(list[i].adj_cost_amt),'') +"</td>";
                }
                
                //새로운 페이지로 열어서 인쇄
                var newPage = window.open('','_blank','directories=no,titlebar=no,toolbar=no, location=no, status=no, menubar=no, scrollbars=no,resizable=no, width=1024, height=1024');
                newPage.document.write(html);
                newPage.focus();
                newPage.print(); 
        
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }
    
    
    //print100: 재고실사표 발행 
    //me.fnPrint100=function() {
    me.fnPrint=function() {
        //var args = me.pageObj["list"].exportData("selected")[0];
        var args = me.pageObj.mst.exportData()[0];
        console.log(args);
        var invar = JSON.stringify(args);
        
        //일자 형식 변환  ex) 2021-04-27
        function dateSub(x){
            return x.substring(0, 4)+"-"+ x.substring(4, 6)+"-"+ x.substring(6, 8);    
        } 
        //콤마 추가
        function numCom(x){
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');    
        } 
        
        // var html = "<html>";
        // //사이즈 조절, css
        // html += "<head><style type='text/css'> .stk, .stk2 {white-space:pre/*nowrap*/; border-collapse:collapse; border-spacing:0; /*text-align:center;*/ vertical-align:middle; font-weight: bold;} .stk .subsum7 .stk2 .subsum7 { background-color: hsl(90deg 85% 89%); } .stk .subsum15, .stk2 .subsum15{ background-color: hsl(120deg 80% 89%); } .stk .subsum31, .stk2 .subsum31 { background-color: hsl(200deg 75% 89%); } .stk .subsum127, .stk2 .subsum127 { background-color: hsl(200deg 65% 89%); } .stk .tag, .stk2 .tag{ border-top: 1px black solid; border-bottom: 1px black solid;} .stk .tag2, .stk2 .tag2{background-color: rgb(220, 220, 220);} .stk .pad, .stk2 .pad{text-align:right; /*padding-top:5px; padding-bottom:5px;*/} .stk tr, .stk2 tr{border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal; } .stk td, .stk2 td{padding-left: 5px; padding-right: 5px; font-size:12px; border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal;} .stk th, .stk2 th{ padding-left: 5px; padding-right: 5px; padding-top: 5px; padding-bottom: 5px; font-size:14px; border-color:black; border-style:solid; border-width:1px; font-weight:bold;overflow:hidden; word-break:normal;} /*Web Print*/ .stk, .stk2{border: 1px black solid;} .page {width: 210mm; min-height: 297mm;} @media screen {.stk2 .headnone { display: none; } } @media print { .stk2 .printnone{ display: none; }/*tr.pbreak {display: block; page-break-before: always;}*/ .stk, .stk2{ margin: 0;border: initial; border-radius: initial; width: initial; min-height: initial; box-shadow: initial; background: initial; page-break-before: always;}}</style></head>";
        // html += "<body>";
        // html += "<div class='page'>";
        // html += "<table class='stk' style='table-layout:fixed'>";
        
        //발행 데이터 가져오기
        gfnTx(appid+"."+pgmid,"print",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.rtnCd=="OK") {
                
                
                
                
                console.log(OUTVAR);
                var mst = OUTVAR.mst[0]; //헤더
                var list = OUTVAR.list;  //요약
                var det = OUTVAR.det;    //상세
                


                

                var prtData = list.concat(det);
                var total = prtData.length;
                var cnt = Math.ceil(total/70); //프린트 수
                console.log(cnt);
                let df = prtData.filter(x => !list.includes(x)); // 결과 det
                
                    function _fnPrint100(mst, list2, det2) {
                        
                    var html = "<html>";
                    //사이즈 조절, css
                    html += "<head><style type='text/css'> .stk, .stk2 {white-space:pre/*nowrap*/; border-collapse:collapse; border-spacing:0; /*text-align:center;*/ vertical-align:middle; font-weight: bold;} .stk .subsum7, .stk2 .subsum7 { background-color: hsl(90deg 85% 89%); } .stk .subsum15, .stk2 .subsum15{ background-color: hsl(120deg 80% 89%); } .stk .subsum31, .stk2 .subsum31 { background-color: hsl(200deg 75% 89%); } .stk .subsum127, .stk2 .subsum127 { background-color: hsl(200deg 65% 89%); } .stk .tag, .stk2 .tag{ border-top: 1px black solid; border-bottom: 1px black solid;} .stk .tag2, .stk2 .tag2{background-color: rgb(220, 220, 220);} .stk .pad, .stk2 .pad{text-align:right; /*padding-top:5px; padding-bottom:5px;*/} .stk tr, .stk2 tr{border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal; } .stk td, .stk2 td{padding-left: 5px; padding-right: 5px; font-size:12px; border-color:black; border-style:solid; border-width:1px; overflow:hidden; word-break:normal;} .stk th, .stk2 th{ padding-left: 5px; padding-right: 5px; padding-top: 5px; padding-bottom: 5px; font-size:14px; border-color:black; border-style:solid; border-width:1px; font-weight:bold;overflow:hidden; word-break:normal;} /*Web Print*/ .stk, .stk2{border: 1px black solid;} .page {width: 210mm; min-height: 297mm;} @media screen {.stk2 .headnone { display: none; } } @media print { .stk2 .printnone{ display: none; }/*tr.pbreak {display: block; page-break-before: always;}*/ .stk, .stk2{ margin: 0;border: initial; border-radius: initial; width: initial; min-height: initial; box-shadow: initial; background: initial; page-break-before: always;}}</style></head>";
                    html += "<body>";
                    html += "<div class='page'>";
            
            
    
                    
                    
                    if(!isNull(list2) || list2.length!=0){
                        html += "<table class='stk' style='table-layout:fixed'>";
                        /*******헤더*******************************************************************/
                        html += "<thead>";
                        mstTd(); //헤더 함수
                        console.log("list2길이",list2.length);
                        console.log("프린트되는det2",det2);
                        
                        html += "<tbody>";
                        /*******요약*******************************************************************/
                        html += "<tr><th colspan='14' style='text-align:left; border-top:hidden; border-left:hidden; border-right:hidden;'>□ 요약</th</tr>";
                        html += "<tr class='tag2'>";
                        html += "<th rowspan='2' colspan='2'>구분</th>";
                        html += "<th rowspan='2'>품목수</th>";
                        html += "<th rowspan='2'>스타일수</th>";
                        html += "<th rowspan='2'>상품수</th>";
                        html += "<th colspan='3'>전산재고</th>";
                        html += "<th colspan='3'>실사</th>";
                        html += "<th colspan='3'>조정</th>";
                        html += "</tr>";
                        
                        html += "<tr class='tag2'>";
                        for(var i=0; i<3; i++){
                            html += "<th>수량</th>";
                            html += "<th>소가액</th>";
                            html += "<th>원가액</th>";
                        }
                        html += "</tr>";
                        
                        //요약 리스트
                        for(var i =0; i<list2.length; i++){
                            if(list2[i].subsumrow=="subsum15") html += "<tr class='subsum15'>";
                            else if(list2[i].subsumrow=="subsum31") html += "<tr class='subsum31'>";
                            else if(list2[i].subsumrow=="subsum127") html += "<tr class='subsum127'>";
                            else html += "<tr>";
                            listTd(i); //요약 리스트 함수
                            html += "</tr>";
                        }
                        html += "</tbody>";
                        
                        html += "</table>";
                    }
                    
                    if(!isNull(det2) || det2.length!=0){
                        
                        html += "<table class='stk2' style='table-layout:fixed'>";
                        html += "<tbody>";
                        
                        /*******헤더*******************************************************************/
                        html += "<thead class='headnone'>";
                        mstTd(); //헤더함수
                        
                        /*******상세*******************************************************************/
                        html += "<tr class='printnone'><th colspan='14' style='border-top:hidden; border-left:hidden; border-right:hidden; border-bottom:hidden;'>"+"<br>"+"</th</tr>";
                        html += "<tr><th colspan='14' style='text-align:left; border-top:hidden; border-left:hidden; border-right:hidden;'>□ 브랜드 품목별</th</tr>";
                        html += "<tr class='tag2'>";
                        html += "<th rowspan='2' colspan='2' style='text-align:center;'>구분</th>";
                        html += "<th rowspan='2' colspan='3''>상품코드</th>"; /* style='text-align:center;*/
                        html += "<th colspan='3'>전산재고</th>";
                        html += "<th colspan='3'>실사</th>";
                        html += "<th colspan='3'>조정</th>";
                        html += "</tr>";
                        
                        html += "<tr class='tag2'>";
                        for(var i=0; i<3; i++){
                            html += "<th>수량</th>";
                            html += "<th>소가액</th>";  
                            html += "<th>원가액</th>";
                        }
                        html += "</tr>";
                        
                        //상세 리스트
                        for(var i =0; i<det2.length; i++){
                            if(det2[i].subsumrow=="subsum7") html += "<tr class='subsum7'>";
                            else if(det2[i].subsumrow=="subsum15") html += "<tr class='subsum15'>";
                            else if(det2[i].subsumrow=="subsum31") html += "<tr class='subsum31'>";
                            else if(det2[i].subsumrow=="subsum127") html += "<tr class='subsum127'>";
                            else html += "<tr>";
                            detTd(i); //상세 리스트 함수
                            html += "</tr>";
                        }
                        /*******************************************************************************/
                        html += "</tbody>";
                        html += "</table>";
                    }
                    
                    html += "</div>";
                    html += "</body>";
                    html += "</html>";
                    
                    function mstTd(){ //헤더함수
                        html += "<tr>";
                        html += "<th colspan='3' class='tag2'>제목</th>";
                        html += "<th colspan='2'>"+"재고실사표"+"</th>";
                        html += "<th colspan='2' class='tag2'>매장/창고</th>";
                        html += "<th colspan='3'>"+ mst.whcd +" "+ mst.wh_nm +"</th>";
                        html += "<th class='tag2'>실사일</th>"
                        html += "<th colspan='3'>"+ dateSub(mst.lg_dt)+ "</th>";
                        html += "</tr>";
                        
                        html += "<tr>";
                        html += "<th colspan='3' class='tag2'>내용/비고</th>";
                        html += "<th colspan='7'>"+ mst.remark+"</th>";
                        html += "<th class='tag2'>담당</th>"
                        html += "<th colspan='3'>"+ mst.usernm +" ("+ mst.upd_dt +")</th>";
                        html += "</tr>";
                        html += "<tr><th colspan='14' style='border-left:hidden; border-right:hidden; border-bottom:hidden;'>"+"<br>"+"</th></tr>";
                        html += "</thead>";
                    }
                    
                    function detTd(i){ //상세 리스트 함수
                        html += "<td colspan = '2'>"+ det2[i].grp_tp +"</td>";
                        html += "<td colspan = '3' style='text-align:center;'>"+ det2[i].goods_cd +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(det2[i].stk_qty),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(det2[i].stk_price_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(det2[i].stk_cost_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(det2[i].cfm_qty),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(det2[i].cfm_price_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(det2[i].cfm_cost_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(det2[i].adj_qty),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(det2[i].adj_price_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(det2[i].adj_cost_amt),'') +"</td>";
                    }
                    
                    function listTd(i){ //요약 리스트 함수
                        html += "<td colspan = '2'>"+ list[i].grp_tp +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].item_cnt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].st_cnt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].goods_cnt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].stk_qty),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].stk_price_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].stk_cost_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].cfm_qty),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].cfm_price_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].cfm_cost_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].adj_qty),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].adj_price_amt),'') +"</td>";
                        html += "<td class='pad'>"+ nzl(numCom(list2[i].adj_cost_amt),'') +"</td>";
                    }
                    
                    //새로운 페이지로 열어서 인쇄
                    newPage = window.open('','_blank','directories=no,titlebar=no,toolbar=no, location=no, status=no, menubar=no, scrollbars=no,resizable=no, width=1024, height=1024, modal=yes');
                    //var prtPage = window.open('','_blank','directories=no,titlebar=no,toolbar=no, location=no, status=no, menubar=no, scrollbars=no,resizable=no, width=1024, height=1024, modal=yes');
                    newPage.document.write(html);
                    newPage.focus();
                    newPage.print();
                    //console.log(newPage);
                    html = "";
            
            
                    console.log("print done");
                        
                    //인쇄페이지에서 벗어났을 때
                    newPage.onbeforeunload = function(){
                    console.log("win unload");
                    
                    
                    console.log("상세페이지 리스트: ",df);
                    cnt = Math.ceil((df.length)/70); //프린트 수
                    console.log("상세페이지 프린트 수: ",cnt);
                    if(cnt > 10) {
                        gfnConfirm("연속출력 확인","상세리스트 100장씩 나누어 발행합니다.",function(rtn){ //발행대상(대상: "+prtData.length+" / 총 : "+total+")을 
                            if(rtn) {
                                var det2 = df.splice(0,700); //100개씩 데이터 교체
                                list = [];
                                console.log("넘어간det2",det2);
                                _fnPrint100(mst,list,det2);
                            }
                        });    
                    }else{
                        if(df.length == 0){ //모든 데이터 출력이 끝나면,
                            gfnAlert("연속출력 확인","재고실사표 발행이 완료되었습니다.");//, 총: "+cnt+"건이 완료되었습니다.");
                            return;
                        }
                        gfnConfirm("연속출력 확인","상세리스트 100장씩 나누어 발행합니다.",function(rtn){
                            if(rtn) {
                                var det2 = df.splice(0,700);
                                list = [];
                                console.log("넘어간det2",det2);
                                _fnPrint100(mst,list,det2);
                            }
                        }); 
                    }
                }
            }
                
                //총 패킹수 100개 이상일 경우 100건씩 나누어 발행
                if(cnt > 10) {
                    //요약페이지 먼저 출력
                    det = [];
                    _fnPrint100(mst, list, det);
                    
                    // gfnConfirm("연속출력 확인","발행대상(건수 : "+total+")을 100건씩 나누어 발행합니다.",function(rtn){
                    //     if(rtn) {
                    //         var data = prtData.splice(0,100); //100건씩 데이터 교체
                    //         _fnPrint100(data); //라벨찍어내는 함수
                    //     }
                    // });
                } else {
                    me.fnPrint2();
                    // var data = prtData.splice(0,100);
                    // _fnPrint100(data);
                }

            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
    }


/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>