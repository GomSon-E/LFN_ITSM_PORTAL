<style>
</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageTop"></div>
<div class="pageContent flexColumn"> 
    <div class="flexColumn">
    <div id='mst' style = "margin-bottom: 20px;"></div>
    <ul id="tabs">
        <li refid="goodslist">박스붙여넣기</li> 
        <li refid="goodslist2">박스붙여넣기2</li> 
        <li refid="hangerlist">행거붙여넣기</li> 
        <li refid="packlist">패킹목록</li>
    </ul>

       
        <div id='goodslist' ></div>
        <div id='goodslist2' ></div>
        <div id='hangerlist' ></div>
        <div id='packlist'  class="flexColumn" ></div>
    </div>
    
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "fo_lg";
    var pgmid = "popupPackUpload"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":2,"upd_dt":"2022-07-18 12:44:00","remark":"","pgmid":"popupPackUpload","proc_mst_id":"","pgm_stat":"Y","sort_seq":25,"app_pgmid":"fo_lg","shortcut":"","reg_dt":"2022-07-18 12:44:00","reg_usid":"lyj","pgm_nm":"20ss 패킹추가팝업","upd_usid":"lyj","pgm_tp":"TX","pgm_grp_nm":"출고","proc_mst_nm":"","app_pgm_nm":"물류","":"트랜젝션(화면)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-save","reg_dt":"2022-07-18 12:44:00","reg_usid":"","func_nm":"저장","upd_usid":"","upd_dt":"2022-07-18 12:44:00","func_tp":"DB_W","remark":null,"pgmid":"popupPackUpload","sort_seq":"2","funcid":"save","content":null,"crud":"R","id":"0"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["mst"]={"sort_seq":"1","data_id":"mst","data_nm":"기본정보","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":null,"content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"whcd","colnm":"창고코드","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"box_dt","colnm":"박스일자","dtype":"ymd","etype":"txt","attr":"ymd","defval":"date(\"today\")","w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"box_keycd","colnm":"키코드","dtype":"text","etype":"sel","attr":null,"defval":"20SS","w":null,"h":null,"refcd":"BOX_KEYCD ","option":"sel:box_keycd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"}]};
me.dataDef["_pgm_data"]["goodslist"]={"sort_seq":"2","data_id":"goodslist","data_nm":"박스붙여넣기","data_icon":null,"component_pgmid":"agGrid","component_option":{"gridOpt":"rn chk","gridOptions":{"singleClickEdit":"false"},"remark":"추가줄수:","content":[{"colid":"rowCnt","colnm":"줄수","dtype":"text","etype":"txt","defval":"10"}],"func":[{"funcid":"addRow","func_nm":"줄추가","func_icon":"fas fa-plus"},{"funcid":"delRow","func_nm":"줄삭제","func_icon":"fas fa-minus"},{"funcid":"selectpack","func_nm":"패킹생성","func_icon":"fas fa-check"},{"funcid":"reset","func_nm":"비우기"}]},"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"brcd","colnm":"브랜드","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"pack_tp","colnm":"운송그룹","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"goods","colnm":"상품","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"out_qty","colnm":"출고수량","dtype":"num","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"qty","colnm":"실수량","dtype":"num","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"ct_num","colnm":"C/T 계","dtype":"num","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"ct_qty","colnm":"C/T 수","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고(데이터검증)","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"20","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"}]};
me.dataDef["_pgm_data"]["goodslist2"]={"sort_seq":"3","data_id":"goodslist2","data_nm":"박스붙여넣기2","data_icon":null,"component_pgmid":"agGrid","component_option":{"gridOpt":"rn chk","gridOptions":{"singleClickEdit":"false"},"remark":"추가줄수:","content":[{"colid":"rowCnt","colnm":"줄수","dtype":"text","etype":"txt","defval":"10"}],"func":[{"funcid":"addRow","func_nm":"줄추가","func_icon":"fas fa-plus"},{"funcid":"delRow","func_nm":"줄삭제","func_icon":"fas fa-minus"},{"funcid":"selectpack","func_nm":"패킹생성","func_icon":"fas fa-check"},{"funcid":"reset","func_nm":"비우기"}]},"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"boxnum","colnm":"박스번호","dtype":"num","etype":null,"attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"goods","colnm":"스타일","dtype":"text","etype":null,"attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"qty","colnm":"수량","dtype":"num","etype":null,"attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"}]};
me.dataDef["_pgm_data"]["hangerlist"]={"sort_seq":"4","data_id":"hangerlist","data_nm":"행거붙여넣기","data_icon":null,"component_pgmid":"agGrid","component_option":{"gridOpt":"rn chk","gridOptions":{"singleClickEdit":"false"},"remark":"추가줄수:","content":[{"colid":"rowCnt","colnm":"줄수","dtype":"text","etype":"txt","defval":"10"}],"func":[{"funcid":"addRow","func_nm":"줄추가","func_icon":"fas fa-plus"},{"funcid":"delRow","func_nm":"줄삭제","func_icon":"fas fa-minus"},{"funcid":"selecthang","func_nm":"패킹생성","func_icon":"fas fa-check"},{"funcid":"reset","func_nm":"비우기"}]},"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"brcd","colnm":"브랜드","dtype":"text","etype":null,"attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"pack_tp","colnm":"운송그룹","dtype":"text","etype":null,"attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"goods","colnm":"상품","dtype":"text","etype":null,"attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"out_qty","colnm":"출고수량","dtype":"num","etype":null,"attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"qty","colnm":"실수량","dtype":"num","etype":null,"attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"hang_qty","colnm":"행거수량","dtype":"num","etype":null,"attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고(데이터검증)","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"20","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"}]};
me.dataDef["_pgm_data"]["packlist"]={"sort_seq":"5","data_id":"packlist","data_nm":"패킹목록","data_icon":null,"component_pgmid":"agGrid","component_option":null,"inout_tp":"OUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"box_barcd","colnm":"박스바코드","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"count(\"box_barcd\")+\"건\"","remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"pack_tp","colnm":"운송그룹","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"PACK_TP","option":"sel:pack_tp::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_cd","colnm":"상품","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"qty","colnm":"실수량","dtype":"num","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"비고","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */

    /* 사용자초기화 */
    me.fnInitExtra=function() {
        gfnTab(pageid, "tabs");
        if(isNull(gParam.whcd)) {
            gfnAlert("등록하려는 창고정보가 없습니다.","팝업창을 닫고 먼저 조회조건 - 창고코드를 지정한 후 작업하시기 바랍니다.");
            return;
        } else {
            me.fncallback = gParam.fncallback;
            me.pageObj.mst.setVal("whcd",gParam.whcd);
        }
        me.myBoxlist = gParam.myBoxlist; 
        me.whcd =gParam.whcd;
        me.chkval=true;

    }
    
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }  
        else if(component==me.pageObj["goodslist"]) {
            if(evt=="componentFunc") {
                if(row=="addRow") {
                    var copyrow = {}; 
                    var rowCnt = component._componentCond["rowCnt"].getVal();
                    var curData = component.exportData();
                    for(var i=0; i < rowCnt; i++) {
                        curData.push($.extend({},copyrow));
                    }
                    component.importData(curData); 
                    me.bEdit = true;
                } else if(row=="selectpack") {  
                    me.fnSelect();
                } else if(row=="delRow") {
                    component.delRow();
                } else if(row=="reset"){
                    me.pageObj.goodslist.reset();
                    
                }
            }
            if(evt=="paste") {
                gfnAlert(1,"붙여넣은 데이터를 점검합니다!"); //gfnAlert의 첫번째 아규먼트를 숫자로 지정하면 로딩바 표시
                setTimeout( me.fnChkGoods, 1);  
            }
        }else if(component==me.pageObj["goodslist2"]) {
            if(evt=="componentFunc") {
                if(row=="addRow") {
                    var copyrow = {}; 
                    var rowCnt = component._componentCond["rowCnt"].getVal();
                    var curData = component.exportData();
                    for(var i=0; i < rowCnt; i++) {
                        curData.push($.extend({},copyrow));
                    }
                    component.importData(curData); 
                    me.bEdit = true;
                } else if(row=="selectpack") {  
                    me.fnSelect2();
                } else if(row=="delRow") {
                    component.delRow();
                } else if(row=="reset"){
                    me.pageObj.goodslist2.reset();
                    
                }
            }
            if(evt=="paste") {
                gfnAlert(1,"붙여넣은 데이터를 점검합니다!"); //gfnAlert의 첫번째 아규먼트를 숫자로 지정하면 로딩바 표시
                setTimeout( me.fnChkGoods, 1);  
            }
        }
        else if(component==me.pageObj["hangerlist"]) {
            if(evt=="componentFunc") {
                if(row=="addRow") {
                    var copyrow = {}; 
                    var rowCnt = component._componentCond["rowCnt"].getVal();
                    var curData = component.exportData();
                    for(var i=0; i < rowCnt; i++) {
                        curData.push($.extend({},copyrow));
                    }
                    component.importData(curData); 
                    me.bEdit = true;
                } else if(row=="selecthang") {  
                    me.fnSelectHang();
                } else if(row=="delRow") {
                    me.bEdit = true;
                    component.delRow();
                } else if(row=="reset"){
                    me.pageObj.hangerlist.reset();
                    
                }
            }
            if(evt=="paste") {
                gfnAlert(1,"붙여넣은 데이터를 점검합니다!"); //gfnAlert의 첫번째 아규먼트를 숫자로 지정하면 로딩바 표시
                setTimeout( me.fnChkGoods, 1);  
            }
        }
    }
    
    me.fnChkGoods=function() {
        //.... 로직수행 ...  
        $("#onloading1").remove(); //로딩바 숨기기
        
    }
    
    me.fnSelect=function() {
        var box_keycd = me.pageObj.mst.getVal("box_keycd");
        var whcd = me.pageObj.mst.getVal("whcd");
        var box_dt = me.pageObj.mst.getVal("box_dt");
        var src = me.pageObj.goodslist.exportData();
        var data = [];
        src = sort(src,"goods"); //상품코드로 정렬 후 작업시작
        var item_key = ""; //상품코드 앞 6자리 
        var box_barcd="";
        var box_seq=0;
        me.chkval=true;

        function checkFunc() {    
            for(var i=0; i < src.length; i++) {
                var srcrow = src[i];
                var ct_qty = src[i].ct_qty;
                var total=0;
                var totalbox=0;
                if(isNull(srcrow.brcd) && isNull(srcrow.goods)){
                   break;
                }
                if (srcrow.goods != null && srcrow.brcd != null && ct_qty==null){
                    src[i].remark = "오류: C/T정보가 없음";
                    me.chkval=false;
                    console.log(i);
                    continue;
                }else{
                        
                    ct_qty=ct_qty.replace(/[^0-9*,]+/g,'');
                    var srcrowarr = ct_qty.split(",");  //5*4,7   20,21   1
                    for(var j=0; j < srcrowarr.length; j++) {
                        if(srcrowarr[j].indexOf('*')>-1) {
                            var el = srcrowarr[j].split("*");
                            total = total + toNum(el[0]) * toNum(el[1]);
                            totalbox=totalbox+toNum(el[1]);
                        }
                        else{
                            total += toNum(srcrowarr[j]);
                            totalbox += 1;
                        }
                    }
                    if(total != src[i].qty){
                        me.chkval=false;
                        src[i].remark = "실수량과 C/T 수 불일치";
                        console.log(i);
                        //gfnAlert("오류","실수량과 C/T 수 일치여부를 확인해주세요");
                    }
                    else if(totalbox != src[i].ct_num ){
                        me.chkval=false;
                        src[i].remark = "C/T계와 C/T 수 불일치";
                        console.log(i);
                    }
                    // else{
                    //      src[i].remark = "";
                    // }
                    me.pageObj.goodslist.setVal(i,"ct_qty",ct_qty);
                }
                //C/T계가 1이면 실수량으로 1건 넣어줌 
                if(toNum(src[i].ct_num)==1){
                    var row = {box_keycd:box_keycd};
                    //추가될Row값 세팅
                    row.box_barcd = whcd+box_dt+(""+box_seq).zf(6);
                    row.pack_tp   = (srcrow.pack_tp=="B")?"BOX":"HANGER";
                    row.goods_cd  = srcrow.goods;
                    row.qty       = toNum(srcrow.qty); 
                    row.goods_seq = 1;
                    row.tab_tp    = "";
                    data.push(row);
                    box_seq++;
                //ct_qty 를 분해해서 row 추가     
                } else {
                    if(isNull(srcrow) || isNull(srcrow.ct_qty) ) {

                        src[i].remark = "오류: C/T정보가 없음";
                        console.log(i);
                        me.chkval=false;
                        continue;
                    }
                    var srcrowarr = (srcrow.ct_qty).split(",");  //5*4,7   20,21   1
                    if(srcrowarr.length < 1) {
                        src[i].remark = "오류: 처리할 수 있는 C/T정보가 없음";
                        console.log(i);
                        me.chkval=false;
                        continue;
                    }   
                    for(var j=0; j < srcrowarr.length; j++) {
                        var srcrowarrrow = srcrowarr[j]; //5*4  20  1
                        var el = srcrowarrrow.split("*");
                        var loopcnt = el.length==1?1:toNum(el[1]); 
                        for(var k=0; k < loopcnt; k++) {
                            var row = {box_keycd:box_keycd};
                            //추가될Row값 세팅
                            row.box_barcd = whcd+box_dt+(""+box_seq).zf(6);
                            row.pack_tp   = (srcrow.pack_tp=="B")?"BOX":"HANGER";
                            row.goods_cd  = srcrow.goods;
                            row.qty       = toNum(el[0]); 
                            row.tab_tp    = "";
                            row.goods_seq = 1;
                            data.push(row); 
                            box_seq++;
                        } 
                    }  
                }
                console.log(me.chkval)
            } //end of for i (src loop)
            me.pageObj.goodslist.importData(src);
            me.pageObj.packlist.importData(data);
            if(me.chkval){
                me.page.find("#tabs li[refid='packlist']").trigger("click");
            }else{
                gfnAlert("생성실패","[비고란]의 오류 내역 확인해주세요");
            }
            me.pageObj.goodslist.total("top");
            me.pageObj.packlist.total("top");
        }
        
        var args = me.pageObj["mst"].exportData()[0];
		console.log(args);
		var invar = JSON.stringify(args);
		gfnTx(appid+"."+pgmid,"selectBoxSeq",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {  
               box_barcd=OUTVAR.box_barcd;
               box_seq=toNum(OUTVAR.box_seq);
               checkFunc()
            } else {
                gfnAlert("채번 오류",OUTVAR.rtnMsg);
            }
        }); 
    }
    
    me.fnSelect2=function() {
        var box_keycd = me.pageObj.mst.getVal("box_keycd");
        var whcd = me.pageObj.mst.getVal("whcd");
        var box_dt = me.pageObj.mst.getVal("box_dt");
        var src = me.pageObj.goodslist2.exportData();
        var data = [];
        var item_key = ""; //상품코드 앞 6자리 
        me.chkval=true;
        var box_barcd="";
        var box_seq=0;
        var boxnum = "";
        var goods_seq=1;
        function checkFunc() {
            for(var i=0; i < src.length; i++) {
                var srcrow = src[i];
                var qty = src[i].qty;
                var total=0;
                var totalbox=0;
                
                if(isNull(srcrow.boxnum) && isNull(srcrow.goods) && isNull(srcrow.qty)){
                   break;
                }
                //박스번호 바뀌면
                if(boxnum != srcrow.boxnum ){
                    if(i != 0){
                      box_seq++; 
                      goods_seq=1;
                    }
                    boxnum = srcrow.boxnum
                    var row = {box_keycd:box_keycd};
                    //추가될Row값 세팅
                    row.box_barcd = whcd+box_dt+box_seq.zf(6);
                    row.pack_tp   = "BOX";
                    row.goods_cd  = srcrow.goods;
                    row.goods_seq = goods_seq
                    row.qty       = toNum(srcrow.qty); 
                    row.remark    = boxnum;
                    row.tab_tp    = "BOX2";
                    data.push(row);
                    goods_seq++;
                    
                //박스번호 같으면    
                } else {
                    var row = {box_keycd:box_keycd};
                    //추가될Row값 세팅
                    row.box_barcd = whcd+box_dt+box_seq.zf(6);
                    row.pack_tp   = "BOX";
                    row.goods_cd  = srcrow.goods;
                    row.goods_seq = goods_seq
                    row.qty       = toNum(srcrow.qty);
                    row.remark    = boxnum;
                    row.tab_tp    = "BOX2";
                    data.push(row);
                    goods_seq++;
                }
                
                
            } //end of for i (src loop)
            
            me.pageObj.goodslist2.importData(src);
            me.pageObj.packlist.importData(data);
            if(me.chkval){
                me.page.find("#tabs li[refid='packlist']").trigger("click");
            }else{
                gfnAlert("생성실패","[비고란]의 오류 내역 확인해주세요");
            }
            me.pageObj.goodslist2.total("top");
            me.pageObj.packlist.total("top");
                
            }
        var args = me.pageObj["mst"].exportData()[0];
		console.log(args);
		var invar = JSON.stringify(args);
		gfnTx(appid+"."+pgmid,"selectBoxSeq",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {  
               box_barcd=OUTVAR.box_barcd;
               box_seq=toNum(OUTVAR.box_seq);
               checkFunc()
            } else {
                gfnAlert("채번 오류",OUTVAR.rtnMsg);
            }
        }); 
    }

    me.fnSelectHang=function() {
        var box_keycd = me.pageObj.mst.getVal("box_keycd");
        var whcd = me.pageObj.mst.getVal("whcd");
        var box_dt = me.pageObj.mst.getVal("box_dt");
        console.log(box_dt);
        var src = me.pageObj.hangerlist.exportData();
        var data = [];
        src = sort(src,"brcd"); //브랜드로 정렬 후 작업시작
        var item_key = ""; //상품코드 앞 6자리 
        me.chkval=true;
        var box_barcd="";
        var box_seq=0;
        var brcd = "";
        var goods_seq=1;
        function checkFunc() {
            for(var i=0; i < src.length; i++) {
                var srcrow = src[i];
                var qty = src[i].qty;
                var total=0;
                var totalbox=0;
                
                if(isNull(srcrow.brcd) && isNull(srcrow.goods)){
                   break;
                }else{
                        
                    if(qty != src[i].hang_qty){
                        me.chkval=false;
                        src[i].remark = "오류 : 실수량과 행거수량 불일치";
                    }
                    else{
                         src[i].remark = "";
                    }
                }
                //브랜드 바뀌면
                if(brcd != srcrow.brcd ){
                    if(i != 0){
                      box_seq++; 
                      goods_seq=1;
                    }
                    brcd = srcrow.brcd
                    var row = {box_keycd:box_keycd};
                    //추가될Row값 세팅
                    row.box_barcd = whcd+box_dt+box_seq.zf(6);
                    row.pack_tp   = (srcrow.pack_tp=="B")?"BOX":"HANGER";
                    row.goods_cd  = srcrow.goods;
                    row.goods_seq = goods_seq
                    row.qty       = toNum(srcrow.qty); 
                    row.remark    = brcd;
                    row.tab_tp    = "";
                    data.push(row);
                    goods_seq++;
                    
                //브랜드 같으면    
                } else {
                    var row = {box_keycd:box_keycd};
                    //추가될Row값 세팅
                    row.box_barcd = whcd+box_dt+box_seq.zf(6);
                    row.pack_tp   = "HANGER";
                    row.goods_cd  = srcrow.goods;
                    row.goods_seq = goods_seq
                    row.qty       = toNum(srcrow.qty);
                    row.remark    = brcd;
                    row.tab_tp    = "";
                    data.push(row);
                    goods_seq++;
                }
            }
            
            me.pageObj.hangerlist.importData(src);
            me.pageObj.packlist.importData(data);
            if(me.chkval){
                me.page.find("#tabs li[refid='packlist']").trigger("click");
            }else{
                gfnAlert("생성실패","[비고란]의 오류 내역 확인해주세요");
            }
            me.pageObj.hangerlist.total("top");
            me.pageObj.packlist.total("top");
                
        }
        var args = me.pageObj["mst"].exportData()[0];
		console.log(args);
		var invar = JSON.stringify(args);
		gfnTx(appid+"."+pgmid,"selectBoxSeq",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {  
               box_barcd=OUTVAR.box_barcd;
               box_seq=toNum(OUTVAR.box_seq);
               checkFunc()
            } else {
                gfnAlert("채번 오류",OUTVAR.rtnMsg);
            }
        }); 
    }
    
    me.fnSave=function() {    
        var args = me.pageObj["mst"].exportData()[0];
        var list = me.pageObj.packlist.exportData();  
        var findString = "오류";
        var total = list.length;
        
        function _fnSave() {
            if(me.chkval){
                args.list = list.splice(0,100);
                var invar = JSON.stringify(args);
                console.log(args);
                gfnTx(appid+"."+pgmid,"savePack",{INVAR:invar},function(OUTVAR){
                    console.log(OUTVAR);
                    if(OUTVAR.rtnCd=="OK") {
                        if(list.length > 0) {
                            gfnStatus(list.length+"/"+total+" 건 저장중...");
                            _fnSave();
                        } else {
                            gfnAlert("저장 완료","모든 패킹정보가 저장되었습니다.");
                            me.fncallback();
                        }
                    } else {
                        gfnAlert("저장 오류",OUTVAR.rtnMsg);
                    }
                });    
            }else{
                gfnAlert("저장실패","오류 내역 확인해주세요");
            }
       }
       _fnSave(); 
    }

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>