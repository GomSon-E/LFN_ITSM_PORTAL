<style>[pgmid='uploadImage'].framepage #imgPreview {
    padding: 10px;
    overflow: auto;
}

[pgmid='uploadImage'].framepage #list, .framepage #upList {
    display: inline;
    flex-wrap: wrap;
    padding: 1em;
    height: 50.5em;
    overflow-y: auto; 
}

[pgmid='uploadImage'].framepage #list li, .framepage #upList li {
    display: flex !important;
    flex-direction: column;
    align-content: space-between;
    justify-content: space-between; 
    background-color: #fefefe;
    border: 1px solid #aeaeae;
    padding: 0.5em;
    text-align: center;
    margin: 0.25em;     
    height: 170px;
    overflow-y:hidden;
    float: left;
}

[pgmid='uploadImage'].framepage #list li:hover {
    border-color: red;
}

[pgmid='uploadImage'].framepage #list li img {
    width: 128px; 
    height: 110px;
    cursor: pointer;
}

[pgmid='uploadImage'].framepage #upList img {
    width: 150px; 
    height: 120px; 
    cursor: pointer;
    margin: 10px 10px 10px 10px;
}

[pgmid='uploadImage'] ul {
    list-style: none;
    padding-left: 0px;
}
[pgmid='uploadImage'] .goodsArea {
    border : 3px solid black; 
    width : 100%; 
    height : 380px
}
[pgmid='uploadImage'] #imgPreview {
    border-left: 1px solid #cbc3c3;
}
[pgmid='uploadImage'] #imgPreview .image {
    width: 90%;
    height: 90%;
    margin: 16px;
}
[pgmid='uploadImage'] .imgArea {
    width: 49.8%;
    height: 380px;
    overflow-x: auto;
    overflow-y: auto;
    display: inline-block;
    border-right: 1px solid black;
    text-align: center;
}
[pgmid='uploadImage'] #imgPreview .gbuttonSet button{
    height: 27px;
    font-size: 11px;
}
.flexColumn > *:last-child{
    height: 170px !important;
}

.fa-times-circle:hover {
    cursor: pointer;
}

.detailArea {
    width: 50%;
    min-height: 147px;
    display: inline;
    float: right;
    background-color : #daeaff;
}

.detailArea .left {
    width: 100%;
    float: left;
    box-sizing: border-box;
    
}

.detail {
    font-size: 14px;
    margin: 18px;
}
.left div {
    border-bottom : 1px solid rgb(136, 136, 136); 
    font-size : 1.14em;
    padding: 2.4px;
    height : 28.9px;
}
.left div:last-child {
    border-bottom: none;
}

[pgmid='uploadImage'] #imgZone img {
    width: 250px;
    height: 250px;
}

[pgmid='uploadImage'] #imgZone canvas {
    margin: 10px 15px 0px 0px
}

[pgmid='uploadImage'] .getImg {
    flex: unset !important;
    margin-top: 20px;
}
[pgmid='uploadImage'] .det_image img {
    width: 7em;
    height : 7em;
    border : 1px solid gray;
    margin: 8px;
    cursor : pointer;
}   
[pgmid='uploadImage'] .det_image img : hover {
    background
}   </style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent flexRow">
    <div style="flex:1 1 calc(100% - 650px)" class="flexColumn">
        <ul id="tabs">
            <li refid="list">조회</li> 
            <!--<li refid="upListTab">업로드</li>-->
            <!--<li refid="getLfmall">LF몰 이미지 가져오기</li>-->
        </ul>
        <div class="flexColumn">
            <div id='list'  class="flexColumn"></div>
            <!--<div id='upListTab' class="flexColumn">-->
            <!--    <input type="file" id="fileSelector" multiple="multiple" style="flex: unset !important; margin-top : 20px;"/>-->
            <!--    <form name="uploadForm" id="uploadForm" enctype="multipart/form-data" method="post" style="display: none;"></form>-->
            <!--    <div id='upList' class="flexColumn">-->
            <!--    </div> -->
            <!--</div>-->
            <!--<div id='getLfmall'  class="flexColumn">-->
            <!--    <div>-->
            <!--        <button class='getImg'>가져오기</button> -->
            <!--        <div id='imgZone'>-->
            <!--        </div>-->
                    <!--<canvas id="drawCanvas" width="200" height="200" style=" position: relative; border: 1px solid #000;"></canvas>-->
            <!--    </div>-->
            <!--    <div id="imgList"></div>-->
            <!--</div>-->
        </div>
    </div>
    <div id="imgPreview" style="flex:1 1 800px" class="flexColumn"></div>
    </div>
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "fo_mdp";
    var pgmid = "uploadImage"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":3.9,"upd_dt":"2022-06-09 14:24:45","remark":"스타일컬러별 이미지 정보를 업로드하고 조회함","pgmid":"uploadImage","proc_mst_id":"","pgm_stat":"Y","sort_seq":20,"app_pgmid":"fo_mdp","shortcut":"","reg_dt":"2022-04-19 12:17:53","reg_usid":"mjw","pgm_nm":"스타일(개별) 보기","upd_usid":"lyj","pgm_tp":"UX","pgm_grp_nm":"스타일MP","proc_mst_nm":"","app_pgm_nm":"상품기획","":"트랜젝션(메뉴)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-search","reg_dt":"2022-04-19 12:17:53","reg_usid":"","func_nm":"조회","upd_usid":"","upd_dt":"2022-04-19 12:17:53","func_tp":"DB_R","remark":"등록탭에서 스타일컬러와 동일한 이름의 .jpg파일을 드래그하면 이미지가 표시됩니다. 이를 확인하고 저장합니다.","pgmid":"uploadImage","sort_seq":1,"funcid":"search","content":null,"crud":"R","id":"0"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["pageCond"]={"sort_seq":"1","data_id":"pageCond","data_nm":"조회조건","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"sssn_cd","colnm":"대표시즌","dtype":"text","etype":"sel","attr":"keycol","defval":null,"w":null,"h":null,"refcd":"SSON_CD","option":"multi:sssn_cd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"brcd","colnm":"브랜드","dtype":"text","etype":"sel","attr":"keycol","defval":null,"w":null,"h":null,"refcd":"brcd","option":"multi:brcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"itemcd","colnm":"품목","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"item","option":"multi:itemcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"yyyy","colnm":"상품연도","dtype":"text","etype":"sel","attr":"keycol","defval":null,"w":null,"h":null,"refcd":"YYYY","option":"multi:yyyy::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"sson_cd","colnm":"시즌","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"SBSN_CD","option":"multi:sson_cd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_cd","colnm":"품번","dtype":"text","etype":"txt","attr":"upper ","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"done_yn","colnm":"등록여부","dtype":"text","etype":"sel","attr":null,"defval":null,"w":"5","h":null,"refcd":"DONE_YN","option":"all:done_yn::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"}]};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"2","data_id":"list","data_nm":"이미지 목록","data_icon":null,"component_pgmid":"FreeForm","component_option":null,"inout_tp":"OUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"stcl","colnm":"스타일컬러코드","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"12","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"st_nm","colnm":"스타일명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"img_yn","colnm":"등록여부","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"}]};
me.dataDef["_pgm_data"]["imgPreview"]={"sort_seq":"3","data_id":"imgPreview","data_nm":"이미지미리보기","data_icon":null,"component_pgmid":"FreeForm","component_option":{"func":[{"funcid":"fit","func_nm":"Fit","func_icon":"fas fa-expand"},{"funcid":"+","func_nm":"확대","func_icon":"fas fa-plus"},{"funcid":"-","func_nm":"축소","func_icon":"fas fa-minus"},{"funcid":"100","func_nm":"원본크기","func_icon":" "}]},"inout_tp":"OUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"stcl","colnm":"스타일컬러코드","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"img_url","colnm":"이미지경로","dtype":"text","etype":"img","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":null,"colid":"fileid","colnm":"파일ID","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"}]};
me.dataDef["_pgm_data"]["upList"]={"sort_seq":"4","data_id":"upList","data_nm":"업로드 목록","data_icon":null,"component_pgmid":"FreeForm","component_option":null,"inout_tp":"OUT","content":[{"sort_seq":"1","section":null,"section_icon":null,"colgrp":null,"colid":"file_nm","colnm":"파일명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":"2","section":null,"section_icon":null,"colgrp":null,"colid":"stcl","colnm":"스타일컬러코드","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"12","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":"3","section":null,"section_icon":null,"colgrp":null,"colid":"st_nm","colnm":"스타일명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":"4","section":null,"section_icon":null,"colgrp":null,"colid":"delRow","colnm":"삭제","dtype":"text","etype":"btn","attr":null,"defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"}]};
me.dataDef["_pgm_data"]["imgList"]={"sort_seq":"5","data_id":"imgList","data_nm":"파일목록","data_icon":null,"component_pgmid":"agGrid","component_option":{"func":[{"funcid":"get","func_nm":"가져오기","func_icon":"fas fa-plus"}]},"inout_tp":"OUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"img_url","colnm":"이미지URL","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"img_preview","colnm":"이미지보기","dtype":"text","etype":"img","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */
me.fnInitExtra=function() {
    //권한제어
    function _auth(auth) {
        me.auth = auth;
        if(isNull(auth)) { 
            gfnAlert("시스템 사용권한 점검","화면에 대한 권한이 없습니다!");
            $("*[pageidx='"+me.pageid+"']").remove();
            delete gfn[me.pageid]; 
            me.page.remove(); 
        } else {
            if(isNull(auth.save_yn) || auth.save_yn != "Y") {
                /* 각 화면에 맞게 적용*/ 
                me.pageObj._pageFunc.setDisp("save",false); 
            }
        } 
    }
    if(subset(gds.comcd,"grpcd","pgm_auth").length==0) {
        gfnGetData("pgm_auth",function(rtn){
            _auth(subset(rtn,"pgmid",pgmid)[0]);
        }); 
    } else {
        _auth(subset(subset(gds.comcd,"grpcd","pgm_auth"),"pgmid",pgmid)[0]) ;
    }  
    
    //탭
    gfnTab(pageid, "tabs");
}
/* 이벤트핸들러 */
me.fnEH=function(component, evt, row, col, val) {
    //화면기능버튼이 눌리면 
    if (component==me.pageObj["_pageFunc"]){ 
        if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
    }
    //이미지 뷰어 버튼 참조
    else if(component==me.pageObj["imgPreview"]) {
        //if(evt=="change" && col=="colid") {...}
        if($('button[funcid="fit"]').on("click",function() {
            $("#"+pageid+" #imgPreview .image").css("width","90%");
            $("#"+pageid+" #imgPreview .image").css("height","90%");
        }));
        if($('button[funcid="+"]').on("click",function() {
            var w = $("#"+pageid+" #imgPreview .image").outerWidth();
            var h = $("#"+pageid+" #imgPreview .image").outerHeight();
            $("#"+pageid+" #imgPreview .image").css("width",(w*1.1)+"px");
            $("#"+pageid+" #imgPreview .image").css("height",(h*1.1)+"px");
            fnCenter();   
        }));
        if($('button[funcid="-"]').on("click",function() {
            var w = $("#"+pageid+" #imgPreview .image").outerWidth();
            var h = $("#"+pageid+" #imgPreview .image").outerHeight();
            $("#"+pageid+" #imgPreview .image").css("width",(w/1.1)+"px"); 
            $("#"+pageid+" #imgPreview .image").css("height",(h/1.1)+"px"); 
            fnCenter();   
        })); 
        if($('button[funcid="100"]').on("click",function() {
            $("#"+pageid+" #imgPreview .image").css("width","unset");
            $("#"+pageid+" #imgPreview .image").css("height","unset");
            fnCenter();   
        }));  
        var fnCenter = function() {
            var outerContent =$("#"+pageid+" #imgPreview .imgArea");
            var innerContent =$("#"+pageid+" #imgPreview .image"); 
            outerContent.scrollLeft( (innerContent.width() - outerContent.width()) / 2);       
        }
    }
    else if (component==me.pageObj["imgList"]) { 
        if(evt=="componentFunc") {
            me.fnGetList();
        }
    }
    
}
//search:조회 
me.fnSearch=function() {
    if( !me.pageObj["pageCond"].chkValid() ) return;
    var args = me.pageObj["pageCond"].exportData()[0];
    var invar = JSON.stringify(args);
    gfnTx(appid+"."+pgmid,"searchList",{INVAR:invar},function(OUTVAR){
        if(OUTVAR.rtnCd=="OK") {
            console.log(OUTVAR);
            /* 이미지 목록 뿌리기 */
            $("#"+pageid+" #list").html("");
            $("#"+pageid+" #imgPreview .componentBody").html("");
            $("#"+pageid+" #list").prepend(`<div class="readCnt"><h3>조회건수: `+ OUTVAR.imgList.length+`건</h3></div>`);
            var dirs = OUTVAR.imgList;
            me.list = OUTVAR.imgList;
            sort(dirs,"stcl");
            for(var dir of dirs) {
                var li = $("<li></li>");
                li.append("<b>" + dir.stcl + "&nbsp;<i id='" + dir.stcl + "' class='fas fa-times-circle fa-2x'></i></b>");
                var src = dir.url;
                var oImg = $(`<img id=${dir.goods_cd} src=${dir.url} colorcd=${dir.colorcd} />`);
                oImg.append("<b>" + dir.stcl +"</b>");
                li.append(oImg);
                li.append("<br/>");
                li.append("<b>판매가 : " + dir.sale_price.replace(/\B(?=(\d{3})+(?!\d))/g, ",") + "원</b>");
                $("#"+pageid+" #list").append(li);
            }
            // 이미지 미리보기에 바인딩
            me.page.find("#list img").click(function(e) {
                var oE = $(e.target);
                console.log(oE)
                var oTR = oE.exactObj("img[src]");
                console.log(oTR)
                var imgSrc = oTR.attr("src");
                console.log(imgSrc)
                me.page.find("#imgPreview .componentBody").html("");
                me.page.find("#imgPreview .componentBody").prepend("<span class='detail'><b>상품세부정보</b></span>");
                me.page.find("#imgPreview .componentBody .detail").append('<div class="goodsArea"><div class="imgArea"></div></div>');
                me.page.find("#imgPreview .componentBody .goodsArea .imgArea").append(`<img class="image" src='`+ imgSrc + `'/>`);
                //detail
                me.page.find("#imgPreview .componentBody .detail").append('<div class="det_image"></div>');
                
                
                var ot = oE.exactObj("img[id]");
                var gcd = ot.attr("id");
                var colorcd = ot.attr("colorcd");
                var goods_cd = {"goods_cd" : gcd, "colorcd" : colorcd};
                var invar = JSON.stringify(goods_cd);
                gfnTx(appid+"."+pgmid,"getDetail",{INVAR:invar},function(OUTVAR){
                    if(OUTVAR.list.length == 1) {
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].url00} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].url01} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].url02} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].url03} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].url04} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].url05} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].urld0} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].urld1} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].urld2} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].urld3} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].urll0} />`);
                        me.page.find(".det_image").append(`<img src =${OUTVAR.list[0].urll1} />`);
                        
                        me.page.find(".det_image img").click(function(e) {
                            var src = $(e.target).attr("src");
                            me.page.find('#imgPreview .image').attr('src', src);
                        })
                        
                        me.page.find(".goodsArea").append('<div class="detailArea"><div class="left"></div></div>');
                        me.page.find(".left").append("<div><b>스타일코드</b> : "+OUTVAR.list[0].goods_cd+"</div>");
                        me.page.find(".left").append("<div><b>품&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;명</b> : "+OUTVAR.list[0].goods_nm+"</div>");
                        me.page.find(".left").append("<div><b>브&nbsp;&nbsp;&nbsp;랜&nbsp;&nbsp;&nbsp;드</b> : "+OUTVAR.list[0].brcd+"</div>");
                        me.page.find(".left").append("<div><b>연도&nbsp;&nbsp;시즌</b> : "+OUTVAR.list[0].yyyy+ " / " +OUTVAR.list[0].sssn_cd+"</div>");
                        me.page.find(".left").append("<div class='init_price'><b>최&nbsp;&nbsp;&nbsp;초&nbsp;&nbsp;&nbsp;가</b> : "+OUTVAR.list[0].init_price.replace(/\B(?=(\d{3})+(?!\d))/g, ",")+"</div>");
                        me.page.find(".left").append("<div><b>판&nbsp;&nbsp;&nbsp;매&nbsp;&nbsp;&nbsp;가</b> : "+OUTVAR.list[0].sale_price.replace(/\B(?=(\d{3})+(?!\d))/g, ",")+"</div>");
                        // $(".left").append("<div class='salerate'><b>판&nbsp;&nbsp;&nbsp;매&nbsp;&nbsp;&nbsp;율</b> : </div>");
                        // $(".left").append("<div class='cost_price'><b>원&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;가</b> : </div>");
                        // $(".left").append("<div class='costrate'><b>원&nbsp;&nbsp;&nbsp;가&nbsp;&nbsp;&nbsp;율</b> : </div>");
                        // $(".left").append("<div class='incnt'><b>입&nbsp;&nbsp;&nbsp;고&nbsp;&nbsp;&nbsp;량</b> : </div>");
                        // $(".left").append("<div class='salecnt'><b>판&nbsp;&nbsp;&nbsp;매&nbsp;&nbsp;&nbsp;량</b> : </div>");
                        // $(".left").append("<div class='invcnt'><b>재&nbsp;&nbsp;&nbsp;고&nbsp;&nbsp;&nbsp;량</b> : </div>");
                        me.page.find(".left").append("<div><b>색&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;상</b> : "+OUTVAR.list[0].colorcds+"</div>");
                        me.page.find(".left").append("<div><b>사&nbsp;&nbsp;&nbsp;이&nbsp;&nbsp;&nbsp;즈</b> : "+OUTVAR.list[0].sz_cds+"</div>");
                    }
                    else {
                        me.page.find(".goodsArea").append('<div class="detailArea"><div class="left"><h3 style="text-align : center"> 등록된 상품 정보가 없습니다.</h3></div>');
                    }
                });
                var args2 = me.pageObj["pageCond"].exportData()[0];
                args2.goods_cd = gcd;
                var invar2 = JSON.stringify(args2);
                gfnTx(appid+"."+pgmid,"getDetail2",{INVAR:invar2},function(OUTVAR){
                    if(OUTVAR.list.length == 1) {
                        var salerate = Math.round((OUTVAR.list[0].salecnt / OUTVAR.list[0].invcnt)*100);
                        var costrate = Math.round((OUTVAR.list[0].cost_price / OUTVAR.list[0].sale_price)*100);
                        if(OUTVAR.list[0].salecnt == 0) salerate = 0;
                        if(OUTVAR.list[0].salecnt != 0 && OUTVAR.list[0].invcnt == 0) salerate = 100;
                        if(OUTVAR.list[0].cost_price == 0) costrate = 0;
                        if(OUTVAR.list[0].cost_price != 0 && OUTVAR.list[0].sale_price == 0) salerate = 100;
                        me.page.find(".incnt").html("<b>입&nbsp;&nbsp;&nbsp;고&nbsp;&nbsp;&nbsp;량</b> : " + OUTVAR.list[0].incnt.replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                        me.page.find(".salecnt").html("<b>판&nbsp;&nbsp;&nbsp;매&nbsp;&nbsp;&nbsp;량</b> : " + OUTVAR.list[0].salecnt.replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                        me.page.find(".invcnt").html("<b>재&nbsp;&nbsp;&nbsp;고&nbsp;&nbsp;&nbsp;량</b> : " + OUTVAR.list[0].invcnt.replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                        me.page.find(".salerate").html("<b>판&nbsp;&nbsp;&nbsp;매&nbsp;&nbsp;&nbsp;율</b> : " + salerate + "%");
                        me.page.find(".init_price").html("<b>최&nbsp;&nbsp;&nbsp;초&nbsp;&nbsp;&nbsp;가</b> : " + OUTVAR.list[0].init_price.replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                        me.page.find(".cost_price").html("<b>원&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;가</b> : " + OUTVAR.list[0].cost_price.replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                        me.page.find(".costrate").html("<b>원&nbsp;&nbsp;&nbsp;가&nbsp;&nbsp;&nbsp;율</b> : " + costrate + "%");
                    }
                });
            })
            
            // 버튼 클릭시 삭제
            $(".fa-times-circle").click(function(e) {
                var oE = $(e.target);
                var oTR = oE.exactObj("i[id]");
                var fileid = oTR.attr("id");
                var inv = {fileid : fileid};
                var inv2 = JSON.stringify(inv);
                if(fileid != undefined && !isNull(fileid)) {
                    // gfnConfirm("이미지 삭제", "등록된 이미지를 삭제하시겠습니까?", function(confirm) {
                    //     if(confirm) {
                    //         gfnTx("aweportal.popupUpload", "deleteFile", {"INVAR" : inv2}, function(OUTVAR){
                    //             if(OUTVAR.rtnCd=="OK") {
                    //                 me.fnSearch();
                    //             } else {
                    //                 gfnAlert("조회오류",OUTVAR.rtnMsg);
                    //             }
                    //         });
                    //     }
                    // })
                }
            })

            //이미지가 없으면 noimg.png 표시
            $("#"+pageid+" #list img").on("error",function(e){
                $(e.target).attr("src","https://fo.lfnetworks.co.kr/pds/LFN/BBS_ATTCH/202111/211103055617bea7a6d7.gif");
            });
        } else {
            gfnAlert("조회오류",OUTVAR.rtnMsg);
        }
    });
}

/* 탭 전환시 이미지 미리보기 초기화*/
$("#"+pageid+" #tabs").on("click", function() {
    $("#imgPreview .componentBody").html("");
    $("#"+pageid+" #imgZone").html("");
    $("#fileSelector").val("");
})   

$("#fileSelector").bind('change', function() {
    selectFile(this.files);
    $("#fileSelector").hide();
    $("#upList .componentTop").hide();
});
// 파일 리스트 번호
var fileIndex = 0;
// 등록할 전체 파일 사이즈
var totalFileSize = 0;
// 파일 리스트
var fileList = new Array();
// 파일 사이즈 리스트
var fileSizeList = new Array();
// 등록 가능한 파일 사이즈 MB
var uploadSize = 10;
// 등록 가능한 총 파일 사이즈 MB
var maxUploadSize = 10;	

// 파일 선택시
function selectFile(fileObject) {
    var files = null; 
    if (fileObject != null) {
        // 파일 Drag 이용하여 등록시 
        files = fileObject;  
    } else {
        // 직접 파일 등록시
        files = $('#multipaartFileList_' + fileIndex)[0].files;
    } 
    if (files != null) { // 다중파일 등록   

        for (var i = 0; i < files.length; i++) { 
            var fileName = files[i].name; // 파일 이름
            var fileNameArr = fileName.split("\."); // 확장자 
            var ext = fileNameArr[fileNameArr.length - 1]; 
            var fileSize = files[i].size; // 파일 사이즈(단위 :byte) 
            if (fileSize <= 0) {
                console.log("0kb file return");
                return;
            } 
            var fileSizeKb = fileSize / 1024; // 파일 사이즈(단위 :kb)
            var fileSizeMb = fileSizeKb / 1024;    // 파일 사이즈(단위 :Mb)

            var fileSizeStr = "";
            if ((1024*1024) <= fileSize) {    // 파일 용량이 1메가 이상인 경우 
                fileSizeStr = fileSizeMb.toFixed(2) + " Mb";
            } else if ((1024) <= fileSize) { 
                fileSizeStr = parseInt(fileSizeKb) + " kb";
            } else { 
                fileSizeStr = parseInt(fileSize) + " byte";
            } 
            if ($.inArray(ext, [ 'pdf', 'jpg', 'jpeg', 'gif', 'png' ]) <= 0) {
                // 확장자 체크
                gfnAlert("등록 실패", "등록이 불가능한 파일 입니다.("+fileName+")");
                break; 
            }
            if (fileSizeMb > uploadSize) {
                // 파일 사이즈 체크
                gfnAlert("업로드 파일확인","용량 초과\n업로드 가능 용량 : " + uploadSize + " MB");
                break;
            } else { 
                totalFileSize += fileSizeMb; // 전체 파일 사이즈 
                fileList[fileIndex] = files[i]; // 파일 배열에 넣기  
                fileSizeList[fileIndex] = fileSizeMb; // 파일 사이즈 배열에 넣기 
                addFileList(fileIndex, fileName, fileSizeStr); // 업로드 파일 목록 생성
                fileIndex++;                      // 파일 번호 증가
            } 
        } /* End of for */
    } else {
        gfnAlert("ERROR", "ERROR");
    }
}

// 업로드 파일 목록 생성
function addFileList(fIndex, fileName, fileSizeStr) {
    var fileNameArr = fileName.split("\."); // 확장자 
    var ext = fileNameArr[fileNameArr.length - 1];
    var file = $("#fileSelector").get(0).files[fIndex];
    if(file) {
        // FileReader 인스턴스 생성
        const reader = new FileReader()
        // 이미지가 로드가 된 경우
        reader.onload = e => {
            const thumb = $(`<li class='`+fileNameArr[0] + fIndex + `'><b class="fnm">`+ fileName + `</b><img src='`+ e.target.result+`'></li>`);
            me.pageObj.upList.componentBody.append(thumb);
            thumb.attr("src", e.target.result );
            $("#upList img").on("click", function(e) {
                var oE = $(e.target);
                var oTR = oE.exactObj("img[src]");
                var imgSrc = oTR.attr("src");
                $("#imgPreview .componentBody").html("");
                $("#imgPreview .componentBody").append(`<img src='`+ imgSrc + `'/>`);
            })
        }
        // reader가 이미지 읽도록 하기
        reader.readAsDataURL(file);
    }
}

// 목록에서 업로드 파일 삭제
function deleteFile(fIndex) { 
    // 전체 파일 사이즈 수정
    totalFileSize -= fileSizeList[fIndex];
    // 파일 배열에서 삭제
    delete fileList[fIndex];
    // 파일 사이즈 배열 삭제
    delete fileSizeList[fIndex];
}

var fileIdList = [];
// 파일 등록
function uploadFile() {
    // 등록할 파일 리스트
    var uploadFileList = Object.keys(fileList);

    // 파일이 있는지 체크
    if (uploadFileList.length == 0) {
        // 파일등록 경고창
        gfnAlert("파일 미등록", "업로드할 파일이 없습니다.");
        return;
    }

    // 용량을 10MB를 넘을 경우 업로드 불가
    if (totalFileSize > maxUploadSize) {
        // 파일 사이즈 초과 경고창
        gfnAlert("총 용량 초과", "총 업로드 가능 용량 : " + maxUploadSize + " MB");
        return;
    }

    var curIdx = 0;
    var maxIdx = uploadFileList.length;

    function submitFile(idx) {
        var file = fileList[uploadFileList[idx]];
        var fileNameArr = file.name.split("\.")[0];
        if(fileNameArr.includes("_")) {
            fileNameArr = fileNameArr.split("\_")[0];
        } else if(fileNameArr.includes("(")) {
            fileNameArr = fileNameArr.split("\(")[0];
        } else if(fileNameArr.includes("-")) {
            fileNameArr = fileNameArr.split("\-")[0];
        }
        var arg = {filenm : fileNameArr};
        var invar = JSON.stringify(arg);
        gfnTx(appid+"."+pgmid,"checkStcl",{INVAR:invar},function(OUTVAR){
            if(OUTVAR.chkValid.length != 0) {
                var goods_cd = OUTVAR.chkValid[0].stcl;
                var saveDir = goods_cd.substring(0, 6);
                var frm = $("#"+pageid+" #uploadForm");
                var formData = new FormData(frm[0]);
                var fileSize = file.size;
                var oName = file.name;
                var userid = gUserinfo.userid;
                var args = {"dateDir": saveDir ,"file_tp": "STYLE_IMG", "ref_file_tp" : "TM_GOODS", "ref_id": fileNameArr, "fileSize" : fileSize};
                var invar = JSON.stringify(args);
                formData.append("file",file);
                formData.append("INVAR",invar);
                $.ajax({
                    url : "awegtx.jsp?pgm=aweportal.popupUpload",
                    data : formData,
                    type : 'POST',
                    enctype : 'multipart/form-data',
                    processData : false,
                    contentType : false,
                    dataType : 'json',
                    cache : false,
                    timeout: 60000,
                    success : function(OUTVAR) {
                        if(OUTVAR.rtnCd == "OK") {
                            gParamFile["fileupload"](OUTVAR.fileno);
                            fileIdList.push({fileid: OUTVAR.fileid});
                            $("." + file.name.split("\.")[0] + idx ).remove();
                            $("#imgPreview .componentBody").html("");
                        } else {
                            gfnAlert("파일업로드 오류",OUTVAR.rtnCd);
                        }
                    },
                    complete: function(jqXHR, rst) {
                        console.dir(jqXHR);
                        console.dir(rst);
                    }
                });
            } else {
                gParamFile["fileupload"](OUTVAR.fileno);
                deleteFile(idx);
                $("." + file.name.split("\.")[0] + idx + " .fnm").append('<br><span>등록된 스타일 코드가 없습니다</span>');
                $("." + file.name.split("\.")[0] + idx ).click(function() {
                    gfnConfirm("삭제 확인","이미지를 목록에서 삭제하시겠습니까?", function(confirm){
                        if(confirm) {
                            $("." + file.name.split("\.")[0] + idx ).remove();
                            $("#imgPreview .componentBody").html("");
                        }   
                    });   
                });
                return;
            }
        });
    }
    gParamFile["fileupload"] = function(fileno) {
        curIdx++;
        if(curIdx < maxIdx) {
            submitFile(curIdx);
        } else if (curIdx==maxIdx) {
            //변수초기화
            fileIndex = 0;
            totalFileSize = 0;
            fileList = new Array();
            fileSizeList = new Array();
        }
    }
    submitFile(curIdx); //첫번째 파일 업로드 트리거
    $("#fileSelector").val("");
}  
//upload:업로드 
me.fnSave=function() {
    gfnConfirm("업로드 확인","이미지를 업로드 하시겠습니까?", function(confirm){
        if(confirm) {
            uploadFile();
            $("#fileSelector").show();
        }   
    });   
}

$("#getLfmall .getImg").on("click", function(e) {
    if( !me.pageObj["pageCond"].chkValid() ) return;
    var args = me.pageObj["pageCond"].exportData()[0];
    var invar = JSON.stringify(args);
    $("#"+pageid+" #imgZone").html("");
    gfnTx(appid+"."+pgmid,"searchList",{INVAR:invar},async function(OUTVAR){
        if(OUTVAR.rtnCd=="OK") {
            for(var i=0; i < OUTVAR.imgList.length; i++) {
                var win = "https://lf-proxy.herokuapp.com/https://nimg.lfmall.co.kr/file/product/prd/"+OUTVAR.imgList[i].brcd+"/"
                +OUTVAR.imgList[i].yyyy +"/1500/"+OUTVAR.imgList[i].stcl+"_00.jpg";
                //window.open(win);
                var img = $(`<img id="getImg`+i+`" width="220" height="277" style='display:none;' src="`+ win + `">`);
                var cv = $(`<canvas id="drawCanvas`+i+`" width="200" height="200" style=" position: relative; border: 1px solid #000;"></canvas>`);
                page.find("#imgZone").append(img);
                page.find("#imgZone").append(cv);
                var image = new Image();
                image.src = win;
                image.crossOrigin = "Anonymous";
                var gImg = document.getElementById("getImg" + i);
                console.log(gImg);
                var canvas = document.getElementById('drawCanvas' + i);
                await new Promise((resolve, reject) => {
                    image.onload = function() {
                        var canvasContext = canvas.getContext('2d');
                        canvas.width = 200;
                        canvas.height = 200;
                        canvasContext.drawImage(image, 0, 0, canvas.width, canvas.height);
                        
                        const imgBase64 = canvas.toDataURL('image/png', 'image/octet-stream');
                        const decodImg = atob(imgBase64.split(',')[1]);
                        
                        let array = [];
                        for (let j = 0; j < decodImg .length; j++) {
                            array.push(decodImg .charCodeAt(j));
                        }
                        
                        const file = new Blob([new Uint8Array(array)], {type: 'image/png'});
                        const fileName = 'canvas_img_' + new Date().getMilliseconds() + '.jpg';
                        let formData = new FormData();
                        var goods_cd = OUTVAR.imgList[i].goods_cd;
                        var saveDir = goods_cd.substring(0, 6);
                        var fileSize = file.size;
                        var oName = OUTVAR.imgList[i].stcl+"_00.jpg";
                        var userid = gUserinfo.userid;
                        var args = {"dateDir": saveDir ,"file_tp": "STYLE_IMG", "ref_file_tp" : "TM_GOODS", "ref_id": goods_cd, "fileSize" : fileSize};
                        var invar = JSON.stringify(args);
                        formData.append('file', file, oName);
                        formData.append("INVAR",invar);
                        $.ajax({
                            type: 'post',
                            url : "awegtx.jsp?pgm=aweportal.popupUpload",
                            cache: false,
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (data) {
                              console.log(" 업로드");
                            }
                        })      
                        resolve();
                    }
                    image.onerror = function() {
                        console.log("에러");
                        resolve();
                    }
                });
            }
        } else {
            gfnAlert("조회오류",OUTVAR.rtnMsg);
        }
    });   
});

me.fnGetList=function() {
    var data = me.list;
    for(var i=0; i < data.length; i++) {
        var row = me.pageObj.imgList.addRow();
        var url = "https://nimg.lfmall.co.kr/file/product/prd/"+data[i].brcd+"/"+data[i].yyyy +"/1500/"+data[i].stcl+"_00.jpg";
        me.pageObj.imgList.setVal(row,"img_url",url);
        me.pageObj.imgList.setVal(row,"img_preview",url); 
    }
    
    
}

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>