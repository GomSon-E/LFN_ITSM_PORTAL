<style>[pgmid='uploadST'].framepage .userClass { 
width:100%; 
}</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent flexColumn" >
    <ul id="tabs">
        <li refid="t1">스타일/컬러</li> 
        <li refid="t3">코드마스터</li>
    </ul>
    <div>
        <div id="t1" class="flexColumn">
            <div id='list' class="flexColumn"></div> 
        </div> 
        <div id="t3" class="flexColumn">
            <div id="codelist" class="flexColumn"></div>
        </div>
    </div> 
</div>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "fo_mdp";
    var pgmid = "uploadST"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"pgmid":"uploadST","pgm_nm":"스타일업로드","pgm_tp":"UX","proc_mst_id":"","proc_mst_nm":"","remark":"LF이관 스타일: 스타일마스터/발주정보 생성","ver":0.22,"pgm_stat":"Y","reg_usid":"lkh","reg_dt":"2021-10-07 08:56:51","upd_usid":"lkh","upd_dt":"2021-10-07 12:16:25","app_pgmid":"fo_mdp","pgm_grp_nm":"스타일MP","sort_seq":22,"shortcut":"S1","crud":"","app_pgm_nm":"상품기획"};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-save","reg_dt":"2021-10-07 08:56:51","reg_usid":"","func_nm":"저장","upd_usid":"","upd_dt":"2021-10-07 08:56:51","func_tp":"DB_W","remark":"바코드, 공급사 상품코드, 수량, 가격, 원가, 속성을 붙여넣습니다.  공급사 상품코드 규칙이 등록된 경우 속성값이 자동으로 채워집니다.","pgmid":"uploadST","sort_seq":"1","funcid":"save","content":"스타일 정보 저장","crud":"U"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["pageCond"]={"sort_seq":"1","data_id":"pageCond","data_nm":"조회조건","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"suprcd","colnm":"공급사","dtype":"text","etype":"sel","attr":"pk ","defval":null,"w":"10","h":null,"refcd":"supr","option":"sel:suprcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"goods_stat_cd","colnm":"차수","dtype":"text","etype":"sel","attr":"pk","defval":null,"w":"10","h":null,"refcd":"GOODS_STAT_CD","option":"sel:goods_stat_cd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"}]};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"2","data_id":"list","data_nm":"상제품코드(SKU) 업로드","data_icon":null,"component_pgmid":"agGrid","component_option":{"remark":"추가줄수:","content":[{"colid":"rowCnt","colnm":"줄수","dtype":"num","etype":"txt","defval":"100"}],"func":[{"funcid":"addRow","func_nm":"줄추가","func_icon":"fas fa-plus"},{"funcid":"delRow","func_nm":"줄삭제","func_icon":"fas fa-minus"}]},"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"barcd","colnm":"바코드","dtype":"text","etype":"txt","attr":"pk fixL ","defval":null,"w":"12","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"\"건수:\" + count( 'goods_cd' )","remark":null,"crud":"C"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":null,"colid":"supr_goods_cd","colnm":"공급사 상품코드","dtype":"text","etype":"txt","attr":"key fixL","defval":null,"w":"12","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":"상제품코드","colid":"stcd","colnm":"스타일","dtype":"text","etype":"txt","attr":"pk fixL ","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":"상제품코드","colid":"colorcd","colnm":"컬러","dtype":"text","etype":"txt","attr":"pk fixL ","defval":null,"w":"4","h":null,"refcd":"COLORCD","option":"sel:colorcd:color_nm:cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":"상제품코드","colid":"szcd","colnm":"사이즈","dtype":"text","etype":"txt","attr":"pk fixL ","defval":null,"w":"5","h":null,"refcd":"SZCD","option":"sel:szcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":"물량","colid":"gr_schd_qty","colnm":"입고예정량","dtype":"num","etype":"txt","attr":"keycol","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":"가격(VAT+)","colid":"init_price","colnm":"최초소비가","dtype":"num","etype":"txt","attr":"keycol ","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"sum('row.init_price*row.gr_schd_qty')/sum('row.gr_schd_qty')","remark":null,"crud":"C"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":"가격(VAT+)","colid":"std_sprice_rt","colnm":"기준판가율(%)","dtype":"num","etype":"txt","attr":"dec2","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"100*sum('row.sale_std_price*row.gr_schd_qty')/sum('row.init_price*row.gr_schd_qty')","remark":null,"crud":"C"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":"가격(VAT+)","colid":"sale_std_price","colnm":"기준판매가","dtype":"num","etype":"txt","attr":"keycol ","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"sum('row.sale_std_price*row.gr_schd_qty')/sum('row.gr_schd_qty')","remark":null,"crud":"C"},{"sort_seq":10,"section":null,"section_icon":null,"colgrp":"원가","colid":"init_prch_rt","colnm":"매입원가율 (최초가比,%)","dtype":"num","etype":"txt","attr":"dec2","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"100*sum('row.schd_cost*row.gr_schd_qty')/sum('row.init_price*row.gr_schd_qty/1.1')","remark":null,"crud":"C"},{"sort_seq":11,"section":null,"section_icon":null,"colgrp":"원가","colid":"schd_cost","colnm":"매입원가","dtype":"num","etype":"txt","attr":"keycol","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"sum('row.schd_cost*row.gr_schd_qty')/sum('row.gr_schd_qty')","remark":null,"crud":"C"},{"sort_seq":12,"section":null,"section_icon":null,"colgrp":"원가","colid":"cost_rt","colnm":"판가원가율 (기준가比)","dtype":"num","etype":"raw","attr":"readonly dec1","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"100*sum('row.schd_cost*row.gr_schd_qty')/sum('row.sale_std_price*row.gr_schd_qty/1.1')","remark":null,"crud":"C"},{"sort_seq":13,"section":null,"section_icon":null,"colgrp":"매입","colid":"prch_amt","colnm":"예정원가액","dtype":"num","etype":"raw","attr":null,"defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":14,"section":null,"section_icon":null,"colgrp":"매입","colid":"sale_std_amt","colnm":"판매기준가액","dtype":"num","etype":"raw","attr":null,"defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":15,"section":null,"section_icon":null,"colgrp":"판기","colid":"sale_start_dt","colnm":"판기시작일","dtype":"ymd","etype":"txt","attr":"ymd ","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":16,"section":null,"section_icon":null,"colgrp":"판기","colid":"sale_end_dt","colnm":"판기종료일","dtype":"ymd","etype":"txt","attr":"ymd","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":17,"section":null,"section_icon":null,"colgrp":"사이즈범위","colid":"sz_range_cd","colnm":"코드","dtype":"text","etype":"txt","attr":"keycol auto upper","defval":null,"w":"5","h":null,"refcd":"SZ_RANGE","option":"sel:sz_range_cd:sz_range_nm:cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":18,"section":null,"section_icon":null,"colgrp":"사이즈범위","colid":"sz_range_nm","colnm":"명","dtype":"text","etype":"raw","attr":"readonly","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":19,"section":null,"section_icon":null,"colgrp":"세부품목","colid":"detail_itemcd","colnm":"코드","dtype":"text","etype":"txt","attr":"auto","defval":null,"w":"4","h":null,"refcd":"DET_ITEMCD","option":"sel:detail_itemcd:detail_item_nm:cdnm:up_item_nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":20,"section":null,"section_icon":null,"colgrp":"세부품목","colid":"detail_item_nm","colnm":"명","dtype":"text","etype":"raw","attr":"readonly","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":21,"section":null,"section_icon":null,"colgrp":"상품명","colid":"goods_cd","colnm":"코드","dtype":"text","etype":"raw","attr":"hidden","defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":22,"section":null,"section_icon":null,"colgrp":"상품명","colid":"goods_nm","colnm":"명","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":23,"section":null,"section_icon":null,"colgrp":"브랜드","colid":"brcd","colnm":"코드","dtype":"text","etype":"txt","attr":"auto upper","defval":null,"w":"5","h":null,"refcd":"brcd","option":"sel:brcd:br_nm:cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":24,"section":null,"section_icon":null,"colgrp":"브랜드","colid":"br_nm","colnm":"명","dtype":"text","etype":"raw","attr":"readonly","defval":null,"w":"5","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":25,"section":null,"section_icon":null,"colgrp":"연도","colid":"yyyy","colnm":"연도","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":26,"section":null,"section_icon":null,"colgrp":"시즌","colid":"sson_cd","colnm":"코드","dtype":"text","etype":"txt","attr":"auto upper","defval":null,"w":"4","h":null,"refcd":"SBSN_CD","option":"sel:sson_cd:sson_nm:cdnm:val_2","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":27,"section":null,"section_icon":null,"colgrp":"시즌","colid":"sson_nm","colnm":"명","dtype":"text","etype":"raw","attr":"readonly","defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":28,"section":null,"section_icon":null,"colgrp":"품목","colid":"itemcd","colnm":"코드","dtype":"text","etype":"txt","attr":"auto upper","defval":null,"w":"4","h":null,"refcd":"item","option":"sel:itemcd:item_nm:cdnm:up_item_nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":29,"section":null,"section_icon":null,"colgrp":"품목","colid":"item_nm","colnm":"명","dtype":"text","etype":"raw","attr":"readonly","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":30,"section":null,"section_icon":null,"colgrp":"번호","colid":"goods_seq","colnm":"ST번호","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":31,"section":null,"section_icon":null,"colgrp":"컬러","colid":"color_nm","colnm":"명","dtype":"text","etype":"raw","attr":"readonly","defval":null,"w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":32,"section":null,"section_icon":null,"colgrp":"상태","colid":"sale_allow_yn","colnm":"판매허용","dtype":"text","etype":"cbx","attr":null,"defval":"Y","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":33,"section":null,"section_icon":null,"colgrp":"상태","colid":"gr_allow_yn","colnm":"입고허용","dtype":"text","etype":"cbx","attr":null,"defval":"Y","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":34,"section":null,"section_icon":null,"colgrp":"상태","colid":"gi_allow_yn","colnm":"출고허용","dtype":"text","etype":"cbx","attr":null,"defval":"Y","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":35,"section":null,"section_icon":null,"colgrp":"상태","colid":"cd_stat","colnm":"코드사용","dtype":"text","etype":"cbx","attr":null,"defval":"Y","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"}]};
me.dataDef["_pgm_data"]["codelist"]={"sort_seq":"3","data_id":"codelist","data_nm":"코드리스트","data_icon":null,"component_pgmid":"agGrid","component_option":null,"inout_tp":"OUT","content":[{"sort_seq":"1","section":null,"section_icon":null,"colgrp":null,"colid":"grpcd","colnm":"코드구분","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"12","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":"2","section":null,"section_icon":null,"colgrp":null,"colid":"grpcd_nm","colnm":"구분명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"20","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":"3","section":null,"section_icon":null,"colgrp":null,"colid":"cd","colnm":"코드","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"},{"sort_seq":"4","section":null,"section_icon":null,"colgrp":null,"colid":"nm","colnm":"명","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"20","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */

    /* 사용자초기화 */
    me.fnInitExtra=function() {
        //탭
        gfnTab(pageid, "tabs");
 
        //코드마스터 미리 조회하여 데이터 세팅: async/await로 클린코드
        me.fnInitCodelist(); 
    }
    
    me.fnInitCodelist=function() {
        function fnInitCodelist(refcd, refnm, afnCallback) {
            gfnGetData(refcd,function(data) {
                if(!isNull(data)) {
                    var codelist = me.pageObj.codelist.exportData();
                    for(var i=0; i < data.length; i++) {
                        codelist.push({grpcd:refcd,grpcd_nm:refnm,cd:data[i].cd,nm:data[i].nm});
                    }
                    me.pageObj.codelist.importData(codelist);
                } else {
                    gfnStatus(refnm+" - 코드목록이 존재하지 않습니다.");
                }
                if(!isNull(afnCallback)) afnCallback();
            });
        }
        gfnStatus("코드마스터를 다시 읽어들이고 있습니다. 잠시만 기다려주세요...");
        gfnTx("aweportal.frameset","retrieveInit",{}, function(OUTVAR){ 
            if(OUTVAR.rtnCd=="OK") {
                gds.comcd         = OUTVAR.comcd;   //공통코드 
                fnInitCodelist("supr","공급사",function(){
                    fnInitCodelist("brcd","브랜드",function(){
                        fnInitCodelist("SBSN_CD","시즌",function(){
                            fnInitCodelist("item","품목",function(){
                                fnInitCodelist("DET_ITEMCD","세부품목",function(){
                                    fnInitCodelist("COLORCD","컬러",function(){
                                        fnInitCodelist("GOODS_STAT_CD","상제품상태(연차)",function(){
                                            fnInitCodelist("SZ_RANGE","사이즈유형"); 
                                        });
                                    });
                                });
                            });
                        });
                    });
                });
            }
		});
         
    }
    //스타일컬러코드를 입력받아 스타일명, 속성코드/명을 리턴 
    me.fnSTCLtoATTR = function(suprcd,goods_cd,detail_itemcd,sz_range_cd) {
        var rtn = {stcd:"",st_nm:"",goods_nm:"",brcd:"",br_nm:"",itemcd:"",item_nm:"",yyyy:"",sson_cd:"",sson_nm:"",goods_seq:"",colorcd:"",color_nm:"",detail_item_nm:"",sz_range_nm:""};
        //if(suprcd=="00423") {  //LF일 경우 
            rtn.brcd    = (goods_cd.substr(0,2)+"").toUpperCase().substr(0,2); //앞 두자리
            rtn.itemcd  = (goods_cd.substr(2,2)+"").toUpperCase().substr(0,2); //두자리
            var y       = (goods_cd.substr(4,1)+"");
            rtn.yyyy    = (isNull(y))?"":((y>6)?"201"+y:"202"+y); //2017부터 2026까지
            rtn.sson_cd = (goods_cd.substr(5,1)+"").toUpperCase().substr(0,1); //한자리 
            rtn.goods_seq = (goods_cd.substr(6,3)+"").toUpperCase().zf(3); //0으로 채운 3자리 
            rtn.colorcd  = (goods_cd.substr(9,2)+"").toUpperCase().substr(0,2); //두자리
            rtn.stcd     = rtn.brcd+rtn.itemcd+y+rtn.sson_cd+rtn.goods_seq;
            rtn.br_nm    = gfnCdNm("brcd",rtn.brcd,"nm");            
            rtn.item_nm  = gfnCdNm("item",rtn.itemcd,"nm");
            rtn.sson_nm  = gfnCdNm("SBSN_CD",rtn.sson_cd,"nm");
            rtn.color_nm  = gfnCdNm("COLORCD",rtn.colorcd,"nm");
            rtn.detail_item_nm  = gfnCdNm("DET_ITEMCD",detail_itemcd,"nm");
            rtn.sz_range_nm  = gfnCdNm("SZ_RANGE",sz_range_cd,"nm");
            rtn.st_nm  = rtn.br_nm+" "+rtn.sson_nm+" "+nvl(rtn.detail_item_nm,rtn.item_nm)+"("+rtn.stcd+")";
            rtn.goods_nm  = rtn.st_nm; //rtn.br_nm+" "+rtn.sson_nm+" "+rtn.color_nm+" "+nvl(rtn.detail_item_nm,rtn.item_nm)+"("+goods_cd+")"; 
        //}
        return rtn;
    }
    //속성코드를 입력받아 스타일컬러코드/스타일명,속성명들을 리턴
    me.fnATTRtoSTCL = function(suprcd,brcd,yyyy,sson_cd,itemcd,goods_seq,colorcd,szcd,detail_itemcd,sz_range_cd) {
        var rtn = {stcd:"",st_nm:"",goods_cd:"",goods_nm:"",br_nm:"",item_nm:"",sson_nm:"",color_nm:"",detail_item_nm:"",sz_range_nm:""};
        //if(suprcd=="00423") {  //LF일 경우 
            var brcd = nvl(brcd,"").toUpperCase().substr(0,2); //앞 두자리
            var y = nvl(yyyy,"").substr(-1); //끝한자리 
            var sson_cd = nvl(sson_cd,"").toUpperCase().substr(0,1); //한자리
            var itemcd = nvl(itemcd,"").toUpperCase().substr(0,2); //두자리
            var goods_seq = nvl(goods_seq,"").toUpperCase().zf(3); //0으로 채운 3자리 
            var colorcd = nvl(colorcd,"").toUpperCase().substr(0,2); //두자리 
            rtn.stcd     = brcd+itemcd+y+sson_cd+goods_seq;
            rtn.goods_cd = rtn.stcd+colorcd+szcd;
            rtn.br_nm    = gfnCdNm("brcd",brcd,"nm");            
            rtn.item_nm  = gfnCdNm("item",itemcd,"nm");
            rtn.sson_nm  = gfnCdNm("SBSN_CD",sson_cd,"nm");
            rtn.color_nm  = gfnCdNm("COLORCD",colorcd,"nm");
            rtn.detail_item_nm  = gfnCdNm("DET_ITEMCD",detail_itemcd,"nm");
            rtn.sz_range_nm  = gfnCdNm("SZ_RANGE",sz_range_cd,"nm");
            rtn.st_nm  = rtn.br_nm+" "+rtn.sson_nm+" "+nvl(rtn.detail_item_nm,rtn.item_nm)+"("+rtn.stcd+")";
            rtn.goods_nm  = rtn.st_nm; // rtn.br_nm+" "+rtn.sson_nm+" "+rtn.color_nm+" "+nvl(rtn.detail_item_nm,rtn.item_nm)+"("+rtn.goods_cd+")";
        //}
        return rtn;
    }
    //조회시 코드에 대한 명칭을 리턴해 줌
    me.fnATTRNm = function(row) {
        if(row==undefined) return {};
        row["supr_nm"]  = gfnCdNm("supr",row.suprcd,"nm");            
        row["br_nm"]    = gfnCdNm("brcd",row.brcd,"nm");            
        row["item_nm"]  = gfnCdNm("item",row.itemcd,"nm");
        row["sson_nm"]  = gfnCdNm("SBSN_CD",row.sson_cd,"nm");
        row["color_nm"]  = gfnCdNm("COLORCD",row.colorcd,"nm");
        row["detail_item_nm"] = gfnCdNm("DET_ITEMCD",row.detail_itemcd,"nm"); 
        row["sz_range_nm"] = gfnCdNm("SZ_RANGE",row.sz_range_cd,"nm"); 
        return row;
    }
    //지표계산
    me.fnCalcRT = function(col, init_price, std_sprice_rt, sale_std_price, init_prch_rt, schd_cost, gr_schd_qty ) {
        var rtn = {init_price:init_price, std_sprice_rt:std_sprice_rt, sale_std_price:sale_std_price, init_prch_rt:init_prch_rt, schd_cost:schd_cost, cost_rt:null, gr_schd_qty:gr_schd_qty, prch_amt:null, sale_std_amt:null };
        var val = rtn[col]; //변경이 일어난 값 
        if(col=="init_price") { 
            rtn.sale_std_price = val*rtn.std_sprice_rt/100; //기준판가는 최초소비자가*기준판가율
        } else if (col=="std_sprice_rt") {
            rtn.sale_std_price = init_price*val/100; //기준판가는 최초소비자가*기준판가율
        } else if (col=="sale_std_price") {
            rtn.std_sprice_rt = val/init_price*100; //기준판가율은 기준판가/최초소비자가 
        } 
        var init_price_unvat = toNum(rtn.init_price / 1.1);
        var sale_std_price_unvat = toNum(rtn.sale_std_price / 1.1);
        if (col=="schd_cost") {
            rtn.init_prch_rt = 100 * val * init_price_unvat;
        } else {
            rtn.schd_cost = init_price_unvat * rtn.init_prch_rt / 100; //매입원가 = 최초소비자가 * 매입원가율
        }
        rtn.std_sprice_rt = toNum( rtn.std_sprice_rt, 2);
        rtn.sale_std_price = toNum( rtn.sale_std_price, -2); //판가 100원단위
        rtn.init_prch_rt = toNum( rtn.init_prch_rt, 2 );
        rtn.schd_cost = toNum( rtn.schd_cost, -1 ); //매입가 10원단위 
        rtn.cost_rt = toNum( 100 * rtn.schd_cost / sale_std_price_unvat, 1);
        rtn.prch_amt = toNum( rtn.gr_schd_qty * rtn.schd_cost );
        rtn.sale_std_amt = toNum( rtn.gr_schd_qty * sale_std_price_unvat ); 
        return rtn;
    }
    
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) { 
        console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]){ 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        //pageCond:조회조건 이벤트처리     
        else if(component==me.pageObj["pageCond"]) {
            //if(evt=="change" && col=="colid") {...}
        }

        //list:상제품 목록 이벤트처리     
        else if(component==me.pageObj["list"]) {
            if(evt == "componentFunc") {
                if(row == "addRow") {
                    //기본값 챙기기 : 줄추가될때 조회조건값이 있으면 사용한다.
                    if(!me.pageObj["pageCond"].chkValid()) return;
                    var copyrow = {}; 
                        copyrow["crud"] = "C";
                        copyrow["suprcd"] = me.pageObj.pageCond.getVal("suprcd");
                        copyrow["supr_nm"]= gfnCdNm("supr",me.pageObj.pageCond.getVal("suprcd"),"nm"); 
                        copyrow["goods_stat_cd"]= me.pageObj.pageCond.getVal("goods_stat_cd"); 
                        copyrow["sale_allow_yn"]= "Y"; 
                        copyrow["gr_allow_yn"]= "Y"; 
                        copyrow["gi_allow_yn"]= "Y"; 
                    var rowCnt = component._componentCond["rowCnt"].getVal();
                    var curData = component.exportData();
                    for(var i=0; i < rowCnt; i++) {
                        curData.push($.extend({},copyrow));
                    }
                    component.importData(curData);
                    component.total("top");
                } else if(row == "delRow") {
                    var rows = component.selectedRows();
                    if(rows.length < 0) {
                        gfnAlert("줄 삭제 확인", "선택된 줄이 없습니다.");
                    } else {
                        component.delRow(rows);
                        component.total("top");
                    }
                }  
            }
            if(evt=="paste") {
                gfnStatus("붙여넣기한 코드를 점검하고, 값을 재계산하고 있습니다.");
                component.bEvent = false;
                for(var i = 0; i < component.countRow(); i++) {
                    var row = component.getNodeId(i);
                    var suprcd = component.getVal(row,"suprcd");
                    var goods_cd = component.getVal(row,"stcd")+component.getVal(row,"colorcd")+component.getVal(row,"szcd");
                    var detail_itemcd = component.getVal(row,"detail_itemcd");
                    var sz_range_cd = component.getVal(row,"sz_range_cd");
                    if(!isNull(goods_cd)) {
                        var rtn = me.fnSTCLtoATTR(suprcd,goods_cd,detail_itemcd,sz_range_cd);
                        // {stcd:"",st_nm:"",goods_nm:"",brcd:"",br_nm:"",itemcd:"",item_nm:"",yyyy:"",sson_cd:"",sson_nm:"",goods_seq:"",colorcd:"",color_nm:"",detail_item_nm:""};
                        component.setVal(row,"goods_cd",goods_cd);
                        component.setVal(row,"goods_nm",rtn.goods_nm);
                        component.setVal(row,"brcd",rtn.brcd);
                        component.setVal(row,"br_nm",rtn.br_nm);
                        component.setVal(row,"itemcd",rtn.itemcd);
                        component.setVal(row,"item_nm",rtn.item_nm);
                        component.setVal(row,"yyyy",rtn.yyyy);
                        component.setVal(row,"sson_cd",rtn.sson_cd);
                        component.setVal(row,"sson_nm",rtn.sson_nm);
                        component.setVal(row,"goods_seq",rtn.goods_seq); 
                        component.setVal(row,"color_nm",rtn.color_nm); 
                        component.setVal(row,"detail_item_nm",rtn.detail_item_nm);
                        component.setVal(row,"sz_range_nm",rtn.sz_range_nm);    
                    }
                    var init_price     = component.getVal(row,"init_price");
                    var std_sprice_rt  = component.getVal(row,"std_sprice_rt");
                    var sale_std_price = component.getVal(row,"sale_std_price");
                    var init_prch_rt   = component.getVal(row,"init_prch_rt");
                    var schd_cost      = component.getVal(row,"schd_cost"); 
                    var gr_schd_qty    = component.getVal(row,"gr_schd_qty"); 
                    var rtn = me.fnCalcRT(col, init_price, std_sprice_rt, sale_std_price, init_prch_rt, schd_cost, gr_schd_qty );
                    //{init_price:init_price, std_sprice_rt:std_sprice_rt, sale_std_price:sale_std_price, init_prch_rt:init_prch_rt, schd_cost:schd_cost, cost_rt:null, gr_schd_qty:gr_schd_qty, prch_amt:null, sale_std_amt:null };
                    component.setVal(row,"std_sprice_rt",rtn.std_sprice_rt);
                    component.setVal(row,"sale_std_price",rtn.sale_std_price);
                    component.setVal(row,"init_prch_rt",rtn.init_prch_rt);
                    component.setVal(row,"schd_cost",rtn.schd_cost);
                    component.setVal(row,"cost_rt",rtn.cost_rt);
                    component.setVal(row,"prch_amt",rtn.prch_amt);
                    component.setVal(row,"sale_std_amt",rtn.sale_std_amt);
                }
                component.bEvent = true;
                component.total("top");
            }
            if(evt=="change") {
                //속성으로 스타일코드/명 조립하기 
                if(inStr(["brcd","yyyy","sson_cd","itemcd","goods_seq","detail_itemcd"],col)>=0) {
                    var suprcd = component.getVal(row,"suprcd");
                    var brcd   = component.getVal(row,"brcd");
                    var yyyy   = component.getVal(row,"yyyy");
                    var sson_cd   = component.getVal(row,"sson_cd");
                    var itemcd   = component.getVal(row,"itemcd");
                    var goods_seq   = component.getVal(row,"goods_seq");
                    var colorcd   = component.getVal(row,"colorcd");
                    var szcd   = component.getVal(row,"szcd");
                    var detail_itemcd   = component.getVal(row,"detail_itemcd");
                    var sz_range_cd   = component.getVal(row,"sz_range_cd");
                    var rtn = me.fnATTRtoSTCL(suprcd,brcd,yyyy,sson_cd,itemcd,goods_seq,colorcd,szcd,detail_itemcd,sz_range_cd);
                    // {stcd:"",st_nm:"",goods_cd:"",goods_nm:"",br_nm:"",item_nm:"",sson_nm:"",color_nm:"",detail_item_nm:""};  
                    component.setVal(row,"stcd",rtn.stcd); 
                    component.setVal(row,"goods_cd",rtn.goods_cd);
                    component.setVal(row,"goods_nm",rtn.goods_nm);
                    component.setVal(row,"br_nm",rtn.br_nm);
                    component.setVal(row,"item_nm",rtn.item_nm);
                    component.setVal(row,"sson_nm",rtn.sson_nm);
                    component.setVal(row,"color_nm",rtn.color_nm);
                    component.setVal(row,"detail_item_nm",rtn.detail_item_nm);
                    component.setVal(row,"sz_range_nm",rtn.sz_range_nm);
                }
                //스타일코드로 속성 세팅하기
                if(col=="stcd"||col=="colorcd"||col=="szcd") {
                    var suprcd = component.getVal(row,"suprcd");
                    var goods_cd = component.getVal(row,"stcd")+component.getVal(row,"colorcd")+component.getVal(row,"szcd");
                    var detail_itemcd = component.getVal(row,"detail_itemcd");
                    var sz_range_cd = component.getVal(row,"sz_range_cd");
                    var rtn = me.fnSTCLtoATTR(suprcd,goods_cd,detail_itemcd,sz_range_cd);
                    // {stcd:"",st_nm:"",goods_nm:"",brcd:"",br_nm:"",itemcd:"",item_nm:"",yyyy:"",sson_cd:"",sson_nm:"",goods_seq:"",colorcd:"",color_nm:"",detail_item_nm:"",sz_range_nm};
                    component.setVal(row,"goods_cd",goods_cd);
                    component.setVal(row,"goods_nm",rtn.goods_nm);
                    component.setVal(row,"brcd",rtn.brcd);
                    component.setVal(row,"br_nm",rtn.br_nm);
                    component.setVal(row,"itemcd",rtn.itemcd);
                    component.setVal(row,"item_nm",rtn.item_nm);
                    component.setVal(row,"yyyy",rtn.yyyy);
                    component.setVal(row,"sson_cd",rtn.sson_cd);
                    component.setVal(row,"sson_nm",rtn.sson_nm);
                    component.setVal(row,"goods_seq",rtn.goods_seq); 
                    component.setVal(row,"color_nm",rtn.color_nm); 
                    component.setVal(row,"detail_item_nm",rtn.detail_item_nm);  
                    component.setVal(row,"sz_range_nm",rtn.sz_range_nm);  
                }
                //공급사최초소비자가, 기준판가율입력, 기준판가 입력시 수식계산
                if(inStr(["init_price","std_sprice_rt","sale_std_price","init_prch_rt","schd_cost","cost_rt","gr_schd_qty"],col)>=0) {
                    var init_price     = component.getVal(row,"init_price");
                    var std_sprice_rt  = component.getVal(row,"std_sprice_rt");
                    var sale_std_price = component.getVal(row,"sale_std_price");
                    var init_prch_rt   = component.getVal(row,"init_prch_rt");
                    var schd_cost      = component.getVal(row,"schd_cost"); 
                    var gr_schd_qty    = component.getVal(row,"gr_schd_qty"); 
                    var rtn = me.fnCalcRT(col, init_price, std_sprice_rt, sale_std_price, init_prch_rt, schd_cost, gr_schd_qty );
                    //{init_price:init_price, std_sprice_rt:std_sprice_rt, sale_std_price:sale_std_price, init_prch_rt:init_prch_rt, schd_cost:schd_cost, cost_rt:null, gr_schd_qty:gr_schd_qty, prch_amt:null, sale_std_amt:null };
                    component.setVal(row,"std_sprice_rt",rtn.std_sprice_rt);
                    component.setVal(row,"sale_std_price",rtn.sale_std_price);
                    component.setVal(row,"init_prch_rt",rtn.init_prch_rt);
                    component.setVal(row,"schd_cost",rtn.schd_cost);
                    component.setVal(row,"cost_rt",rtn.cost_rt);
                    component.setVal(row,"prch_amt",rtn.prch_amt);
                    component.setVal(row,"sale_std_amt",rtn.sale_std_amt);
                    component.total("top");
                }  
            } 
        }
    } 
 
    //save:저장 
    me.fnSave=function() {
        if( !me.pageObj["pageCond"].chkValid() ) return;
        if( !me.pageObj["list"].chkValid() ) return;
        var args = me.pageObj["pageCond"].exportData()[0];
        args.list = me.pageObj["list"].exportData("CUD");
        if(args.list.length==0) {
            gfnAlert("저장확인","변경된 사항이 없습니다.");
            return;
        }
        //console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"save",{INVAR:invar},function(OUTVAR){
            //console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                gfnAlert("저장성공","스타일/컬러 정보를 저장하였습니다.");
                me.fnInit();
            } else {
                gfnAlert("저장오류",OUTVAR.rtnMsg);
            }
        });
    }
 

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>