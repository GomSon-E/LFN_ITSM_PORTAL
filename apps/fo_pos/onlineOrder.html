<style>[pgmid='onlineOrder'].framepage .userClass { 
width:100%; 
}</style>

<!-- HTML autogen start ---------------------------------------------- -->            
<div class="pageNav"></div>
<div class="pageTop"></div>
<div class="pageCond"></div>
<div class="pageGuide"></div>
<div class="pageContent">
    <div id='list' class="flexColumn"></div>
</div>
<script>
function lpad(str, padLen, padStr) {
if (padStr.length > padLen) {
    return str;
}
str += ""; // 문자로
padStr += ""; // 문자로
while (str.length < padLen)
    str = padStr + str;
str = str.length >= padLen ? str.substring(0, padLen) : str;
return str;
}
    
function rpad(str, padLen, padStr) {
    if (padStr.length > padLen) {
        return str + "";
    }
    str += ""; // 문자로
    padStr += ""; // 문자로
    while (str.length < padLen)
        str += padStr;
    str = str.length >= padLen ? str.substring(0, padLen) : str;
    return str;
}    
    
</script>
<!-- HTML autogen end ---------------------------------------------- -->
<script>
/*-- SCRIPT autogen start ---------------------------------------------- */        
$(function() {
    var appid = "fo_pos";
    var pgmid = "onlineOrder"; 
    var page = $("*[pgmid='"+pgmid+"'].framepage").last();
    var pageid = page.attr("id"); 
    var me = {}
    var dataSet = {};
    var dataDef = {};
    var pageObj = {};
    var bEdit = false;
    me.fnInit = function() {
        gfn[pageid] = me; 
        me.appid    = appid;
        me.pgmid    = pgmid;
        me.pageid   = pageid;
        me.page     = page; 
        me.dataSet = dataSet;
        me.dataDef = dataDef;
        me.pageObj = pageObj;
        me.bEdit = bEdit;
me.dataDef["_pgm"]={"ver":6.9,"upd_dt":"2022-08-11 14:42:21","remark":"스퀘어몰로부터 전송되었거나 수기 입력한 주문내역과 상태를 조회한다.","pgmid":"onlineOrder","proc_mst_id":"","pgm_stat":"Y","sort_seq":210,"app_pgmid":"fo_pos","shortcut":"","reg_dt":"2022-08-11 14:42:21","reg_usid":"mjw","pgm_nm":"온라인자사몰 주문 접수","upd_usid":"mjw","pgm_tp":"UX","pgm_grp_nm":"온라인","proc_mst_nm":"","app_pgm_nm":"매장","":"트랜젝션(메뉴)","crud":""};
me.dataDef["_pgm_func"]=[{"func_icon":"fas fa-search","reg_dt":"2022-08-11 14:42:21","reg_usid":"","func_nm":"조회","upd_usid":"","upd_dt":"2022-08-11 14:42:21","func_tp":"DB_R","remark":null,"pgmid":"onlineOrder","sort_seq":"1","funcid":"search","content":"대상자료 조회","crud":"R","id":"0"},{"func_icon":"fas fa-save","reg_dt":"2022-08-11 14:42:21","reg_usid":"","func_nm":"주문확인 및 RT의뢰","upd_usid":"","upd_dt":"2022-08-11 14:42:21","func_tp":"DB_W","remark":"[접수구분] 온라인점 출고, 매장RT 수령 후 출고, 오프매장 고객직송을 선택하여 접수할 수 있습니다. 접수시  RT/직송 의뢰정보가 자동생성됩니다.","pgmid":"onlineOrder","sort_seq":"3","funcid":"save","content":"주문내역을 확인하고 접수구분(온라인출고,RT의뢰,고객직송)에 따라 ERP의뢰를 생성함","crud":"R","id":"1"},{"func_icon":"fas fa-check","reg_dt":"2022-08-11 14:42:21","reg_usid":"","func_nm":"주문접수","upd_usid":"","upd_dt":"2022-08-11 14:42:21","func_tp":"DB_W","remark":null,"pgmid":"onlineOrder","sort_seq":"4","funcid":"accept","content":"온라인재고가 확보되었거나 고객직송 수락건에 대해서 주문 접수정보를 스퀘어몰로 전송함","crud":"R","id":"2"}];
me.dataDef["_pgm_data"] = {};
me.dataDef["_pgm_data"]["pageCond"]={"sort_seq":"1","data_id":"pageCond","data_nm":"조회조건","data_icon":null,"component_pgmid":"aweForm","component_option":null,"inout_tp":"IN","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":null,"colid":"market_idx","colnm":"주문번호","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":"주문일자","colid":"dt_from","colnm":"주문일자","dtype":"ymd","etype":"txt","attr":"ymd keycol","defval":"date(\"1st\")","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":"주문일자","colid":"dt_to","colnm":"주문일자","dtype":"ymd","etype":"txt","attr":"ymd keycol","defval":"date(\"today\")","w":"8","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":null,"colid":"confirm","colnm":"주문접수","dtype":"text","etype":"sel","attr":null,"defval":"\"N\"","w":null,"h":null,"refcd":"[{\"cd\":\"Y\",\"nm\":\"접수완료\"},{\"cd\":\"N\",\"nm\":\"미접수\"}]","option":"all:confirm::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":null,"colid":"mov_yn","colnm":"접수구분","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"ONLINE_SO_MOV_YN","option":"multi:mov_yn::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":null,"colid":"remark","colnm":"메모(포함)","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":null,"colid":"remarkexcept","colnm":"메모(제외)","dtype":"text","etype":"txt","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"mat_tp","colnm":"상품유형","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"MAT_TP","option":"multi:mat_tp::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"suprcd","colnm":"공급사","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"supr","option":"multi:suprcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":10,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"yyyy","colnm":"상품연도","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"YYYY","option":"multi:yyyy::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":11,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"sson_cd","colnm":"시즌","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"SBSN_CD","option":"multi:sson_cd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"},{"sort_seq":12,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"brcd","colnm":"브랜드","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"brcd","option":"multi:brcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"11"},{"sort_seq":13,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"itemcd","colnm":"품목","dtype":"text","etype":"sel","attr":null,"defval":null,"w":null,"h":null,"refcd":"item","option":"multi:itemcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"12"},{"sort_seq":14,"section":"상품구분","section_icon":null,"colgrp":null,"colid":"goods_cd","colnm":"상품코드","dtype":"text","etype":"txt","attr":"upper","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"13"}]};
me.dataDef["_pgm_data"]["list"]={"sort_seq":"2","data_id":"list","data_nm":"주문목록","data_icon":null,"component_pgmid":"agGrid","component_option":{"gridOpt":"rn chk","gridOptions":{"singleClickEdit":"false"},"remark":"*'미이행': 해당상품을 제외하고 발송(타매장 재의뢰필요).   *매장재고 = 전 매장 가용재고 합계 - 안전재고1 "},"inout_tp":"INOUT","content":[{"sort_seq":1,"section":null,"section_icon":null,"colgrp":"주문상태","colid":"accept_done","colnm":"확인","dtype":"text","etype":"raw","attr":"hidden","defval":null,"w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"0"},{"sort_seq":2,"section":null,"section_icon":null,"colgrp":"주문상태","colid":"confirmed","colnm":"접수","dtype":"num","etype":"sel","attr":"readonly","defval":null,"w":"4.5","h":null,"refcd":"ONLINE_ACCEPT_YN","option":"sel:confirmed::nm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"1"},{"sort_seq":3,"section":null,"section_icon":null,"colgrp":"주문정보","colid":"order_dt","colnm":"주문일","dtype":"ymd","etype":"raw","attr":"rowSpan","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"2"},{"sort_seq":4,"section":null,"section_icon":null,"colgrp":"주문정보","colid":"market_idx","colnm":"주문번호","dtype":"text","etype":"raw","attr":"rowSpan","defval":null,"w":"6","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"count('market_idx')+\"건\"","remark":null,"crud":"C","id":"3"},{"sort_seq":5,"section":null,"section_icon":null,"colgrp":"주문정보","colid":"basket_idx","colnm":"항번","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"7","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"4"},{"sort_seq":6,"section":null,"section_icon":null,"colgrp":"주문정보","colid":"yysssn_cd","colnm":"연도시즌","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"5","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"5"},{"sort_seq":7,"section":null,"section_icon":null,"colgrp":"주문정보","colid":"goods_cd","colnm":"상품코드","dtype":"text","etype":"raw","attr":null,"defval":null,"w":"15","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"6"},{"sort_seq":8,"section":null,"section_icon":null,"colgrp":"주문정보","colid":"ea","colnm":"수량","dtype":"num","etype":"raw","attr":"keycol","defval":null,"w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"7"},{"sort_seq":9,"section":null,"section_icon":null,"colgrp":"주문정보","colid":"price","colnm":"판매가","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"8"},{"sort_seq":10,"section":null,"section_icon":null,"colgrp":"주문정보","colid":"sale_amt","colnm":"판매금액","dtype":"num","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"9"},{"sort_seq":11,"section":null,"section_icon":null,"colgrp":"주문정보","colid":"customer_req","colnm":"고객 요청사항","dtype":"text","etype":"raw","attr":"hidden ","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"10"},{"sort_seq":12,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"stk_qty","colnm":"온라인재고","dtype":"num","etype":"raw","attr":"disabled","defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"11"},{"sort_seq":13,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"gr_exp_qty","colnm":"이동중(RT출고)","dtype":"num","etype":"raw","attr":"hidden ","defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"12"},{"sort_seq":14,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"qty","colnm":"할당수량","dtype":"num","etype":"raw","attr":"hidden ","defval":null,"w":"4","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"13"},{"sort_seq":15,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"stk_qty_shop","colnm":"매장재고","dtype":"num","etype":"raw","attr":"disabled","defval":null,"w":"6","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"14"},{"sort_seq":16,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"checkStk","colnm":"재고확인","dtype":"text","etype":"btn","attr":null,"defval":null,"w":"6","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"15"},{"sort_seq":17,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"item_cnt","colnm":"합포건수","dtype":"num","etype":"raw","attr":null,"defval":null,"w":"3","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":"\"\"","remark":null,"crud":"C","id":"16"},{"sort_seq":18,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"mov_yn","colnm":"접수구분","dtype":"text","etype":"sel","attr":"keycol","defval":null,"w":null,"h":null,"refcd":"ONLINE_SO_MOV_YN","option":"sel:mov_yn::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"17"},{"sort_seq":19,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"no_req","colnm":"재할당불가","dtype":"text","etype":"raw","attr":null,"defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"18"},{"sort_seq":20,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"rt_shopcd","colnm":"RT의뢰매장","dtype":"text","etype":"sel","attr":null,"defval":null,"w":"10","h":null,"refcd":"SHOPCD","option":"sel:rt_shopcd::cdnm","len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"19"},{"sort_seq":21,"section":null,"section_icon":null,"colgrp":"주문확인 및 RT의뢰","colid":"remark","colnm":"메모","dtype":"text","etype":"txt","attr":null,"defval":null,"w":"10","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"20"},{"sort_seq":22,"section":null,"section_icon":null,"colgrp":"주문접수 점검","colid":"rotate_no","colnm":"RT의뢰번호","dtype":"text","etype":"raw","attr":"hidden","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"21"},{"sort_seq":23,"section":null,"section_icon":null,"colgrp":"주문접수 점검","colid":"gr_yn","colnm":"RT입고/직송수락 여부","dtype":"text","etype":"raw","attr":"disabled","defval":null,"w":"12","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"22"},{"sort_seq":24,"section":null,"section_icon":null,"colgrp":"주문접수 점검","colid":"ord_content","colnm":"송장정보","dtype":"text","etype":"raw","attr":"hidden ","defval":null,"w":null,"h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"23"},{"sort_seq":25,"section":null,"section_icon":null,"colgrp":"주문접수 점검","colid":"accept_row","colnm":"접수대상","dtype":"text","etype":"raw","attr":"disabled","defval":null,"w":"5","h":null,"refcd":null,"option":null,"len":null,"valid":null,"colFormula":null,"grpFormula":null,"totFormula":null,"remark":null,"crud":"C","id":"24"}]};

        me.pageObj["_page"] = new gfnFramepage( me ); 
        for(var component_id in me.dataDef["_pgm_data"]) { 
            me.pageObj[component_id] = new gfnComponent( me.pageid, component_id, me.dataDef["_pgm_data"][component_id], me.fnEH, me); 
        }  
        setTimeout(function(){
            $("#frameset").scrollTo(0); //스크롤 
        },10);
        if(typeof(me.fnInitExtra)=='function') me.fnInitExtra(); 
    } 
/*-- SCRIPT autogen end ---------------------------------------------- */

    /* 사용자초기화 */
    me.fnInitExtra=function() {
        gfnGetData("SHOPCD",function(e){}); 
    }
    
    /* 이벤트핸들러 */
    me.fnEH=function(component, evt, row, col, val) {
        //console.log(evt+","+row+","+col+","+val);
        //화면기능버튼이 눌리면 
        if (component==me.pageObj["_pageFunc"]) { 
            if(typeof(me[col])=='function') me[col](); //col=기능명 me["fnSearch"]()=me.fnSearch(); 
        }
        if (component==me.pageObj["list"]) { 
            if(evt=="click" && col=="checkStk") {
                //매장별 재고조회 팝업  
                gObj.goods_cd   = component.getVal(row,"goods_cd");
                gObj.market_idx = component.getVal(row,"market_idx");
                gObj.basket_idx = component.getVal(row,"basket_idx");
                gObj.so_no      = component.getVal(row,"so_no");
                gObj.so_seq     = component.getVal(row,"so_seq");
                gObj.qty        = component.getVal(row,"ea");
                gObj.remark     = component.getVal(row,"remark");
                gObj.rt_shopcd  = component.getVal(row,"rt_shopcd");
                var searchPop = $("<div id='stkPop' class='framepage active'></div>");
                var searchPopup = null; 
                var _fnCallback = function(shopcd) { 
                    if(component.getVal(row,"mov_yn")!="Y" && component.getVal(row,"mov_yn")!="C") {
                        // if(shopcd=="LF101") {
                        //     component.setVal(row,"rt_shopcd",""); 
                        //     component.setVal(row,"mov_yn","D"); 
                        // } 
                        //else {
                            component.setVal(row,"rt_shopcd",shopcd); 
                            if(component.getVal(row,"mov_yn")!="O") component.setVal(row,"mov_yn","R"); 
                        //}
                    } else {
                        gfnStatus("판매완료 또는 취소건입니다...");
                    }
                    if(shopcd != gObj.rt_shopcd){
                        component.setVal(row,"rotate_no"," ");
                        component.setVal(row,"gr_yn"," ");
                    }
                    setTimeout(function(){searchPopup.dialog("close");},1);    
                }
                gObj.fnCallback = _fnCallback;  
                // gfnLoad("fo_pos","onlineOrderStkPop",searchPop,function(){
                //      searchPopup = gfnPopup("매장재고조회",searchPop,{width:900, height:600});
                // });
                gfnLoad("fo_pos","onlineOrderStkPop2",searchPop,function(){
                     searchPopup = gfnPopup("매장재고조회",searchPop,{width:1200, height:800});
                });
            }
            if(evt=="change") {
                //온라인점 접수처리시 
                if(col=="mov_yn" && val=="D") component.setVal(row,"rt_shopcd","");
                //RT의뢰점이 변경될때
                else if(col=="rt_shopcd") {
                    //Y 수불완료인 건은 그대로 둔다.
                    if(component.getVal(row,"mov_yn")!="Y") {
                        //LF101 로 RT의뢰하는 건 온라인점 접수처리하는 것과 같다.
                        // if(val=="LF101") {
                        //     component.setVal(row,"mov_yn","D");
                        //     component.setVal(row,"rt_shopcd",""); 
                        // } else {
                            //이미 직송이 선택되어 있었으면 유지, 그렇지 않으면 RT의뢰
                            if(component.getVal(row,"mov_yn")!="O") component.setVal(row,"mov_yn","O");  
                        // }
                    }
                }
                if(col=='rt_shopcd'){
                    component.setVal(row,"rotate_no"," ");
                    component.setVal(row,"gr_yn"," ");
                }
            }
        } 
    }
    //search:조회 
    me.fnSearch=function() {
        var pageCond = me.pageObj["pageCond"].exportData()[0];
        me.pageObj.pageCond.setVal("so_no","");
        me.pageObj.pageCond.setVal("so_seq","");
        me.pageObj.pageCond.setVal("so_amt","");
        me.pageObj.pageCond.setVal("so_nm","");
        if( !me.pageObj["pageCond"].chkValid() ) return;
        var args = me.pageObj["pageCond"].exportData()[0];
        console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"search",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {
                var lists = OUTVAR.list;
                for(i=0;i<lists.length;i++) {
                    if(!isNull(lists[i].confirm_dt)) {
                        lists[i].confirm = 'Y';
                    } else {
                        lists[i].confirm = 'N';
                    }
                }
                for(i=0;i<lists.length;i++){
                    if(lists[i].gr_yn == 'F'){
                        lists[i].gr_yn = 'Y';
                    }else if(lists[i].gr_yn == 'Y'){
                        lists[i].gr_yn = 'C'+ " (" +"출고완료" + ")";
                    }else if(lists[i].gr_yn == 'D'){
                        lists[i].gr_yn = ' ';
                    }
                    
                }
                for(i=0;i<lists.length;i++){
                    if(lists[i].mov_yn == 'D'){
                        lists[i].rt_shopcd = 'LF101';
                    }
                }
                /* 매장교육 후 아래 로직 삭제 
                var flag = 0;
                for(i=0;i<lists.length;i++){
                    if(lists[i].mov_yn=="O") {
                        lists[i].mov_yn="R"; 
                        lists[i].remark="**"+lists[i].remark;
                        flag++;
                    } 
                }  
                if(flag > 0) gfnStatus("고객직송이 추천되는 주문["+flag+"]건을 RT의뢰로 변경하였습니다. 매장교육 후 고객직송 개시합니다.");
                */ 
                me.pageObj["list"].importData(lists);
                me.pageObj["list"].total("top"); 
            } else {
                gfnAlert("조회오류",OUTVAR.rtnMsg);
            }
        });
        
    }
    
    //자동배분
    me.fnCalc=function() { 
        var args = {}; 
        args.list = me.pageObj.list.exportData("selected");
        console.log(args);
        var invar = JSON.stringify(args);
        gfnTx(appid+"."+pgmid,"calc",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") {  
                me.fnSearch();  
            } else {
                gfnAlert("저장오류",OUTVAR.rtnMsg);
            }
        }); 
    } 
    
    me.fnSave=function(bAccept) {
        //할당확인 > 주문접수
        //  할당확인 : 신규 주문내역을 확인하여 온라인출고 지정하거나 부족분은 RT의뢰, 온라인점에 재고 없는 건은 직송의뢰 함
        //  주문접수 : 온라인출고를 위한 재고가 확보되었거나, 직송의뢰를 수락한 경우 어드민으로 확정정보를 전송함  
        var list = me.pageObj.list.exportData("selected");
        for(i=0;i<list.length;i++){
            if(list[i].confirmed == 'Y'){
                gfnAlert("접수오류","주문번호[" + list[i].market_idx + "-" + list[i].basket_idx + "]은 이미 접수된 건입니다. 어드민 할당완료 상태가 맞지 않거나 추가RT의뢰가 필요한 경우 시스템담당자에게 미접수 상태로 변경 요청해주세요.");
                return;
            } 
        }
        //일단 저장하고 체크된 건은 접수처리한다.
        var args = {};
        args.list = me.pageObj.list.exportData("selected");  
        for(i=0; i < args.list.length; i++) {
            if( (args.list[i].mov_yn=="R"||args.list[i].mov_yn=="O") && isNull(args.list[i].rt_shopcd) ) {
                gfnAlert("접수구분 확인","주문번호[" + args.list[i].market_idx + "-" + args.list[i].basket_idx + "] 접수구분 직송 또는 RT인 건은 의뢰매장이 지정되어야 합니다.");
                return;
            }
            //접수구분이 Y,N,C인건은 판단대상 아님 N -> D R O -> Y C
            else if(inStr("Y N C",args.list[i].mov_yn) >= 0) args.list[i].accept_row = "N"; 
            else {
                var sub = subset(args.list,"market_idx",args.list[i].market_idx);
                
                //단포
                //  D 이고 온라인재고 있으면 Y
                //  R 이고 RT이행 했고 온라인 재고 있으면 Y
                //  O 이고 수락했으면 Y
                /* 나중에 로직 정교화 
                if(sub.length==1) {
                */
                if(!isNull(args.list[i].ord_content)){
                    var cur_ord_content = args.list[i].ord_content;
                    var ord_content = cur_ord_content.replace("택배발송 후 송장번호 입력 저장해 주세요!"," ");
                    args.list[i].ord_content = ord_content;
                }
                    if(args.list[i].mov_yn == 'D' && ( toNum(args.list[i].ea) <= toNum (args.list[i].qty)||isNull(args.list[i].qty)) ) args.list[i].accept_row = "Y";
                    else if(args.list[i].mov_yn != 'D' && args.list[i].mov_yn != 'O' && toNum(args.list[i].ea) <= toNum (args.list[i].qty)) args.list[i].accept_row = "Y";
                    else if(args.list[i].mov_yn == 'O' && args.list[i].ord_content != " ") args.list[i].accept_row = "Y";
                    else args.list[i].accept_row = "N"; 

                //합포
                //  해당 주문의 모든 Row를 체크해서 모두 Y이면 Y 그렇지 않으면 N  
                /*
                } else if (sub.length > 1 ) {
                    var cur_mov_yn = args.list[i].mov_yn;
                    if(cur_mov_yn=="O") {
                        var chk = extract(sub,["mov_yn","rt_shopcd"],"distinct");
                        if(chk.length ==1 && !isNull(args.list[i].ord_content)) args.list[i].accept_row = "Y";
                        else args.list[i].accept_row = "N"; 
                    } else {
                        if(toNum(args.list[i].ea) <= toNum (args.list[i].qty)) args.list[i].accept_row = "Y"; 
                        else args.list[i].accept_row = "N"; 
                    } 
                }
                */
            } 
        } 
        me.pageObj.list.importData(args.list); 
        console.log(args);
        var _fnSave = function(args) {
            var invar = JSON.stringify(args);
            console.log(args); 
            //먼저 row별로 접수구분과 메모 save하면서 tp_so_goods의 cd_stat = 'R'로 업데이트 
            //saveBatch하면서 고객직송, RT변경건 의뢰서 생성
            gfnTx(appid+"."+pgmid,"save",{INVAR:invar},function(OUTVAR){
                console.log(OUTVAR);
                if(OUTVAR.rtnCd=="OK") { 
                    if(isNull(bAccept)) { //주문확인 눌렀으면 주문접수토록 안내 
                        me.pageObj.pageCond.setVal("market_idx","");  
                        me.fnSearch(); 
                        gfnAlert("주문접수 진행","주문확인이 저장되었습니다. 전체 미접수내역을 확인하고 [주문접수] 해주세요");
                    } else if (bAccept==true) {
                        var invar = JSON.stringify(args);
                        console.log(args);
                        //위에서 접수해야 하는 건은 Y, 아닌 건은 N로 업데이트 해놓았음 
                        gfnTx("api"+"."+"order_accept","send",{INVAR:invar},function(OUTVAR){
                            console.log(OUTVAR);
                            if(OUTVAR.rtnCd=="OK") { 
                                gfnAlert("주문접수","주문접수가 완료되었습니다. 어드민페이지에서 할당완료를 확인해주세요!");
                                me.fnSearch(); 
                            } else {
                                gfnAlert("주문접수(이퀴닉스 전송) 오류",OUTVAR.rtnMsg);
                            }
                        });
                    }
                } else {
                    gfnAlert("저장오류",OUTVAR.rtnMsg);
                }
            });
        }
        if(bAccept==true) {
            gfnConfirm("주문접수","접수가능 상태 주문을 접수처리(어드민 대기 -> 할당완료)하시겠습니까?",function(rtn) {
                args.accept = 'Y';  //접수일떄 
                if(rtn) _fnSave(args);
            });
        } else {
            gfnConfirm("주문확인 및 RT의뢰","주문확인 내역저장 및 RT의뢰를 생성하시겠습니까?",function(rtn) {
                args.accept = 'N'; //주문확인 및 RT의뢰일떄 
                if(rtn) _fnSave(args);
            });
        }
    } 
    
    //주문접수
    me.fnAccept=function() {
        me.fnSave(true); //일단 저장하고 접수처리 진행  
    }
    
    me.fnSavememo=function() {
        var args = {};
        args.list = me.pageObj.list.exportData();  
        var invar = JSON.stringify(args);
        console.log(args);
        //먼저 row별로 접수구분과 메모 save하면서 tp_so_goods의 cd_stat = 'R'로 업데이트 
        //saveBatch하면서 고객직송, RT변경건 의뢰서 생성
        gfnTx(appid+"."+pgmid,"savememo",{INVAR:invar},function(OUTVAR){
            console.log(OUTVAR);
            if(OUTVAR.rtnCd=="OK") { 
                gfnAlert("저장성공","메모를 저장하였습니다.");
            } else {
                gfnAlert("저장오류",OUTVAR.rtnMsg);
            }
        });        
    }  
 
    
    

/*-- SCRIPT autogen ---------------------------------------------------- */        
if(typeof(me.fnInit)=='function') me.fnInit();
});

</script>