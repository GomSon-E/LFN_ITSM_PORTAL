<style>
	#totalpaylist input{
    width : 350px;
    height : 40px;
    font-size : 30px;
    font-weight : bold;
	}
	#totalpaylist button{
		width : 250px;
		height : 65px;
		font-size : 30px;
		font-weight : bold;
	}
	#totalpaylist2 input{
		width : 350px;
		height : 40px;
		font-size : 30px;
		font-weight : bold;
	}
	#totalpaylist2 button{
		width : 250px;
		height : 65px;
		font-size : 30px;
		font-weight : bold;
	}
</style>
<html>
	<head>	 
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.0/jquery.min.js"> </script>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />	
		<script> 
		console.log("0");
		function lpad(str, padLen, padStr) {
		if (padStr.length > padLen) {
			return str;
		}
		str += ""; // 문자로
		padStr += ""; // 문자로
		while (str.length < padLen)
			str = padStr + str;
		str = str.length >= padLen ? str.substring(0, padLen) : str;
		return str;
		}

		function rpad(str, padLen, padStr) {
		if (padStr.length > padLen) {
			return str + "";
		}
		str += ""; // 문자로
		padStr += ""; // 문자로
		while (str.length < padLen)
			str += padStr;
		str = str.length >= padLen ? str.substring(0, padLen) : str;
		return str;
		}

		function setYYMMDDHHMMSS()
			{
				var nowDate = new Date(); 
				var vaYY = nowDate.getFullYear().toString().substr(2, 4);
				var vaMM = pad(nowDate.getMonth()+1, 2);
				var vaDD = pad(nowDate.getDate()   , 2);
				var vaHH = pad(nowDate.getHours()  , 2);
				var vaMin= pad(nowDate.getMinutes(), 2);
				var vaSS = pad(nowDate.getSeconds(), 2);
				
				return vaYY+vaMM+vaDD+vaHH+vaMin+vaSS;
			}
		function pad(number, length)
		{
			var str = number.toString();
			while(str.length < length)
			{
				str = '0' + str;
			}
			return str;
		}
		function setContent(param)
		{
			if(param.slsAmt) 
			{
				document.getElementById("txtSlsAmt").value = param.slsAmt;    //매출금액		
			}
			
			if(param.mlplMnts) 
			{
				document.getElementById("txtMlplMnts").value = param.mlplMnts;	//할부개월			
			}
			
			if(param.slsDt) 
			{
				document.getElementById("txtCatApprDate").value = param.slsDt;	//승인일자			
			}
			
			if(param.aprvNo) 
			{
				document.getElementById("txtCatApprNo").value = param.aprvNo;	//승인번호			
			}
			
			if(param.csrcCnsmKd) 
			{
				document.getElementById("txtCsrcCnsmKd").value = param.csrcCnsmKd;		//현금영수증 소비자구분		
			}		    
		}

		String.prototype.fillZero = function(n)
		{
			var str   = this;
			var zeros = "";

			if(str.length < n)
			{
				for(i = 0; i < n - str.length; i++)
				{
					zeros += '0';
				}
			}
			return zeros + str;
		}

		String.prototype.fillSpace = function(n)
		{
			var str   = this;
			var space = "";

			if(str.length < n)
			{
				for(i = 0; i < n - str.length; i++)
				{
					space += ' ';
				}
			}
			return str + space;
		}

		String.prototype.byteLength = function()
		{
			var len = 0;
		
			for(var i=0; i<this.length; i++)
			{
				len += (this.charCodeAt(i) > 127) ? 2 : 1;
			}
			return len;
		}

		String.prototype.substrKor = function(idx, len)
		{
			if(!this.valueOf()) return "";
		
			var str = this;
			var pos = 0;

			for(var i=0; pos<idx; i++)
			{
				pos += (str.charCodeAt(i) > 127) ? 2 : 1;
			}

			var beg = i;
			var byteLen = str.byteLength();
			var lim = 0;			

			for(var i=beg; i<byteLen; i++)
			{
				lim += (str.charCodeAt(i) > 127) ? 2 : 1;

				if(lim > len)
				{ 
					str = str.substring(beg, i);
					break;
				}
			}
		
			return str;   
		}

		function JSONtoString(object) 
		{
			var results = [];
			
			for (var property in object) 
			{
				var value = object[property];
				if (value)
					results.push(property.toString() + ': ' + value);
			}
						
			return '{' + results.join(', ') + '}';
		}

		function FindJSONtoString(Key, object) 
		{
			var results = "";
			for (var property in object) 
			{
				var value = object[property];
				if (value)
				{
					if(Key == property.toString())
					{
						results = value;
						break;
					}
				}
			}
			return results;
		}

		stringformat = function (text) 
		{
			if (arguments.length <= 1) return text;

			for (var i = 0; i <= arguments.length - 2; i++) {
				text = text.replace(new RegExp("\\{" + i + "\\}", "gi"), arguments[i + 1]);
			}

			return text;
		}
		function usdcash_cancel(){
			var request_msg = "";
			request_msg = "S_STATUS";
			$("input[name=taRequest]").attr("value", request_msg);
			var taRequestvalue = $("input[name=taRequest]").val();
			var taRequest = {taRequest : taRequestvalue };
			$.ajax
			({
				url:"http://127.0.0.1:27098", 
				type:"POST",
				async : false,
				dataType : "jsonp",
				jsonp : "callback",
				data : { "REQ": taRequestvalue },
				success: function(datalist)
				{	
					if(datalist != null && datalist.RES_CD == '0000'){
					var strSaleAmt = $("input[name=txtSlsAmt]").val();
					var orgSlsDt = $("input[name=txtCatApprDate]").val();
					var orgAprvNo = $("input[name=txtCatApprNo]").val();
					var strCsrcCnsmKd = $("input[name=txtCsrcCnsmKd]").val();

					var saleAmt = new Number(strSaleAmt);
					var suppAmt = Math.round(saleAmt / 1.1);
					var vat = saleAmt - suppAmt;
					var strVat = new String(vat);
					var request_msg = "";
					
					request_msg += "APP____2";                     			   // 메시지 창 출력하지 않음 
					request_msg += String.fromCharCode(2);                     // STX
					request_msg += "A0";									   // 거래요청전문
					request_msg += "CR";                                       // 거래종류코드
					request_msg += String.fromCharCode(28);                    // FS(1) //단말기ID
					request_msg += String.fromCharCode(28);     
					request_msg += "@0100001234";               			   // FS(2) //현금영수증 WCC + 현금고객ID
					request_msg += String.fromCharCode(28);                    // FS(3)
					request_msg += "0" + strCsrcCnsmKd;						   // 할부개월(현금영수증-([01]법인,[02]개인) / 수표조회-권종코드)
					request_msg += String.fromCharCode(28);					   // FS(4)
					request_msg += strSaleAmt;                    				// 총금액
					request_msg += String.fromCharCode(28);					   // FS(5)
					request_msg += strVat;                         				// 세금
					request_msg += String.fromCharCode(28);					   // FS(6)
					request_msg += "0";                                			// 봉사료
					request_msg += String.fromCharCode(28);					   // FS(7) 원거래 일시
					request_msg += orgSlsDt.fillSpace(6);    				   // 원거래 일시
					request_msg += String.fromCharCode(28);                    // FS(8) 원거래 승인번호
					request_msg += orgAprvNo;     								// 원거래 승인번호
					request_msg += String.fromCharCode(28);                    // FS(9) 거래일련번호
					request_msg += String.fromCharCode(28);                    // FS(10)거래구분코드 - 현금영수증 취소 사유. - [1]거래취소, [2]오류취소, [3]기타
					request_msg += "1";
					request_msg += String.fromCharCode(28);                    // FS(11)간편결제구분코드
					request_msg += String.fromCharCode(28);                    // FS(12)(포인트)WCC+포인트번호
					request_msg += String.fromCharCode(28);                    // FS(13) 포인트승인번호     
					request_msg += String.fromCharCode(28);                    // FS(14) 사업자번호
					request_msg += String.fromCharCode(28);                    // FS(15) 대표자명
					request_msg += String.fromCharCode(28);                    // FS(16) 가맹점명
					request_msg += String.fromCharCode(28);                    // FS(17) 가맹점주소
					request_msg += String.fromCharCode(28);                    // FS(18) 가맹점전화번호
					request_msg += String.fromCharCode(28);                    // FS(19) 매출전표출력여부/추가요청
					request_msg += "N";                                        // [Y] 전표출력 , N 전표출력하지 않음
					request_msg += String.fromCharCode( 3);                    // ETX

					console.log(request_msg);
					$("input[name=taRequest]").val(request_msg);
					console.log($("input[name=taRequest]").val());
					var taRequestvalue = $("input[name=taRequest]").val();
					var taRequest = {taRequest : taRequestvalue };

						$.ajax
						({
							url:"http://127.0.0.1:27098", 
							async : false,
							type:"POST",
							dataType : "jsonp",
							jsonp : "callback",
							data : { "REQ": taRequestvalue},
							success: function(data)
							{	

								var rtn = {data : data,
												taRequest : taRequest};			
								console.log("2");
								console.log(data);
								window.close();
								window.opener.gParam.fnCallback(rtn);
								if(data != null && data.RES_CD == '0000'){
									var request_msg2 = "";
									var mst = window.opener.gParam.mstlist; // 헤더정보
									var list2 = window.opener.gParam.itemlist;  // 상품코드, 판매수량, 판매가격, 판매액 리스트
									var shoplist = window.opener.gParam.shoplist; //매장정보 및 매장경영인 이름 리스트
									var paylist = data; // 
									if(paylist.INSTALLMENT == '00'){
										paylist.INSTALLMENT = "일시불";
									}
									var tot_amt = new Number(paylist.TOT_AMT);
									var total_amt = tot_amt;
									var suppamt = Math.round(tot_amt / 1.1);
									var vat = tot_amt - suppamt;
									var strvat = new String(vat);
									var message = "";
									var today = new Date();
									var year = today.getFullYear();
									var month = ('0' + (today.getMonth() + 1)).slice(-2);
									var day = ('0' + today.getDate()).slice(-2);
									var dateString = year + '/' + month  + '/' + day;
									var hours = ('0' + today.getHours()).slice(-2); 
									var minutes = ('0' + today.getMinutes()).slice(-2);
									var seconds = ('0' + today.getSeconds()).slice(-2); 
									var timeString = hours + ':' + minutes  + ':' + seconds;
									//String.fromCharCode(16); //디폴트폰트
									//String.fromCharCode(17); //굵게 (강조)
									//String.fromCharCode(18); //더블사이즈 (Height)
									//String.fromCharCode(19); //더블사이즈( width)
									//String.fromCharCode(20); //연한 밑줄
									//String.fromCharCode(21); //진한 밑줄 
									//String.fromCharCode(22); //이미지 출력(0x16)
									//String.fromCharCode(23); //BarCode 출력(0x17)
									//String.fromCharCode(24); //더블사이즈(Height, width)
									message += "L_PPRINT";  //api를 이용한 전표 출력
									message += "===========================================";        		    
									message += String.fromCharCode(16); //디폴트폰트
									message += " * [     반    품    영    수    증     ] *";
									message += String.fromCharCode(16); //디폴트폰트
									message += "===========================================";        		    
									message += String.fromCharCode(16); //디폴트폰트
									message += shoplist[0].shop_nm;
									message += String.fromCharCode(16); //디폴트폰트
									message += shoplist[0].biz_no + " "+ "TEL : "+ shoplist[0].telno + " " + shoplist[0].ceo_nm;
									message += String.fromCharCode(16); //디폴트폰트
									message += shoplist[0].addr_1;
									message += String.fromCharCode(16);
									message += String.fromCharCode(16);
									message += String.fromCharCode(16);
									message += "* 저희매장을 찾아주셔서 감사합니다 *";
									message += String.fromCharCode(16);
									if(shoplist[0].addr_2 == null){
										message += "오픈 10시 30분      마감 20시 00분";
									}else{
										message += shoplist[0].addr_2;
									}
									message += String.fromCharCode(16);
									message += "[일시] :" + dateString + " " + timeString + " " + "[POS: " + mst.pos_no + "-" + mst.sale_seq + "]";
									message += String.fromCharCode(16);
									message += "===========================================";
									message += String.fromCharCode(16);
									message += String.fromCharCode(16);
									for(i=0;i<list2.length;i++){
										var goods_cd = list2[i].goods_cd;
										var sale_price = Number(list2[i].sale_price);
										var so_qty = list2[i].so_qty;
										var sale_amt = Number(list2[i].sale_amt);
										message += goods_cd;
										message += String.fromCharCode(16);
										message += rpad(sale_price.toLocaleString('en'),15," ") + lpad(so_qty,7," ")+"개" + lpad(sale_amt.toLocaleString('en'),17," ");
										message += String.fromCharCode(16);
									};
									message += String.fromCharCode(16);
									message += "===========================================";
									message += String.fromCharCode(16);
									message += "    상품명 앞 *표시가 되어 있는 품목은 ";
									message += String.fromCharCode(16);
									message += "        부가세 면세 품목입니다. ";
									message += String.fromCharCode(16);
									message += "-------------------------------------------";
									message += String.fromCharCode(16);
									message += lpad("과세금액",27," ") + lpad(suppamt.toLocaleString('en'),10," ");
									message += String.fromCharCode(16);
									message += lpad("부 가 세",28," ") + lpad(strvat.toLocaleString('en'),10," ");
									message += String.fromCharCode(16);
									message += "-------------------------------------------";
									message += String.fromCharCode(16);
									message += String.fromCharCode(16);
									message += String.fromCharCode(16);
									message += rpad("총      액",23," ");
									message += lpad(total_amt.toLocaleString('en'),16," ");
									message += String.fromCharCode(16);
									message += rpad("합      계",23," ");
									message += lpad(tot_amt.toLocaleString('en'),16," ");
									message += String.fromCharCode(16);
									message += rpad("반 품 금 액",22," ");
									message += lpad("-"+tot_amt.toLocaleString('en'),16," ");
									message += String.fromCharCode(16);
									message += String.fromCharCode(16);
									message += "             현금결제 취소전표          ";
									message += String.fromCharCode(16);
									message += "            ==================";
									message += String.fromCharCode(16);
									message += "[등록번호] " + paylist.CARDNO + "*****";
									message += String.fromCharCode(16);
									message += "[승인번호] " + paylist.APPROVALNO;
									message += String.fromCharCode(16);
									message += "[반품금액] " + tot_amt.toLocaleString('en');
									message += String.fromCharCode(16);
									message += String.fromCharCode(16);
									message += "**교환은 영수증지참 7일이내 방문해 주세요";
									message += String.fromCharCode(16);
									message += "***반품은 절대 불가합니다. (교환증X)";
									message += String.fromCharCode(16);
									message += "===========================================";
									message += String.fromCharCode(16);
									message += mst.so_no + " " + year + month + day + " " + mst.pos_no + " "+ mst.sale_seq;
									message += String.fromCharCode(23); //바코드출력
									message += String.fromCharCode(16);
									message += String.fromCharCode(16);
	
							
									request_msg2 = message;
									console.log(request_msg2);
									$("input[name=taRequest2]").attr("value", request_msg2);
									console.log(request_msg2);
									
									$.ajax
										({
											url:"http://127.0.0.1:27098", 
											type:"POST",
											async : false,
											dataType : "jsonp",
											jsonp : "callback",
											data : { "REQ": request_msg2},
											success: function()
											{				
												console.log("통신완료");
												console.log(request_msg2);
												//json 디비깅용
												//document.getElementById("taResponse").innerText =JSON.stringify(data);
											},
											error : function(request,status,error){
												window.NEXACROHTML.FireUserNotify(request.responseText);
												alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
												console.log (error);
											}
										});
										//json 디비깅용
										//document.getElementById("taResponse").innerText =JSON.stringify(data);
												
												
								}else{
									alert("오류 발생 사유: " + data.DISPLAY);
									return;
								}
							},
							error : function(request,status,error){
								window.NEXACROHTML.FireUserNotify(request.responseText);
								alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
								console.log (error);
							}
						});
					}else if(datalist.RES_CD == "XXX3" || datalist.RES_CD == "XXX4" || datalist.RES_CD == ""){
						alert("단말기 통신 오류 : " + datalist.DISPLAY);
						return;
					}else{
						if (confirm("통신오류 : 임의등록을 진행하시겠습니까? ") == true){    //확인
							var rtn = {data : datalist,
									taRequest : taRequest};	
								window.opener.gParam.fnCallback(rtn);
								window.close();
                        }else{   //취소
							return;
                        }
						
					}
				}
			})
				
		};

		function usdcash_cancel2(){
			var request_msg = "";
			request_msg = "S_STATUS";
			$("input[name=taRequest]").attr("value", request_msg);
			var taRequestvalue = $("input[name=taRequest]").val();
			var taRequest = {taRequest : taRequestvalue };
			$.ajax
			({
				url:"http://127.0.0.1:27098", 
				type:"POST",
				async : false,
				dataType : "jsonp",
				jsonp : "callback",
				data : { "REQ": taRequestvalue },
				success: function(datalist)
				{	
					if(datalist != null && datalist.RES_CD == '0000'){
					console.log("1");
					var strSaleAmt = $("input[name=txtSlsAmt]").val();
					var orgSlsDt = $("input[name=txtCatApprDate]").val();
					var orgAprvNo = $("input[name=txtCatApprNo]").val();
					var strCsrcCnsmKd = $("input[name=txtCsrcCnsmKd]").val();

					var saleAmt = new Number(strSaleAmt);
					var suppAmt = Math.round(saleAmt / 1.1);
					var vat = saleAmt - suppAmt;
					var strVat = new String(vat);
					var request_msg = "";
					
					request_msg += "APP____1";                     			   // 메시지 창 출력하지 않음 
					request_msg += String.fromCharCode(2);                     // STX
					request_msg += "A0";									   // 거래요청전문
					request_msg += "CR";                                       // 거래종류코드
					request_msg += String.fromCharCode(28);                    // FS(1) //단말기ID
					request_msg += String.fromCharCode(28);                    // FS(2) //현금영수증 WCC + 현금고객ID
					request_msg += String.fromCharCode(28);                    // FS(3)
					request_msg += "0" + strCsrcCnsmKd;						   // 할부개월(현금영수증-([01]법인,[02]개인) / 수표조회-권종코드)
					request_msg += String.fromCharCode(28);					   // FS(4)
					request_msg += strSaleAmt;                    				// 총금액
					request_msg += String.fromCharCode(28);					   // FS(5)
					request_msg += strVat;                         				// 세금
					request_msg += String.fromCharCode(28);					   // FS(6)
					request_msg += "0";                                			// 봉사료
					request_msg += String.fromCharCode(28);					   // FS(7) 원거래 일시
					request_msg += orgSlsDt.fillSpace(6);    				   // 원거래 일시
					request_msg += String.fromCharCode(28);                    // FS(8) 원거래 승인번호
					request_msg += orgAprvNo;     								// 원거래 승인번호
					request_msg += String.fromCharCode(28);                    // FS(9) 거래일련번호
					request_msg += String.fromCharCode(28);                    // FS(10)거래구분코드 - 현금영수증 취소 사유. - [1]거래취소, [2]오류취소, [3]기타
					request_msg += "1";
					request_msg += String.fromCharCode(28);                    // FS(11)간편결제구분코드
					request_msg += String.fromCharCode(28);                    // FS(12)(포인트)WCC+포인트번호
					request_msg += String.fromCharCode(28);                    // FS(13) 포인트승인번호     
					request_msg += String.fromCharCode(28);                    // FS(14) 사업자번호
					request_msg += String.fromCharCode(28);                    // FS(15) 대표자명
					request_msg += String.fromCharCode(28);                    // FS(16) 가맹점명
					request_msg += String.fromCharCode(28);                    // FS(17) 가맹점주소
					request_msg += String.fromCharCode(28);                    // FS(18) 가맹점전화번호
					request_msg += String.fromCharCode(28);                    // FS(19) 매출전표출력여부/추가요청
					request_msg += "N";                                        // [Y] 전표출력 , N 전표출력하지 않음
					request_msg += String.fromCharCode( 3);                    // ETX

					console.log(request_msg);
					$("input[name=taRequest]").val(request_msg);
					console.log($("input[name=taRequest]").val());
					var taRequestvalue = $("input[name=taRequest]").val();
					var taRequest = {taRequest : taRequestvalue };

						$.ajax
								({
									url:"http://127.0.0.1:27098", 
									async : false,
									type:"POST",
									dataType : "jsonp",
									jsonp : "callback",
									data : { "REQ": taRequestvalue},
									success: function(data)
									{	

										var rtn = {data : data,
												   taRequest : taRequest
										};			
										console.log("2");
										console.log(data);
										window.opener.gParam.fnCallback(rtn);
										if(data != null && data.RES_CD == '0000'){
											var request_msg2 = "";
											var mst = window.opener.gParam.mstlist; // 헤더정보
											var list2 = window.opener.gParam.itemlist;  // 상품코드, 판매수량, 판매가격, 판매액 리스트
											var shoplist = window.opener.gParam.shoplist; //매장정보 및 매장경영인 이름 리스트
											var paylist = data; // 
											if(paylist.INSTALLMENT == '00'){
												paylist.INSTALLMENT = "일시불";
											}
											var tot_amt = new Number(paylist.TOT_AMT);
											var total_amt = tot_amt;
											var suppamt = Math.round(tot_amt / 1.1);
											var vat = tot_amt - suppamt;
											var strvat = new String(vat);
											var message = "";
											var today = new Date();
											var year = today.getFullYear();
											var month = ('0' + (today.getMonth() + 1)).slice(-2);
											var day = ('0' + today.getDate()).slice(-2);
											var dateString = year + '/' + month  + '/' + day;
											var hours = ('0' + today.getHours()).slice(-2); 
											var minutes = ('0' + today.getMinutes()).slice(-2);
											var seconds = ('0' + today.getSeconds()).slice(-2); 
											var timeString = hours + ':' + minutes  + ':' + seconds;
											//String.fromCharCode(16); //디폴트폰트
											//String.fromCharCode(17); //굵게 (강조)
											//String.fromCharCode(18); //더블사이즈 (Height)
											//String.fromCharCode(19); //더블사이즈( width)
											//String.fromCharCode(20); //연한 밑줄
											//String.fromCharCode(21); //진한 밑줄 
											//String.fromCharCode(22); //이미지 출력(0x16)
											//String.fromCharCode(23); //BarCode 출력(0x17)
											//String.fromCharCode(24); //더블사이즈(Height, width)
											message += "L_PPRINT";  //api를 이용한 전표 출력
											message += "===========================================";        		    
											message += String.fromCharCode(16); //디폴트폰트
											message += " * [     반    품    영    수    증     ] *";
											message += String.fromCharCode(16); //디폴트폰트
											message += "===========================================";        		    
											message += String.fromCharCode(16); //디폴트폰트
											message += "LF네트웍스_" + shoplist[0].shop_nm + "점";
											message += String.fromCharCode(16); //디폴트폰트
											message += shoplist[0].biz_no + " "+ "TEL : "+ shoplist[0].telno + " " + shoplist[0].ceo_nm;
											message += String.fromCharCode(16); //디폴트폰트
											message += shoplist[0].addr_1;
											message += String.fromCharCode(16);
											message += String.fromCharCode(16);
											message += String.fromCharCode(16);
											message += "* 저희매장을 찾아주셔서 감사합니다 *";
											message += String.fromCharCode(16);
											if(shoplist[0].addr_2 == null){
												message += "오픈 10시 30분      마감 20시 00분";
											}else{
												message += shoplist[0].addr_2;
											}
											message += String.fromCharCode(16);
											message += "[일시] :" + dateString + " " + timeString + " " + "[POS: " + mst.pos_no + "-" + mst.sale_seq + "]";
											message += String.fromCharCode(16);
											message += "===========================================";
											message += String.fromCharCode(16);
											message += String.fromCharCode(16);
											for(i=0;i<list2.length;i++){
												var goods_cd = list2[i].goods_cd;
												var sale_price = Number(list2[i].sale_price);
												var so_qty = list2[i].so_qty;
												var sale_amt = Number(list2[i].sale_amt);
												message += goods_cd;
												message += String.fromCharCode(16);
												message += rpad(sale_price.toLocaleString('en'),15," ") + lpad(so_qty,7," ")+"개" + lpad(sale_amt.toLocaleString('en'),17," ");
												message += String.fromCharCode(16);
											};
											message += String.fromCharCode(16);
											message += "===========================================";
											message += String.fromCharCode(16);
											message += "    상품명 앞 *표시가 되어 있는 품목은 ";
											message += String.fromCharCode(16);
											message += "        부가세 면세 품목입니다. ";
											message += String.fromCharCode(16);
											message += "-------------------------------------------";
											message += String.fromCharCode(16);
											message += lpad("과세금액",27," ") + lpad(suppamt.toLocaleString('en'),10," ");
											message += String.fromCharCode(16);
											message += lpad("부 가 세",28," ") + lpad(strvat.toLocaleString('en'),10," ");
											message += String.fromCharCode(16);
											message += "-------------------------------------------";
											message += String.fromCharCode(16);
											message += String.fromCharCode(16);
											message += String.fromCharCode(16);
											message += rpad("총      액",23," ");
											message += lpad(total_amt.toLocaleString('en'),16," ");
											message += String.fromCharCode(16);
											message += rpad("합      계",23," ");
											message += lpad(tot_amt.toLocaleString('en'),16," ");
											message += String.fromCharCode(16);
											message += rpad("반 품 금 액",22," ");
											message += lpad("-"+tot_amt.toLocaleString('en'),16," ");
											message += String.fromCharCode(16);
											message += String.fromCharCode(16);
											message += "             현금결제 취소전표          ";
											message += String.fromCharCode(16);
											message += "            ==================";
											message += String.fromCharCode(16);
											message += "[등록번호] " + paylist.CARDNO + "*****";
											message += String.fromCharCode(16);
											message += "[승인번호] " + paylist.APPROVALNO;
											message += String.fromCharCode(16);
											message += "[반품금액] " + tot_amt.toLocaleString('en');
											message += String.fromCharCode(16);
											message += String.fromCharCode(16);
											message += "**교환은 영수증지참 7일이내 방문해 주세요";
											message += String.fromCharCode(16);
											message += "***반품은 절대 불가합니다. (교환증X)";
											message += String.fromCharCode(16);
											message += "===========================================";
											message += String.fromCharCode(16);
											message += mst.so_no + " " + year + month + day + " " + mst.pos_no + " "+ mst.sale_seq;
											message += String.fromCharCode(23); //바코드출력
											message += String.fromCharCode(16);
											message += String.fromCharCode(16);
			
									
											request_msg2 = message;
											console.log(request_msg2);
											$("input[name=taRequest2]").attr("value", request_msg2);
											console.log(request_msg2);
											
											$.ajax
												({
													url:"http://127.0.0.1:27098", 
													type:"POST",
													async : false,
													dataType : "jsonp",
													jsonp : "callback",
													data : { "REQ": request_msg2},
													success: function()
													{				
														console.log("통신완료");
														console.log(request_msg2);
														window.close();
														//json 디비깅용
														//document.getElementById("taResponse").innerText =JSON.stringify(data);
													},
													error : function(request,status,error){
														window.NEXACROHTML.FireUserNotify(request.responseText);
														alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
														console.log (error);
													}
												});
										//json 디비깅용
										//document.getElementById("taResponse").innerText =JSON.stringify(data);
														
														
										}else{
											alert("오류 발생 사유: " + data.DISPLAY);
											return;
										}
									},
									error : function(request,status,error){
										window.NEXACROHTML.FireUserNotify(request.responseText);
										alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
										console.log (error);
									}
								});
					}else if(datalist.RES_CD == "XXX3" || datalist.RES_CD == "XXX4" || datalist.RES_CD == ""){
						alert("단말기 통신 오류 : " + datalist.DISPLAY);
						return;
					}else{
						if (confirm("통신오류 : 임의등록을 진행하시겠습니까? ") == true){    //확인
							var rtn = {data : datalist,
									taRequest : taRequest};	
								window.opener.gParam.fnCallback(rtn);
								window.close();
                        }else{   //취소
							return;
                        }
						
					}
				},

				error : function(request,status,error){
				window.NEXACROHTML.FireUserNotify(request.responseText);
				alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
				console.log (error);
				}

			})
		};
			

			$(function(){
				var payinfo = window.opener.gParam.payinfo;
				var txtSlsAmt = window.opener.gParam.payinfo.pay_amt;
				var apvRstlist = window.opener.gParam.apvRstlist;
				var mstlist = window.opener.gParam.mstlist;
				var date = mstlist.sale_dt.split('-');
				$("input[name=txtCatApprNo]").val(payinfo.doc_no);	
				$("input[name=txtSlsAmt]").val(txtSlsAmt);
				$("input[name=txtCatApprDate]").val(date);
				
			}); 
				
		</script>	
	</head>
	
	<body>
		<br><br><br>
		<td colspan="4"><input name="txtUrl" style="width:100%;" type="hidden" value="http://127.0.0.1:27098" /></td>
		<td colspan="4"><input name="taRequest"  style="width:100%;" type="hidden"></input></td>
		<td colspan="4"><input name="taRequest2"  style="width:100%;" type="hidden"></input></td>
			<table id="totalpaylist">
				<tr>
					<td style="font-size : 30px; font-weight : bold; text-align : right;">취 소 액 : </td><td><input type="text" name = "txtSlsAmt" readonly></td>
				</tr>
				<tr>
					<td style="font-size : 30px; font-weight : bold; text-align : right;">승인일자 : </td><td><input type="text" name = "txtCatApprDate" placeholder=" ex : 211030 "></td>
				</tr>
				<tr>
					<td style="font-size : 30px; font-weight : bold; text-align : right;">구분 : </td><td><input type="text" name = "txtCsrcCnsmKd"></td>
				</tr>
				<tr>
					<td style="font-size : 15px; font-weight : bold; text-align : right;">(법인 : 1 / 개인 : 2)</td>
				</tr>
				<tr>
					<td style="font-size : 30px; font-weight : bold; text-align : right;">승인번호 : </td><td><input type="text" name = "txtCatApprNo"></td>
				</tr>
				<tr style="text-align: center;">
					<td colspan="3"><button class="cash" onclick="usdcash_cancel();">자진발급 취소</button>  <button class="cashprint" onclick="usdcash_cancel2();">현금영수증 취소</button></td>
				</tr>
			</table>
	</body>	
	
</html>